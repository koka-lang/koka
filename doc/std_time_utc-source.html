<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="initial-scale=1.0" />

<style type="text/css">.koka .plaincode, .koka a.pp .pc { display: none; } .koka a.pp { color: inherit; text-decoration: none; }</style>
<link rel="stylesheet" type="text/css" href="styles/madoko.css" />
<link rel="stylesheet" type="text/css" href="styles/koka.css" />

<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Nunito:400,400italic,700,700italic" />
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700,400italic" />

<title>utc.kk documentation</title>
</head>

<body class="koka doc body madoko">
<pre class="koka source"><span class="comment">/&#42;----------------------------------------------------------------------------
   Copyright (C) 2012-2019,2020 Daan Leijen, Microsoft Corporation

   Licensed under the Apache License, Version 2.0 ("The Licence"). You may not
   use this file except in compliance with the License. A copy of the License
   can be found in the file "license.txt" at the root of this distribution.
----------------------------------------------------------------------------&#42;/</span>

<span class="comment">/&#42; UTC time scales and leap second support.

# UTC time calculation

The world's standard time scale is Universal Coordinated Time ([UTC]).
UTC is directly based on International Atomic Time ([TAI])
(&#96;ts-tai&#96;) and uses standard SI seconds. The UTC time scale differs from
TAI in that UTC stays within 1 second of [UT1](std&#95;time&#95;ut1.html); the
time scale based on the rotation of the Earth. To keep UTC close to UT1
about every 1.5 year a &#95;leap second&#95; is added to the day (appearing as
a 60th second in the last minute of the day, e.g. 23:59:60h).

In order to calculate SI second durations between time instants, we need to
know when a leap second is inserted. For example, there was a leap second
inserted on 2017-01-01Z, so:
&#96;&#96;&#96;
time(2017,1,1,0,0,0) - time(2016,12,31,23,0,0)
&#96;&#96;&#96;
equals 3601 SI seconds to account for the extra leap second. We also need to
know the inserted leap seconds to convert UTC time to TAI which forms the
basis of many other time scales (see [&#96;&#96;std/time/astro&#96;&#96;](std&#95;time&#95;astro.html)).

The occurrence of leap seconds cannot be reliably predicted though and
the IERS
usually [announces](https://www.iers.org/SharedDocs/News/EN/BulletinC.html)
leap seconds about half a year in advance. The [IETF leap second][ietfl]
table contains a list of all currently announced leap seconds. &#95;As such,
any future duration calculation in UTC is essentially non-deterministic since
it may be off by a number of (as yet unannounced) leap seconds&#95;. This means
in practice:

&#42; You cannot reliably tell how many SI seconds in the future a certain
  UTC time occurs (since there may be leap seconds inserted in the future).
  If you need to store a future date, say &#96;&#96;2020-01-01T12:00:00Z&#96;&#96;, then
  store it as an ISO calendar date (&#96;:std/time/time/time&#96;), not as a time stamp.

&#42; Do not use Unix time stamps as those may be ambigious (see &#96;unix-instant&#96;);
  this library
  already defaults to time stamps as SI seconds since &#96;epoch&#96; which are
  monotonic and unambigious. If no interaction with the user is needed,
  consider using TAI time and calendar instead.


## Effect types and future leap seconds

Since UTC time calculations depend on a leap second table (&#96;:leaps-table&#96;),
the UTC time scale can only be created from such table (&#96;ts-utc-create&#96;).
For most precise UTC time, you can use [&#96;ts-utc-load&#96;](std&#95;time&#95;download.html#ts&#95;utc&#95;load)
to automatically download and cache the latest IERS leap second information.
This can be somewhat cumbersome though as this is a function with an &#96;:io&#96; effect.

International Time ([TI]) (or &#95;Temps International&#95;) is a proposed time scale
that matches exactly UTC up to some date but with no further leap seconds
added  after that -- which makes time calculations robust and deterministic
with regard to future dates. For this reason, this library defaults to using
TI instead of UTC. The TI time scale (&#96;ts-ti&#96;) is defined
to exactly match UTC before the compiler release date (currently 2019) but
ignores any future leap seconds.


## UTC between 1961 and 1972

UTC only got integral leap seconds after 1972-01-01Z.
Before 1972, the UTC time was broadcast using a combination of
fixed time steps (i.e. &#95;mini leap seconds&#95;) and an offset from the atomic
clock frequency. By adjusting the frequency, UTC time was effectively
running at a linearly adjusted rate relative to TAI. We call this
adjustment &#95;drift&#95;. For example, between 1963-11-01Z and 1964-01-01Z
the frequency offset was -130&amp;times;10^-10^ which means UTC was running
ahead of TAI by 0.0011232 seconds per day. The drift was then defined as:

&amp;quad;(TAI-UTC) = 1.9458580 + 0.0011232&amp;times;&amp;Delta;(1962-01-01)

where the function &amp;Delta;(&#95;date&#95;) returns the number of days since
&#95;date&#95;. Therefore, the difference started as 2.6972788s (as there were
669 days between 1962-01-01 and 1963-11-01) and increased linearly up to
2.7657940s on 1964-01-01Z. For dates between 1961-01-01Z and 1972-01-01Z
the library calculates the UTC time based on the historical [USNO][dat]
drift data (see Table [#tab-utc]).

Here are some interesting time steps that occurred in this time frame:

&#42; There was a negative time step of -0.1s inserted on 1968-02-01Z:
  &#96;&#96;&#96;
  instant(1968,1,31,23,59,59,0.9).time(cal=cal-tai) == "1968-02-01T00:00:06.185682Z TAI"
  instant(1968,2,1).time(cal=cal-tai) == "1968-02-01T00:00:06.185682Z TAI"
  &#96;&#96;&#96;
  The only other negative time step was inserted on 1961-08-01Z with a
  duration of -0.05s.

&#42; On the transition to modern UTC at 1972-01-01Z there is a mini leap second of 0.107758s.
  (because the final drift just before 1971-01-01 is 9.892242s)
  &#96;&#96;&#96;
  instant(1972,1,1,0,0,9,0.99999999,cal=cal-tai).time.show(6) == "1971-12-31T23:59:60.107758Z"
  instant(1972,1,1,0,0,10,cal=cal-tai).time.show == "1972-01-01T00:00:00Z"
  &#96;&#96;&#96;

UTC was only established in 1960 (Arias and Guinot [@Arias:utc]), and the TAI
instant 1961-01-01 00:00:01.422818Z TAI was set to be UTC instant
1961-01-01Z exactly.

## UTC before 1961

The TAI timescale was established with a 1958-01-01Z epoch, where
the difference (UT2 - TAI) was set to be approximately zero[^fn-taiepoch].
In the time frame 1958 up to 1961 the relation between TAI and UTC
is not formally defined.

We can however use the time steps and frequency adjustments as broadcast by
the NIST WWV radio station (see Explanatory Supplement to the Astronomical
Almanac [@Almanac, pages [86--87][astroa]]).  Historically there were
18 20ms time steps from 1958. The frequency offset in the year 1958 is
not clear, and is described in the Supplement as  ".. an offset of &#95;about&#95;
-100&amp;times;10^-10^ during 1958".  We fixed the offset at -85&amp;times;10^-10^ in
order to have a zero difference from TAI at exactly 1958-01-01Z.

In the library, this makes UTC coincide with TAI up to 1958-01-01,
interpolated with 'drift' up to 1972-01-01, and using integral leap-seconds
after that.

Interestingly, in the time before 1961, most leap steps occurred at 19:00h
instead of at the last second of the day, for example, on 1959-01-28
there was a 0.02s leap step:
&#96;&#96;&#96;
instant(1959,1,28,19,0,0,0.50,cal=cal-tai).time.show == "1959-01-28T18:59:60.007866Z"
instant(1959,1,28,19,0,0,0.52,cal=cal-tai).time.show == "1959-01-28T19:00:00.007866Z"
&#96;&#96;&#96;
showing the seconds at 60 just before 19:00h.

## All historical leap second adjustments

Table [#tab-utc] shows all leap second time steps from 1958 up to 2017. This table
is calculated and uses historical data for time steps before 1972.

~ Begin TableFigure { #tab-utc; caption:"Leap second time steps since 1958. The function \
  &amp;Delta;(&#95;date&#95;) returns the number of days since &#95;date&#95;. Entries after \
  1972 are based on [IETF data][ietfl]. The entries before 1972 are  \
  derived from the &#95;Explanatory Supplement to the Astronomical Almanac&#95;, by \
  P. Kenneth Seidelmann [@Almanac, pages [86--87][astroa]]. Entries before 1961 are based on the \
  time steps broadcast by the NIST [WWV] radio station."}

|-------------------|--------------------------|----------------|----------------|-------------------------------------------------|-----------|
| Date (UTC) &amp;quad; | Time steps &amp;quad; &amp;quad; | (TAI--UTC)     | (TAI--UTC)     | Drift                                           | &amp;quad; Frequency |
|                   |                          | Just before\ \ | On the date&amp;quad; |                                                 | Offset    |
+:------------------|--------------------------|:---------------|:---------------|-------------------------------------------------|----------:+
| 1958-01-01        | +0                       | 0.000000       | 0.000000       | 0.000000s + 0.00073458&amp;times;&amp;Delta;(1958-01-01) | -85&amp;times;10^-10^ |
| 1958-01-15, 19:00 | +0.020                   | 0.010866       | 0.030866       | 0.020000s + 0.00073458&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -85&amp;times;10^-10^ |
| 1958-02-05, 19:00 | +0.020                   | 0.046292       | 0.066292       | 0.040000s + 0.00073458&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -85&amp;times;10^-10^ |
| 1958-02-19, 19:00 | +0.020                   | 0.076576       | 0.096576       | 0.060000s + 0.00073458&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -85&amp;times;10^-10^ |
| 1958-04-09, 19:00 | +0.020                   | 0.132570       | 0.152570       | 0.080000s + 0.00073458&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -85&amp;times;10^-10^ |
| 1958-06-11, 19:00 | +0.020                   | 0.198849       | 0.218849       | 0.100000s + 0.00073458&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -85&amp;times;10^-10^ |
| 1958-07-02, 19:00 | +0.020                   | 0.234275       | 0.254275       | 0.120000s + 0.00073458&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -85&amp;times;10^-10^ |
| 1958-07-16, 19:00 | +0.020                   | 0.264559       | 0.284559       | 0.140000s + 0.00073458&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -85&amp;times;10^-10^ |
| 1958-10-22, 19:00 | +0.020                   | 0.356548       | 0.376548       | 0.160000s + 0.00073458&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -85&amp;times;10^-10^ |
| 1958-11-26, 19:00 | +0.020                   | 0.402258       | 0.422258       | 0.180000s + 0.00073458&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -85&amp;times;10^-10^ |
| 1958-12-24, 19:00 | +0.020                   | 0.442827       | 0.462827       | 0.200000s + 0.00073458&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -85&amp;times;10^-10^ |
| 1959-01-01        | +0                       | 0.468122       | 0.468122       | 0.468122s + 0.0008640&amp;times;&amp;Delta;(1959-01-01) | -100&amp;times;10^-10^ |
| 1959-01-28, 19:00 | +0.020                   | 0.492134       | 0.512134       | 0.488122s + 0.0008640&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -100&amp;times;10^-10^ |
| 1959-02-25, 19:00 | +0.020                   | 0.536326       | 0.556326       | 0.508122s + 0.0008640&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -100&amp;times;10^-10^ |
| 1959-04-05, 19:00 | +0.020                   | 0.590022       | 0.610022       | 0.528122s + 0.0008640&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -100&amp;times;10^-10^ |
| 1959-08-26, 19:00 | +0.020                   | 0.733574       | 0.753574       | 0.548122s + 0.0008640&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -100&amp;times;10^-10^ |
| 1959-09-30, 19:00 | +0.020                   | 0.783814       | 0.803814       | 0.568122s + 0.0008640&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -100&amp;times;10^-10^ |
| 1959-11-04, 19:00 | +0.020                   | 0.834054       | 0.854054       | 0.588122s + 0.0008640&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -100&amp;times;10^-10^ |
| 1959-11-18, 19:00 | +0.020                   | 0.866150       | 0.886150       | 0.608122s + 0.0008640&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -100&amp;times;10^-10^ |
| 1959-12-16, 19:00 | +0.020                   | 0.910342       | 0.930342       | 0.628122s + 0.0008640&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -100&amp;times;10^-10^ |
| \                 |                          |                |                   |                                                                 |                    |
| 1960-01-01        | +0                       | 0.943482       | 0.943482       | 0.943482s + 0.0012960&amp;times;&amp;Delta;(1960-01-01) | -150&amp;times;10^-10^ |
| 1961-01-01        | +0.005                   | 1.417818       | 1.422818       | 1.422818s + 0.0012960&amp;times;&amp;Delta;(1961-01-01) | -150&amp;times;10^-10^ |
| 1961-08-01        | -0.050                   | 1.697570       | 1.647570       | 1.372818s + 0.0012960&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -150&amp;times;10^-10^ |
| 1962-01-01        | +0                       | 1.845858       | 1.845858       | 1.845858s + 0.0011232&amp;times;&amp;Delta;(1962-01-01) | -130&amp;times;10^-10^ |
| 1963-11-01        | +0.100                   | 2.597279       | 2.697279       | 1.945858s + 0.0011232&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -130&amp;times;10^-10^ |
| 1964-01-01        | +0                       | 2.765794       | 2.765794       | 3.240130s + 0.0012960&amp;times;&amp;Delta;(1965-01-01) | -150&amp;times;10^-10^ |
| 1964-04-01        | +0.100                   | 2.883730       | 2.983730       | 3.340130s + 0.0012960&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -150&amp;times;10^-10^ |
| 1964-09-01        | +0.100                   | 3.182018       | 3.282018       | 3.440130s + 0.0012960&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -150&amp;times;10^-10^ |
| 1965-01-01        | +0.100                   | 3.440130       | 3.540130       | 3.540130s + 0.0012960&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -150&amp;times;10^-10^ |
| 1965-03-01        | +0.100                   | 3.616594       | 3.716594       | 3.640130s + 0.0012960&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -150&amp;times;10^-10^ |
| 1965-07-01        | +0.100                   | 3.874706       | 3.974706       | 3.740130s + 0.0012960&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -150&amp;times;10^-10^ |
| 1965-09-01        | +0.100                   | 4.055058       | 4.155058       | 3.840130s + 0.0012960&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -150&amp;times;10^-10^ |
| 1966-01-01        | +0                       | 4.313170       | 4.313170       | 4.313170s + 0.0025920&amp;times;&amp;Delta;(1966-01-01) | -300&amp;times;10^-10^ |
| 1968-02-01        | -0.100                   | 6.285682       | 6.185682       | 4.213170s + 0.0025920&amp;times;&amp;Delta;(&amp;quad;&amp;quad;"&amp;quad;&amp;quad;) | -300&amp;times;10^-10^ |
| \                 |                          |                |                   |                                                                 |                    |
| 1972-01-01        | +0.107758                | 9.892242       | 10             |                                                 |            |
| 1972-07-01        | +1                       | 10             | 11             |                                                 |            |
| 1973-01-01        | +1                       | 11             | 12             |                                                 |            |
| 1974-01-01        | +1                       | 12             | 13             |                                                 |            |
| 1975-01-01        | +1                       | 13             | 14             |                                                 |            |
| 1976-01-01        | +1                       | 14             | 15             |                                                 |            |
| 1977-01-01        | +1                       | 15             | 16             |                                                 |            |
| 1978-01-01        | +1                       | 16             | 17             |                                                 |            |
| 1979-01-01        | +1                       | 17             | 18             |                                                 |            |
| 1980-01-01        | +1                       | 18             | 19             |                                                 |            |
| 1981-07-01        | +1                       | 19             | 20             |                                                 |            |
| 1982-07-01        | +1                       | 20             | 21             |                                                 |            |
| 1983-07-01        | +1                       | 21             | 22             |                                                 |            |
| 1985-07-01        | +1                       | 22             | 23             |                                                 |            |
| 1988-01-01        | +1                       | 23             | 24             |                                                 |            |
| 1990-01-01        | +1                       | 24             | 25             |                                                 |            |
| 1991-01-01        | +1                       | 25             | 26             |                                                 |            |
| 1992-07-01        | +1                       | 26             | 27             |                                                 |            |
| 1993-07-01        | +1                       | 27             | 28             |                                                 |            |
| 1994-07-01        | +1                       | 28             | 29             |                                                 |            |
| 1996-01-01        | +1                       | 29             | 30             |                                                 |            |
| 1997-07-01        | +1                       | 30             | 31             |                                                 |            |
| 1999-01-01        | +1                       | 31             | 32             |                                                 |            |
| 2006-01-01        | +1                       | 32             | 33             |                                                 |            |
| 2009-01-01        | +1                       | 33             | 34             |                                                 |            |
| 2012-07-01        | +1                       | 34             | 35             |                                                 |            |
| 2015-07-01        | +1                       | 35             | 36             |                                                 |            |
| 2017-01-01        | +1                       | 36             | 37             |                                                 |            |
|-------------------|--------------------------|----------------|----------------|-------------------------------------------------|-----------|
{white-space:nowrap; col-2-padding-left:1em; .sans-serif; }

~ End TableFigure

-- Daan Leijen, 2016.

## References { - }

~ Begin Bibliography { caption:"9" }

~~ BibItem { #Arias:utc; bibitem-label:"[1]"; searchterm:"Arias+Coordinated+universal+time+UTC+historical+background+perspectives" }
E.F.\ Arias and B.\ Guinot.
&#95;Coordinated universal time UTC: historical background and perspectives&#95;.
Journ&amp;eacute;es Syst&amp;egrave;mes de R&amp;eacute;f&amp;eacute;rence Spatio-Temporels. 2004.
[pdf][utchistory].
~~

~~ BibItem { #Almanac; bibitem-label:"[2]"; searchterm:"Explanatory+Supplement+to+the+Astronomical+Almanac" }
P.K.\ Seidelmann.
&#95;Explanatory Supplement to the Astronomical Almanac&#95;.
University Science Books, 1992. [book][astroa]
~~

~~ BibItem { #taiepoch; bibitem-label:"[3]"; searchterm:"History+of+the+Bureau+International+lHeure+Guinot" }
B.\ Guinot.
&#95;	History of the Bureau International de l'Heure&#95;.
In "Polar Motion: Historical and Scientific Problems", ASP Conference Series, Vol. 208,
Edited by Steven Dick, Dennis McCarthy, and Brian Luzum.
ISBN: 1-58381-039-0, 2000., p.175.
[pdf][taiepoch]
~~

~~ BibItem { #byear; bibitem-label:"[4]"; searchterm:"Besselian+Year+Precession+Matrix+Based+on+IAU+Lieske" }
Jay\ Lieske.
&#95;Precession Matrix Based on IAU&#95; (1976).
System of Astronomical Constants, Astronomy \&amp; Astrophysics, Vol. 73, pages 282--284. 1979.
[wikipedia](https://en.wikipedia.org/wiki/Year#Besselian&#95;year)
~~

~ End Bibliography

[^fn-taiepoch]: The difference TAI-UT2 was supposed to be zero on 1958-01-01Z TAI but different
    observatories used their own versions of UT2 leading to longitude errors
    of a "few 0.01s" [@taiepoch]. At 1958-01-01 TAI the &amp;Delta;T = TT - UT1 was 31.166s &amp;plusmn; 0.003s
    (see [historical &amp;Delta;T](http://maia.usno.navy.mil/ser7/historic&#95;deltat.data)),
    which equals 1958-01-01T00:00:00.018 UT1 time.
    When we calculate UT2 using the current definition [@Almanac, page 85]:

    &gt; UT2 = UT1 + 0.022&amp;centerdot;sin(2&amp;pi;&amp;tau;) - 0.012&amp;centerdot;cos(2&amp;pi;&amp;tau;) - 0.006&amp;centerdot;sin(4&amp;pi;&amp;tau;) + 0.007&amp;centerdot;cos(4&amp;pi;&amp;tau;)

    where &amp;tau; is the fraction of the Besselian year [@byear]:

    &gt; &amp;tau; = 1900.0 + (JD~TT~ - 2415020.31352) / 365.242198781

    we get 1958-01-01T00:00:00.013023922Z UT2. A difference of about 0.013s with TAI.


[ietfl]: https://www.ietf.org/timezones/data/leap-seconds.list
[dat]: http://maia.usno.navy.mil/ser7/tai-utc.dat
[astroa]: https://books.google.com/books?id=uJ4JhGJANb4C&amp;lpg=PA87&amp;vq=wwv&amp;pg=PA87#v=onepage&amp;q=wwv&amp;f=false
[utchistory]: https://syrte.obspm.fr/journees2004/pdf/Arias2.pdf
[taiepoch]:http://articles.adsabs.harvard.edu/cgi-bin/nph-iarticle&#95;query?2000ASPC..208..175G&amp;amp;data&#95;type=PDF&#95;HIGH&amp;amp;whole&#95;paper=YES&amp;amp;type=PRINTER&amp;amp;filetype=.pdf
[WWV]: https://www.nist.gov/time-and-frequency-services/nist-radio-stations/wwv
[UTC]: std&#95;time&#95;astro.html
[TAI]: std&#95;time&#95;astro.html
[TI]: std&#95;time&#95;astro.html
[TIpropose]: https://syrte.obspm.fr/journees2004/pdf/McCarthy2.pdf#page=4
\/
&#42;/</span>
<span class="kw">module</span> utc

<span class="kw">import</span> double
<span class="kw">import</span> ddouble
<span class="kw">import</span> parse
<span class="kw">import</span> timestamp
<span class="kw">import</span> duration
<span class="kw">import</span> instant

<span class="comment">// Return the UTC timescale with the latest leap second information.
</span><span class="decl-con" id="con_space_Utc"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_int32"><span class="tp">public</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>int32: <span class="tp">V</span></span></a> <span class="tp kw">effect</span> <span class="kw">fun</span> <span class="decl-fun" id="utc"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_hnd-source.html#type_space_clause0"><span class="tp">utc</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>hnd<span class="fslash last">/</span></span>clause0: <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp sp">(</span><span class="tp">E</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a>() <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_instant-source.html#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a></span></span>

<span class="kw">public</span> <span class="kw">fun</span> <span class="st">".default-utc"</span>( <a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">utc</span><span class="tp op">|$</span><span class="number">4589</span><span class="op">&gt;</span> <span class="op">$</span><span class="number">4588</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_utc"><span class="tp">utc</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc: <span class="tp">HX</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a>) <span class="tp kw op">:</span> <a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> {
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#int32"><span class="kw">with</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int32: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int32</span></span></a> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_hnd-source.html#clause_tail0">utc<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>hnd<span class="fslash last">/</span></span>clause<span class="dash">-</span>tail0: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">c</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">op</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">clause0</span><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">c</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>() { <a class="pp" href="#ts_ti">ts-ti<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ts<span class="dash">-</span>ti: <span class="tp">timescale</span></span></a> }
  <a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">utc</span><span class="tp op">|$</span><span class="number">4589</span><span class="op">&gt;</span> <span class="op">$</span><span class="number">4588</span></span></a>()
}

<span class="comment">/&#42;----------------------------------------------------------------------------
  Unix and NTP timestamps
----------------------------------------------------------------------------&#42;/</span>

<span class="comment">/&#42; Given a Unix time stamp in (fractional) seconds (&#96;secs&#96;) and an optional separate
fraction of seconds &#96;frac&#96; (for increased precision for nanosecond timestamps), return an &#96;:instant&#96;.
that is &#96;secs + frac&#96; seconds after the Unix epoch (&#96;&#96;1970-01-01Z&#96;&#96;).

Unfortunately, Unix time stamps are [ambigious](https://en.wikipedia.org/wiki/Unix&#95;time).
The seconds &#96;secs&#96; are interpreted as: &#96;val days = secs / 86400&#96; and &#96;val dsecs = secs % 86400&#96;,
where &#96;days&#96; is the number of days since &#96;&#96;1970-01-01Z&#96;&#96; and &#96;dsecs&#96; is the SI seconds into
the day. This means that one cannot represent a possible extra leap second since it
will look as the first second of the next day. For example, here is how the time stamps look
around the leap second of &#96;&#96;1973-01-01Z&#96;&#96;:
&#96;&#96;&#96;&#96;
&gt; instant(1972,12,31,23,59,59).unix-timestamp
94694399

&gt; instant(1972,12,31,23,59,60).unix-timestamp
94694400

&gt; instant(1973,1,1).unix-timestamp
94694400
&#96;&#96;&#96;&#96;

Internally, this library uses proper &#96;:timestamp&#96;s that &#95;can&#95; keep track of leap seconds.
To indicate a time in a leap second, you can use a fraction &#96;frac&#96; that is larger than &#96;1.0&#96;. For example:
&#96;&#96;&#96;&#96;
&gt; unix-instant(94694399.0).time
1972-12-31T23:59:59Z

&gt; unix-instant(94694399.0,1.0).time
1972-12-31T23:59:60Z

&gt; unix-instant(94694400.0).time
1973-01-01T00:00:00Z
&#96;&#96;&#96;&#96;

This works well for systems that support [&#96;&#96;CLOCK&#95;UTC&#96;&#96;](http://www.madore.org/~david/computers/unix-leap-seconds.html).
&#42;/</span>
<span class="decl-fun" id="unix_instant"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#unix_instant">unix-instant<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>unix<span class="dash">-</span>instant: <span class="tp sp">(</span><span class="tp tpp">u</span> <span class="tp kw op">:</span> <span class="tp">double</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">double</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">timescale</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>( <a class="pp">u<span class="pc">u: <span class="tp">double</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_double"><span class="tp">double</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>double: <span class="tp">V</span></span></a>, <a class="pp">frac<span class="pc">frac: <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">double</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_optional"><span class="tp">double</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <span class="number">0.0</span>, <a class="pp">ts<span class="pc">ts: <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">timescale</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_optional"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="#ts_ti">ts-ti<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ts<span class="dash">-</span>ti: <span class="tp">timescale</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_instant-source.html#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a> {
  <span class="kw">val</span> <a class="pp">t<span class="pc">t: <span class="tp">ddouble</span></span></a>    <span class="kw">=</span> <a class="pp">u<span class="pc">u: <span class="tp">double</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#ddouble">ddouble<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>ddouble: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp">frac<span class="pc">frac: <span class="tp">double</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_double-source.html#fraction">fraction<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>double<span class="fslash last">/</span></span>fraction: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">double</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#ddouble">ddouble<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>ddouble: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a>
  <span class="kw">val</span> <a class="pp">leap<span class="pc">leap: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp">frac<span class="pc">frac: <span class="tp">double</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_double-source.html#truncate">truncate<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>double<span class="fslash last">/</span></span>truncate: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">double</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#int_3">int<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int<span class="postfix">.3</span>: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>
  <a class="pp" href="#unix_instant_2">unix-instant<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>unix<span class="dash">-</span>instant<span class="postfix">.2</span>: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp tpp">leap</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">timescale</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>(<a class="pp">t<span class="pc">t: <span class="tp">ddouble</span></span></a>,<a class="pp">leap<span class="pc">leap: <span class="tp">int</span></span></a>,<a class="pp">ts<span class="pc">ts: <span class="tp">timescale</span></span></a>)
</span>}

<span class="comment">// Create an instant from raw unix seconds since the unix epoch (1970-01-01T00:00:10 TAI)
// Use a fraction &#96;&gt; 1&#96; to indicate a time inside a leap second.
</span><span class="decl-fun" id="unix_instant_1"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#unix_instant_1">unix-instant<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>unix<span class="dash">-</span>instant<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">u</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">double</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">timescale</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>( <a class="pp">u<span class="pc">u: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a>, <a class="pp">frac<span class="pc">frac: <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">double</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_optional"><span class="tp">double</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <span class="number">0.0</span>, <a class="pp">ts<span class="pc">ts: <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">timescale</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_optional"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="#ts_ti">ts-ti<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ts<span class="dash">-</span>ti: <span class="tp">timescale</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_instant-source.html#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a> {
  <span class="kw">val</span> <a class="pp">t<span class="pc">t: <span class="tp">ddouble</span></span></a>    <span class="kw">=</span> <a class="pp">u<span class="pc">u: <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#ddouble_1">ddouble<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>ddouble<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp">frac<span class="pc">frac: <span class="tp">double</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_double-source.html#fraction">fraction<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>double<span class="fslash last">/</span></span>fraction: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">double</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#ddouble">ddouble<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>ddouble: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a>
  <span class="kw">val</span> <a class="pp">leap<span class="pc">leap: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp">frac<span class="pc">frac: <span class="tp">double</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_double-source.html#truncate">truncate<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>double<span class="fslash last">/</span></span>truncate: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">double</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#int_3">int<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int<span class="postfix">.3</span>: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>
  <a class="pp" href="#unix_instant_2">unix-instant<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>unix<span class="dash">-</span>instant<span class="postfix">.2</span>: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp tpp">leap</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">timescale</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>(<a class="pp">t<span class="pc">t: <span class="tp">ddouble</span></span></a>,<a class="pp">leap<span class="pc">leap: <span class="tp">int</span></span></a>,<a class="pp">ts<span class="pc">ts: <span class="tp">timescale</span></span></a>)
</span>}

<span class="comment">// Create an instant from raw unix seconds since the unix epoch (1970-01-01T00:00:10 TAI)
// and optional leap seconds to designate instants inside a leap seconds.
</span><span class="decl-fun" id="unix_instant_2"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#unix_instant_2">unix-instant<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>unix<span class="dash">-</span>instant<span class="postfix">.2</span>: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp tpp">leap</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">timescale</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>( <a class="pp">t<span class="pc">t: <span class="tp">timespan</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#type_space_timespan"><span class="tp">timespan</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp">V</span></span></a>, <a class="pp">leap<span class="pc">leap: <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_optional"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <span class="number">0</span>, <a class="pp">ts<span class="pc">ts: <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">timescale</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_optional"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="#ts_ti">ts-ti<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ts<span class="dash">-</span>ti: <span class="tp">timescale</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_instant-source.html#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a> {
  <a class="pp" href="#ts_ti">ts-ti<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ts<span class="dash">-</span>ti: <span class="tp">timescale</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_instant-source.html#instant">instant<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>( <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#timestamp">timestamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp tpp">leap</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp">t<span class="pc">t: <span class="tp">timespan</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp" href="#unix2000">unix2000<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>unix2000: <span class="tp">timespan</span></span></a>, <a class="pp">leap<span class="pc">leap: <span class="tp">int</span></span></a>) )<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_instant-source.html#use_timescale">use-timescale<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>use<span class="dash">-</span>timescale: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">tscale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>(<a class="pp">ts<span class="pc">ts: <span class="tp">timescale</span></span></a>)
</span>}


<span class="comment">// Get a standard Unix timestamp in fractional seconds since the Unix epoch (1970-01-01Z).
// Since Unix time stamps are ambigioous,
// instants inside a leap seconds show as occurring in the second after that.
</span><span class="decl-fun" id="unix_timestamp"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#unix_timestamp">unix-timestamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>unix<span class="dash">-</span>timestamp: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a>( <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a> <span class="tp kw op">:</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_instant-source.html#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#type_space_ddouble"><span class="tp">ddouble</span><span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>ddouble: <span class="tp">V</span></span></a> {
  (<a class="pp" href="#unix2000">unix2000<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>unix2000: <span class="tp">timespan</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_instant-source.html#timestamp_in">timestamp-in<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timestamp<span class="dash">-</span>in: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">tscale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp" href="#ts_ti">ts-ti<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ts<span class="dash">-</span>ti: <span class="tp">timescale</span></span></a>)<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#unsafe_timespan_withleap">unsafe-timespan-withleap<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>timespan<span class="dash">-</span>withleap: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>)
</span>}

<span class="decl-val" id="unix2000"><span class="kw">val</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#unix2000">unix2000<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>unix2000: <span class="tp">timespan</span></span></a> <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#timespan">timespan<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp sp">(</span><span class="tp tpp">seconds</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">double</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>(<span class="number">946684800</span></span>)


<span class="comment">// Convert an NTP time in seconds since the NTP epoch (1900-01-01Z) to an instant.
// Also takes an optional &#96;leap&#96; argument if the NTP time is inside a leap second.
</span><span class="decl-fun" id="ntp_instant"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#ntp_instant">ntp-instant<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ntp<span class="dash">-</span>instant: <span class="tp sp">(</span><span class="tp tpp">ntp</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">leap</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>( <a class="pp">ntp<span class="pc">ntp: <span class="tp">ddouble</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#type_space_ddouble"><span class="tp">ddouble</span><span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>ddouble: <span class="tp">V</span></span></a>, <a class="pp">leap<span class="pc">leap: <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_optional"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <span class="number">0</span> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_instant-source.html#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a> {
  <a class="pp" href="#ts_ntp">ts-ntp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ts<span class="dash">-</span>ntp: <span class="tp">timescale</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_instant-source.html#instant">instant<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>( <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#timestamp">timestamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp tpp">leap</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp">ntp<span class="pc">ntp: <span class="tp">ddouble</span></span></a>,<a class="pp">leap<span class="pc">leap: <span class="tp">int</span></span></a>) <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> <a class="pp" href="#ntp2000">ntp2000<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ntp2000: <span class="tp">timespan</span></span></a> )
</span>}

<span class="comment">// Return the NTP time of an instant since the NTP epoch (1900-01-01)
// Since NTP time stamps are ambigious, times inside a leap second show
// as occurring in the second after the leap second.
</span><span class="decl-fun" id="ntp_timestamp"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#ntp_timestamp">ntp-timestamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ntp<span class="dash">-</span>timestamp: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a>( <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_instant-source.html#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#type_space_ddouble"><span class="tp">ddouble</span><span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>ddouble: <span class="tp">V</span></span></a> {
  <a class="pp" href="#ntp2000">ntp2000<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ntp2000: <span class="tp">timespan</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp">i<span class="pc">i: <span class="tp">instant</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_instant-source.html#timestamp_in">timestamp-in<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timestamp<span class="dash">-</span>in: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">tscale</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp" href="#ts_ntp">ts-ntp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ts<span class="dash">-</span>ntp: <span class="tp">timescale</span></span></a>)<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#unsafe_timespan_withleap">unsafe-timespan-withleap<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>timespan<span class="dash">-</span>withleap: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>
</span>}

<span class="decl-val" id="ntp2000"><span class="kw">val</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#ntp2000">ntp2000<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ntp2000: <span class="tp">timespan</span></span></a> <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#timespan">timespan<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp sp">(</span><span class="tp tpp">seconds</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">double</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>(<span class="number">3155673600</span></span>)   <span class="comment">// 2000-01-01 - 1900-01-01 in NTP seconds; = (100&#42;365 + 24)&#42;(24&#42;3600)  (24 leap days)
</span>

<span class="comment">/&#42;----------------------------------------------------------------------------
  Timescale creation
----------------------------------------------------------------------------&#42;/</span>

<span class="comment">// Create a new time scale based on UTC seconds with a given &#96;name&#96;
// and a leap second table.
</span><span class="decl-fun" id="utc_timescale"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#utc_timescale">utc-timescale<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>timescale: <span class="tp sp">(</span><span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>( <a class="pp">name<span class="pc">name: <span class="tp">string</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a>, <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_instant-source.html#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a> {
  <span class="decl-fun" id="from_tai"><span class="kw">fun</span> <a class="pp">from-tai<span class="pc">from<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">tai</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp">tai<span class="pc">tai: <span class="tp">duration</span></span></a><span class="tp kw op">:</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_duration-source.html#type_space_duration"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration: <span class="tp">V</span></span></a>)       { <a class="pp" href="#utc_from_tai">utc-from-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>from<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">tai<span class="dash">-</span>since</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>,<a class="pp">tai<span class="pc">tai: <span class="tp">duration</span></span></a>) </span>}
  <span class="decl-fun" id="to_tai"><span class="kw">fun</span> <a class="pp">to-tai<span class="pc">to<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">utc</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a>(<a class="pp">utc<span class="pc">utc: <span class="tp">timestamp</span></span></a><span class="tp kw op">:</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a>)        { <a class="pp" href="#utc_to_tai">utc-to-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>to<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">utc</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>,<a class="pp">utc<span class="pc">utc: <span class="tp">timestamp</span></span></a>) </span>}
  <span class="decl-fun" id="seconds_in_day"><span class="kw">fun</span> <a class="pp">seconds-in-day<span class="pc">seconds<span class="dash">-</span>in<span class="dash">-</span>day: <span class="tp sp">(</span><span class="tp tpp">utc</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>(<a class="pp">utc<span class="pc">utc: <span class="tp">timestamp</span></span></a><span class="tp kw op">:</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a>){ <a class="pp" href="#utc_seconds_in_day">utc-seconds-in-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>seconds<span class="dash">-</span>in<span class="dash">-</span>day: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">utc</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>,<a class="pp">utc<span class="pc">utc: <span class="tp">timestamp</span></span></a>) </span>}
  <span class="decl-fun" id="to_mjd"><span class="kw">fun</span> <a class="pp">to-mjd<span class="pc">to<span class="dash">-</span>mjd: <span class="tp sp">(</span><span class="tp tpp">utc</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">tzdelta</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a>(<a class="pp">utc<span class="pc">utc: <span class="tp">timestamp</span></span></a><span class="tp kw op">:</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a>,<a class="pp">tzdelta<span class="pc">tzdelta: <span class="tp">timespan</span></span></a><span class="tp kw op">:</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#type_space_timespan"><span class="tp">timespan</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp">V</span></span></a>){ <a class="pp" href="#utc_to_mjd">utc-to-mjd<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>to<span class="dash">-</span>mjd: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">utc</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">,</span> <span class="tp tpp">tzdelta</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>,<a class="pp">utc<span class="pc">utc: <span class="tp">timestamp</span></span></a>,<a class="pp">tzdelta<span class="pc">tzdelta: <span class="tp">timespan</span></span></a>) </span>}
  <span class="decl-fun" id="from_mjd"><span class="kw">fun</span> <a class="pp">from-mjd<span class="pc">from<span class="dash">-</span>mjd: <span class="tp sp">(</span><span class="tp tpp">days</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a>(<a class="pp">days<span class="pc">days: <span class="tp">int</span></span></a><span class="tp kw op">:</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a>,<a class="pp">frac<span class="pc">frac: <span class="tp">ddouble</span></span></a><span class="tp kw op">:</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#type_space_ddouble"><span class="tp">ddouble</span><span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>ddouble: <span class="tp">V</span></span></a>){ <a class="pp" href="#utc_from_mjd">utc-from-mjd<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>from<span class="dash">-</span>mjd: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">days</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>,<a class="pp">days<span class="pc">days: <span class="tp">int</span></span></a>,<a class="pp">frac<span class="pc">frac: <span class="tp">ddouble</span></span></a>) </span>}
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_instant-source.html#timescale_1">timescale<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">from<span class="dash">-</span>tai</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">to<span class="dash">-</span>tai</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span><span class="tp sp">,</span> <span class="tp tpp">unit</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">string</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">seconds<span class="dash">-</span>in<span class="dash">-</span>day</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">to<span class="dash">-</span>mjd2000</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">tzdelta</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">from<span class="dash">-</span>mjd2000</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tpp">days</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>(
    <a class="pp">name<span class="pc">name: <span class="tp">string</span></span></a>,
    <a class="pp">from-tai<span class="pc">from<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">tai</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>,
    <a class="pp">to-tai<span class="pc">to<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">utc</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a>,
    <span class="st">"UTC"</span>,
    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">seconds-in-day<span class="pc">seconds<span class="dash">-</span>in<span class="dash">-</span>day: <span class="tp sp">(</span><span class="tp tpp">utc</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>),
    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">to-mjd<span class="pc">to<span class="dash">-</span>mjd: <span class="tp sp">(</span><span class="tp tpp">utc</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">tzdelta</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a>),
    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">from-mjd<span class="pc">from<span class="dash">-</span>mjd: <span class="tp sp">(</span><span class="tp tpp">days</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a>)
  )
</span>}

<span class="comment">// The UTC time scale.
</span><span class="decl-fun" id="ts_utc_create"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#ts_utc_create">ts-utc-create<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ts<span class="dash">-</span>utc<span class="dash">-</span>create: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>( <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_instant-source.html#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a> {
  <a class="pp" href="#utc_timescale">utc-timescale<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>timescale: <span class="tp sp">(</span><span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>( <span class="st">"UTC"</span>, <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> )
</span>}

<span class="comment">// [Unix](https://en.wikipedia.org/wiki/Unix&#95;time) time scale is equal
// to the UTC time scale (&#96;ts-utc&#96;).
</span><span class="decl-fun" id="ts_unix_create"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#ts_unix_create">ts-unix-create<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ts<span class="dash">-</span>unix<span class="dash">-</span>create: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>( <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_instant-source.html#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a> {
  <a class="pp" href="#ts_utc_create">ts-utc-create<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ts<span class="dash">-</span>utc<span class="dash">-</span>create: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>) <span class="comment">// utc-timescale( "UNIX", leaps )
</span></span>}


<span class="comment">// [NTP](https://en.wikipedia.org/wiki/Network&#95;Time&#95;Protocol) time scale is equal
// to the UTC time scale (&#96;ts-utc&#96;).
</span><span class="decl-fun" id="ts_ntp_create"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#ts_ntp_create">ts-ntp-create<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ts<span class="dash">-</span>ntp<span class="dash">-</span>create: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>( <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_instant-source.html#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a> {
  <a class="pp" href="#ts_utc_create">ts-utc-create<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ts<span class="dash">-</span>utc<span class="dash">-</span>create: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>)
</span>}


<span class="comment">/&#42; The [TI] (&#95;International Time&#95;) time scale with a 2000-01-01Z UTC epoch.
This is the default time scale used in this library. It was a
[proposed][TIpropose] time scale at the 2004 ITU-R meeting as a replacement of UTC
without future leap seconds. In this library, we define TI to match
exactly UTC up to the compiler release date (currently 2017) but ignore any
possible future leap seconds after that date. This is the preferred time scale
in this library as it guarantees deterministic time calculations for any
future date, i.e. before 2017-01-01Z, TI == UTC, while after that, TI == TAI - 37s.
&#42;/</span>
<span class="decl-val" id="ts_ti"><span class="kw">public</span> <span class="kw">val</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#ts_ti">ts-ti<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ts<span class="dash">-</span>ti: <span class="tp">timescale</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_instant-source.html#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="#utc_timescale">utc-timescale<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>timescale: <span class="tp sp">(</span><span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>( <span class="st">""</span>, <a class="pp" href="#leaps_table_ti">leaps-table-ti<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table<span class="dash">-</span>ti: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> </span>)

<span class="comment">// [Unix](https://en.wikipedia.org/wiki/Unix&#95;time) time scale based on Unix seconds.
// It equals the &#96;ts-ti&#96; time scale.
</span><span class="decl-val" id="ts_unix"><span class="kw">public</span> <span class="kw">val</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#ts_unix">ts-unix<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ts<span class="dash">-</span>unix: <span class="tp">timescale</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_instant-source.html#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="#ts_ti">ts-ti<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ts<span class="dash">-</span>ti: <span class="tp">timescale</span></span></a></span> <span class="comment">// utc-timescale( "UNIX-TI", leaps-table-ti )
</span>
<span class="comment">// [NTP](https://en.wikipedia.org/wiki/Network&#95;Time&#95;Protocol) time scale.
// It equals the &#96;ts-ti&#96; time scale.
</span><span class="decl-val" id="ts_ntp"><span class="kw">public</span> <span class="kw">val</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#ts_ntp">ts-ntp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ts<span class="dash">-</span>ntp: <span class="tp">timescale</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_instant-source.html#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="#ts_ti">ts-ti<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ts<span class="dash">-</span>ti: <span class="tp">timescale</span></span></a></span> <span class="comment">// utc-timescale( "NTP-TI", leaps-table-ti )
</span>



<span class="comment">// Create a new smooted leap second time scale with an optional period during
// which smoothing takes place. This is 1000s for &#96;ts-utc-sls&#96;.
</span><span class="decl-fun" id="utc_sls_timescale"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#utc_sls_timescale">utc-sls-timescale<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>sls<span class="dash">-</span>timescale: <span class="tp sp">(</span><span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">smooth</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">timespan</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>( <a class="pp">name<span class="pc">name: <span class="tp">string</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a>, <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a>, <a class="pp">smooth<span class="pc">smooth: <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">timespan</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_optional"><span class="tp">timespan</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <span class="number">1000</span><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#timespan">timespan<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp sp">(</span><span class="tp tpp">seconds</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">double</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_instant-source.html#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a> {
  <span class="decl-fun" id="from_tai"><span class="kw">fun</span> <a class="pp">from-tai<span class="pc">from<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">tai</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp">tai<span class="pc">tai: <span class="tp">duration</span></span></a><span class="tp kw op">:</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_duration-source.html#type_space_duration"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration: <span class="tp">V</span></span></a>) { <a class="pp" href="#utc_sls_from_tai">utc-sls-from-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>sls<span class="dash">-</span>from<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">smooth</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp tpp">tai<span class="dash">-</span>since</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>,<a class="pp">smooth<span class="pc">smooth: <span class="tp">timespan</span></span></a>,<a class="pp">tai<span class="pc">tai: <span class="tp">duration</span></span></a>) </span>}
  <span class="decl-fun" id="to_tai"><span class="kw">fun</span> <a class="pp">to-tai<span class="pc">to<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">utc</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a>(<a class="pp">utc<span class="pc">utc: <span class="tp">timestamp</span></span></a><span class="tp kw op">:</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a>)  { <a class="pp" href="#utc_sls_to_tai">utc-sls-to-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>sls<span class="dash">-</span>to<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">smooth</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp tpp">sls</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>,<a class="pp">smooth<span class="pc">smooth: <span class="tp">timespan</span></span></a>,<a class="pp">utc<span class="pc">utc: <span class="tp">timestamp</span></span></a>) </span>}
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_instant-source.html#timescale_1">timescale<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">from<span class="dash">-</span>tai</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">to<span class="dash">-</span>tai</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span><span class="tp sp">,</span> <span class="tp tpp">unit</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">string</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">seconds<span class="dash">-</span>in<span class="dash">-</span>day</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">to<span class="dash">-</span>mjd2000</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">tzdelta</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">from<span class="dash">-</span>mjd2000</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tpp">days</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>(
    <a class="pp">name<span class="pc">name: <span class="tp">string</span></span></a>,
    <a class="pp">from-tai<span class="pc">from<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">tai</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>,
    <a class="pp">to-tai<span class="pc">to<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">utc</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a>,
    <span class="st">"UTC-SLS"</span>
  )
</span>}


<span class="comment">// Create a new UTC-SLS time scale from a provided leap second table &#96;leaps&#96;.
// Implements a UTC time scale except without ever showing leap seconds.
// UTC-SLS is equivalent to UTC except for the last 1000 seconds of a day where
// a leap second occurs. On such day, the leap second time step (positive or negative)
// is distributed over the last 1000 seconds of the day. On the full hour, UTC
// and UTC-SLS are equal again.
//
// This is a recommended time scale to use for time stamps or communication
// with other services since it avoids any potential trouble
// with leap seconds while still being quite precise.
// See also: &lt;https://www.cl.cam.ac.uk/~mgk25/time/utc-sls&gt;.
//
// You can create a UTC-SLS time scale based on the latest IETF leap second
// data using [&#96;cal-utc-sls-load&#96;](std&#95;time&#95;download.html#cal&#95;utc&#95;sls&#95;load).
</span><span class="decl-fun" id="ts_utc_sls_create"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#ts_utc_sls_create">ts-utc-sls-create<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ts<span class="dash">-</span>utc<span class="dash">-</span>sls<span class="dash">-</span>create: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>( <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_instant-source.html#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a> {
  <a class="pp" href="#utc_sls_timescale">utc-sls-timescale<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>sls<span class="dash">-</span>timescale: <span class="tp sp">(</span><span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">smooth</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">timespan</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>( <span class="st">"UTC-SLS"</span>, <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> )
</span>}

<span class="comment">// TI time scale with smoothed leap seconds.\
// Implements a TI time scale (&#96;ts-ti&#96;) except without ever showing leap seconds.
// TI-SLS is equivalent to TI except for the last 1000 seconds of a day where
// a leap second occurs. On such day, the leap second time step (positive or negative)
// is distributed over the last 1000 seconds of the day. On the full hour, TI
// and TI-SLS are equal again.
</span><span class="decl-val" id="ts_ti_sls"><span class="kw">public</span> <span class="kw">val</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#ts_ti_sls">ts-ti-sls<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ts<span class="dash">-</span>ti<span class="dash">-</span>sls: <span class="tp">timescale</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_instant-source.html#type_space_timescale"><span class="tp">timescale</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>timescale: <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="#utc_sls_timescale">utc-sls-timescale<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>sls<span class="dash">-</span>timescale: <span class="tp sp">(</span><span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">smooth</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">timespan</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timescale</span></span></a>( <span class="st">"TI-SLS"</span>, <a class="pp" href="#leaps_table_ti">leaps-table-ti<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table<span class="dash">-</span>ti: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> </span>)


<span class="comment">/&#42;----------------------------------------------------------------------------
  UTC to TAI conversion
----------------------------------------------------------------------------&#42;/</span>

<span class="decl-fun" id="utc_to_tai"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#utc_to_tai">utc-to-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>to<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">utc</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a>( <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a>, <a class="pp">utc<span class="pc">utc: <span class="tp">timestamp</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_duration-source.html#type_space_duration"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration: <span class="tp">V</span></span></a> {
  <span class="kw">val</span> <a class="pp">dtai<span class="pc">dtai: <span class="tp">timespan</span></span></a> <span class="kw">=</span> <a class="pp" href="#utc_to_delta_tai">utc-to-delta-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>to<span class="dash">-</span>delta<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">utc</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>,<a class="pp">utc<span class="pc">utc: <span class="tp">timestamp</span></span></a>)
  (<a class="pp">utc<span class="pc">utc: <span class="tp">timestamp</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> <a class="pp">dtai<span class="pc">dtai: <span class="tp">timespan</span></span></a>)<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_duration-source.html#unsafe_duration">unsafe-duration<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>duration: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a>  <span class="comment">// ok, because TAI seconds now
</span></span>}


<span class="comment">/&#42; Converting TAI time back to UTC is not straigtforward as
we need to estimate UTC at first as the leap table goes from UTC-to-TAI.
Moreover, we need to detect if we crossed over a leap second, or are
inside a leap step. Take for example the leap second of 2006-01-01
to +33. This looks like:

UTC-to-TAI-delta:                        ... +32   |   +33 ...

UTC timestamp          189388799   189388799+1  189388800
UTC 2015-12-31T23:59:     59          60   leap    00
                 ---------|-----------|xxxxxxxxxxxx|-------------
                          |           |            |
TAI 2016-01-01T00:00:     31          32           33
TAI timestamp:         189388831   189388832    189388833

In the code below, suppose &#96;tai&#96; is &#96;189388832.5&#96;.
The we estimate at first the delta &#96;dtai0&#96; to +33, so our
estimate &#96;utc0&#96; is &#96;189388799.5&#96; (just before the leap step!).
We then use &#96;utc0&#96; to get delta-TAI at that time, +32 and
set the difference &#96;diff&#96; to &#96;(33-32) == 1&#96; -- the time of the
leap second we crossed. (usually, &#96;diff&#96; is zero of course).
If the difference is positive, we then check if &#96;utc0&#96; is in the
leap period itself (instead of before it): that is the case if
the delta-TAI at &#96;utc0+diff&#96; equals &#96;dtai0&#96; again.
If we are not in a leap second, the final utc time is the
estimate plus the time of the leap period if we crossed over it, &#96;utc0+diff&#96;.
Otherwise, the same holds but we need to add &#96;diff&#96; as leap seconds,
in the example ending up as &#96;189388799.5+1&#96;.
&#42;/</span>
<span class="decl-fun" id="utc_from_tai"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#utc_from_tai">utc-from-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>from<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">tai<span class="dash">-</span>since</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>( <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a>, <a class="pp">tai-since<span class="pc">tai<span class="dash">-</span>since: <span class="tp">duration</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_duration-source.html#type_space_duration"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a> {
  <span class="kw">val</span> <a class="pp">tai<span class="pc">tai: <span class="tp">timestamp</span></span></a>   <span class="kw">=</span> <a class="pp">tai-since<span class="pc">tai<span class="dash">-</span>since: <span class="tp">duration</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_duration-source.html#timestamp">timestamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>timestamp: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>
  <span class="comment">// take tai==utc for an initial estimate
</span>  <span class="kw">val</span> <a class="pp">dtai0<span class="pc">dtai0: <span class="tp">timespan</span></span></a> <span class="kw">=</span> <a class="pp" href="#utc_to_delta_tai">utc-to-delta-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>to<span class="dash">-</span>delta<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">utc</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>,<a class="pp">tai<span class="pc">tai: <span class="tp">timestamp</span></span></a>)
  <span class="kw">val</span> <a class="pp">utc0<span class="pc">utc0: <span class="tp">timestamp</span></span></a>  <span class="kw">=</span> <a class="pp">tai<span class="pc">tai: <span class="tp">timestamp</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> <a class="pp">dtai0<span class="pc">dtai0: <span class="tp">timespan</span></span></a>
  <span class="comment">// get delta-tai at the estimate
</span>  <span class="kw">val</span> <a class="pp">dtai1<span class="pc">dtai1: <span class="tp">timespan</span></span></a> <span class="kw">=</span> <a class="pp" href="#utc_to_delta_tai">utc-to-delta-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>to<span class="dash">-</span>delta<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">utc</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>,<a class="pp">utc0<span class="pc">utc0: <span class="tp">timestamp</span></span></a>)
  <span class="comment">// check if we crossed over a leap-second moment
</span>  <span class="kw">val</span> <a class="pp">diff<span class="pc">diff: <span class="tp">ddouble</span></span></a>  <span class="kw">=</span> (<a class="pp">dtai0<span class="pc">dtai0: <span class="tp">timespan</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp">dtai1<span class="pc">dtai1: <span class="tp">timespan</span></span></a>)
  <span class="comment">// &#96;inleap&#96; is &#96;True&#96; if this time falls in the leap second gap itself
</span>  <span class="kw">val</span> <a class="pp">hasgap<span class="pc">hasgap: <span class="tp">bool</span></span></a> <span class="kw">=</span> (<a class="pp">diff<span class="pc">diff: <span class="tp">ddouble</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#round_to_prec">round-to-prec<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>round<span class="dash">-</span>to<span class="dash">-</span>prec: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">prec</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a>(<span class="number">3</span>)<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#is_pos">is-pos<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>is<span class="dash">-</span>pos: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>)  <span class="comment">// round to disregard a difference due to &#96;drift&#96;
</span>  <span class="kw">val</span> <a class="pp">inleap<span class="pc">inleap: <span class="tp">bool</span></span></a> <span class="kw">=</span> (<a class="pp">hasgap<span class="pc">hasgap: <span class="tp">bool</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#_amp__amp_">&amp;&amp;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(&amp;&amp;): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">bool</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp" href="#utc_to_delta_tai">utc-to-delta-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>to<span class="dash">-</span>delta<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">utc</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>,<a class="pp">utc0<span class="pc">utc0: <span class="tp">timestamp</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> <a class="pp">diff<span class="pc">diff: <span class="tp">ddouble</span></span></a>) <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_excl__eq_">!=<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(!=): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">dtai1<span class="pc">dtai1: <span class="tp">timespan</span></span></a>)

  <span class="kw">if</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_True"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#_excl_">!<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(!): <span class="tp sp">(</span><span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a><a class="pp">inleap<span class="pc">inleap: <span class="tp">bool</span></span></a>) <span class="kw">then</span> <a class="pp">utc0<span class="pc">utc0: <span class="tp">timestamp</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> <a class="pp">diff<span class="pc">diff: <span class="tp">ddouble</span></span></a> <span class="kw">else</span> <a class="pp">utc0<span class="pc">utc0: <span class="tp">timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#add_leap_seconds">add-leap-seconds<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>add<span class="dash">-</span>leap<span class="dash">-</span>seconds: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp">diff<span class="pc">diff: <span class="tp">ddouble</span></span></a>)
</span>}

<span class="comment">// Return &#96;Just(start,diff)&#96; if a leap second occurred in the given day
// (&#96;days&#96; after 2000-01-01) with the start time and leap second gap (&#96;diff&#96;)
</span><span class="decl-fun" id="utc_leap_in_day"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#utc_leap_in_day">utc-leap-in-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>leap<span class="dash">-</span>in<span class="dash">-</span>day: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">days</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp">timespan</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a>, <a class="pp">days<span class="pc">days: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space__lp__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#type_space_timespan"><span class="tp">timespan</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space__lp__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
  <span class="comment">// check if there is a leap second in the day
</span>  <span class="kw">val</span> <a class="pp">utc0<span class="pc">utc0: <span class="tp">timestamp</span></span></a>  <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#timestamp_days">timestamp-days<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp<span class="dash">-</span>days: <span class="tp sp">(</span><span class="tp tpp">days</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">timespan</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">leap</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp">days<span class="pc">days: <span class="tp">int</span></span></a>)
  <span class="kw">val</span> <a class="pp">utc1<span class="pc">utc1: <span class="tp">timestamp</span></span></a>  <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#timestamp_days">timestamp-days<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp<span class="dash">-</span>days: <span class="tp sp">(</span><span class="tp tpp">days</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">timespan</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">leap</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp">days<span class="pc">days: <span class="tp">int</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">1</span>)
  <span class="kw">val</span> <a class="pp">la1<span class="pc">la1: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>   <span class="kw">=</span> <a class="pp" href="#utc_to_leap_adjust">utc-to-leap-adjust<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>to<span class="dash">-</span>leap<span class="dash">-</span>adjust: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">utc</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>,<a class="pp">utc1<span class="pc">utc1: <span class="tp">timestamp</span></span></a>)
  <span class="kw">if</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_True"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><a class="pp">la1<span class="pc">la1: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><span class="kw op">.</span><a class="pp" href="#utc_start">utc-start<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>start: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#_lt_">&lt;<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(&lt;): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">utc0<span class="pc">utc0: <span class="tp">timestamp</span></span></a>) <span class="kw">then</span> <a class="pp"><span class="kw">return</span><span class="pc">return: <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp">timespan</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>

  <span class="comment">// if so, find the start and the timespan of the leap second
</span>  <span class="kw">val</span> <a class="pp">dtai0<span class="pc">dtai0: <span class="tp">timespan</span></span></a> <span class="kw">=</span> <a class="pp" href="#utc_to_delta_tai">utc-to-delta-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>to<span class="dash">-</span>delta<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">utc</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>,<a class="pp">utc0<span class="pc">utc0: <span class="tp">timestamp</span></span></a>)
  <span class="kw">val</span> <a class="pp">dtai1<span class="pc">dtai1: <span class="tp">timespan</span></span></a> <span class="kw">=</span> <a class="pp">la1<span class="pc">la1: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><span class="kw op">.</span><a class="pp" href="#delta_tai">delta-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>delta<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">la</span> <span class="tp kw op">:</span> <span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">,</span> <span class="tp tpp">utc</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>(<a class="pp">utc1<span class="pc">utc1: <span class="tp">timestamp</span></span></a>)
  <span class="kw">val</span> <a class="pp">diff<span class="pc">diff: <span class="tp">ddouble</span></span></a>  <span class="kw">=</span> (<a class="pp">dtai1<span class="pc">dtai1: <span class="tp">timespan</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp">dtai0<span class="pc">dtai0: <span class="tp">timespan</span></span></a>)<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#round_to_prec">round-to-prec<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>round<span class="dash">-</span>to<span class="dash">-</span>prec: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">prec</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a>(<span class="number">3</span>)  <span class="comment">// round to not take drift into account
</span>  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">la1<span class="pc">la1: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><span class="kw op">.</span><a class="pp" href="#utc_start">utc-start<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>start: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a>, <a class="pp">diff<span class="pc">diff: <span class="tp">ddouble</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>)
</span>}

<span class="comment">// The UTC seconds in a day
</span><span class="decl-fun" id="utc_seconds_in_day"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#utc_seconds_in_day">utc-seconds-in-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>seconds<span class="dash">-</span>in<span class="dash">-</span>day: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">utc</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>( <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a>, <a class="pp">utc<span class="pc">utc: <span class="tp">timestamp</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#type_space_timespan"><span class="tp">timespan</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp">V</span></span></a> {
  <span class="kw">match</span>(<a class="pp" href="#utc_leap_in_day">utc-leap-in-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>leap<span class="dash">-</span>in<span class="dash">-</span>day: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">days</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp">timespan</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>,<a class="pp">utc<span class="pc">utc: <span class="tp">timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#days">days<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>days: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>)) {
    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#solar_secs_per_day">solar-secs-per-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>solar<span class="dash">-</span>secs<span class="dash">-</span>per<span class="dash">-</span>day: <span class="tp">timespan</span></span></a>
    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>&#95;,<a class="pp">diff<span class="pc">diff: <span class="tp">timespan</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>) <span class="kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#solar_secs_per_day">solar-secs-per-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>solar<span class="dash">-</span>secs<span class="dash">-</span>per<span class="dash">-</span>day: <span class="tp">timespan</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp">diff<span class="pc">diff: <span class="tp">timespan</span></span></a>
  }
</span>}

<span class="comment">// Return the modified julian day since 2000-01-01 taking leap seconds into
// account that happen any time during the day
</span><span class="decl-fun" id="utc_to_mjd"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#utc_to_mjd">utc-to-mjd<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>to<span class="dash">-</span>mjd: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">utc</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">,</span> <span class="tp tpp">tzdelta</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a>( <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a>, <a class="pp">utc<span class="pc">utc: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_utc_timestamp"><span class="tp">utc-timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>timestamp: <span class="tp">V</span></span></a>, <a class="pp">tzdelta<span class="pc">tzdelta: <span class="tp">timespan</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#type_space_timespan"><span class="tp">timespan</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#type_space_ddouble"><span class="tp">ddouble</span><span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>ddouble: <span class="tp">V</span></span></a> {
  <span class="kw">val</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">days1<span class="pc">days1: <span class="tp">int</span></span></a>,<a class="pp">secs1<span class="pc">secs1: <span class="tp">ddouble</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a> <span class="kw">=</span> (<a class="pp">utc<span class="pc">utc: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> <a class="pp">tzdelta<span class="pc">tzdelta: <span class="tp">timespan</span></span></a>)<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#days_seconds">days-seconds<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>days<span class="dash">-</span>seconds: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">ddouble</span><span class="tp sp">)</span></span></a>
  <span class="kw">val</span> <a class="pp">frac<span class="pc">frac: <span class="tp">ddouble</span></span></a> <span class="kw">=</span> <span class="kw">match</span>(<a class="pp" href="#utc_leap_in_day">utc-leap-in-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>leap<span class="dash">-</span>in<span class="dash">-</span>day: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">days</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp">timespan</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>,<a class="pp">utc<span class="pc">utc: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#days">days<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>days: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>)) {
               <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> (<a class="pp">secs1<span class="pc">secs1: <span class="tp">ddouble</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp">utc<span class="pc">utc: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#leap">leap<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>leap: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#ddouble_1">ddouble<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>ddouble<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a>) <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_fs_">/<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(<span class="fslash">/</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#solar_secs_per_day">solar-secs-per-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>solar<span class="dash">-</span>secs<span class="dash">-</span>per<span class="dash">-</span>day: <span class="tp">timespan</span></span></a>
               <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">start<span class="pc">start: <span class="tp">timestamp</span></span></a>,<a class="pp">diff<span class="pc">diff: <span class="tp">timespan</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>) {
                 <span class="kw">val</span> <a class="pp">secs-in-day<span class="pc">secs<span class="dash">-</span>in<span class="dash">-</span>day: <span class="tp">ddouble</span></span></a> <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#solar_secs_per_day">solar-secs-per-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>solar<span class="dash">-</span>secs<span class="dash">-</span>per<span class="dash">-</span>day: <span class="tp">timespan</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp">diff<span class="pc">diff: <span class="tp">timespan</span></span></a>
                 <span class="kw">val</span> <a class="pp">secs<span class="pc">secs: <span class="tp">ddouble</span></span></a> <span class="kw">=</span> <span class="kw">if</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_True"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><a class="pp">utc<span class="pc">utc: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#_lt_">&lt;<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(&lt;): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">start<span class="pc">start: <span class="tp">timestamp</span></span></a>) <span class="kw">then</span> <a class="pp">secs1<span class="pc">secs1: <span class="tp">ddouble</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp">utc<span class="pc">utc: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#leap">leap<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>leap: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#ddouble_1">ddouble<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>ddouble<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a>
                                             <span class="kw">else</span> <a class="pp">secs1<span class="pc">secs1: <span class="tp">ddouble</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp">diff<span class="pc">diff: <span class="tp">timespan</span></span></a>
                 (<a class="pp">secs<span class="pc">secs: <span class="tp">ddouble</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_fs_">/<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(<span class="fslash">/</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp">secs-in-day<span class="pc">secs<span class="dash">-</span>in<span class="dash">-</span>day: <span class="tp">ddouble</span></span></a>)
               }
             }
  (<a class="pp">days1<span class="pc">days1: <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#ddouble_1">ddouble<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>ddouble<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp">frac<span class="pc">frac: <span class="tp">ddouble</span></span></a>)
</span>}

<span class="comment">// Return UTC from the modified julian day since 2000-01-01 taking leap seconds into
// account that happen any time during the day
</span><span class="decl-fun" id="utc_from_mjd"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#utc_from_mjd">utc-from-mjd<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>from<span class="dash">-</span>mjd: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">days</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a>( <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a>, <a class="pp">days<span class="pc">days: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a>, <a class="pp">frac<span class="pc">frac: <span class="tp">ddouble</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#type_space_ddouble"><span class="tp">ddouble</span><span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>ddouble: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_utc_timestamp"><span class="tp">utc-timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>timestamp: <span class="tp">V</span></span></a> {
  <span class="kw">match</span>(<a class="pp" href="#utc_leap_in_day">utc-leap-in-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>leap<span class="dash">-</span>in<span class="dash">-</span>day: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">days</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp">timespan</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>,<a class="pp">days<span class="pc">days: <span class="tp">int</span></span></a>)) {
    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#timestamp_days">timestamp-days<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp<span class="dash">-</span>days: <span class="tp sp">(</span><span class="tp tpp">days</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">timespan</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">leap</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>( <a class="pp">days<span class="pc">days: <span class="tp">int</span></span></a>, <a class="pp">frac<span class="pc">frac: <span class="tp">ddouble</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#solar_secs_per_day">solar-secs-per-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>solar<span class="dash">-</span>secs<span class="dash">-</span>per<span class="dash">-</span>day: <span class="tp">timespan</span></span></a>)
    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">start<span class="pc">start: <span class="tp">timestamp</span></span></a>,<a class="pp">diff<span class="pc">diff: <span class="tp">timespan</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>) {
      <span class="kw">val</span> <a class="pp">secs<span class="pc">secs: <span class="tp">ddouble</span></span></a> <span class="kw">=</span> <a class="pp">frac<span class="pc">frac: <span class="tp">ddouble</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#solar_secs_per_day">solar-secs-per-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>solar<span class="dash">-</span>secs<span class="dash">-</span>per<span class="dash">-</span>day: <span class="tp">timespan</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp">diff<span class="pc">diff: <span class="tp">timespan</span></span></a>)
      <span class="kw">val</span> <a class="pp">utc<span class="pc">utc: <span class="tp">timestamp</span></span></a>  <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#timestamp_days">timestamp-days<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp<span class="dash">-</span>days: <span class="tp sp">(</span><span class="tp tpp">days</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">timespan</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">leap</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp">days<span class="pc">days: <span class="tp">int</span></span></a>,<a class="pp">secs<span class="pc">secs: <span class="tp">ddouble</span></span></a>)
      <span class="kw">if</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_True"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><a class="pp">utc<span class="pc">utc: <span class="tp">timestamp</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#_lt_">&lt;<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(&lt;): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">start<span class="pc">start: <span class="tp">timestamp</span></span></a>) <span class="kw">then</span> <a class="pp">utc<span class="pc">utc: <span class="tp">timestamp</span></span></a>
      <span class="kw">elif</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_True"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><a class="pp">utc<span class="pc">utc: <span class="tp">timestamp</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#_gt_">&gt;<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(&gt;): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">start<span class="pc">start: <span class="tp">timestamp</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> <a class="pp">diff<span class="pc">diff: <span class="tp">timespan</span></span></a>) <span class="kw">then</span> <a class="pp">utc<span class="pc">utc: <span class="tp">timestamp</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> <a class="pp">diff<span class="pc">diff: <span class="tp">timespan</span></span></a>
      <span class="kw">else</span> (<a class="pp">utc<span class="pc">utc: <span class="tp">timestamp</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> <a class="pp">diff<span class="pc">diff: <span class="tp">timespan</span></span></a>)<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#add_leap_seconds">add-leap-seconds<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>add<span class="dash">-</span>leap<span class="dash">-</span>seconds: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp">diff<span class="pc">diff: <span class="tp">timespan</span></span></a>)
    }
  }
</span>}


<span class="comment">/&#42;----------------------------------------------------------------------------
  UTC-SLS to TAI conversion
----------------------------------------------------------------------------&#42;/</span>
<span class="decl-fun" id="utc_sls_leap_in_day"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#utc_sls_leap_in_day">utc-sls-leap-in-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>sls<span class="dash">-</span>leap<span class="dash">-</span>in<span class="dash">-</span>day: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">smooth</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp tpp">utc</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp">timespan</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a>, <a class="pp">smooth<span class="pc">smooth: <span class="tp">timespan</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#type_space_timespan"><span class="tp">timespan</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp">V</span></span></a>, <a class="pp">utc<span class="pc">utc: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_utc_timestamp"><span class="tp">utc-timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>timestamp: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space__lp__comma__comma__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,,,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#type_space_timespan"><span class="tp">timespan</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#type_space_timespan"><span class="tp">timespan</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space__lp__comma__comma__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,,,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
  <span class="kw">match</span>(<a class="pp" href="#utc_leap_in_day">utc-leap-in-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>leap<span class="dash">-</span>in<span class="dash">-</span>day: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">days</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp">timespan</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>, <a class="pp">utc<span class="pc">utc: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#days">days<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>days: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>)) {
    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="comment">// on non-leap days, utc-sls == utc
</span>    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">start<span class="pc">start: <span class="tp">timestamp</span></span></a>,<a class="pp">diff<span class="pc">diff: <span class="tp">timespan</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>) {
      <span class="kw">val</span> <a class="pp">smooth-start<span class="pc">smooth<span class="dash">-</span>start: <span class="tp">timestamp</span></span></a> <span class="kw">=</span> (<a class="pp">start<span class="pc">start: <span class="tp">timestamp</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> <a class="pp">smooth<span class="pc">smooth: <span class="tp">timespan</span></span></a>) <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> <a class="pp">diff<span class="pc">diff: <span class="tp">timespan</span></span></a>
      <span class="kw">val</span> <a class="pp">smooth-end<span class="pc">smooth<span class="dash">-</span>end: <span class="tp">timestamp</span></span></a>   <span class="kw">=</span> <a class="pp">start<span class="pc">start: <span class="tp">timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#add_leap_seconds">add-leap-seconds<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>add<span class="dash">-</span>leap<span class="dash">-</span>seconds: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp">diff<span class="pc">diff: <span class="tp">timespan</span></span></a>)
      <span class="kw">if</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_True"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><a class="pp">utc<span class="pc">utc: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#_lt__eq_">&lt;=<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(&lt;=): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">smooth-start<span class="pc">smooth<span class="dash">-</span>start: <span class="tp">timestamp</span></span></a>) <span class="kw">then</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="comment">// before the smoothing
</span>      <span class="kw">elif</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_True"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><a class="pp">utc<span class="pc">utc: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#_gt_">&gt;<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(&gt;): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">smooth-end<span class="pc">smooth<span class="dash">-</span>end: <span class="tp">timestamp</span></span></a>) <span class="kw">then</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="comment">// after the leap second
</span>      <span class="kw">else</span> {
        <span class="kw">val</span> <a class="pp">smooth-total<span class="pc">smooth<span class="dash">-</span>total: <span class="tp">ddouble</span></span></a> <span class="kw">=</span> <a class="pp">smooth-end<span class="pc">smooth<span class="dash">-</span>end: <span class="tp">timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#timespan_noleap">timespan-noleap<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan<span class="dash">-</span>noleap: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp">smooth-start<span class="pc">smooth<span class="dash">-</span>start: <span class="tp">timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#timespan_noleap">timespan-noleap<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan<span class="dash">-</span>noleap: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>
        <span class="kw">val</span> <a class="pp">dt<span class="pc">dt: <span class="tp">ddouble</span></span></a> <span class="kw">=</span> (<a class="pp">utc<span class="pc">utc: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#unsafe_timespan_withleap">unsafe-timespan-withleap<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>timespan<span class="dash">-</span>withleap: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp">smooth-start<span class="pc">smooth<span class="dash">-</span>start: <span class="tp">timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#timespan_noleap">timespan-noleap<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan<span class="dash">-</span>noleap: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>)
        <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space__lp__comma__comma__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,,,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">c</span><span class="tp sp">,</span><span class="tp tv">d</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tpp">thd</span> <span class="tp kw op">:</span> <span class="tp tv">c</span><span class="tp sp">,</span> <span class="tp tpp">field4</span> <span class="tp kw op">:</span> <span class="tp tv">d</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tv">c</span><span class="tp sp">,</span> <span class="tp tv">d</span><span class="tp sp">)</span></span></a><a class="pp">start<span class="pc">start: <span class="tp">timestamp</span></span></a>,<a class="pp">smooth-start<span class="pc">smooth<span class="dash">-</span>start: <span class="tp">timestamp</span></span></a>,<a class="pp">smooth-total<span class="pc">smooth<span class="dash">-</span>total: <span class="tp">ddouble</span></span></a>,<a class="pp">dt<span class="pc">dt: <span class="tp">ddouble</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space__lp__comma__comma__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,,,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">c</span><span class="tp sp">,</span><span class="tp tv">d</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tpp">thd</span> <span class="tp kw op">:</span> <span class="tp tv">c</span><span class="tp sp">,</span> <span class="tp tpp">field4</span> <span class="tp kw op">:</span> <span class="tp tv">d</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tv">c</span><span class="tp sp">,</span> <span class="tp tv">d</span><span class="tp sp">)</span></span></a>)
      }
    }
  }
</span>}

<span class="decl-fun" id="utc_sls_from_tai"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#utc_sls_from_tai">utc-sls-from-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>sls<span class="dash">-</span>from<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">smooth</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp tpp">tai<span class="dash">-</span>since</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>( <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a>, <a class="pp">smooth<span class="pc">smooth: <span class="tp">timespan</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#type_space_timespan"><span class="tp">timespan</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp">V</span></span></a>, <a class="pp">tai-since<span class="pc">tai<span class="dash">-</span>since: <span class="tp">duration</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_duration-source.html#type_space_duration"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a> {
  <span class="kw">val</span> <a class="pp">utc<span class="pc">utc: <span class="tp">timestamp</span></span></a> <span class="kw">=</span> <a class="pp" href="#utc_from_tai">utc-from-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>from<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">tai<span class="dash">-</span>since</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>,<a class="pp">tai-since<span class="pc">tai<span class="dash">-</span>since: <span class="tp">duration</span></span></a>)
  <span class="kw">match</span>(<a class="pp" href="#utc_sls_leap_in_day">utc-sls-leap-in-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>sls<span class="dash">-</span>leap<span class="dash">-</span>in<span class="dash">-</span>day: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">smooth</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp tpp">utc</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp">timespan</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>, <a class="pp">smooth<span class="pc">smooth: <span class="tp">timespan</span></span></a>, <a class="pp">utc<span class="pc">utc: <span class="tp">timestamp</span></span></a>)) {
    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> <a class="pp">utc<span class="pc">utc: <span class="tp">timestamp</span></span></a> <span class="comment">// outside smooth zone: utc-sls == utc
</span>    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space__lp__comma__comma__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,,,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">c</span><span class="tp sp">,</span><span class="tp tv">d</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tpp">thd</span> <span class="tp kw op">:</span> <span class="tp tv">c</span><span class="tp sp">,</span> <span class="tp tpp">field4</span> <span class="tp kw op">:</span> <span class="tp tv">d</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tv">c</span><span class="tp sp">,</span> <span class="tp tv">d</span><span class="tp sp">)</span></span></a>&#95;start,<a class="pp">smooth-start<span class="pc">smooth<span class="dash">-</span>start: <span class="tp">timestamp</span></span></a>,<a class="pp">smooth-total<span class="pc">smooth<span class="dash">-</span>total: <span class="tp">timespan</span></span></a>,<a class="pp">dt<span class="pc">dt: <span class="tp">timespan</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space__lp__comma__comma__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,,,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">c</span><span class="tp sp">,</span><span class="tp tv">d</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tpp">thd</span> <span class="tp kw op">:</span> <span class="tp tv">c</span><span class="tp sp">,</span> <span class="tp tpp">field4</span> <span class="tp kw op">:</span> <span class="tp tv">d</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tv">c</span><span class="tp sp">,</span> <span class="tp tv">d</span><span class="tp sp">)</span></span></a>) {
      <span class="kw">val</span> <a class="pp">frac<span class="pc">frac: <span class="tp">ddouble</span></span></a> <span class="kw">=</span> <a class="pp">dt<span class="pc">dt: <span class="tp">timespan</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_fs_">/<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(<span class="fslash">/</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp">smooth<span class="pc">smooth: <span class="tp">timespan</span></span></a>
      <a class="pp">smooth-start<span class="pc">smooth<span class="dash">-</span>start: <span class="tp">timestamp</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> (<a class="pp">frac<span class="pc">frac: <span class="tp">ddouble</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp">smooth-total<span class="pc">smooth<span class="dash">-</span>total: <span class="tp">timespan</span></span></a>)
    }
  }
</span>}

<span class="decl-fun" id="utc_sls_to_tai"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#utc_sls_to_tai">utc-sls-to-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>sls<span class="dash">-</span>to<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">smooth</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp tpp">sls</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a>( <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a>, <a class="pp">smooth<span class="pc">smooth: <span class="tp">timespan</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#type_space_timespan"><span class="tp">timespan</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp">V</span></span></a>, <a class="pp">sls<span class="pc">sls: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_utc_timestamp"><span class="tp">utc-timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>timestamp: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_duration-source.html#type_space_duration"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration: <span class="tp">V</span></span></a> {
  <span class="kw">val</span> <a class="pp">utc<span class="pc">utc: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a> <span class="kw">=</span> <span class="kw">match</span>(<a class="pp" href="#utc_sls_leap_in_day">utc-sls-leap-in-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>sls<span class="dash">-</span>leap<span class="dash">-</span>in<span class="dash">-</span>day: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">smooth</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp tpp">utc</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp">timespan</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>,<a class="pp">smooth<span class="pc">smooth: <span class="tp">timespan</span></span></a>,<a class="pp">sls<span class="pc">sls: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a>)) { <span class="comment">// sls ~ utc
</span>    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> <a class="pp">sls<span class="pc">sls: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a>  <span class="comment">// utc == utc-sls outside smooth zone
</span>    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space__lp__comma__comma__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,,,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">c</span><span class="tp sp">,</span><span class="tp tv">d</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tpp">thd</span> <span class="tp kw op">:</span> <span class="tp tv">c</span><span class="tp sp">,</span> <span class="tp tpp">field4</span> <span class="tp kw op">:</span> <span class="tp tv">d</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tv">c</span><span class="tp sp">,</span> <span class="tp tv">d</span><span class="tp sp">)</span></span></a><a class="pp">start<span class="pc">start: <span class="tp">timestamp</span></span></a>,<a class="pp">smooth-start<span class="pc">smooth<span class="dash">-</span>start: <span class="tp">timestamp</span></span></a>,<a class="pp">smooth-total<span class="pc">smooth<span class="dash">-</span>total: <span class="tp">timespan</span></span></a>,<a class="pp">dt<span class="pc">dt: <span class="tp">timespan</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space__lp__comma__comma__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,,,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">c</span><span class="tp sp">,</span><span class="tp tv">d</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tpp">thd</span> <span class="tp kw op">:</span> <span class="tp tv">c</span><span class="tp sp">,</span> <span class="tp tpp">field4</span> <span class="tp kw op">:</span> <span class="tp tv">d</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tv">c</span><span class="tp sp">,</span> <span class="tp tv">d</span><span class="tp sp">)</span></span></a>) {
      <span class="kw">val</span> <a class="pp">frac<span class="pc">frac: <span class="tp">ddouble</span></span></a>  <span class="kw">=</span> <a class="pp">dt<span class="pc">dt: <span class="tp">timespan</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_fs_">/<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(<span class="fslash">/</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp">smooth-total<span class="pc">smooth<span class="dash">-</span>total: <span class="tp">timespan</span></span></a>
      <span class="kw">val</span> <a class="pp">utc0<span class="pc">utc0: <span class="tp">timestamp</span></span></a>  <span class="kw">=</span> <a class="pp">smooth-start<span class="pc">smooth<span class="dash">-</span>start: <span class="tp">timestamp</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> (<a class="pp">frac<span class="pc">frac: <span class="tp">ddouble</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp">smooth<span class="pc">smooth: <span class="tp">timespan</span></span></a>)
      <span class="kw">if</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_True"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><a class="pp">utc0<span class="pc">utc0: <span class="tp">timestamp</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#_lt__eq_">&lt;=<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(&lt;=): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">start<span class="pc">start: <span class="tp">timestamp</span></span></a>) <span class="kw">then</span> <a class="pp">utc0<span class="pc">utc0: <span class="tp">timestamp</span></span></a> <span class="kw">else</span> {
        <span class="kw">val</span> <a class="pp">ldiff<span class="pc">ldiff: <span class="tp">ddouble</span></span></a> <span class="kw">=</span> <a class="pp">utc0<span class="pc">utc0: <span class="tp">timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#timespan_noleap">timespan-noleap<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan<span class="dash">-</span>noleap: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp">start<span class="pc">start: <span class="tp">timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#timespan_noleap">timespan-noleap<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan<span class="dash">-</span>noleap: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>
        <a class="pp">start<span class="pc">start: <span class="tp">timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#add_leap_seconds">add-leap-seconds<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>add<span class="dash">-</span>leap<span class="dash">-</span>seconds: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp">ldiff<span class="pc">ldiff: <span class="tp">ddouble</span></span></a>)
      }
    }
  }
  <a class="pp" href="#utc_to_tai">utc-to-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>to<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">utc</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>,<a class="pp">utc<span class="pc">utc: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a>)
</span>}


<span class="comment">// -----------------------------------------------------------
// Leap second table
// -----------------------------------------------------------
</span>
<span class="comment">// &#96;:utc-timestamp&#96; is UTC time since 2000-01-01
</span><span class="decl-alias" id="type_space_utc_timestamp"><span class="kw">public</span> <span class="tp kw">alias</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#type_space_utc_timestamp"><span class="tp">utc-timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>timestamp: <span class="tp">V</span></span></a> <span class="tp kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a></span>

<span class="comment">// A leap second table describes when UTC leap seconds occur.
</span><span class="decl-type" id="type_space_leaps_table"><span class="kw">abstract</span> <span class="tp kw">struct</span> <span class="decl-con" id="con_space_Leaps_table"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a>(
  <span class="kw">public</span> <span class="decl-fun" id="expire"><a class="pp">expire<span class="pc">expire: <span class="tp">instant</span></span></a></span> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_instant-source.html#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a>,
  <span class="comment">// List of adjustments, ordered from most recent to oldest (decreasing &#96;utc-start&#96;)
</span>  <span class="comment">// Each entry gives the start instant and integer leap second adjustment.
</span>  <span class="decl-fun" id="adjusts"><a class="pp">adjusts<span class="pc">adjusts: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a></span><span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="#type_space_leap_adjust"><span class="tp">leap-adjust</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leap<span class="dash">-</span>adjust: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>
</span></span>)

<span class="comment">// Leap second adjustments. For an instant &#96;i&#96; after &#96;start&#96;:\
// &#96;&#96;TAI-offset = offset + (drift &#42; days(i - drift-start))&#96;&#96;
</span><span class="decl-type" id="type_space_leap_adjust"><span class="kw">abstract</span> <span class="tp kw">struct</span> <span class="decl-con" id="con_space_Leap_adjust"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#type_space_leap_adjust"><span class="tp">leap-adjust</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leap<span class="dash">-</span>adjust: <span class="tp">V</span></span></a>(
  <span class="decl-fun" id="utc_start"><a class="pp">utc-start<span class="pc">utc<span class="dash">-</span>start: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a></span>  <span class="tp kw op">:</span> <a class="pp" href="#type_space_utc_timestamp"><span class="tp">utc-timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>timestamp: <span class="tp">V</span></span></a>,  <span class="comment">// start time in NTP seconds since epoch (2000-01-01)
</span>  <span class="decl-fun" id="offset"><a class="pp">offset<span class="pc">offset: <span class="tp">timespan</span></span></a></span>     <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#type_space_timespan"><span class="tp">timespan</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp">V</span></span></a>,       <span class="comment">// base offset
</span>  <span class="decl-fun" id="drift_start"><a class="pp">drift-start<span class="pc">drift<span class="dash">-</span>start: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a></span><span class="tp kw op">:</span> <a class="pp" href="#type_space_utc_timestamp"><span class="tp">utc-timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>timestamp: <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#timestamp0">timestamp0<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp0: <span class="tp">timestamp</span></span></a>,   <span class="comment">// start of drift adjustment
</span>  <span class="decl-fun" id="drift"><a class="pp">drift<span class="pc">drift: <span class="tp">ddouble</span></span></a></span>      <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#type_space_ddouble"><span class="tp">ddouble</span><span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>ddouble: <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>zero: <span class="tp">ddouble</span></span></a>
</span></span>)

<span class="decl-val" id="leaps_table0"><span class="kw">val</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#leaps_table0">leaps-table0<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table0: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="kw">=</span> <a class="pp" href="#con_space_Leaps_table"><span class="co">Leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>Leaps<span class="dash">-</span>table: <span class="tp sp">(</span><span class="tp tpp">expire</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">adjusts</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">leaps<span class="dash">-</span>table</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_instant-source.html#epoch">epoch<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>epoch: <span class="tp">instant</span></span></a>,<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Nil"><span class="co">[</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Nil"><span class="co">]</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a></span>)
<span class="decl-val" id="zero"><span class="kw">val</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>zero: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leap_adjust"><span class="tp">leap-adjust</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leap<span class="dash">-</span>adjust: <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="#con_space_Leap_adjust"><span class="co">Leap-adjust</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>Leap<span class="dash">-</span>adjust: <span class="tp sp">(</span><span class="tp tpp">utc<span class="dash">-</span>start</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">,</span> <span class="tp tpp">offset</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp tpp">drift<span class="dash">-</span>start</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">,</span> <span class="tp tpp">drift</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#timestamp0">timestamp0<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp0: <span class="tp">timestamp</span></span></a>,<a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#timespan0">timespan0<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan0: <span class="tp">timespan</span></span></a>,<a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#timestamp0">timestamp0<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp0: <span class="tp">timestamp</span></span></a>,<a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>zero: <span class="tp">ddouble</span></span></a></span>)

<span class="decl-fun" id="is_zero"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#is_zero">is-zero<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>is<span class="dash">-</span>zero: <span class="tp sp">(</span><span class="tp tpp">la</span> <span class="tp kw op">:</span> <span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>( <a class="pp">la<span class="pc">la: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leap_adjust"><span class="tp">leap-adjust</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leap<span class="dash">-</span>adjust: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a> {
  <a class="pp">la<span class="pc">la: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><span class="kw op">.</span><a class="pp" href="#offset">offset<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>offset: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#is_zero">is-zero<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>is<span class="dash">-</span>zero: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#_amp__amp_">&amp;&amp;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(&amp;&amp;): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">bool</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">la<span class="pc">la: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><span class="kw op">.</span><a class="pp" href="#drift">drift<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>drift: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#is_zero">is-zero<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>is<span class="dash">-</span>zero: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>
</span>}

<span class="decl-fun" id="show"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#show">show<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>show: <span class="tp sp">(</span><span class="tp tpp">l</span> <span class="tp kw op">:</span> <span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>( <a class="pp">l<span class="pc">l: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leap_adjust"><span class="tp">leap-adjust</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leap<span class="dash">-</span>adjust: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a> {
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Cons"><span class="co">[</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><a class="pp">l<span class="pc">l: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><span class="kw op">.</span><a class="pp" href="#utc_start">utc-start<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>start: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_instant-source.html#show_1">show<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>show<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">max<span class="dash">-</span>prec</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">secs<span class="dash">-</span>width</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">unit</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">string</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>,<span class="st">": offset: "</span>,<a class="pp">l<span class="pc">l: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><span class="kw op">.</span><a class="pp" href="#offset">offset<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>offset: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#show">show<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>show: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">prec</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>,<span class="st">", drift-start: "</span>,<a class="pp">l<span class="pc">l: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><span class="kw op">.</span><a class="pp" href="#drift_start">drift-start<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>drift<span class="dash">-</span>start: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_instant-source.html#show_1">show<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>show<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">max<span class="dash">-</span>prec</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">secs<span class="dash">-</span>width</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">unit</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">string</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>,<span class="st">", drift: "</span>,<a class="pp">l<span class="pc">l: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><span class="kw op">.</span><a class="pp" href="#drift">drift<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>drift: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#show">show<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>show: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">prec</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Nil"><span class="co">]</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#join_2">join<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>join<span class="postfix">.2</span>: <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">string</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>
</span>}

<span class="decl-fun" id="show_1"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#show_1">show<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>show<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>( <a class="pp">t<span class="pc">t: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a> {
  <a class="pp">t<span class="pc">t: <span class="tp">leaps<span class="dash">-</span>table</span></span></a><span class="kw op">.</span><a class="pp" href="#adjusts">adjusts<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>adjusts: <span class="tp sp">(</span><span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#map_5">map<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>map<span class="postfix">.5</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="#show">show<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>show: <span class="tp sp">(</span><span class="tp tpp">l</span> <span class="tp kw op">:</span> <span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>)<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#unlines">unlines<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>unlines: <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">string</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>
</span>}

<span class="comment">/&#42;----------------------------------------------------------------------------
  delta-TAI == TAI - UTC
----------------------------------------------------------------------------&#42;/</span>

<span class="decl-val" id="utc1958"><span class="kw">val</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#utc1958">utc1958<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc1958: <span class="tp">timestamp</span></span></a> <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#timestamp_1">timestamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">double</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">leap</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<span class="number">-1325376000</span></span>) <span class="comment">// 2000-01-01 - 1958-01-01 in NTP seconds
</span>
<span class="decl-fun" id="utc_to_delta_tai"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#utc_to_delta_tai">utc-to-delta-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>to<span class="dash">-</span>delta<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">utc</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>( <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a>, <a class="pp">utc<span class="pc">utc: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_utc_timestamp"><span class="tp">utc-timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>timestamp: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#type_space_timespan"><span class="tp">timespan</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp">V</span></span></a> {
  <a class="pp" href="#utc_to_leap_adjust">utc-to-leap-adjust<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>to<span class="dash">-</span>leap<span class="dash">-</span>adjust: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">utc</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>,<a class="pp">utc<span class="pc">utc: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a>)<span class="kw op">.</span><a class="pp" href="#delta_tai">delta-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>delta<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">la</span> <span class="tp kw op">:</span> <span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">,</span> <span class="tp tpp">utc</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>(<a class="pp">utc<span class="pc">utc: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a>)
</span>}

<span class="decl-fun" id="utc_to_leap_adjust"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#utc_to_leap_adjust">utc-to-leap-adjust<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>to<span class="dash">-</span>leap<span class="dash">-</span>adjust: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">utc</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>( <a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a>, <a class="pp">utc<span class="pc">utc: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_utc_timestamp"><span class="tp">utc-timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>timestamp: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_leap_adjust"><span class="tp">leap-adjust</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leap<span class="dash">-</span>adjust: <span class="tp">V</span></span></a> {
  <span class="kw">if</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_True"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><a class="pp">utc<span class="pc">utc: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#_lt_">&lt;<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(&lt;): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp" href="#utc1958">utc1958<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc1958: <span class="tp">timestamp</span></span></a>)
   <span class="kw">then</span> <a class="pp" href="#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>zero: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>
   <span class="kw">else</span> <a class="pp" href="#find_leap_adjust">find-leap-adjust<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>find<span class="dash">-</span>leap<span class="dash">-</span>adjust: <span class="tp sp">(</span><span class="tp tpp">utc</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">,</span> <span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>(<a class="pp">utc<span class="pc">utc: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a>,<a class="pp">leaps<span class="pc">leaps: <span class="tp">leaps<span class="dash">-</span>table</span></span></a><span class="kw op">.</span><a class="pp" href="#adjusts">adjusts<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>adjusts: <span class="tp sp">(</span><span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a>)
</span>}

<span class="decl-fun" id="find_leap_adjust"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#find_leap_adjust">find-leap-adjust<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>find<span class="dash">-</span>leap<span class="dash">-</span>adjust: <span class="tp sp">(</span><span class="tp tpp">utc</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">,</span> <span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>( <a class="pp">utc<span class="pc">utc: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_utc_timestamp"><span class="tp">utc-timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>timestamp: <span class="tp">V</span></span></a>, <a class="pp">leaps<span class="pc">leaps: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="#type_space_leap_adjust"><span class="tp">leap-adjust</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leap<span class="dash">-</span>adjust: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_leap_adjust"><span class="tp">leap-adjust</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leap<span class="dash">-</span>adjust: <span class="tp">V</span></span></a> {
  <span class="kw">match</span>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a>) {
    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Nil"><span class="co">Nil</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> <a class="pp" href="#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>zero: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a> <span class="comment">// should never happen
</span>    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Cons"><span class="co">Cons</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">la<span class="pc">la: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>,<a class="pp">earlier<span class="pc">earlier: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a>) {
      <span class="kw">if</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_True"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><a class="pp">la<span class="pc">la: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><span class="kw op">.</span><a class="pp" href="#utc_start">utc-start<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>start: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#_gt_">&gt;<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(&gt;): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">utc<span class="pc">utc: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a>)
       <span class="kw">then</span> <a class="pp" href="#find_leap_adjust">find-leap-adjust<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>find<span class="dash">-</span>leap<span class="dash">-</span>adjust: <span class="tp sp">(</span><span class="tp tpp">utc</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">,</span> <span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>(<a class="pp">utc<span class="pc">utc: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a>,<a class="pp">earlier<span class="pc">earlier: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a>)
       <span class="kw">else</span> <a class="pp">la<span class="pc">la: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>
    }
  }
</span>}

<span class="comment">// Get the leap-second adjustment &#95;delta-tai&#95; (= TAI - UTC).
// Needs the timestamp to handle &#95;drift&#95;.
</span><span class="decl-fun" id="delta_tai"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#delta_tai">delta-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>delta<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">la</span> <span class="tp kw op">:</span> <span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">,</span> <span class="tp tpp">utc</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>( <a class="pp">la<span class="pc">la: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leap_adjust"><span class="tp">leap-adjust</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leap<span class="dash">-</span>adjust: <span class="tp">V</span></span></a>, <a class="pp">utc<span class="pc">utc: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_utc_timestamp"><span class="tp">utc-timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>timestamp: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#type_space_timespan"><span class="tp">timespan</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp">V</span></span></a> {
  <span class="kw">if</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_True"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><a class="pp">la<span class="pc">la: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><span class="kw op">.</span><a class="pp" href="#drift">drift<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>drift: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#is_zero">is-zero<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>is<span class="dash">-</span>zero: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>) <span class="kw">then</span> <a class="pp">la<span class="pc">la: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><span class="kw op">.</span><a class="pp" href="#offset">offset<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>offset: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a> <span class="kw">else</span> {
    <span class="comment">// pre 1972 is a rubber leap second
</span>    <span class="kw">val</span> <a class="pp">days<span class="pc">days: <span class="tp">ddouble</span></span></a> <span class="kw">=</span> (<a class="pp">utc<span class="pc">utc: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#timespan_noleap">timespan-noleap<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan<span class="dash">-</span>noleap: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp">la<span class="pc">la: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><span class="kw op">.</span><a class="pp" href="#drift_start">drift-start<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>drift<span class="dash">-</span>start: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#timespan_noleap">timespan-noleap<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan<span class="dash">-</span>noleap: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>) <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_fs_">/<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(<span class="fslash">/</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#solar_secs_per_day">solar-secs-per-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>solar<span class="dash">-</span>secs<span class="dash">-</span>per<span class="dash">-</span>day: <span class="tp">timespan</span></span></a>
    <a class="pp">la<span class="pc">la: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><span class="kw op">.</span><a class="pp" href="#offset">offset<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>offset: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> (<a class="pp">la<span class="pc">la: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><span class="kw op">.</span><a class="pp" href="#drift">drift<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>drift: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp">days<span class="pc">days: <span class="tp">ddouble</span></span></a>)
  }
</span>}


<span class="comment">/&#42;----------------------------------------------------------------------------
  Default leap tables
----------------------------------------------------------------------------&#42;/</span>

<span class="comment">// Leap second table upto (but not including) 1972-01-01 UTC
</span><span class="decl-val" id="leaps_table_pre1972"><span class="kw">public</span> <span class="kw">val</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#leaps_table_pre1972">leaps-table-pre1972<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table<span class="dash">-</span>pre1972: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a> <span class="kw">=</span> {
  <a class="pp" href="#parse_leap_seconds_dat">parse-leap-seconds-dat<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>parse<span class="dash">-</span>leap<span class="dash">-</span>seconds<span class="dash">-</span>dat: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">leaps<span class="dash">-</span>table</span></span></a>( <a class="pp" href="#default_leap_seconds_pre72">default-leap-seconds-pre72<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>default<span class="dash">-</span>leap<span class="dash">-</span>seconds<span class="dash">-</span>pre72: <span class="tp">string</span></span></a> )
</span>}

<span class="comment">// Default TI leaps table has leap second information up to the compiler release (currently &#96;leaps-table-y2017&#96;).
</span><span class="decl-val" id="leaps_table_ti"><span class="kw">public</span> <span class="kw">val</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#leaps_table_ti">leaps-table-ti<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table<span class="dash">-</span>ti: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a> <span class="kw">=</span> {
  <span class="kw">val</span> <a class="pp">post72<span class="pc">post72: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="kw">=</span> <a class="pp" href="#parse_leap_seconds">parse-leap-seconds<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>parse<span class="dash">-</span>leap<span class="dash">-</span>seconds: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">leaps<span class="dash">-</span>table</span></span></a>( <a class="pp" href="#default_ietf_leap_seconds">default-ietf-leap-seconds<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>default<span class="dash">-</span>ietf<span class="dash">-</span>leap<span class="dash">-</span>seconds: <span class="tp">string</span></span></a> )
  <a class="pp">post72<span class="pc">post72: <span class="tp">leaps<span class="dash">-</span>table</span></span></a><span class="kw op">.</span><a class="pp" href="#extend">extend<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>extend: <span class="tp sp">(</span><span class="tp tpp">leap1</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">leap2</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">leaps<span class="dash">-</span>table</span></span></a>(<a class="pp" href="#leaps_table_pre1972">leaps-table-pre1972<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table<span class="dash">-</span>pre1972: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>)
</span>}

<span class="comment">// Leap second table up to 2017-01-01Z.
</span><span class="decl-val" id="leaps_table_y2017"><span class="kw">public</span> <span class="kw">val</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#leaps_table_y2017">leaps-table-y2017<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table<span class="dash">-</span>y2017: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="#leaps_table_ti">leaps-table-ti<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table<span class="dash">-</span>ti: <span class="tp">leaps<span class="dash">-</span>table</span></span></a><span class="kw op">.</span><a class="pp" href="#upto">upto<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>upto: <span class="tp sp">(</span><span class="tp tpp">lt</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">end</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">leaps<span class="dash">-</span>table</span></span></a>(<span class="number">536544000</span><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#timestamp_1">timestamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">double</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">leap</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a></span>)  <span class="comment">// == instant(2017,1,1).timestamp(ts-ti)
</span>
<span class="decl-fun" id="extend"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#extend">extend<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>extend: <span class="tp sp">(</span><span class="tp tpp">leap1</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">leap2</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">leaps<span class="dash">-</span>table</span></span></a>(<a class="pp">leap1<span class="pc">leap1: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a>, <a class="pp">leap2<span class="pc">leap2: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a>) <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a> {
  <span class="kw">match</span>(<a class="pp">leap1<span class="pc">leap1: <span class="tp">leaps<span class="dash">-</span>table</span></span></a><span class="kw op">.</span><a class="pp" href="#adjusts">adjusts<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>adjusts: <span class="tp sp">(</span><span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#reverse">reverse<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>reverse: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>) {
    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Nil"><span class="co">Nil</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> <a class="pp">leap2<span class="pc">leap2: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>
    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Cons"><span class="co">Cons</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">la<span class="pc">la: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>,&#95;) <span class="kw op">-></span>
      <a class="pp">leap1<span class="pc">leap1: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>( adjusts <span class="kw">=</span> <a class="pp">leap1<span class="pc">leap1: <span class="tp">leaps<span class="dash">-</span>table</span></span></a><span class="kw op">.</span><a class="pp" href="#adjusts">adjusts<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>adjusts: <span class="tp sp">(</span><span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#_plus__4">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+)<span class="postfix">.4</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">ys</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <a class="pp">leap2<span class="pc">leap2: <span class="tp">leaps<span class="dash">-</span>table</span></span></a><span class="kw op">.</span><a class="pp" href="#upto">upto<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>upto: <span class="tp sp">(</span><span class="tp tpp">lt</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">end</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">leaps<span class="dash">-</span>table</span></span></a>(<a class="pp">la<span class="pc">la: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><span class="kw op">.</span><a class="pp" href="#utc_start">utc-start<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>start: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> <span class="number">1</span><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#timespan">timespan<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp sp">(</span><span class="tp tpp">seconds</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">double</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>)<span class="kw op">.</span><a class="pp" href="#adjusts">adjusts<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>adjusts: <span class="tp sp">(</span><span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a> )
  }
</span>}

<span class="decl-fun" id="upto"><span class="kw">private</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#upto">upto<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>upto: <span class="tp sp">(</span><span class="tp tpp">lt</span> <span class="tp kw op">:</span> <span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">,</span> <span class="tp tpp">end</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">leaps<span class="dash">-</span>table</span></span></a>( <a class="pp">lt<span class="pc">lt: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a>, <a class="pp">end<span class="pc">end: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_utc_timestamp"><span class="tp">utc-timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>timestamp: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a> {
  <a class="pp">lt<span class="pc">lt: <span class="tp">leaps<span class="dash">-</span>table</span></span></a>( adjusts <span class="kw">=</span> <a class="pp">lt<span class="pc">lt: <span class="tp">leaps<span class="dash">-</span>table</span></span></a><span class="kw op">.</span><a class="pp" href="#adjusts">adjusts<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>adjusts: <span class="tp sp">(</span><span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#drop_while">drop-while<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>drop<span class="dash">-</span>while: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">predicate</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<span class="kw">fn</span>(<a class="pp">la<span class="pc">la: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>) { <a class="pp">la<span class="pc">la: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><span class="kw op">.</span><a class="pp" href="#utc_start">utc-start<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>start: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#_gt_">&gt;<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(&gt;): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">end<span class="pc">end: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a> }) )
</span>}

<span class="comment">// Get a list of leap second steps in a triple, NTP start time, offset just before, and the new offset at that time,
// the base offset, the drift start date and the drift rate.
</span><span class="decl-fun" id="get_leap_steps"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#get_leap_steps">get-leap-steps<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>get<span class="dash">-</span>leap<span class="dash">-</span>steps: <span class="tp sp">(</span><span class="tp tpp">table</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">,</span> <span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp sp">(</span><span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">,</span> <span class="tp">ddouble</span><span class="tp sp">)</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">table<span class="pc">table: <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_optional"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="#leaps_table_ti">leaps-table-ti<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table<span class="dash">-</span>ti: <span class="tp">leaps<span class="dash">-</span>table</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space__lp__comma__comma__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,,,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="#type_space_utc_timestamp"><span class="tp">utc-timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>timestamp: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#type_space_timespan"><span class="tp">timespan</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#type_space_timespan"><span class="tp">timespan</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space__lp__comma__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#type_space_timespan"><span class="tp">timespan</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp" href="#type_space_utc_timestamp"><span class="tp">utc-timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>timestamp: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#type_space_ddouble"><span class="tp">ddouble</span><span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>ddouble: <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space__lp__comma__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space__lp__comma__comma__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,,,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
  <span class="kw">val</span> <a class="pp">adjusts<span class="pc">adjusts: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a> <span class="kw">=</span> <a class="pp">table<span class="pc">table: <span class="tp">leaps<span class="dash">-</span>table</span></span></a><span class="kw op">.</span><a class="pp" href="#adjusts">adjusts<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>adjusts: <span class="tp sp">(</span><span class="tp">leaps<span class="dash">-</span>table</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#reverse">reverse<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>reverse: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#zip">zip<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>zip: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">ys</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Cons"><span class="co">Cons</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>zero: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>,<a class="pp">adjusts<span class="pc">adjusts: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a>),<a class="pp">adjusts<span class="pc">adjusts: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a>)<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#map_5">map<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>map<span class="postfix">.5</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>( <span class="kw">fn</span>(<a class="pp">las<span class="pc">las: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">,</span> <span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span></span></a>) {
    <span class="kw">val</span> <a class="pp">start<span class="pc">start: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a> <span class="kw">=</span> <a class="pp">las<span class="pc">las: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">,</span> <span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#snd">snd<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>snd: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">b</span></span></a><span class="kw op">.</span><a class="pp" href="#utc_start">utc-start<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>start: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a>
    <span class="kw">val</span> <a class="pp">ofs1<span class="pc">ofs1: <span class="tp">timespan</span></span></a> <span class="kw">=</span> <a class="pp">las<span class="pc">las: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">,</span> <span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#fst">fst<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>fst: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span></span></a><span class="kw op">.</span><a class="pp" href="#delta_tai">delta-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>delta<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">la</span> <span class="tp kw op">:</span> <span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">,</span> <span class="tp tpp">utc</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>(<a class="pp">start<span class="pc">start: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a>)
    <span class="kw">val</span> <a class="pp">ofs2<span class="pc">ofs2: <span class="tp">timespan</span></span></a> <span class="kw">=</span> <a class="pp">las<span class="pc">las: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">,</span> <span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#snd">snd<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>snd: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">b</span></span></a><span class="kw op">.</span><a class="pp" href="#delta_tai">delta-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>delta<span class="dash">-</span>tai: <span class="tp sp">(</span><span class="tp tpp">la</span> <span class="tp kw op">:</span> <span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">,</span> <span class="tp tpp">utc</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>(<a class="pp">start<span class="pc">start: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a>)
    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space__lp__comma__comma__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,,,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">c</span><span class="tp sp">,</span><span class="tp tv">d</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tpp">thd</span> <span class="tp kw op">:</span> <span class="tp tv">c</span><span class="tp sp">,</span> <span class="tp tpp">field4</span> <span class="tp kw op">:</span> <span class="tp tv">d</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tv">c</span><span class="tp sp">,</span> <span class="tp tv">d</span><span class="tp sp">)</span></span></a><a class="pp">start<span class="pc">start: <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a>,<a class="pp">ofs1<span class="pc">ofs1: <span class="tp">timespan</span></span></a>,<a class="pp">ofs2<span class="pc">ofs2: <span class="tp">timespan</span></span></a>,<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space__lp__comma__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">c</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tpp">thd</span> <span class="tp kw op">:</span> <span class="tp tv">c</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tv">c</span><span class="tp sp">)</span></span></a><a class="pp">las<span class="pc">las: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">,</span> <span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#snd">snd<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>snd: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">b</span></span></a><span class="kw op">.</span><a class="pp" href="#offset">offset<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>offset: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>,<a class="pp">las<span class="pc">las: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">,</span> <span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#snd">snd<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>snd: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">b</span></span></a><span class="kw op">.</span><a class="pp" href="#drift_start">drift-start<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>drift<span class="dash">-</span>start: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a>,<a class="pp">las<span class="pc">las: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">,</span> <span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#snd">snd<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>snd: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">b</span></span></a><span class="kw op">.</span><a class="pp" href="#drift">drift<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>drift: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space__lp__comma__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">c</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tpp">thd</span> <span class="tp kw op">:</span> <span class="tp tv">c</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tv">c</span><span class="tp sp">)</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space__lp__comma__comma__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,,,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">c</span><span class="tp sp">,</span><span class="tp tv">d</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tpp">thd</span> <span class="tp kw op">:</span> <span class="tp tv">c</span><span class="tp sp">,</span> <span class="tp tpp">field4</span> <span class="tp kw op">:</span> <span class="tp tv">d</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tv">c</span><span class="tp sp">,</span> <span class="tp tv">d</span><span class="tp sp">)</span></span></a>
  })
</span>}

<span class="comment">// -----------------------------------------------------------
// Parsing UTC leap second tables
// -----------------------------------------------------------
</span>
<span class="comment">// Parse a leap second table from text &#96;leaps&#96; in the  [IETF leap second](https://www.ietf.org/timezones/data/leap-seconds.list)
// file format.
</span>
<span class="decl-fun" id="parse_leap_seconds"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#parse_leap_seconds">parse-leap-seconds<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>parse<span class="dash">-</span>leap<span class="dash">-</span>seconds: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">leaps<span class="dash">-</span>table</span></span></a>( <a class="pp">leaps<span class="pc">leaps: <span class="tp">string</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a> {
  <span class="kw">val</span> <a class="pp">adjusts<span class="pc">adjusts: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a> <span class="kw">=</span> <a class="pp">leaps<span class="pc">leaps: <span class="tp">string</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#lines">lines<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>lines: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">string</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#flatmap_maybe">flatmap-maybe<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>flatmap<span class="dash">-</span>maybe: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="#parse_leap">parse-leap<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>parse<span class="dash">-</span>leap: <span class="tp sp">(</span><span class="tp tpp">line</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a>)<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#reverse">reverse<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>reverse: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
  <span class="kw">val</span> <a class="pp">expire<span class="pc">expire: <span class="tp">instant</span></span></a> <span class="kw">=</span> <a class="pp" href="#parse_leap_expire">parse-leap-expire<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>parse<span class="dash">-</span>leap<span class="dash">-</span>expire: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">adjusts</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">string</span></span></a>,<a class="pp">adjusts<span class="pc">adjusts: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a>)
  <a class="pp" href="#con_space_Leaps_table"><span class="co">Leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>Leaps<span class="dash">-</span>table: <span class="tp sp">(</span><span class="tp tpp">expire</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">adjusts</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">leaps<span class="dash">-</span>table</span></span></a>(<a class="pp">expire<span class="pc">expire: <span class="tp">instant</span></span></a>,<a class="pp">adjusts<span class="pc">adjusts: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a>)
</span>}

<span class="decl-fun" id="parse_leap"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#parse_leap">parse-leap<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>parse<span class="dash">-</span>leap: <span class="tp sp">(</span><span class="tp tpp">line</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">line<span class="pc">line: <span class="tp">string</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="#type_space_leap_adjust"><span class="tp">leap-adjust</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leap<span class="dash">-</span>adjust: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
  <span class="kw">if</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_True"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><a class="pp">line<span class="pc">line: <span class="tp">string</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#trim_left_1">trim-left<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>trim<span class="dash">-</span>left<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">sub</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>(<span class="st">" "</span>)<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#starts_with">starts-with<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>starts<span class="dash">-</span>with: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">pre</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">sslice</span><span class="tp sp">&gt;</span></span></a>(<span class="st">"#"</span>)<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#bool_1">bool<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">m</span> <span class="tp kw op">:</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>)
   <span class="kw">then</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
   <span class="kw">else</span> <a class="pp">line<span class="pc">line: <span class="tp">string</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#slice">slice<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>slice: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">sslice</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#parse">parse<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>parse: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">input0</span> <span class="tp kw op">:</span> <span class="tp">sslice</span><span class="tp sp">,</span> <span class="tp tpp">p</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">parse</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">parse<span class="dash">-</span>error</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="#pleap">pleap<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>pleap: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>)<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#maybe">maybe<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>maybe: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">perr</span> <span class="tp kw op">:</span> <span class="tp">parse<span class="dash">-</span>error</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
</span>}

<span class="decl-fun" id="pleap"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#pleap">pleap<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>pleap: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>() <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#type_space_parse"><span class="tp">parse</span><span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>parse: <span class="tp">HX</span></span></a> <a class="pp" href="#type_space_leap_adjust"><span class="tp">leap-adjust</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leap<span class="dash">-</span>adjust: <span class="tp">V</span></span></a> {
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#whitespace0">whitespace0<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>whitespace0: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">string</span></span></a>()
  <span class="kw">val</span> <a class="pp">ntpsecs<span class="pc">ntpsecs: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#pint">pint<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>pint: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">int</span></span></a>()
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#whitespace">whitespace<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>whitespace: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">string</span></span></a>()
  <span class="kw">val</span> <a class="pp">adjust<span class="pc">adjust: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#pint">pint<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>pint: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">int</span></span></a>()
  <span class="comment">// trace("leap entry: " + adjust.show + " - " + ntpsecs.show )
</span>  <a class="pp" href="#con_space_Leap_adjust"><span class="co">Leap-adjust</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>Leap<span class="dash">-</span>adjust: <span class="tp sp">(</span><span class="tp tpp">utc<span class="dash">-</span>start</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">,</span> <span class="tp tpp">offset</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp tpp">drift<span class="dash">-</span>start</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">drift</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">ddouble</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#timestamp">timestamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp tpp">leap</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp">ntpsecs<span class="pc">ntpsecs: <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#timespan">timespan<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp sp">(</span><span class="tp tpp">seconds</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">double</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp" href="#ntp2000">ntp2000<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ntp2000: <span class="tp">timespan</span></span></a>), <a class="pp">adjust<span class="pc">adjust: <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#timespan">timespan<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp sp">(</span><span class="tp tpp">seconds</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">double</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>, <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#timestamp0">timestamp0<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp0: <span class="tp">timestamp</span></span></a>, <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#timespan0">timespan0<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan0: <span class="tp">timespan</span></span></a>)
</span>}

<span class="comment">/&#42;
public fun parse-leap-seconds( leaps : string ) : leaps-table {
  // get leap second adjustments
  val adjusts = leaps.find-all(rxleap).map fn(cap) {
    val ntpsecs = cap.groups[1].parse-int-default(0)
    val adjust  = cap.groups[2].parse-int-default(0)
    // trace("leap entry: " + adjust.show + " - " + ntpsecs.show )
    Leap-adjust(timestamp(ntpsecs.timespan - ntp2000), adjust.timespan, timestamp0, timespan0)
  }.reverse

  val expire = parse-leap-expire(leaps,adjusts)
  val table = Leaps-table(expire,adjusts)
  table
}
val rxleap   = regex(@"^[ \t]&#42;(\d+)[ \t]+(\d+)[ \t]&#42;(?:#.&#42;)?$",multiLine=True)
&#42;/</span>

<span class="comment">// IETF leap second data valid until 2017-06-28
</span><span class="decl-val" id="default_ietf_leap_seconds"><span class="kw">val</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#default_ietf_leap_seconds">default-ietf-leap-seconds<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>default<span class="dash">-</span>ietf<span class="dash">-</span>leap<span class="dash">-</span>seconds: <span class="tp">string</span></span></a> <span class="kw">=</span> <span class="st">"\n  # From: https://www.ietf.org/timezones/data/leap-seconds.list\n  # Updated through IERS Bulletin C52\n  # File expires on:  28 June 2017\n  #\n  #@  3707596800\n  #\n  2272060800  10  # 1 Jan 1972\n  2287785600  11  # 1 Jul 1972\n  2303683200  12  # 1 Jan 1973\n  2335219200  13  # 1 Jan 1974\n  2366755200  14  # 1 Jan 1975\n  2398291200  15  # 1 Jan 1976\n  2429913600  16  # 1 Jan 1977\n  2461449600  17  # 1 Jan 1978\n  2492985600  18  # 1 Jan 1979\n  2524521600  19  # 1 Jan 1980\n  2571782400  20  # 1 Jul 1981\n  2603318400  21  # 1 Jul 1982\n  2634854400  22  # 1 Jul 1983\n  2698012800  23  # 1 Jul 1985\n  2776982400  24  # 1 Jan 1988\n  2840140800  25  # 1 Jan 1990\n  2871676800  26  # 1 Jan 1991\n  2918937600  27  # 1 Jul 1992\n  2950473600  28  # 1 Jul 1993\n  2982009600  29  # 1 Jul 1994\n  3029443200  30  # 1 Jan 1996\n  3076704000  31  # 1 Jul 1997\n  3124137600  32  # 1 Jan 1999\n  3345062400  33  # 1 Jan 2006\n  3439756800  34  # 1 Jan 2009\n  3550089600  35  # 1 Jul 2012\n  3644697600  36  # 1 Jul 2015\n  3692217600  37  # 1 Jan 2017"</span></span>
  <span class="comment">// 3723753600  35  # 1 Jan 2018" //testing negative 2 seconds
</span>
<span class="comment">// -----------------------------------------------------------
// Parsing TAI 'continuous' leap second tables from before 1972
// -----------------------------------------------------------
</span>
<span class="decl-val" id="jd_epoch_shift"><span class="kw">val</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#jd_epoch_shift">jd-epoch-shift<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>jd<span class="dash">-</span>epoch<span class="dash">-</span>shift: <span class="tp">timespan</span></span></a>     <span class="kw">=</span> <span class="number">2400000.5</span><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#timespan_1">timespan<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a></span>  <span class="comment">// JD to MJD
</span><span class="decl-val" id="mjd_epoch_shift"><span class="kw">val</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#mjd_epoch_shift">mjd-epoch-shift<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>mjd<span class="dash">-</span>epoch<span class="dash">-</span>shift: <span class="tp">timespan</span></span></a>    <span class="kw">=</span> <span class="number">51544</span><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#timespan">timespan<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp sp">(</span><span class="tp tpp">seconds</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">double</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a></span> <span class="comment">// 2000-01-01Z - 1858-11-17Z modified julian date epoch
</span>

<span class="comment">// Parse the standard UTC leap second adjustment file in the "old" .dat format as
// in &lt;http://maia.usno.navy.mil/ser7/tai-utc.dat&gt;, where entries have the shape
// &#96;&#96;&#96;&#96;
// 1961 JAN  1 =JD 2437300.5  TAI-UTC=   1.4228180 S + (MJD - 37300.) X 0.001296 S
// &#96;&#96;&#96;&#96;
// which specifies the start time (&#96;JD 2437300.5&#96;), new TAI-UTC offset
// (&#96;1.4228180&#96;s), and the drift, starting at &#96;37300&#96; MJD of 0.001296s per day.
// Lines that start with &#96;&#96;#&#96;&#96; are comments. As an extension you can have an
// expiration date on a line that starts with &#96;&#96;#@&#96;&#96; followed by seconds since
// the NTP epoch (1900-01-01). Just as in a standard IETF leap second file.
</span><span class="decl-fun" id="parse_leap_seconds_dat"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#parse_leap_seconds_dat">parse-leap-seconds-dat<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>parse<span class="dash">-</span>leap<span class="dash">-</span>seconds<span class="dash">-</span>dat: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">leaps<span class="dash">-</span>table</span></span></a>( <a class="pp">leaps<span class="pc">leaps: <span class="tp">string</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a>  ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_leaps_table"><span class="tp">leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leaps<span class="dash">-</span>table: <span class="tp">V</span></span></a> {
  <span class="kw">val</span> <a class="pp">adjusts<span class="pc">adjusts: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a> <span class="kw">=</span> <a class="pp">leaps<span class="pc">leaps: <span class="tp">string</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#lines">lines<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>lines: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">string</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#flatmap_maybe">flatmap-maybe<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>flatmap<span class="dash">-</span>maybe: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="#parse_taiadjust">parse-taiadjust<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>parse<span class="dash">-</span>taiadjust: <span class="tp sp">(</span><span class="tp tpp">line</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a>)<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#reverse">reverse<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>reverse: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
  <span class="kw">val</span> <a class="pp">expire<span class="pc">expire: <span class="tp">instant</span></span></a> <span class="kw">=</span> <a class="pp" href="#parse_leap_expire">parse-leap-expire<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>parse<span class="dash">-</span>leap<span class="dash">-</span>expire: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">adjusts</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>(<a class="pp">leaps<span class="pc">leaps: <span class="tp">string</span></span></a>,<a class="pp">adjusts<span class="pc">adjusts: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a>)
  <a class="pp" href="#con_space_Leaps_table"><span class="co">Leaps-table</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>Leaps<span class="dash">-</span>table: <span class="tp sp">(</span><span class="tp tpp">expire</span> <span class="tp kw op">:</span> <span class="tp">instant</span><span class="tp sp">,</span> <span class="tp tpp">adjusts</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">leaps<span class="dash">-</span>table</span></span></a>(<a class="pp">expire<span class="pc">expire: <span class="tp">instant</span></span></a>,<a class="pp">adjusts<span class="pc">adjusts: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a>)
</span>}

<span class="decl-fun" id="parse_leap_expire"><span class="kw">private</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#parse_leap_expire">parse-leap-expire<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>parse<span class="dash">-</span>leap<span class="dash">-</span>expire: <span class="tp sp">(</span><span class="tp tpp">leaps</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">adjusts</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>( <a class="pp">leaps<span class="pc">leaps: <span class="tp">string</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a>, <a class="pp">adjusts<span class="pc">adjusts: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="#type_space_leap_adjust"><span class="tp">leap-adjust</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leap<span class="dash">-</span>adjust: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_instant-source.html#type_space_instant"><span class="tp">instant</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp">V</span></span></a> {
  <span class="comment">// get expiration date
</span>  <span class="kw">val</span> <a class="pp">la-final<span class="pc">la<span class="dash">-</span>final: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>    <span class="kw">=</span> <a class="pp">adjusts<span class="pc">adjusts: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#head_1">head<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>head<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#default">default<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>default: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">m</span> <span class="tp kw op">:</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">nothing</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span></span></a>(<a class="pp" href="#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>zero: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>)
  <span class="kw">val</span> <a class="pp">utc-expires<span class="pc">utc<span class="dash">-</span>expires: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">timestamp</span><span class="tp sp">&gt;</span></span></a> <span class="kw">=</span> <a class="pp">leaps<span class="pc">leaps: <span class="tp">string</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#lines">lines<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>lines: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">string</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#flatmap_maybe">flatmap-maybe<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>flatmap<span class="dash">-</span>maybe: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="#parse_expire">parse-expire<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>parse<span class="dash">-</span>expire: <span class="tp sp">(</span><span class="tp tpp">line</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">timestamp</span><span class="tp sp">&gt;</span></span></a>)
  <span class="kw">val</span> <a class="pp">utc-expire<span class="pc">utc<span class="dash">-</span>expire: <span class="tp">timestamp</span></span></a>  <span class="kw">=</span> <a class="pp">utc-expires<span class="pc">utc<span class="dash">-</span>expires: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">timestamp</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#head_1">head<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>head<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#default">default<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>default: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">m</span> <span class="tp kw op">:</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">nothing</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span></span></a>(<a class="pp">la-final<span class="pc">la<span class="dash">-</span>final: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><span class="kw op">.</span><a class="pp" href="#utc_start">utc-start<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc<span class="dash">-</span>start: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">utc<span class="dash">-</span>timestamp</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> (<span class="number">182</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#isolar_secs_per_day">isolar-secs-per-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>isolar<span class="dash">-</span>secs<span class="dash">-</span>per<span class="dash">-</span>day: <span class="tp">int</span></span></a>)<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#timespan">timespan<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan: <span class="tp sp">(</span><span class="tp tpp">seconds</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">frac</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">double</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a>)  <span class="comment">// default: 6 months after last leap second
</span>  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_instant-source.html#ts_tai">ts-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>ts<span class="dash">-</span>tai: <span class="tp">timescale</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_instant-source.html#instant">instant<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>instant: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">instant</span></span></a>( <a class="pp">utc-expire<span class="pc">utc<span class="dash">-</span>expire: <span class="tp">timestamp</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> <a class="pp" href="#ntp2000">ntp2000<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ntp2000: <span class="tp">timespan</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timestamp</span><span class="tp sp">,</span> <span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a> <a class="pp">la-final<span class="pc">la<span class="dash">-</span>final: <span class="tp">leap<span class="dash">-</span>adjust</span></span></a><span class="kw op">.</span><a class="pp" href="#offset">offset<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>offset: <span class="tp sp">(</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a> ) <span class="comment">// interpret as TAI to avoid recursion.
</span></span>}

<span class="comment">// val rxexpire = regex(@"^[ \t]&#42;#@[ \t]&#42;(\d+)[ \t]&#42;(?:#.&#42;)?$", multiLine=True)
</span><span class="decl-fun" id="parse_expire"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#parse_expire">parse-expire<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>parse<span class="dash">-</span>expire: <span class="tp sp">(</span><span class="tp tpp">line</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">timestamp</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">line<span class="pc">line: <span class="tp">string</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
  <span class="kw">if</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_True"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><a class="pp">line<span class="pc">line: <span class="tp">string</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#trim_left_1">trim-left<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>trim<span class="dash">-</span>left<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">sub</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>(<span class="st">" "</span>)<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#starts_with">starts-with<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>starts<span class="dash">-</span>with: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">pre</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">sslice</span><span class="tp sp">&gt;</span></span></a>(<span class="st">"#@"</span>)<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#bool_1">bool<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">m</span> <span class="tp kw op">:</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>)
   <span class="kw">then</span> <a class="pp">line<span class="pc">line: <span class="tp">string</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#slice">slice<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>slice: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">sslice</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#parse">parse<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>parse: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">input0</span> <span class="tp kw op">:</span> <span class="tp">sslice</span><span class="tp sp">,</span> <span class="tp tpp">p</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">parse</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">parse<span class="dash">-</span>error</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="#pexpire">pexpire<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>pexpire: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">timestamp</span></span></a>)<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#maybe">maybe<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>maybe: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">perr</span> <span class="tp kw op">:</span> <span class="tp">parse<span class="dash">-</span>error</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
   <span class="kw">else</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
</span>}

<span class="decl-fun" id="pexpire"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#pexpire">pexpire<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>pexpire: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">timestamp</span></span></a>() <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#type_space_parse"><span class="tp">parse</span><span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>parse: <span class="tp">HX</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#type_space_timestamp"><span class="tp">timestamp</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp">V</span></span></a> {
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#whitespace0">whitespace0<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>whitespace0: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">string</span></span></a>()
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#pstring">pstring<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>pstring: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">string</span></span></a>(<span class="st">"#@"</span>)
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#whitespace0">whitespace0<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>whitespace0: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">string</span></span></a>()
  <span class="kw">val</span> <a class="pp">ntpex<span class="pc">ntpex: <span class="tp">ddouble</span></span></a> <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#pddouble">pddouble<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>pddouble: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">ddouble</span></span></a>()
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#timestamp">timestamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp tpp">leap</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>(<a class="pp">ntpex<span class="pc">ntpex: <span class="tp">ddouble</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#timespan_2">timespan<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timespan<span class="postfix">.2</span>: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timespan</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp" href="#ntp2000">ntp2000<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ntp2000: <span class="tp">timespan</span></span></a>)
</span>}

<span class="decl-fun" id="parse_taiadjust"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#parse_taiadjust">parse-taiadjust<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>parse<span class="dash">-</span>taiadjust: <span class="tp sp">(</span><span class="tp tpp">line</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">leap<span class="dash">-</span>adjust</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">line<span class="pc">line: <span class="tp">string</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="#type_space_leap_adjust"><span class="tp">leap-adjust</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leap<span class="dash">-</span>adjust: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
  <a class="pp">line<span class="pc">line: <span class="tp">string</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#slice">slice<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>slice: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">sslice</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#parse_eof">parse-eof<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>parse<span class="dash">-</span>eof: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">input</span> <span class="tp kw op">:</span> <span class="tp">sslice</span><span class="tp sp">,</span> <span class="tp tpp">p</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">parse</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">parse<span class="dash">-</span>error</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="#ptaiadjust">ptaiadjust<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ptaiadjust: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>)<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#maybe">maybe<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>maybe: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">perr</span> <span class="tp kw op">:</span> <span class="tp">parse<span class="dash">-</span>error</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
</span>}

<span class="decl-fun" id="ptaiadjust"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#ptaiadjust">ptaiadjust<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>ptaiadjust: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>() <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#type_space_parse"><span class="tp">parse</span><span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>parse: <span class="tp">HX</span></span></a> <a class="pp" href="#type_space_leap_adjust"><span class="tp">leap-adjust</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>leap<span class="dash">-</span>adjust: <span class="tp">V</span></span></a> {
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#whitespace0">whitespace0<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>whitespace0: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">string</span></span></a>()
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#many1">many1<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>many1: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">p</span> <span class="tp kw op">:</span> <span class="tp">parser</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">parse</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>{ <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#none_of">none-of<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>none<span class="dash">-</span>of: <span class="tp sp">(</span><span class="tp tpp">chars</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">char</span></span></a>(<span class="st">"="</span>) }
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#pstring">pstring<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>pstring: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">string</span></span></a>(<span class="st">"=JD"</span>)
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#whitespace0">whitespace0<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>whitespace0: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">string</span></span></a>()
  <span class="kw">val</span> <a class="pp">mjd<span class="pc">mjd: <span class="tp">ddouble</span></span></a> <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#pddouble">pddouble<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>pddouble: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">ddouble</span></span></a>() <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp" href="#jd_epoch_shift">jd-epoch-shift<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>jd<span class="dash">-</span>epoch<span class="dash">-</span>shift: <span class="tp">timespan</span></span></a>
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#whitespace0">whitespace0<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>whitespace0: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">string</span></span></a>()
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#pstring">pstring<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>pstring: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">string</span></span></a>(<span class="st">"TAI-UTC="</span>)
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#whitespace0">whitespace0<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>whitespace0: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">string</span></span></a>()
  <span class="kw">val</span> <a class="pp">ofs<span class="pc">ofs: <span class="tp">ddouble</span></span></a> <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#pddouble">pddouble<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>pddouble: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">ddouble</span></span></a>()
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#many1">many1<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>many1: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">p</span> <span class="tp kw op">:</span> <span class="tp">parser</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">parse</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>{ <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#no_digit">no-digit<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>no<span class="dash">-</span>digit: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">char</span></span></a>() }
  <span class="kw">val</span> <a class="pp">dmjd<span class="pc">dmjd: <span class="tp">ddouble</span></span></a> <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#pddouble">pddouble<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>pddouble: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">ddouble</span></span></a>()
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#many1">many1<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>many1: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">p</span> <span class="tp kw op">:</span> <span class="tp">parser</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">parse</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>{ <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#no_digit">no-digit<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>no<span class="dash">-</span>digit: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">char</span></span></a>() }
  <span class="kw">val</span> <a class="pp">drift<span class="pc">drift: <span class="tp">ddouble</span></span></a> <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#pddouble">pddouble<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>pddouble: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">ddouble</span></span></a>()
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#whitespace0">whitespace0<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>whitespace0: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">string</span></span></a>()
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#pstring">pstring<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>pstring: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">string</span></span></a>(<span class="st">"S"</span>)
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#whitespace0">whitespace0<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>whitespace0: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">string</span></span></a>()
  <span class="comment">// round to always start on a whole second
</span>  <span class="kw">val</span> <a class="pp">start<span class="pc">start: <span class="tp">timestamp</span></span></a>  <span class="kw">=</span> ((<a class="pp">mjd<span class="pc">mjd: <span class="tp">ddouble</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp" href="#mjd_epoch_shift">mjd-epoch-shift<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>mjd<span class="dash">-</span>epoch<span class="dash">-</span>shift: <span class="tp">timespan</span></span></a>)<a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#solar_secs_per_day">solar-secs-per-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>solar<span class="dash">-</span>secs<span class="dash">-</span>per<span class="dash">-</span>day: <span class="tp">timespan</span></span></a>)<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#round">round<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>round: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#timestamp">timestamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp tpp">leap</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>
  <span class="kw">val</span> <a class="pp">dstart<span class="pc">dstart: <span class="tp">timestamp</span></span></a> <span class="kw">=</span> ((<a class="pp">dmjd<span class="pc">dmjd: <span class="tp">ddouble</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp" href="#mjd_epoch_shift">mjd-epoch-shift<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>mjd<span class="dash">-</span>epoch<span class="dash">-</span>shift: <span class="tp">timespan</span></span></a>)<a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#solar_secs_per_day">solar-secs-per-day<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>solar<span class="dash">-</span>secs<span class="dash">-</span>per<span class="dash">-</span>day: <span class="tp">timespan</span></span></a>)<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#round">round<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>round: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_timestamp-source.html#timestamp">timestamp<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>timestamp<span class="fslash last">/</span></span>timestamp: <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp tpp">leap</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timestamp</span></span></a>
  <span class="comment">// trace("pre72 start=" + start.show + ", ofs: " + ofs.show + ", drift: " + drift.show )
</span>  <a class="pp" href="#con_space_Leap_adjust"><span class="co">Leap-adjust</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>Leap<span class="dash">-</span>adjust: <span class="tp sp">(</span><span class="tp tpp">utc<span class="dash">-</span>start</span> <span class="tp kw op">:</span> <span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">,</span> <span class="tp tpp">offset</span> <span class="tp kw op">:</span> <span class="tp">timespan</span><span class="tp sp">,</span> <span class="tp tpp">drift<span class="dash">-</span>start</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">utc<span class="dash">-</span>timestamp</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">drift</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">ddouble</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">leap<span class="dash">-</span>adjust</span></span></a>( <a class="pp">start<span class="pc">start: <span class="tp">timestamp</span></span></a>, <a class="pp">ofs<span class="pc">ofs: <span class="tp">ddouble</span></span></a>, <a class="pp">dstart<span class="pc">dstart: <span class="tp">timestamp</span></span></a>, <a class="pp">drift<span class="pc">drift: <span class="tp">ddouble</span></span></a> )
</span>}

<span class="comment">// TAI leap second adjustments for dates before 1972-01-01Z are linear interpolations.
// TAI started in 1958-01-01Z. The initial official UTC time step in 1961-01-01Z was 1.422818s and before that there
// were small steps of 20ms. See Explanatory Supplement to the Astronomical Almanac, 1992 edition, pages 86--87.
// In 1958, the supplement remarks that WWC operated at an offset of &#95;about&#95; -100e-10, we
// change it to -85e-10 to end up with TAI-UTC == 0 at 1958-01-01.
// (without a rate change it is a negative -0.0472380s).
// Note the JD dates are at 0.29167 as the time steps were usually at 19:00h instead of midnight.
</span><span class="decl-val" id="default_leap_seconds_pre72"><span class="kw">val</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc.html#default_leap_seconds_pre72">default-leap-seconds-pre72<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>default<span class="dash">-</span>leap<span class="dash">-</span>seconds<span class="dash">-</span>pre72: <span class="tp">string</span></span></a> <span class="kw">=</span> <span class="st">"\n  # from: Explanatory Supplement to the Astronomical Almanac, 1992 edition, pages 86--87.\n  1958 JAN  1 =JD 2436204.5     TAI-UTC= 0.0  S + (MJD - 36204.) X 0.00073458 S\n  1958 JAN 15 =JD 2436219.29167 TAI-UTC= 0.02 S + (MJD - 36204.) X 0.00073458 S\n  1958 FEB  5 =JD 2436240.29167 TAI-UTC= 0.04 S + (MJD - 36204.) X 0.00073458 S\n  1958 FEB 19 =JD 2436254.29167 TAI-UTC= 0.06 S + (MJD - 36204.) X 0.00073458 S\n  1958 APR  9 =JD 2436303.29167 TAI-UTC= 0.08 S + (MJD - 36204.) X 0.00073458 S\n  1958 JUN 11 =JD 2436366.29167 TAI-UTC= 0.10 S + (MJD - 36204.) X 0.00073458 S\n  1958 JUL  2 =JD 2436387.29167 TAI-UTC= 0.12 S + (MJD - 36204.) X 0.00073458 S\n  1958 JUL 16 =JD 2436401.29167 TAI-UTC= 0.14 S + (MJD - 36204.) X 0.00073458 S\n  1958 OCT 22 =JD 2436499.29167 TAI-UTC= 0.16 S + (MJD - 36204.) X 0.00073458 S\n  1958 NOV 26 =JD 2436534.29167 TAI-UTC= 0.18 S + (MJD - 36204.) X 0.00073458 S\n  1958 DEC 24 =JD 2436562.29167 TAI-UTC= 0.20 S + (MJD - 36204.) X 0.00073458 S\n\n  1959 JAN  1 =JD 2436569.5     TAI-UTC= 0.4681220 S + (MJD - 36569.) X 0.000864 S\n  1959 JAN 28 =JD 2436597.29167 TAI-UTC= 0.4881220 S + (MJD - 36569.) X 0.000864 S\n  1959 FEB 25 =JD 2436625.29167 TAI-UTC= 0.5081220 S + (MJD - 36569.) X 0.000864 S\n  1959 APR  5 =JD 2436664.29167 TAI-UTC= 0.5281220 S + (MJD - 36569.) X 0.000864 S\n  1959 AUG 26 =JD 2436807.29167 TAI-UTC= 0.5481220 S + (MJD - 36569.) X 0.000864 S\n  1959 SEP 30 =JD 2436842.29167 TAI-UTC= 0.5681220 S + (MJD - 36569.) X 0.000864 S\n  1959 NOV  4 =JD 2436877.29167 TAI-UTC= 0.5881220 S + (MJD - 36569.) X 0.000864 S\n  1959 NOV 18 =JD 2436891.29167 TAI-UTC= 0.6081220 S + (MJD - 36569.) X 0.000864 S\n  1959 DEC 16 =JD 2436919.29167 TAI-UTC= 0.6281220 S + (MJD - 36569.) X 0.000864 S\n  1960 JAN  1 =JD 2436934.5     TAI-UTC= 0.9434820 S + (MJD - 36934.) X 0.001296 S\n\n  # from: http://maia.usno.navy.mil/ser7/tai-utc.dat\n  1961 JAN  1 =JD 2437300.5  TAI-UTC=   1.4228180 S + (MJD - 37300.) X 0.001296 S\n  1961 AUG  1 =JD 2437512.5  TAI-UTC=   1.3728180 S + (MJD - 37300.) X 0.001296 S\n  1962 JAN  1 =JD 2437665.5  TAI-UTC=   1.8458580 S + (MJD - 37665.) X 0.0011232S\n  1963 NOV  1 =JD 2438334.5  TAI-UTC=   1.9458580 S + (MJD - 37665.) X 0.0011232S\n  1964 JAN  1 =JD 2438395.5  TAI-UTC=   3.2401300 S + (MJD - 38761.) X 0.001296 S\n  1964 APR  1 =JD 2438486.5  TAI-UTC=   3.3401300 S + (MJD - 38761.) X 0.001296 S\n  1964 SEP  1 =JD 2438639.5  TAI-UTC=   3.4401300 S + (MJD - 38761.) X 0.001296 S\n  1965 JAN  1 =JD 2438761.5  TAI-UTC=   3.5401300 S + (MJD - 38761.) X 0.001296 S\n  1965 MAR  1 =JD 2438820.5  TAI-UTC=   3.6401300 S + (MJD - 38761.) X 0.001296 S\n  1965 JUL  1 =JD 2438942.5  TAI-UTC=   3.7401300 S + (MJD - 38761.) X 0.001296 S\n  1965 SEP  1 =JD 2439004.5  TAI-UTC=   3.8401300 S + (MJD - 38761.) X 0.001296 S\n  1966 JAN  1 =JD 2439126.5  TAI-UTC=   4.3131700 S + (MJD - 39126.) X 0.002592 S\n  1968 FEB  1 =JD 2439887.5  TAI-UTC=   4.2131700 S + (MJD - 39126.) X 0.002592 S"</span></span>


<span class="comment">/&#42;
private fun parse-leap-expire( leaps : string, adjusts : list&lt;leap-adjust&gt;) : instant {
val la-final    = adjusts.head.default(zero)
val utc-expire  = leaps.find(rxexpire).map fn(cap) {
    val ntpex = cap.groups[1].parse-int-default(ntp2000.int)
    timestamp(ntpex.timespan - ntp2000)
  }.default(la-final.utc-start + (182&#42;isolar-secs-per-day).timespan)  // default: 6 months after last leap second
  // trace("expire: " + utc-expire.ts-show)
  ts-tai.instant( utc-expire - ntp2000 + la-final.offset ) // interpret as TAI to avoid recursion.
}
val rxexpire = regex(@"^[ \t]&#42;#@[ \t]&#42;(\d+)[ \t]&#42;(?:#.&#42;)?$", multiLine=True)
&#42;/</span>

<span class="comment">/&#42;
public fun parse-leap-seconds-dat( leaps : string  ) : leaps-table {
  val adjusts = leaps.find-all(rxtaiadjust).map( fn(cap) {
    val mjd    = cap.groups[1].parse-ddouble.default(jd-epoch-shift) - jd-epoch-shift
    val ofs    = cap.groups[2].parse-ddouble.default(zero)
    val dmjd   = cap.groups[3].parse-ddouble.default(zero)
    val drift  = cap.groups[4].parse-ddouble.default(zero)
    // round to always start on a whole second
    val start  = ((mjd - mjd-epoch-shift)&#42;solar-secs-per-day).round.timestamp
    val dstart = ((dmjd - mjd-epoch-shift)&#42;solar-secs-per-day).round.timestamp
    // trace("pre72 start=" + start.show + ", ofs: " + ofs.show + ", drift: " + drift.show )
    Leap-adjust( start, ofs, dstart, drift )
  }).reverse
  val expire = parse-leap-expire(leaps,adjusts)
  Leaps-table(expire,adjusts)
}

val rxtaiadjust = regex(@"^ &#42;\d[^=]&#42;=JD (\d+\.\d+) &#42;TAI-UTC= &#42;(-?\d+(?:\.\d&#42;)?)[^\d]+(\d+(?:\.\d&#42;)?)[^\d]+(\d+\.\d+) &#42;S &#42;$", multiLine=True)
&#42;/</span>
</pre>

</body>
</html>
