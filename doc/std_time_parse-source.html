<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="initial-scale=1.0" />

<style type="text/css">.koka .plaincode, .koka a.pp .pc { display: none; } .koka a.pp { color: inherit; text-decoration: none; }</style>
<link rel="stylesheet" type="text/css" href="styles/madoko.css" />
<link rel="stylesheet" type="text/css" href="styles/koka.css" />

<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Nunito:400,400italic,700,700italic" />
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700,400italic" />

<title>parse.kk documentation</title>
</head>

<body class="koka doc body madoko">
<pre class="koka source"><span class="comment">/&#42;----------------------------------------------------------------------------
   Copyright (C) 2012-2016 Microsoft Corporation

   Licensed under the Apache License, Version 2.0 ("The Licence"). You may not
   use this file except in compliance with the License. A copy of the License
   can be found in the file "license.txt" at the root of this distribution.
----------------------------------------------------------------------------&#42;/</span>

<span class="comment">// Parsing of time strings.
</span><span class="kw">module</span> parse

<span class="kw">import</span> parse
<span class="kw">import</span> ddouble
<span class="kw">import</span> duration
<span class="kw">import</span> instant
<span class="kw">import</span> date
<span class="kw">import</span> calendar
<span class="kw">import</span> calendars  <span class="comment">// iso-week, iso-month
</span><span class="kw">import</span> time
<span class="kw">import</span> locale
<span class="kw">import</span> utc

<span class="comment">// -----------------------------------------------------------
// Parsing
// -----------------------------------------------------------
</span>
<span class="comment">/&#42; Parse an [ISO 8601](https://en.wikipedia.org/wiki/ISO&#95;8601) time string.
The optional &#96;calendar&#96; (=&#96;cal-iso&#96;) argument can be given to interpret
the date in a different calendar. If a time zone offset is given, the

&#96;&#96;&#96;&#96;plain
2008-12-31               // just date
2009-W01-3               // week number and day
2008-366                 // day of the year

20081231, 2009W013, 2008366  // without dashes

2008-12-31T09            // with time part, use T or space
2008-12-31 09
2008-12-31T09:20:16
2008-12-31T09:20:16.345  // with milliseconds (can be any fraction)
2008-12-30T24:00:00      // next day at midnight
20081231T092016.345      // without separators

2008-12-31T09Z           // UTC time zone (Z)
2008-12-31 09-07:00      // UTC-07:00 time zone
2008-12-31T09:20:16+0830 // UTC+08:30 time zone (without colon)
&#96;&#96;&#96;&#96;

And also parses the ISO month dates (see &#96;cal-iso-month&#96;):

&#96;&#96;&#96;&#96;plain
2009-M01-03              // just month date
2009-M003                // month date with day of the year
&#96;&#96;&#96;&#96;
.
&#42;/</span>

<span class="decl-fun" id="parse_iso"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_parse.html#parse_iso">parse-iso<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>parse<span class="fslash last">/</span></span>parse<span class="dash">-</span>iso: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">calendar</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">calendar</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">utc</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">time</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">s<span class="pc">s: <span class="tp">string</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a>, <a class="pp">calendar<span class="pc">calendar: <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">calendar</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_optional"><span class="tp">calendar</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_calendar-source.html#cal_iso">cal-iso<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendar<span class="fslash last">/</span></span>cal<span class="dash">-</span>iso: <span class="tp">calendar</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc-source.html#type_space_utc"><span class="tp">utc</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc: <span class="tp">HX</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_time-source.html#type_space_time"><span class="tp">time</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>time<span class="fslash last">/</span></span>time: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
  <a class="pp">s<span class="pc">s: <span class="tp">string</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#slice">slice<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>slice: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">sslice</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#parse_eof">parse-eof<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>parse<span class="dash">-</span>eof: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">input</span> <span class="tp kw op">:</span> <span class="tp">sslice</span><span class="tp sp">,</span> <span class="tp tpp">p</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">parse</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">parse<span class="dash">-</span>error</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( { <a class="pp" href="#piso">piso<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>parse<span class="fslash last">/</span></span>piso: <span class="tp sp">(</span><span class="tp tpp">calendar</span> <span class="tp kw op">:</span> <span class="tp">calendar</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">parse</span><span class="tp sp">,</span><span class="tp">utc</span><span class="tp sp">&gt;</span> <span class="tp">time</span></span></a>(<a class="pp">calendar<span class="pc">calendar: <span class="tp">calendar</span></span></a>) } )<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#maybe">maybe<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>maybe: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">perr</span> <span class="tp kw op">:</span> <span class="tp">parse<span class="dash">-</span>error</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> 
</span>}

<span class="decl-fun" id="piso"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_parse.html#piso">piso<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>parse<span class="fslash last">/</span></span>piso: <span class="tp sp">(</span><span class="tp tpp">calendar</span> <span class="tp kw op">:</span> <span class="tp">calendar</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">parse</span><span class="tp sp">,</span><span class="tp">utc</span><span class="tp sp">&gt;</span> <span class="tp">time</span></span></a>(<a class="pp">calendar<span class="pc">calendar: <span class="tp">calendar</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_calendar-source.html#type_space_calendar"><span class="tp">calendar</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendar<span class="fslash last">/</span></span>calendar: <span class="tp">V</span></span></a>) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#type_space_parse"><span class="tp">parse</span><span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>parse: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc-source.html#type_space_utc"><span class="tp">utc</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc: <span class="tp">HX</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_time-source.html#type_space_time"><span class="tp">time</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>time<span class="fslash last">/</span></span>time: <span class="tp">V</span></span></a> {
  <span class="kw">val</span> <a class="pp">year<span class="pc">year: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp" href="#num">num<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>parse<span class="fslash last">/</span></span>num: <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">int</span></span></a>(<span class="number">4</span>)
  <a class="pp" href="#dash">dash<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>parse<span class="fslash last">/</span></span>dash: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">char</span></span></a>()
  <span class="kw">val</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">date<span class="pc">date: <span class="tp">date</span></span></a>,<a class="pp">cal<span class="pc">cal: <span class="tp">calendar</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a> <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#choose">choose<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>choose: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ps</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">parser</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">parse</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Cons"><span class="co">[</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
    { <span class="kw">val</span> <a class="pp">m<span class="pc">m: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp" href="#num">num<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>parse<span class="fslash last">/</span></span>num: <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">int</span></span></a>(<span class="number">2</span>)   <span class="comment">// month-day
</span>      <a class="pp" href="#dash">dash<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>parse<span class="fslash last">/</span></span>dash: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">char</span></span></a>()
      <span class="kw">val</span> <a class="pp">d<span class="pc">d: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp" href="#num">num<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>parse<span class="fslash last">/</span></span>num: <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">int</span></span></a>(<span class="number">2</span>)
      <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_date-source.html#con_space_Date"><span class="co">Date</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>date<span class="fslash last">/</span></span>Date: <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">month</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">day</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">date</span></span></a>(<a class="pp">year<span class="pc">year: <span class="tp">int</span></span></a>,<a class="pp">m<span class="pc">m: <span class="tp">int</span></span></a>,<a class="pp">d<span class="pc">d: <span class="tp">int</span></span></a>),<a class="pp">calendar<span class="pc">calendar: <span class="tp">calendar</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>
    },
    { <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#char">char<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>char: <span class="tp sp">(</span><span class="tp tpp">c</span> <span class="tp kw op">:</span> <span class="tp">char</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">char</span></span></a>(<span class="st">'W'</span>)       <span class="comment">// ISO week-day
</span>      <span class="kw">val</span> <a class="pp">w<span class="pc">w: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp" href="#num">num<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>parse<span class="fslash last">/</span></span>num: <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">int</span></span></a>(<span class="number">2</span>)
      <a class="pp" href="#dash">dash<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>parse<span class="fslash last">/</span></span>dash: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">char</span></span></a>()
      <span class="kw">val</span> <a class="pp">d<span class="pc">d: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#optional">optional<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>optional: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">default</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">p</span> <span class="tp kw op">:</span> <span class="tp">parser</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">parse</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>(<span class="number">1</span>){ <a class="pp" href="#num">num<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>parse<span class="fslash last">/</span></span>num: <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">int</span></span></a>(<span class="number">1</span>) }
      <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_date-source.html#con_space_Date"><span class="co">Date</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>date<span class="fslash last">/</span></span>Date: <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">month</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">day</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">date</span></span></a>(<a class="pp">year<span class="pc">year: <span class="tp">int</span></span></a>,<a class="pp">w<span class="pc">w: <span class="tp">int</span></span></a>,<a class="pp">d<span class="pc">d: <span class="tp">int</span></span></a>),<a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_calendars-source.html#cal_iso_week">cal-iso-week<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>cal<span class="dash">-</span>iso<span class="dash">-</span>week: <span class="tp">calendar</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>
    }, 
    { <span class="kw">val</span> <a class="pp">d<span class="pc">d: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp" href="#num">num<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>parse<span class="fslash last">/</span></span>num: <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">int</span></span></a>(<span class="number">3</span>)  <span class="comment">// ISO day of year
</span>      <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_date-source.html#con_space_Date"><span class="co">Date</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>date<span class="fslash last">/</span></span>Date: <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">month</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">day</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">date</span></span></a>(<a class="pp">year<span class="pc">year: <span class="tp">int</span></span></a>,<span class="number">1</span>,<a class="pp">d<span class="pc">d: <span class="tp">int</span></span></a>),<a class="pp">calendar<span class="pc">calendar: <span class="tp">calendar</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>
    },
    { <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#char">char<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>char: <span class="tp sp">(</span><span class="tp tpp">c</span> <span class="tp kw op">:</span> <span class="tp">char</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">char</span></span></a>(<span class="st">'M'</span>)
      <span class="kw">val</span> <a class="pp">m<span class="pc">m: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp" href="#num">num<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>parse<span class="fslash last">/</span></span>num: <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">int</span></span></a>(<span class="number">2</span>)   <span class="comment">// ISO month-day
</span>      <a class="pp" href="#dash">dash<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>parse<span class="fslash last">/</span></span>dash: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">char</span></span></a>()
      <span class="kw">val</span> <a class="pp">d<span class="pc">d: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp" href="#num">num<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>parse<span class="fslash last">/</span></span>num: <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">int</span></span></a>(<span class="number">2</span>)
      <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_date-source.html#con_space_Date"><span class="co">Date</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>date<span class="fslash last">/</span></span>Date: <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">month</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">day</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">date</span></span></a>(<a class="pp">year<span class="pc">year: <span class="tp">int</span></span></a>,<a class="pp">m<span class="pc">m: <span class="tp">int</span></span></a>,<a class="pp">d<span class="pc">d: <span class="tp">int</span></span></a>),<a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_calendars-source.html#cal_iso_month">cal-iso-month<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>cal<span class="dash">-</span>iso<span class="dash">-</span>month: <span class="tp">calendar</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>
    },
    { <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#char">char<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>char: <span class="tp sp">(</span><span class="tp tpp">c</span> <span class="tp kw op">:</span> <span class="tp">char</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">char</span></span></a>(<span class="st">'M'</span>)         <span class="comment">// ISO month day-of-year
</span>      <span class="kw">val</span> <a class="pp">d<span class="pc">d: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp" href="#num">num<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>parse<span class="fslash last">/</span></span>num: <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">int</span></span></a>(<span class="number">3</span>)
      <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_date-source.html#con_space_Date"><span class="co">Date</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>date<span class="fslash last">/</span></span>Date: <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">month</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">day</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">date</span></span></a>(<a class="pp">year<span class="pc">year: <span class="tp">int</span></span></a>,<span class="number">1</span>,<a class="pp">d<span class="pc">d: <span class="tp">int</span></span></a>),<a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_calendars-source.html#cal_iso_month">cal-iso-month<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>cal<span class="dash">-</span>iso<span class="dash">-</span>month: <span class="tp">calendar</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>
    }      
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Nil"><span class="co">]</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>) 
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#optional">optional<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>optional: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">default</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">p</span> <span class="tp kw op">:</span> <span class="tp">parser</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">parse</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_time-source.html#time_5">time<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>time<span class="fslash last">/</span></span>time<span class="postfix">.5</span>: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">date</span><span class="tp sp">,</span> <span class="tp tpp">c</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">clock</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">tz</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">timezone</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">cal</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">calendar</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">timescale</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">utc</span> <span class="tp">time</span></span></a>(<a class="pp">date<span class="pc">date: <span class="tp">date</span></span></a>,cal<span class="kw">=</span><a class="pp">cal<span class="pc">cal: <span class="tp">calendar</span></span></a>)){ <a class="pp" href="#ptime">ptime<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>parse<span class="fslash last">/</span></span>ptime: <span class="tp sp">(</span><span class="tp tpp">date</span> <span class="tp kw op">:</span> <span class="tp">date</span><span class="tp sp">,</span> <span class="tp tpp">cal</span> <span class="tp kw op">:</span> <span class="tp">calendar</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">parse</span><span class="tp sp">,</span><span class="tp">utc</span><span class="tp sp">&gt;</span> <span class="tp">time</span></span></a>(<a class="pp">date<span class="pc">date: <span class="tp">date</span></span></a>,<a class="pp">cal<span class="pc">cal: <span class="tp">calendar</span></span></a>) }
</span>}

<span class="decl-fun" id="ptime"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_parse.html#ptime">ptime<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>parse<span class="fslash last">/</span></span>ptime: <span class="tp sp">(</span><span class="tp tpp">date</span> <span class="tp kw op">:</span> <span class="tp">date</span><span class="tp sp">,</span> <span class="tp tpp">cal</span> <span class="tp kw op">:</span> <span class="tp">calendar</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">parse</span><span class="tp sp">,</span><span class="tp">utc</span><span class="tp sp">&gt;</span> <span class="tp">time</span></span></a>(<a class="pp">date<span class="pc">date: <span class="tp">date</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_date-source.html#type_space_date"><span class="tp">date</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>date<span class="fslash last">/</span></span>date: <span class="tp">V</span></span></a>, <a class="pp">cal<span class="pc">cal: <span class="tp">calendar</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_calendar-source.html#type_space_calendar"><span class="tp">calendar</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendar<span class="fslash last">/</span></span>calendar: <span class="tp">V</span></span></a>) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#type_space_parse"><span class="tp">parse</span><span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>parse: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_utc-source.html#type_space_utc"><span class="tp">utc</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>utc<span class="fslash last">/</span></span>utc: <span class="tp">HX</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_time-source.html#type_space_time"><span class="tp">time</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>time<span class="fslash last">/</span></span>time: <span class="tp">V</span></span></a> {
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#one_of">one-of<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>one<span class="dash">-</span>of: <span class="tp sp">(</span><span class="tp tpp">chars</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">char</span></span></a>(<span class="st">"T "</span>)
  <span class="kw">val</span> <a class="pp">hour<span class="pc">hour: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp" href="#num">num<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>parse<span class="fslash last">/</span></span>num: <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">int</span></span></a>(<span class="number">2</span>)
  <a class="pp" href="#colon">colon<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>parse<span class="fslash last">/</span></span>colon: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">char</span></span></a>()
  <span class="kw">val</span> <a class="pp">min<span class="pc">min: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#optional">optional<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>optional: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">default</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">p</span> <span class="tp kw op">:</span> <span class="tp">parser</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">parse</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>(<span class="number">0</span>){<a class="pp" href="#num">num<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>parse<span class="fslash last">/</span></span>num: <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">int</span></span></a>(<span class="number">2</span>)}
  <a class="pp" href="#colon">colon<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>parse<span class="fslash last">/</span></span>colon: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">char</span></span></a>()
  <span class="kw">val</span> <a class="pp">secs<span class="pc">secs: <span class="tp">ddouble</span></span></a> <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#optional">optional<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>optional: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">default</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">p</span> <span class="tp kw op">:</span> <span class="tp">parser</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">parse</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>zero: <span class="tp">ddouble</span></span></a>) { <span class="kw">val</span> <a class="pp">s<span class="pc">s: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp" href="#num">num<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>parse<span class="fslash last">/</span></span>num: <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">int</span></span></a>(<span class="number">2</span>) 
                              <span class="kw">val</span> <a class="pp">f<span class="pc">f: <span class="tp">string</span></span></a> <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#optional">optional<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>optional: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">default</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">p</span> <span class="tp kw op">:</span> <span class="tp">parser</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">parse</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>(<span class="st">""</span>){ <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#one_of">one-of<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>one<span class="dash">-</span>of: <span class="tp sp">(</span><span class="tp tpp">chars</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">char</span></span></a>(<span class="st">".,"</span>); <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#digits">digits<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>digits: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">string</span></span></a>() }
                              (<a class="pp">s<span class="pc">s: <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#ddouble_1">ddouble<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>ddouble<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ddouble</span></span></a> (<span class="kw">if</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_True"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><a class="pp">f<span class="pc">f: <span class="tp">string</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#is_empty_2">is-empty<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>is<span class="dash">-</span>empty<span class="postfix">.2</span>: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>) <span class="kw">then</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>zero: <span class="tp">ddouble</span></span></a> <span class="kw">else</span> (<span class="st">"0."</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#_plus__6">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+)<span class="postfix">.6</span>: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a> <a class="pp">f<span class="pc">f: <span class="tp">string</span></span></a>)<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#parse_ddouble">parse-ddouble<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>parse<span class="dash">-</span>ddouble: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">ddouble</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#default">default<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>default: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">m</span> <span class="tp kw op">:</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">nothing</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_num_ddouble-source.html#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble<span class="fslash last">/</span></span>zero: <span class="tp">ddouble</span></span></a>))) } 
  <span class="kw">val</span> <a class="pp">tzone<span class="pc">tzone: <span class="tp">timezone</span></span></a> <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#choose">choose<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>choose: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ps</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">parser</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">parse</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Cons"><span class="co">[</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
                { <span class="kw">val</span> <a class="pp">sign<span class="pc">sign: <span class="tp">char</span></span></a> <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#one_of">one-of<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>one<span class="dash">-</span>of: <span class="tp sp">(</span><span class="tp tpp">chars</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">char</span></span></a>(<span class="st">"+-"</span>)
                  <span class="kw">val</span> <a class="pp">tzhour<span class="pc">tzhour: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp" href="#num">num<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>parse<span class="fslash last">/</span></span>num: <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">int</span></span></a>(<span class="number">2</span>)
                  <a class="pp" href="#colon">colon<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>parse<span class="fslash last">/</span></span>colon: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">char</span></span></a>()
                  <span class="kw">val</span> <a class="pp">tzmin<span class="pc">tzmin: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp" href="#num">num<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>parse<span class="fslash last">/</span></span>num: <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">int</span></span></a>(<span class="number">2</span>)
                  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_calendar-source.html#tz_fixed">tz-fixed<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendar<span class="fslash last">/</span></span>tz<span class="dash">-</span>fixed: <span class="tp sp">(</span><span class="tp tpp">hours</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">mins</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">string</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">abbrv</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">string</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">hourwidth</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timezone</span></span></a>( <span class="kw">if</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#con_space_True"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><a class="pp">sign<span class="pc">sign: <span class="tp">char</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#_eq__eq_">==<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(==): <span class="tp sp">(</span><span class="tp">char</span><span class="tp sp">,</span> <span class="tp">char</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a><span class="st">'-'</span>) <span class="kw">then</span> <a class="pp">tzhour<span class="pc">tzhour: <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#negate">negate<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>negate: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="kw">else</span> <a class="pp">tzhour<span class="pc">tzhour: <span class="tp">int</span></span></a>, <a class="pp">tzmin<span class="pc">tzmin: <span class="tp">int</span></span></a> )
                }, 
                { <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#optional">optional<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>optional: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">default</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">p</span> <span class="tp kw op">:</span> <span class="tp">parser</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">parse</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>(<span class="st">'Z'</span>){ <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#char">char<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>char: <span class="tp sp">(</span><span class="tp tpp">c</span> <span class="tp kw op">:</span> <span class="tp">char</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">char</span></span></a>(<span class="st">'Z'</span>) }; <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_calendar-source.html#tz_utc">tz-utc<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendar<span class="fslash last">/</span></span>tz<span class="dash">-</span>utc: <span class="tp">timezone</span></span></a> }
              <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#con_space_Nil"><span class="co">]</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>)
  <span class="kw">val</span> <a class="pp">clk<span class="pc">clk: <span class="tp">clock</span></span></a> <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_date-source.html#con_space_Clock"><span class="co">Clock</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>date<span class="fslash last">/</span></span>Clock: <span class="tp sp">(</span><span class="tp tpp">hours</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">minutes</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">seconds</span> <span class="tp kw op">:</span> <span class="tp">ddouble</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">clock</span></span></a>(<a class="pp">hour<span class="pc">hour: <span class="tp">int</span></span></a>,<a class="pp">min<span class="pc">min: <span class="tp">int</span></span></a>,<a class="pp">secs<span class="pc">secs: <span class="tp">ddouble</span></span></a>)
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_time-source.html#time_5">time<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>time<span class="fslash last">/</span></span>time<span class="postfix">.5</span>: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">date</span><span class="tp sp">,</span> <span class="tp tpp">c</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">clock</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">tz</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">timezone</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">cal</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">calendar</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">optional</span><span class="tp sp">&lt;</span><span class="tp">timescale</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">utc</span> <span class="tp">time</span></span></a>(<a class="pp">date<span class="pc">date: <span class="tp">date</span></span></a>,<a class="pp">clk<span class="pc">clk: <span class="tp">clock</span></span></a>,tz<span class="kw">=</span><a class="pp">tzone<span class="pc">tzone: <span class="tp">timezone</span></span></a>,cal<span class="kw">=</span><a class="pp">cal<span class="pc">cal: <span class="tp">calendar</span></span></a>)
</span>}

<span class="decl-fun" id="dash"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_parse.html#dash">dash<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>parse<span class="fslash last">/</span></span>dash: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">char</span></span></a>() <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#type_space_parse"><span class="tp">parse</span><span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>parse: <span class="tp">HX</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_char"><span class="tp">char</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>char: <span class="tp">V</span></span></a> {
  <a class="pp" href="#optchar">optchar<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>parse<span class="fslash last">/</span></span>optchar: <span class="tp sp">(</span><span class="tp tpp">c</span> <span class="tp kw op">:</span> <span class="tp">char</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">char</span></span></a>(<span class="st">'-'</span>)
</span>}

<span class="decl-fun" id="colon"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_parse.html#colon">colon<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>parse<span class="fslash last">/</span></span>colon: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">char</span></span></a>() <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#type_space_parse"><span class="tp">parse</span><span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>parse: <span class="tp">HX</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_char"><span class="tp">char</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>char: <span class="tp">V</span></span></a> {
  <a class="pp" href="#optchar">optchar<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>parse<span class="fslash last">/</span></span>optchar: <span class="tp sp">(</span><span class="tp tpp">c</span> <span class="tp kw op">:</span> <span class="tp">char</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">char</span></span></a>(<span class="st">':'</span>)
</span>}

<span class="decl-fun" id="optchar"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_parse.html#optchar">optchar<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>parse<span class="fslash last">/</span></span>optchar: <span class="tp sp">(</span><span class="tp tpp">c</span> <span class="tp kw op">:</span> <span class="tp">char</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">char</span></span></a>(<a class="pp">c<span class="pc">c: <span class="tp">char</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_char"><span class="tp">char</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>char: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#type_space_parse"><span class="tp">parse</span><span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>parse: <span class="tp">HX</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_char"><span class="tp">char</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>char: <span class="tp">V</span></span></a> {
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#optional">optional<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>optional: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">default</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">p</span> <span class="tp kw op">:</span> <span class="tp">parser</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">parse</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>(<a class="pp">c<span class="pc">c: <span class="tp">char</span></span></a>,{<a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#char">char<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>char: <span class="tp sp">(</span><span class="tp tpp">c</span> <span class="tp kw op">:</span> <span class="tp">char</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">char</span></span></a>(<a class="pp">c<span class="pc">c: <span class="tp">char</span></span></a>)})
</span>}

<span class="decl-fun" id="num"><span class="kw">fun</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_time_parse.html#num">num<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>parse<span class="fslash last">/</span></span>num: <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">int</span></span></a>( <a class="pp">n<span class="pc">n: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#type_space_parse"><span class="tp">parse</span><span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>parse: <span class="tp">HX</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core_types-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> {
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#count">count<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>count: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">p</span> <span class="tp kw op">:</span> <span class="tp">parser</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">parse</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">n<span class="pc">n: <span class="tp">int</span></span></a>,<a class="pp" href="https://koka-lang.github.io/koka/doc/std_text_parse-source.html#digit">digit<span class="pc"><span class="mo">std<span class="fslash">/</span>text<span class="fslash">/</span>parse<span class="fslash last">/</span></span>digit: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">parse</span> <span class="tp">int</span></span></a>)<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#foldl">foldl<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>foldl: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp sp">(</span><span class="tp tv">b</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span></span></a>(<span class="number">0</span>, <span class="kw">fn</span>(<a class="pp">d<span class="pc">d: <span class="tp">int</span></span></a>,<a class="pp">x<span class="pc">x: <span class="tp">int</span></span></a>){ <a class="pp">x<span class="pc">x: <span class="tp">int</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="number">10</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <a class="pp">d<span class="pc">d: <span class="tp">int</span></span></a> })
</span>}

<span class="comment">/&#42;
public fun parse-iso( s : string, calendar : calendar = cal-iso ) : &lt;utc&gt; maybe&lt;time&gt; {
  match(s.find(rx-iso-date)) {
    Nothing -&gt; Nothing
    Just(capd) -&gt; {
      val xyear = capd.num(1)
      val (date,cal) =
        if (capd.groups[4] != "") then // ISO week date
          (Date(xyear,capd.num(4),capd.num(5,1)),cal-iso-week)
        elif (capd.groups[6] != "") then // ISO day of the year
          (Date(xyear,1,capd.num(6)), calendar)
        elif (capd.groups[7] != "") then // ISO month date
          (Date(xyear,capd.num(7),capd.num(8)), cal-iso-month)
        elif (capd.groups[9] != "") then // ISO month date, day of the year
          (Date(xyear,1,capd.num(9)), cal-iso-month)
        else // (capd.groups[2] != "")  // regular ISO date
          (Date(xyear,capd.num(2),capd.num(3)),calendar)
      match(capd.slice.after.string.find(rx-iso-time)) {
        Nothing    -&gt; Nothing
        Just(capt) -&gt; {
          val hours = capt.num(1)
          val mins  = capt.num(2)
          val secs  = parse-ddouble(capt.groups[3] + "." + capt.groups[4]).default(zero)
          val tzsign= if (capt.groups[5]=="+") then 1 else ~1
          val tzhours= capt.num(6)
          val tzmins = capt.num(7)
          val tzone = tz-fixed(tzsign&#42;tzhours, tzmins)
          val clock = Clock(hours,mins,secs)
          Just(time(date,clock,tz=tzone,cal=cal))
        }
      }
    }
  }
}
val rx-iso-date = regex(@"^(\d\d\d\d)\-?(?:(\d\d)\-?(\d\d)|W(\d\d)\-?(\d)?|(\d\d\d)|M(\d\d)\-?(\d\d)|M(\d\d\d))(?=$|[T\+\- ]\d|Z)");
val rx-iso-time = regex(@"^(?:[T ](\d\d)(?:\:?(\d\d)(?:\:?(\d\d))?)?(?:[\.,](\d+))?)?(?:Z|([\+\-])(\d\d)(?:\:?(\d\d))?)?$")

fun num( cap : matched, group : int, default : int = 0 ) : int {
  parse-int-default(cap.groups[group], default = default)
}

// Parse an [Internet Message Format](https://tools.ietf.org/html/rfc2822#section-3.3) time string.
// For example: &#96;"Tue, 27 Sep 2016 06:36:55 -0700"&#96;.
public fun parse-imf( s : string ) : &lt;utc&gt; maybe&lt;time&gt; {
  match(s.find(rx-imf)) {
    Nothing -&gt; Nothing
    Just(cap) -&gt; {
      val day   = cap.num(2)
      val month = month-from-name(cap.groups[3]).default(1)
      val xyear = cap.num(4)
      val hours = cap.num(5)
      val mins  = cap.num(6)
      val secs  = cap.num(7)
      val tzsign= if (cap.groups[8]=="+") then 1 else ~1
      val tzhours= cap.num(9)
      val tzmins = cap.num(10)
      val tzone = tz-fixed(tzsign&#42;tzhours, tzmins)
      // adjust 2 digit year
      val year  = if (cap.groups[4].count &lt;= 2)
                   then (if (xyear &lt; 50) then 2000 + xyear else 1900 + xyear)
                   else xyear
      Just(time(year,month,day,hours,mins,secs,tz=tzone))
    }
  }
}
val rx-imf = regex(@"^ &#42;(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun) &#42;, &#42;)? (\d\d?) &#42;(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) &#42;(\d\d(?:\d\d)?) +(\d\d?):(\d\d?)(?::(\d\d))? &#42;(?:([\+\-])(\d\d)(\d\d) &#42;)?$")

fun month-from-name( mname : string ) : maybe&lt;int&gt; {
  val lname = mname.to-lower
  fun search( names : list&lt;string&gt;, month : int ) : maybe&lt;int&gt; {
    match(names) {
      Nil -&gt; Nothing
      Cons(name,rest) -&gt; {
        if (name.to-lower.starts-with(lname).bool)
         then Just(month)
         else search(rest,month+1)
      }
    }
  }
  search(time-locale-en-iso.month-names,1)
}
&#42;/</span>
</pre>

</body>
</html>
