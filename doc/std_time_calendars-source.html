<!DOCTYPE html>
<html>
<!-- NO_CLICK_TRACKING -->

<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />

<style type="text/css">.koka .plaincode, .koka a.pp .pc { display: none; } .koka a.pp { color: inherit; text-decoration: none; }</style>
<link rel="stylesheet" type="text/css" href="styles/madoko.css" />
<link rel="stylesheet" type="text/css" href="styles/koka.css" />

<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Noto+Serif:400,400italic,700,700italic" />
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700,400italic" />

<title>calendars.kk documentation</title>
</head>

<body class="koka doc body"><div class="madoko">
<pre class="koka source"><span class="comment">/&#42;----------------------------------------------------------------------------
   Copyright (C) 2012-2016 Microsoft Corporation
    
   Licensed under the Apache License, Version 2.0 ("The Licence"). You may not
   use this file except in compliance with the License. A copy of the License
   can be found in the file "license.txt" at the root of this distribution.
----------------------------------------------------------------------------&#42;/</span>

<span class="comment">/&#42; Various calendars\: TAI, GPS, ISO week, Julian, Coptic, etc.
  
&#42;/</span>
<span class="kw">module</span> calendars

<span class="kw">import</span> instant
<span class="kw">import</span> utc
<span class="kw">import</span> date
<span class="kw">import</span> calendar

<span class="comment">/&#42;----------------------------------------------------------------------------
  Time scale calendars
----------------------------------------------------------------------------&#42;/</span>

<span class="comment">// The TAI Calendar. This is a standard ISO 8601 calender using
// TAI time where every day is exactly 86400 SI seconds (unlike
// standard UTC time which can insert leap seconds).
</span><span class="decl-val" id="cal_tai"><span class="kw">public</span> <span class="kw">val</span> <a class="pp" href="std_time_calendars.html#cal_tai">cal-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>cal<span class="dash">-</span>tai: <span class="tp">calendar</span></span></a> <span class="kw">=</span> <a class="pp" href="std_time_calendar-source.html#iso_calendar">iso-calendar<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendar<span class="fslash last">/</span></span>iso<span class="dash">-</span>calendar: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">,</span> <span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">long<span class="dash">-</span>name</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">calendar</span></span></a>( <a class="pp" href="std_time_instant-source.html#ts_tai">ts-tai<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>ts<span class="dash">-</span>tai: <span class="tp">timescale</span></span></a> </span>)

<span class="comment">// The GPS calendar is always &#96;TAI - 19&#96; but with epoch 1980-01-06Z
</span><span class="decl-val" id="cal_gps"><span class="kw">public</span> <span class="kw">val</span> <a class="pp" href="std_time_calendars.html#cal_gps">cal-gps<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>cal<span class="dash">-</span>gps: <span class="tp">calendar</span></span></a> <span class="kw">=</span> <a class="pp" href="std_time_calendar-source.html#iso_calendar">iso-calendar<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendar<span class="fslash last">/</span></span>iso<span class="dash">-</span>calendar: <span class="tp sp">(</span><span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp">timescale</span><span class="tp sp">,</span> <span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">long<span class="dash">-</span>name</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">calendar</span></span></a>( <a class="pp" href="std_time_instant-source.html#ts_gps">ts-gps<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>instant<span class="fslash last">/</span></span>ts<span class="dash">-</span>gps: <span class="tp">timescale</span></span></a> </span>) <span class="comment">//(ts-gps.to-tai)(timestamp(fixed(~19))).seconds )
</span>


<span class="comment">// ----------------------------------------------------
// Coptic calendar
// ----------------------------------------------------
</span>
<span class="comment">// The [Coptic](https://en.wikipedia.org/wiki/Coptic&#95;calendar) calendar.
// The calendar short name is &#96;&#96;CC&#96;&#96;.
</span><span class="decl-val" id="cal_coptic"><span class="kw">public</span> <span class="kw">val</span> <a class="pp" href="std_time_calendars.html#cal_coptic">cal-coptic<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>cal<span class="dash">-</span>coptic: <span class="tp">calendar</span></span></a> <span class="kw">=</span> <a class="pp" href="std_time_calendar-source.html#solar_ecalendar">solar-ecalendar<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendar<span class="fslash last">/</span></span>solar<span class="dash">-</span>ecalendar: <span class="tp sp">(</span><span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">long<span class="dash">-</span>name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">days<span class="dash">-</span>before<span class="dash">-</span>year</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">estimate<span class="dash">-</span>year</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">days</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">days<span class="dash">-</span>before<span class="dash">-</span>month</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">month</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">days<span class="dash">-</span>to<span class="dash">-</span>month</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">doy</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">epoch<span class="dash">-</span>shift</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">has<span class="dash">-</span>year<span class="dash">-</span>zero?</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">bool</span><span class="tp sp">,</span> <span class="tp tpp">month<span class="dash">-</span>prefix</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">show<span class="dash">-</span>era</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp sp">(</span><span class="tp">date</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">calendar</span></span></a>(
  <span class="st">"CC"</span>, <span class="st">"Coptic"</span>, 
  <a class="pp" href="#coptic_days_before_year">coptic-days-before-year<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>coptic<span class="dash">-</span>days<span class="dash">-</span>before<span class="dash">-</span>year: <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>, <a class="pp" href="#coptic_estimate_year">coptic-estimate-year<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>coptic<span class="dash">-</span>estimate<span class="dash">-</span>year: <span class="tp sp">(</span><span class="tp tpp">days</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span></span></a>, <span class="comment">// coptic-days-to-yeardoy, 
</span>  <a class="pp" href="#coptic_days_before_month">coptic-days-before-month<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>coptic<span class="dash">-</span>days<span class="dash">-</span>before<span class="dash">-</span>month: <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">month</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>, <a class="pp" href="#coptic_doy_to_month">coptic-doy-to-month<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>coptic<span class="dash">-</span>doy<span class="dash">-</span>to<span class="dash">-</span>month: <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">doy</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>,
  epoch<span class="dash">-</span>shift <span class="kw">=</span> <span class="number">626515</span>,  <span class="comment">// 2001-01-01 - 284-08-29 Julian
</span>  show<span class="dash">-</span>era <span class="kw">=</span> <span class="kw">fun</span>(<a class="pp">d<span class="pc">d: <span class="tp">date</span></span></a><span class="tp kw op">:</span><a class="pp" href="std_time_date-source.html#type_space_date"><span class="tp">date</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>date<span class="fslash last">/</span></span>date: <span class="tp">V</span></span></a>){ <span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">d</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_date-source.html#year">year<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>date<span class="fslash last">/</span></span>year: <span class="tp sp">(</span><span class="tp tpp">date</span> <span class="tp kw op">:</span> <span class="tp">date</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#pos_ques__1">pos?<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>pos?<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>) <span class="kw">then</span> <span class="st">"A.M."</span> <span class="kw">else</span> <span class="st">""</span> }  <span class="comment">// Anno Martyrum
</span></span>)

<span class="decl-fun" id="coptic_days_before_month"><span class="kw">fun</span> <a class="pp" href="std_time_calendars.html#coptic_days_before_month">coptic-days-before-month<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>coptic<span class="dash">-</span>days<span class="dash">-</span>before<span class="dash">-</span>month: <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">month</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>( <a class="pp">year<span class="pc">year: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a>, <a class="pp">month<span class="pc">month: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> { 
  <span class="number">30</span><a class="pp" href="std_core-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>(<a class="pp">month<span class="pc">month: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">1</span>)
</span>}

<span class="decl-fun" id="coptic_doy_to_month"><span class="kw">fun</span> <a class="pp" href="std_time_calendars.html#coptic_doy_to_month">coptic-doy-to-month<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>coptic<span class="dash">-</span>doy<span class="dash">-</span>to<span class="dash">-</span>month: <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">doy</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>( <a class="pp">year<span class="pc">year: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a>, <a class="pp">doy<span class="pc">doy: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> {
  <a class="pp">doy<span class="pc">doy: <span class="tp">int</span></span></a><a class="pp" href="std_core-source.html#_fs_">/<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="fslash">/</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="number">30</span> <a class="pp" href="std_core-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">1</span>
</span>}   

<span class="decl-fun" id="coptic_days_before_year"><span class="kw">fun</span> <a class="pp" href="std_time_calendars.html#coptic_days_before_year">coptic-days-before-year<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>coptic<span class="dash">-</span>days<span class="dash">-</span>before<span class="dash">-</span>year: <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>( <a class="pp">year<span class="pc">year: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> ) {
  <span class="number">365</span><a class="pp" href="std_core-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><a class="pp">year<span class="pc">year: <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#dec">dec<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>dec: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <a class="pp">year<span class="pc">year: <span class="tp">int</span></span></a><a class="pp" href="std_core-source.html#_fs_">/<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="fslash">/</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="number">4</span>
</span>}

<span class="decl-fun" id="coptic_estimate_year"><span class="kw">fun</span> <a class="pp" href="std_time_calendars.html#coptic_estimate_year">coptic-estimate-year<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>coptic<span class="dash">-</span>estimate<span class="dash">-</span>year: <span class="tp sp">(</span><span class="tp tpp">days</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span></span></a>( <a class="pp">days<span class="pc">days: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> {
  <span class="kw">val</span> <a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">era<span class="pc">era: <span class="tp">int</span></span></a>,<a class="pp">doe<span class="pc">doe: <span class="tp">int</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a> <span class="kw">=</span> <a class="pp" href="std_core-source.html#divmod">divmod<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>divmod: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span></span></a>(<a class="pp">days<span class="pc">days: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">365</span>, <span class="number">1461</span>)
  <a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><span class="number">4</span><a class="pp" href="std_core-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><a class="pp">era<span class="pc">era: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <a class="pp">doe<span class="pc">doe: <span class="tp">int</span></span></a><a class="pp" href="std_core-source.html#_fs_">/<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="fslash">/</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="number">366</span>, <a class="pp" href="std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<span class="number">364</span>)<a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>
</span>}

<span class="decl-fun" id="coptic_days_to_yeardoy"><span class="kw">fun</span> <a class="pp" href="std_time_calendars.html#coptic_days_to_yeardoy">coptic-days-to-yeardoy<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>coptic<span class="dash">-</span>days<span class="dash">-</span>to<span class="dash">-</span>yeardoy: <span class="tp sp">(</span><span class="tp tpp">days</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span></span></a>( <a class="pp">days<span class="pc">days: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> {
  <span class="kw">val</span> <a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">era<span class="pc">era: <span class="tp">int</span></span></a>,<a class="pp">doe<span class="pc">doe: <span class="tp">int</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a> <span class="kw">=</span> <a class="pp" href="std_core-source.html#divmod">divmod<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>divmod: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span></span></a>(<a class="pp">days<span class="pc">days: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">365</span>, <span class="number">1461</span>)
  <span class="kw">val</span> <a class="pp">yoe<span class="pc">yoe: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp" href="std_core-source.html#min">min<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>min: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>( <a class="pp">doe<span class="pc">doe: <span class="tp">int</span></span></a><a class="pp" href="std_core-source.html#_fs_">/<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="fslash">/</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="number">365</span>, <span class="number">3</span>)
  <a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><span class="number">4</span><a class="pp" href="std_core-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><a class="pp">era<span class="pc">era: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <a class="pp">yoe<span class="pc">yoe: <span class="tp">int</span></span></a>, <a class="pp">doe<span class="pc">doe: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">365</span><a class="pp" href="std_core-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><a class="pp">yoe<span class="pc">yoe: <span class="tp">int</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>
</span>}

<span class="comment">// The [Ethiopian](https://en.wikipedia.org/wiki/Ethiopian&#95;calendar) calendar.
// The calendar short name is &#96;&#96;EC&#96;&#96;.
</span><span class="decl-val" id="cal_ethiopian"><span class="kw">public</span> <span class="kw">val</span> <a class="pp" href="std_time_calendars.html#cal_ethiopian">cal-ethiopian<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>cal<span class="dash">-</span>ethiopian: <span class="tp">calendar</span></span></a> <span class="kw">=</span> <a class="pp" href="std_time_calendar-source.html#year_shift_earth_calendar">year-shift-earth-calendar<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendar<span class="fslash last">/</span></span>year<span class="dash">-</span>shift<span class="dash">-</span>earth<span class="dash">-</span>calendar: <span class="tp sp">(</span><span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">long<span class="dash">-</span>name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">year<span class="dash">-</span>shift</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">cal</span> <span class="tp kw op">:</span> <span class="tp">calendar</span><span class="tp sp">,</span> <span class="tp tpp">month<span class="dash">-</span>prefix</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">show<span class="dash">-</span>era</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp sp">(</span><span class="tp">date</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">calendar</span></span></a>( <span class="st">"EC"</span>, <span class="st">"Ethiopian"</span>, <a class="pp" href="std_core-source.html#_tilde_">~<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(~): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="number">276</span>, <a class="pp" href="#cal_coptic">cal-coptic<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>cal<span class="dash">-</span>coptic: <span class="tp">calendar</span></span></a> </span>)


<span class="comment">// ----------------------------------------------------
// ISO week calendar
// ----------------------------------------------------
</span>
<span class="comment">/&#42; The 'ISO week' calendar. This implements the [ISO week date](https://en.wikipedia.org/wiki/ISO&#95;week&#95;date)
calendar the week number is interpreted as "month" number instead, i.e. every year has 52 (or 53)
months of 7 week days each. Short name is &#96;"IW"&#96;.

Since its introduction in 1988, the ISO week calendar is a widely accepted standard for a weekly
calendar. It is used mainly by businesses for fiscal year calculations.
Weeks start on Monday (as day 1) and every common year has 52 weeks.
Every 5 to 7 years, there is a 'leap' year with an extra week 53. 
The ISO week calendar is directly based on the Gregorian calendar.
For example, Tuesday 2001-01-02 is denoted as 2001-W01-2 in the ISO week
calendar: weekday 2 (Tuesday) of week 1 in 2001. 

The year of an ISO week is defined as the Gregorian year that has the
Thursday of that week, &amp;ie; contains the most days of that week. For
example, Thursday 2004-01-01 has week date 2004-W01-4. This means that
sometimes the Gregorian year is different for a first- or last week:
Wednesday 2003-12-31 falls in the first week of 2004W and has week date
2004-W01-3. Similarly, Saturday 2005-01-01 falls in the last (leap) week of
2004W and has week date 2004-W53-6.
&#42;/</span>
<span class="decl-val" id="cal_iso_week"><span class="kw">public</span> <span class="kw">val</span> <a class="pp" href="std_time_calendars.html#cal_iso_week">cal-iso-week<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>cal<span class="dash">-</span>iso<span class="dash">-</span>week: <span class="tp">calendar</span></span></a> <span class="kw">=</span> <a class="pp" href="std_time_calendar-source.html#solar_ecalendar">solar-ecalendar<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendar<span class="fslash last">/</span></span>solar<span class="dash">-</span>ecalendar: <span class="tp sp">(</span><span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">long<span class="dash">-</span>name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">days<span class="dash">-</span>before<span class="dash">-</span>year</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">estimate<span class="dash">-</span>year</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">days</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">days<span class="dash">-</span>before<span class="dash">-</span>month</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">month</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">days<span class="dash">-</span>to<span class="dash">-</span>month</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">doy</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">epoch<span class="dash">-</span>shift</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">has<span class="dash">-</span>year<span class="dash">-</span>zero?</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">bool</span><span class="tp sp">,</span> <span class="tp tpp">month<span class="dash">-</span>prefix</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">show<span class="dash">-</span>era</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp sp">(</span><span class="tp">date</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">calendar</span></span></a>(
  <span class="st">"IW"</span>, <span class="st">"ISO Week"</span>, 
  <a class="pp" href="#isow_days_before_year">isow-days-before-year<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>isow<span class="dash">-</span>days<span class="dash">-</span>before<span class="dash">-</span>year: <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>, <a class="pp" href="#isow_estimate_year">isow-estimate-year<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>isow<span class="dash">-</span>estimate<span class="dash">-</span>year: <span class="tp sp">(</span><span class="tp tpp">days</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span></span></a>, 
  <a class="pp" href="#isow_days_before_month">isow-days-before-month<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>isow<span class="dash">-</span>days<span class="dash">-</span>before<span class="dash">-</span>month: <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">month</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>, <a class="pp" href="#isow_doy_to_month">isow-doy-to-month<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>isow<span class="dash">-</span>doy<span class="dash">-</span>to<span class="dash">-</span>month: <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">doy</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>,
  month<span class="dash">-</span>prefix <span class="kw">=</span> <span class="st">"W"</span>  
</span>)

<span class="decl-fun" id="isow_days_before_month"><span class="kw">fun</span> <a class="pp" href="std_time_calendars.html#isow_days_before_month">isow-days-before-month<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>isow<span class="dash">-</span>days<span class="dash">-</span>before<span class="dash">-</span>month: <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">month</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>( <a class="pp">year<span class="pc">year: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a>, <a class="pp">month<span class="pc">month: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> { 
  <span class="number">7</span><a class="pp" href="std_core-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>(<a class="pp">month<span class="pc">month: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">1</span>)
</span>}

<span class="decl-fun" id="isow_doy_to_month"><span class="kw">fun</span> <a class="pp" href="std_time_calendars.html#isow_doy_to_month">isow-doy-to-month<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>isow<span class="dash">-</span>doy<span class="dash">-</span>to<span class="dash">-</span>month: <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">doy</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>( <a class="pp">year<span class="pc">year: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a>, <a class="pp">doy<span class="pc">doy: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> {
  <a class="pp">doy<span class="pc">doy: <span class="tp">int</span></span></a><a class="pp" href="std_core-source.html#_fs_">/<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="fslash">/</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="number">7</span> <a class="pp" href="std_core-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">1</span>
</span>}

<span class="decl-fun" id="isow_days_before_year"><span class="kw">fun</span> <a class="pp" href="std_time_calendars.html#isow_days_before_year">isow-days-before-year<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>isow<span class="dash">-</span>days<span class="dash">-</span>before<span class="dash">-</span>year: <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>( <a class="pp">year<span class="pc">year: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> ) {
  <span class="kw">val</span> <a class="pp">gdays<span class="pc">gdays: <span class="tp">int</span></span></a>   <span class="kw">=</span> <a class="pp" href="#iso_days_before_year">iso-days-before-year<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>iso<span class="dash">-</span>days<span class="dash">-</span>before<span class="dash">-</span>year: <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>(<a class="pp">year<span class="pc">year: <span class="tp">int</span></span></a>)
  <span class="kw">val</span> <a class="pp">weekday<span class="pc">weekday: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp">gdays<span class="pc">gdays: <span class="tp">int</span></span></a><a class="pp" href="std_core-source.html#_perc_">%<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(%): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="number">7</span>  <span class="comment">// Monday=0, Saturday=6 (because 0001-01-01 is a Monday)
</span>  <span class="kw">val</span> <a class="pp">adjust<span class="pc">adjust: <span class="tp">int</span></span></a>  <span class="kw">=</span> <span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">weekday</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a> <a class="pp" href="std_core-source.html#_lt__eq__1">&lt;=<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;=)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <span class="number">3</span>) <span class="kw">then</span> (<span class="number">0</span> <a class="pp" href="std_core-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <a class="pp">weekday<span class="pc">weekday: <span class="tp">int</span></span></a>) <span class="kw">else</span> (<span class="number">7</span> <a class="pp" href="std_core-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <a class="pp">weekday<span class="pc">weekday: <span class="tp">int</span></span></a>)
  <a class="pp">gdays<span class="pc">gdays: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <a class="pp">adjust<span class="pc">adjust: <span class="tp">int</span></span></a>
</span>}

<span class="decl-fun" id="isow_estimate_year"><span class="kw">fun</span> <a class="pp" href="std_time_calendars.html#isow_estimate_year">isow-estimate-year<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>isow<span class="dash">-</span>estimate<span class="dash">-</span>year: <span class="tp sp">(</span><span class="tp tpp">days</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span></span></a>( <a class="pp">days<span class="pc">days: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> {
  <a class="pp" href="#iso_estimate_year">iso-estimate-year<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>iso<span class="dash">-</span>estimate<span class="dash">-</span>year: <span class="tp sp">(</span><span class="tp tpp">days</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span></span></a>( <a class="pp">days<span class="pc">days: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">3</span> )  <span class="comment">// because we stick out at most 3 days into the next year
</span></span>}

<span class="comment">// duplicate from std/time/calendar to reduce dependencies
</span><span class="decl-fun" id="iso_days_before_year"><span class="kw">fun</span> <a class="pp" href="std_time_calendars.html#iso_days_before_year">iso-days-before-year<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>iso<span class="dash">-</span>days<span class="dash">-</span>before<span class="dash">-</span>year: <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>( <a class="pp">year<span class="pc">year: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> ) {
  <span class="kw">val</span> <a class="pp">y<span class="pc">y: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp">year<span class="pc">year: <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#dec">dec<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>dec: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>
  <span class="kw">val</span> <a class="pp">leapdays<span class="pc">leapdays: <span class="tp">int</span></span></a> <span class="kw">=</span> (<a class="pp">y<span class="pc">y: <span class="tp">int</span></span></a><a class="pp" href="std_core-source.html#_fs_">/<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="fslash">/</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="number">4</span> <a class="pp" href="std_core-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <a class="pp">y<span class="pc">y: <span class="tp">int</span></span></a><a class="pp" href="std_core-source.html#_fs_">/<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="fslash">/</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="number">100</span>) <a class="pp" href="std_core-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <a class="pp">y<span class="pc">y: <span class="tp">int</span></span></a><a class="pp" href="std_core-source.html#_fs_">/<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="fslash">/</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="number">400</span>
  <span class="number">365</span><a class="pp" href="std_core-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><a class="pp">y<span class="pc">y: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <a class="pp">leapdays<span class="pc">leapdays: <span class="tp">int</span></span></a>
</span>}

<span class="decl-fun" id="iso_estimate_year"><span class="kw">fun</span> <a class="pp" href="std_time_calendars.html#iso_estimate_year">iso-estimate-year<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>iso<span class="dash">-</span>estimate<span class="dash">-</span>year: <span class="tp sp">(</span><span class="tp tpp">days</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span></span></a>( <a class="pp">days<span class="pc">days: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> {
  <span class="kw">val</span> <a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">era<span class="pc">era: <span class="tp">int</span></span></a>,<a class="pp">yoe<span class="pc">yoe: <span class="tp">int</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a> <span class="kw">=</span> <a class="pp" href="std_core-source.html#divmod">divmod<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>divmod: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span></span></a>(<a class="pp">days<span class="pc">days: <span class="tp">int</span></span></a>,<span class="number">146097</span>)
  <a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><span class="number">1</span> <a class="pp" href="std_core-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">400</span><a class="pp" href="std_core-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><a class="pp">era<span class="pc">era: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> (<span class="number">100</span><a class="pp" href="std_core-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><a class="pp">yoe<span class="pc">yoe: <span class="tp">int</span></span></a>)<a class="pp" href="std_core-source.html#_fs_">/<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="fslash">/</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="number">36525</span>, <a class="pp" href="std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<span class="number">363</span>)<a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>
</span>}


<span class="comment">// ----------------------------------------------------
// ISO month calendar
// ----------------------------------------------------
</span>
<span class="comment">/&#42;
&lt;!--meta
.calendar {
  .sans-serif;
  border: 1px solid black;
}
.mheader {
  font-weight: bold;
}
.separator {
  padding-bottom:0.2ex;
}
.noborder {
  border-left:none;
  border-right:none;
}
.spacer {
  border-left:none;
  border-right:none;
  height:0.4ex;
}
.month {
  td-padding-right: 1ex;
  tr-padding-top: 0.25ex;
  tbody-tr-1-padding-top: 0.5ex;
  .sans-serif
}
--&gt;
This is &#95;not&#95; a standard ISO calendar -- it is named this way because
it is based directly on the standard [ISO week
date](https://en.wikipedia.org/wiki/ISO&#95;week&#95;date) calendar.
The short name of the calendar is &#96;"IM"&#96;.

The "ISO month" calendar takes the ISO week calendar &#95;as is&#95;, but divides
it up in 12 months. This is more familiar than using week numbers to
denote a date. A common ISO week year of 52 weeks is divided into 4
quarters of 13 weeks each. Each quarter has 3 months of 30, 30, and 31
days respectively. So, January has 30 days, February has 30 days too,
March has 31 days, April has 30 days again, etc. On a leap year, we have
an extra leap week 53 that is inserted at the end of the last month,
&amp;ie; adds days 32 to 38 to December. Since quarters are meant to be equal
for business purposes, we generally don't count the leap week as part of
the 4th quarter.

This monthly calendar has many good properties, not the least that it
matches the Gregorian calendar dates very closely[^fn-match], and is based a widely supported standard ISO calendar. Moreover,
it is [perennial](https://en.wikipedia.org/wiki/Perennial&#95;calendar) where
every date in the year always has the same weekday. For example, every
year and every quarter always start on a Monday and end on a Sunday.
Thanksgiving (the 4th Thursday of November) is always on November 23, and
always 31 days before Christmas. Christmas and New year are always on
Sunday, and there is never a Friday the 13th.

[^fn-match]: The month date always matches within 5 days of the
    Gregorian calendar; and 90% of the time, the date is within 3 days. 

When writing down a date in the monthly calendar we prefix the 
month with a capital [M]{.sans-serif} in order to distinguish these
dates from regular Gregorian dates or ISO week dates. For example,


|-----|----------------|----------------|----------------------------------------------------------|---------------|
| Day | Gregorian date | Month date     | Remarks                                                | ISO week date |
+-----|:--------------:|:--------------:+----------------------------------------------------------|:-------------:+
| Mon | 2018-01-01     | 2018-M01-01    | Matches since Monday starts the first week of the year.  | 2018-W01-1    |
| Thu | 2016-11-24     | 2016-M11-23    | Thanksgiving, always on Thursday M11-23 every year.      | 2016-W47-5    |
| Thu | 2013-07-04     | 2013-M07-04    | Independence day is always on Thursday M07-04.           | 2013-W27-4    |
|-----|----------------|----------------|----------------------------------------------------------|---------------|
| Thu | 2004-01-01     | 2004-M01-04    | Since the first week falls partly in 2003M.              | 2004-W01-4    |
| Sun | 2005-01-02     | 2004-M12-38    | Since it is the last day of the leap week of 2004M.      | 2004-W53-7    |
|-----|----------------|----------------|----------------------------------------------------------|---------------|
{ white-space:nowrap; col-4-white-space:normal; col-3-padding-right:1ex;   }


With the regularity of the new calendar, we can reuse the same calendar
pattern for each quarter over and over; unlike the Gregorian calendar it
never changes which makes planning for businesses, schools, government
etc. much simpler. Here is the (perpetual) calendar with the
corresponding ISO week numbers:

~ Begin Calendar { .sans-serif; border: 1px solid #AAA; padding:1ex; }

+~~~:|~~~:|~~~:|~~~:|~~~:|~~~:|~~~:+~~~|~~~~:|~~~~:|~~~~:|~~~~:|~~~~~~~~~~~~~|
|  Quarterly Calendar        ||||||| &amp;quad;  | ISO week numbers   ||||             |{.noborder; text-align:center}
|    |    |    |    |    |    |    |   | Q1  | Q2  | Q3  | Q4  |             |{.noborder; .mheader}
|----|----|----|----|----|----|----|   |     |     |     |     |             |
| Mo | Tu | We | Th | Fr | Sa | Su |   | Jan | Apr | Jul |Oct  |             |{.mheader}
|----|----|----|----|----|----|----|   |     |     |     |     |             |
| 1  | 2  | 3  | 4  | 5  | 6  | 7  |   | 1   | 14  | 27  | 40  |             |
| 8  | 9  | 10 | 11 | 12 | 13 | 14 |   | 2   | 15  | 28  | 41  |             |
| 15 | 16 | 17 | 18 | 19 | 20 | 21 |   | 3   | 16  | 29  | 42  |             |
| 22 | 23 | 24 | 25 | 26 | 27 | 28 |   | 4   | 17  | 30  | 43  |             |
| 29 | 30 |    |    |    |    |    |   | 5   | 18  | 31  | 44  |             |
|----|----|----|----|----|----|----|   |     |     |     |     |             |
|    |    |    |    |    |    |    |   |     |     |     |     |             |{.spacer}
|----|----|----|----|----|----|----|   |     |     |     |     |             |
| Mo | Tu | We | Th | Fr | Sa | Su |   | Feb | May | Aug | Nov |             |{.mheader}
|----|----|----|----|----|----|----|   |     |     |     |     |             |
|    |    | 1  | 2  | 3  | 4  | 5  |   | 5   | 18  | 31  | 44  |             |
| 6  | 7  | 8  | 9  | 10 | 11 | 12 |   | 6   | 19  | 32  | 45  |             |
| 13 | 14 | 15 | 16 | 17 | 18 | 19 |   | 7   | 20  | 33  | 46  |             |
| 20 | 21 | 22 | 23 | 24 | 25 | 26 |   | 8   | 21  | 34  | 47  |             |
| 27 | 28 | 29 | 30 |    |    |    |   | 9   | 22  | 35  | 48  |             |
|----|----|----|----|----|----|----|   |     |     |     |     |             |
|    |    |    |    |    |    |    |   |     |     |     |     |             |{.spacer}
|----|----|----|----|----|----|----|   |     |     |     |     |             |
| Mo | Tu | We | Th | Fr | Sa | Su |   | Mar | Jun | Sep | Dec |             |{.mheader}
|----|----|----|----|----|----|----|   |     |     |     |     |             |
|    |    |    |    | 1  | 2  | 3  |   | 9   | 22  | 35  | 48  |             |
| 4  | 5  | 6  | 7  | 8  | 9  | 10 |   | 10  | 23  | 36  | 49  |             |
| 11 | 12 | 13 | 14 | 15 | 16 | 17 |   | 11  | 24  | 37  | 50  |             |
| 18 | 19 | 20 | 21 | 22 | 23 | 24 |   | 12  | 25  | 38  | 51  |             |
| 25 | 26 | 27 | 28 | 29 | 30 | 31 |   | 13  | 26  | 39  | 52  |             |
|----|----|----|----|----|----|----|   |     |     |     |     |             |
|    |    |    |    |    |    |    |   |     |     |     |     |             |{.spacer}
|----|----|----|----|----|----|----|   |     |     |     |     |             |
|\ 32|\ 33|\ 34|\ 35|\ 36|\ 37|\ 38|   | leap week^&amp;dagger;^     ||| 53  |             |
|----|----|----|----|----|----|----|   |     |     |     |     |             |
{ .month; margin-left:auto; margin-right:auto }

&amp;nbsp;

^&amp;dagger;^ A leap week is inserted
  at the end of December. Upcoming years with a leap week are 2020, 2026, 2032, 2037, and 2043. In
  general, a leap week is inserted whenever the corresponding Gregorian
  year starts and/or ends on a Thursday.

~ End Calendar

-- Daan Leijen, 2016.
&#42;/</span>
<span class="decl-val" id="cal_iso_month"><span class="kw">public</span> <span class="kw">val</span> <a class="pp" href="std_time_calendars.html#cal_iso_month">cal-iso-month<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>cal<span class="dash">-</span>iso<span class="dash">-</span>month: <span class="tp">calendar</span></span></a> <span class="kw">=</span> <a class="pp" href="std_time_calendar-source.html#solar_ecalendar">solar-ecalendar<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendar<span class="fslash last">/</span></span>solar<span class="dash">-</span>ecalendar: <span class="tp sp">(</span><span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">long<span class="dash">-</span>name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">days<span class="dash">-</span>before<span class="dash">-</span>year</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">estimate<span class="dash">-</span>year</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">days</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">days<span class="dash">-</span>before<span class="dash">-</span>month</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">month</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">days<span class="dash">-</span>to<span class="dash">-</span>month</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">doy</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">epoch<span class="dash">-</span>shift</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">has<span class="dash">-</span>year<span class="dash">-</span>zero?</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">bool</span><span class="tp sp">,</span> <span class="tp tpp">month<span class="dash">-</span>prefix</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">show<span class="dash">-</span>era</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp sp">(</span><span class="tp">date</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">calendar</span></span></a>(
  <span class="st">"IM"</span>, <span class="st">"ISO Month"</span>, 
  <a class="pp" href="#isow_days_before_year">isow-days-before-year<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>isow<span class="dash">-</span>days<span class="dash">-</span>before<span class="dash">-</span>year: <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>, <a class="pp" href="#isow_estimate_year">isow-estimate-year<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>isow<span class="dash">-</span>estimate<span class="dash">-</span>year: <span class="tp sp">(</span><span class="tp tpp">days</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span></span></a>, 
  <a class="pp" href="#isom_days_before_month">isom-days-before-month<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>isom<span class="dash">-</span>days<span class="dash">-</span>before<span class="dash">-</span>month: <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">month</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>, <a class="pp" href="#isom_doy_to_month">isom-doy-to-month<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>isom<span class="dash">-</span>doy<span class="dash">-</span>to<span class="dash">-</span>month: <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">doy</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>,
  month<span class="dash">-</span>prefix <span class="kw">=</span> <span class="st">"M"</span>  
</span>)

<span class="decl-fun" id="isom_days_before_month"><span class="kw">fun</span> <a class="pp" href="std_time_calendars.html#isom_days_before_month">isom-days-before-month<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>isom<span class="dash">-</span>days<span class="dash">-</span>before<span class="dash">-</span>month: <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">month</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>( <a class="pp">year<span class="pc">year: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a>, <a class="pp">month<span class="pc">month: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> { 
  <span class="number">30</span><a class="pp" href="std_core-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><a class="pp">month<span class="pc">month: <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#dec">dec<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>dec: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <a class="pp">month<span class="pc">month: <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#dec">dec<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>dec: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><a class="pp" href="std_core-source.html#_fs_">/<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="fslash">/</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="number">3</span>
</span>}

<span class="decl-fun" id="isom_doy_to_month"><span class="kw">fun</span> <a class="pp" href="std_time_calendars.html#isom_doy_to_month">isom-doy-to-month<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>isom<span class="dash">-</span>doy<span class="dash">-</span>to<span class="dash">-</span>month: <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">doy</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>( <a class="pp">year<span class="pc">year: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a>, <a class="pp">doy<span class="pc">doy: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> {
  <span class="kw">val</span> <a class="pp">m<span class="pc">m: <span class="tp">int</span></span></a> <span class="kw">=</span> (<span class="number">100</span><a class="pp" href="std_core-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><a class="pp">doy<span class="pc">doy: <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#inc">inc<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>inc: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>)<a class="pp" href="std_core-source.html#_fs_">/<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="fslash">/</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="number">3034</span>   
  <a class="pp" href="std_core-source.html#min">min<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>min: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>(<a class="pp">m<span class="pc">m: <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#inc">inc<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>inc: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>,<span class="number">12</span>)
</span>}



<span class="comment">// ------------------------------------------------------------------------
// Julian calendar
// ------------------------------------------------------------------------
</span>
<span class="comment">// The [Julian calendar](https://en.wikipedia.org/wiki/Julian&#95;calendar).
// Uses old-style &#96;&#96;BC&#96;&#96; and &#96;&#96;AD&#96;&#96; to display era's.
// The calendar short name is &#96;&#96;JC&#96;&#96;.
</span><span class="decl-val" id="cal_julian"><span class="kw">public</span> <span class="kw">val</span> <a class="pp" href="std_time_calendars.html#cal_julian">cal-julian<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>cal<span class="dash">-</span>julian: <span class="tp">calendar</span></span></a> <span class="kw">=</span> <a class="pp" href="std_time_calendar-source.html#solar_ecalendar">solar-ecalendar<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendar<span class="fslash last">/</span></span>solar<span class="dash">-</span>ecalendar: <span class="tp sp">(</span><span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">long<span class="dash">-</span>name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">days<span class="dash">-</span>before<span class="dash">-</span>year</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">estimate<span class="dash">-</span>year</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">days</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">days<span class="dash">-</span>before<span class="dash">-</span>month</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">month</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">days<span class="dash">-</span>to<span class="dash">-</span>month</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">doy</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">epoch<span class="dash">-</span>shift</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">has<span class="dash">-</span>year<span class="dash">-</span>zero?</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">bool</span><span class="tp sp">,</span> <span class="tp tpp">month<span class="dash">-</span>prefix</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">show<span class="dash">-</span>era</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp sp">(</span><span class="tp">date</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">ts</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">timescale</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">calendar</span></span></a>(
  <span class="st">"JC"</span>, <span class="st">"Julian"</span>, 
  <a class="pp" href="#julian_days_before_year">julian-days-before-year<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>julian<span class="dash">-</span>days<span class="dash">-</span>before<span class="dash">-</span>year: <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>, <a class="pp" href="#julian_estimate_year">julian-estimate-year<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>julian<span class="dash">-</span>estimate<span class="dash">-</span>year: <span class="tp sp">(</span><span class="tp tpp">days</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span></span></a>, 
  <a class="pp" href="#julian_days_before_month">julian-days-before-month<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>julian<span class="dash">-</span>days<span class="dash">-</span>before<span class="dash">-</span>month: <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">month</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>, <a class="pp" href="#julian_doy_to_month">julian-doy-to-month<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>julian<span class="dash">-</span>doy<span class="dash">-</span>to<span class="dash">-</span>month: <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">doy</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>,
  epoch<span class="dash">-</span>shift    <span class="kw">=</span> <span class="number">730121</span>, <span class="comment">// 2000-01-01 - 0000-12-30  // 730121 + 366
</span>  has<span class="dash">-</span>year<span class="dash">-</span>zero? <span class="kw">=</span> <a class="pp" href="std_core-source.html#con_space_False"><span class="co">False</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>False: <span class="tp">bool</span></span></a>,
  show<span class="dash">-</span>era       <span class="kw">=</span> <span class="kw">fun</span>(<a class="pp">d<span class="pc">d: <span class="tp">date</span></span></a><span class="tp kw op">:</span><a class="pp" href="std_time_date-source.html#type_space_date"><span class="tp">date</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>date<span class="fslash last">/</span></span>date: <span class="tp">V</span></span></a>){ <span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">d</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_date-source.html#year">year<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>date<span class="fslash last">/</span></span>year: <span class="tp sp">(</span><span class="tp tpp">date</span> <span class="tp kw op">:</span> <span class="tp">date</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#neg_ques__1">neg?<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>neg?<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>) <span class="kw">then</span> <span class="st">"BC"</span> <span class="kw">else</span> <span class="st">"AD"</span> }
</span>)

<span class="decl-fun" id="julian_days_before_month"><span class="kw">fun</span> <a class="pp" href="std_time_calendars.html#julian_days_before_month">julian-days-before-month<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>julian<span class="dash">-</span>days<span class="dash">-</span>before<span class="dash">-</span>month: <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">month</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>( <a class="pp">year<span class="pc">year: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a>, <a class="pp">month<span class="pc">month: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> { 
  <span class="kw">val</span> <a class="pp">adj<span class="pc">adj: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp" href="#julian_adjust">julian-adjust<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>julian<span class="dash">-</span>adjust: <span class="tp sp">(</span><span class="tp tpp">before<span class="dash">-</span>march?</span> <span class="tp kw op">:</span> <span class="tp">bool</span><span class="tp sp">,</span> <span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>( <a class="pp">month<span class="pc">month: <span class="tp">int</span></span></a><a class="pp" href="std_core-source.html#_lt__eq__1">&lt;=<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;=)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a><span class="number">2</span>, <a class="pp">year<span class="pc">year: <span class="tp">int</span></span></a> )
  (<span class="number">367</span><a class="pp" href="std_core-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><a class="pp">month<span class="pc">month: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">362</span>)<a class="pp" href="std_core-source.html#_fs_">/<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="fslash">/</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="number">12</span> <a class="pp" href="std_core-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <a class="pp">adj<span class="pc">adj: <span class="tp">int</span></span></a>
</span>}

<span class="decl-fun" id="julian_doy_to_month"><span class="kw">fun</span> <a class="pp" href="std_time_calendars.html#julian_doy_to_month">julian-doy-to-month<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>julian<span class="dash">-</span>doy<span class="dash">-</span>to<span class="dash">-</span>month: <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">doy</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>( <a class="pp">year<span class="pc">year: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a>, <a class="pp">doy<span class="pc">doy: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> {
  <span class="kw">val</span> <a class="pp">adj<span class="pc">adj: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp" href="#julian_adjust">julian-adjust<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>julian<span class="dash">-</span>adjust: <span class="tp sp">(</span><span class="tp tpp">before<span class="dash">-</span>march?</span> <span class="tp kw op">:</span> <span class="tp">bool</span><span class="tp sp">,</span> <span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>( <a class="pp">doy<span class="pc">doy: <span class="tp">int</span></span></a><a class="pp" href="std_core-source.html#_lt__eq__1">&lt;=<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;=)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a><span class="number">58</span>,  <a class="pp">year<span class="pc">year: <span class="tp">int</span></span></a>)
  (<span class="number">12</span><a class="pp" href="std_core-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>(<a class="pp">doy<span class="pc">doy: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <a class="pp">adj<span class="pc">adj: <span class="tp">int</span></span></a>) <a class="pp" href="std_core-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">373</span>)<a class="pp" href="std_core-source.html#_fs_">/<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="fslash">/</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="number">367</span>
</span>}

<span class="decl-fun" id="julian_adjust"><span class="kw">fun</span> <a class="pp" href="std_time_calendars.html#julian_adjust">julian-adjust<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>julian<span class="dash">-</span>adjust: <span class="tp sp">(</span><span class="tp tpp">before<span class="dash">-</span>march?</span> <span class="tp kw op">:</span> <span class="tp">bool</span><span class="tp sp">,</span> <span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>( <a class="pp">before-march?<span class="pc">before<span class="dash">-</span>march?: <span class="tp">bool</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a>, <a class="pp">year<span class="pc">year: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> {
  <span class="kw">if</span> (<a class="pp">before-march?<span class="pc">before<span class="dash">-</span>march?: <span class="tp">bool</span></span></a>) <span class="kw">then</span> <span class="number">0</span> <span class="kw">elif</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">year</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><a class="pp" href="std_core-source.html#_perc_">%<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(%): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="number">4</span><a class="pp" href="std_core-source.html#_eq__eq__1">==<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(==)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a><span class="number">0</span>) <span class="kw">then</span> <span class="number">1</span> <span class="kw">else</span> <span class="number">2</span>
</span>}
    
<span class="decl-fun" id="julian_days_before_year"><span class="kw">fun</span> <a class="pp" href="std_time_calendars.html#julian_days_before_year">julian-days-before-year<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>julian<span class="dash">-</span>days<span class="dash">-</span>before<span class="dash">-</span>year: <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>( <a class="pp">year<span class="pc">year: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> ) {
  <span class="kw">val</span> <a class="pp">leapdays<span class="pc">leapdays: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp">year<span class="pc">year: <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#dec">dec<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>dec: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><a class="pp" href="std_core-source.html#_fs_">/<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="fslash">/</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="number">4</span>
  <span class="number">365</span><a class="pp" href="std_core-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><a class="pp">year<span class="pc">year: <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#dec">dec<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>dec: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <a class="pp">leapdays<span class="pc">leapdays: <span class="tp">int</span></span></a>
</span>}

<span class="decl-fun" id="julian_estimate_year"><span class="kw">fun</span> <a class="pp" href="std_time_calendars.html#julian_estimate_year">julian-estimate-year<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>julian<span class="dash">-</span>estimate<span class="dash">-</span>year: <span class="tp sp">(</span><span class="tp tpp">days</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span></span></a>( <a class="pp">days<span class="pc">days: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> {
  <span class="kw">val</span> <a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">era<span class="pc">era: <span class="tp">int</span></span></a>,<a class="pp">yoe<span class="pc">yoe: <span class="tp">int</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a> <span class="kw">=</span> <a class="pp" href="std_core-source.html#divmod">divmod<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>divmod: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span></span></a>(<a class="pp">days<span class="pc">days: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">365</span>, <span class="number">1461</span>)
  <a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><span class="number">4</span><a class="pp" href="std_core-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><a class="pp">era<span class="pc">era: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <a class="pp">yoe<span class="pc">yoe: <span class="tp">int</span></span></a><a class="pp" href="std_core-source.html#_fs_">/<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="fslash">/</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="number">366</span>, <a class="pp" href="std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<span class="number">364</span>)<a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>
</span>}


<span class="comment">// ------------------------------------------------------------------------
// Julian/Gregorian calendar
// ------------------------------------------------------------------------
</span>
<span class="comment">// The combined Julian / Gregorian calendar, using the Julian calendar for dates 
// before 1582-10-15 and the Gregorian calendar otherwise. It is possible to 
// specify a different switch date using the &#96;julian-gregorian&#96; function.
// The calendar short name is &#96;&#96;JG&#96;&#96;.
</span><span class="decl-val" id="cal_jg"><span class="kw">public</span> <span class="kw">val</span> <a class="pp" href="std_time_calendars.html#cal_jg">cal-jg<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>cal<span class="dash">-</span>jg: <span class="tp">calendar</span></span></a> <span class="kw">=</span> <a class="pp" href="#julian_gregorian">julian-gregorian<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>julian<span class="dash">-</span>gregorian: <span class="tp sp">(</span><span class="tp tpp">switch<span class="dash">-</span>date</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">date</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">calendar</span></span></a>(</span>)

<span class="decl-fun" id="julian_gregorian"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_time_calendars.html#julian_gregorian">julian-gregorian<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>julian<span class="dash">-</span>gregorian: <span class="tp sp">(</span><span class="tp tpp">switch<span class="dash">-</span>date</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">date</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">calendar</span></span></a>( <a class="pp">switch-date<span class="pc">switch<span class="dash">-</span>date: <span class="tp op">?</span><span class="tp">date</span></span></a><span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_optional"><span class="tp">date</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="std_time_date-source.html#con_space_Date"><span class="co">Date</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>date<span class="fslash last">/</span></span>Date: <span class="tp sp">(</span><span class="tp tpp">year</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">month</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">day</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">date</span></span></a>(<span class="number">1582</span>,<span class="number">10</span>,<span class="number">15</span>) ) <span class="tp kw op">:</span> <a class="pp" href="std_time_calendar-source.html#type_space_calendar"><span class="tp">calendar</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendar<span class="fslash last">/</span></span>calendar: <span class="tp">V</span></span></a> {
  <span class="decl-fun" id="showera"><span class="kw">fun</span> <a class="pp">showera<span class="pc">showera: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">date</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>( <a class="pp">d<span class="pc">d: <span class="tp">date</span></span></a><span class="tp kw op">:</span><a class="pp" href="std_time_date-source.html#type_space_date"><span class="tp">date</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>date<span class="fslash last">/</span></span>date: <span class="tp">V</span></span></a> ) { 
    <span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">d</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a> <a class="pp" href="std_time_date-source.html#_lt_">&lt;<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>date<span class="fslash last">/</span></span>(&lt;): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">date</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">date</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">switch-date<span class="pc">switch<span class="dash">-</span>date: <span class="tp">date</span></span></a>) {
      <span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">d</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_date-source.html#year">year<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>date<span class="fslash last">/</span></span>year: <span class="tp sp">(</span><span class="tp tpp">date</span> <span class="tp kw op">:</span> <span class="tp">date</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_gt__eq__1">&gt;=<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&gt;=)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <span class="number">1500</span>) <span class="kw">then</span> <span class="st">"CE (O.S.)"</span> <span class="kw">else</span> (<a class="pp" href="#cal_julian">cal-julian<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>cal<span class="dash">-</span>julian: <span class="tp">calendar</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_calendar-source.html#show_era">show-era<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendar<span class="fslash last">/</span></span>show<span class="dash">-</span>era: <span class="tp sp">(</span><span class="tp tpp">calendar</span> <span class="tp kw op">:</span> <span class="tp">calendar</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp">date</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span><span class="tp sp">)</span></span></a>)(<a class="pp">d<span class="pc">d: <span class="tp">date</span></span></a>)
    }
    <span class="kw">else</span> {
      <span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">d</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_date-source.html#year">year<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>date<span class="fslash last">/</span></span>year: <span class="tp sp">(</span><span class="tp tpp">date</span> <span class="tp kw op">:</span> <span class="tp">date</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_lt__eq__1">&lt;=<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;=)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <span class="number">1926</span>) <span class="kw">then</span> <span class="st">"CE (N.S.)"</span> <span class="kw">else</span> (<a class="pp" href="std_time_calendar-source.html#cal_gregorian">cal-gregorian<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendar<span class="fslash last">/</span></span>cal<span class="dash">-</span>gregorian: <span class="tp">calendar</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_calendar-source.html#show_era">show-era<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendar<span class="fslash last">/</span></span>show<span class="dash">-</span>era: <span class="tp sp">(</span><span class="tp tpp">calendar</span> <span class="tp kw op">:</span> <span class="tp">calendar</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp">date</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span><span class="tp sp">)</span></span></a>)(<a class="pp">d<span class="pc">d: <span class="tp">date</span></span></a>)
    }
  </span>}
  <a class="pp" href="std_time_calendar-source.html#combine_earth_calendars">combine-earth-calendars<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendar<span class="fslash last">/</span></span>combine<span class="dash">-</span>earth<span class="dash">-</span>calendars: <span class="tp sp">(</span><span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">long<span class="dash">-</span>name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">switch<span class="dash">-</span>date</span> <span class="tp kw op">:</span> <span class="tp">date</span><span class="tp sp">,</span> <span class="tp tpp">cal1</span> <span class="tp kw op">:</span> <span class="tp">calendar</span><span class="tp sp">,</span> <span class="tp tpp">cal2</span> <span class="tp kw op">:</span> <span class="tp">calendar</span><span class="tp sp">,</span> <span class="tp tpp">mb<span class="dash">-</span>show<span class="dash">-</span>era</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">date</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">calendar</span></span></a>( <span class="st">"JG"</span>, <span class="st">"Julian-Gregorian"</span>, <a class="pp">switch-date<span class="pc">switch<span class="dash">-</span>date: <span class="tp">date</span></span></a>, <a class="pp" href="#cal_julian">cal-julian<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendars<span class="fslash last">/</span></span>cal<span class="dash">-</span>julian: <span class="tp">calendar</span></span></a>, <a class="pp" href="std_time_calendar-source.html#cal_gregorian">cal-gregorian<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>calendar<span class="fslash last">/</span></span>cal<span class="dash">-</span>gregorian: <span class="tp">calendar</span></span></a>, <a class="pp" href="std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">showera<span class="pc">showera: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">date</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>) )
</span>}

</pre>

</div></body>
</html>
