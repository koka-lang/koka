<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <meta name="generator" content="Madoko, version 1.1.3" />
  <meta name="viewport" content="initial-scale=1.0" />
  <meta name="description" content="Provides popup anchor links to headings in a web page.
     This makes it easier for others to link to specific sections
     in a large web manual or book." />
  <title>The Koka Book</title>
  <style type="text/css"  class="link">
  /*# sourceURL=madoko.css */
  
  .madoko .toc>.tocblock .tocblock .tocblock {
    margin-left: 2.25em;
  }
  .madoko .toc>.tocblock .tocblock {
    margin-left: 1.5em;
  }
  .madoko .toc-contents>.tocblock>.tocitem {
    font-weight: bold;
  }
  .madoko .toc {
    margin-top: 1em;
  }
  .madoko p.para-continue {
    margin-bottom: 0pt;
  }
  .madoko .para-block+p {
    margin-top: 0pt;
  }
  .madoko ul.para-block, .madoko ol.para-block {
    margin-top: 0pt;
    margin-bottom: 0pt;
  }
  .madoko ul.para-end, .madoko ol.para-end {
    margin-bottom: 1em;
  }
  .madoko dl {
    margin-left: 0em;
  }
  .madoko blockquote {
    font-style: italic;
  }
  .madoko a.localref {
    text-decoration: none;
  }
  .madoko a.localref:hover {
    text-decoration: underline;
  }
  .madoko .footnotes {
    font-size: smaller;
    margin-top: 2em;
  }
  .madoko .footnotes hr {
    width: 50%;
    text-align: left;
  }
  .madoko .footnote { 
    margin-left: 1em;
  }
  .madoko .footnote-before {
    margin-left: -1em;
    width: 1em;
    display: inline-block;
  }
  .madoko .align-center, .madoko .align-center>p {
    text-align: center !important;
  }
  .madoko .align-center pre {
    text-align: left;
  }
  .madoko .align-center>* {
    margin-left: auto !important;
    margin-right: auto !important;
  }
  .madoko .align-left, .madoko .align-left>p {
    text-align: left !important;
  }
  .madoko .align-left>* {
    margin-left: 0pt !important;
    margin-right: auto !important;
  }
  .madoko .align-right, .madoko .align-right>p {
    text-align: right !important;
  }
  .madoko .align-right>* {
    margin-left: auto !important;
    margin-right: 0pt !important;
  }
  .madoko .align-center>table,
  .madoko .align-left>table,
  .madoko .align-right>table {
    text-align: left !important;
  }
  .madoko .equation-before {
    float: right;
  }
  .madoko .bibitem {
    font-size: smaller;
  }
  .madoko .bibsearch {
    font-size: x-small;
    text-decoration:none;
    color: black;
    font-family: "Segoe UI Symbol", Symbola, serif;
  }
  .madoko .block, .madoko .figure, .madoko .bibitem, .madoko .equation, .madoko div.math {
    margin-top: 1ex;
    margin-bottom: 1ex;
  }
  .madoko .figure {
    padding: 0.5em;
    margin-left: 0pt;
    margin-right: 0pt;
  }
  .madoko .hidden {
    display: none;
  }
  .madoko .invisible {
    visibility: hidden;
  }
  .madoko.preview .invisible {
    visibility: visible;
    opacity: 0.5;
  }
  .madoko code.code, .madoko span.code {
    white-space: pre-wrap;
  }
  .madoko hr, hr.madoko {
    border: none;
    border-bottom: black solid 1px;
    margin-bottom: 0.5ex;
  }
  .madoko .framed>*:first-child {
    margin-top: 0pt;
  }
  .madoko .framed>*:last-child {
    margin-bottom: 0pt;
  }
  .madoko ul.list-style-type-dash {
      list-style-type: none !important;
  }
  .madoko ul.list-style-type-dash > li:before {
      content: "\2013"; 
      position: absolute;
      margin-left: -1em; 
  }
  .madoko table.madoko {
    border-collapse: collapse;
  }
  .madoko td, .madoko th {
    padding: 0ex 0.5ex;
    margin: 0pt;
    vertical-align: top;
  }
  .madoko .cell-border-left {
    border-left: 1px solid black;
  }
  .madoko .cell-border-right {
    border-right: 1px solid black;
  }
  .madoko thead>tr:first-child>.cell-line,
  .madoko tbody:first-child>tr:first-child>.cell-line {
    border-top: 1px solid black;
    border-bottom: none;
  }
  .madoko .cell-line, .madoko .cell-double-line {
    border-bottom: 1px solid black;
    border-top: none;
  }
  .madoko .cell-double-line {
    border-top: 1px solid black;
    padding-top: 1.5px !important;
  }
  .madoko .input-mathpre .MathJax_Display {
    text-align: left !important;
  }
  .madoko div.input-mathpre {
    text-align: left;
    margin-top: 1.5ex;
    margin-bottom: 1ex;
  }
  .madoko .math-rendering {
    text-align: left;
    white-space: pre;
    color: gray;
  }
  .madoko .mathdisplay {
    text-align: center;
  }
  .madoko .pretty table {
    border-collapse: collapse;
  }
  .madoko .pretty td {
    padding: 0em;
  }
  .madoko .pretty td.empty {
    min-width: 1.5ex;
  }
  .madoko .pretty td.expander {
    width: 100em;
  }
  body.madoko, .madoko .serif {
    font-family: Cambria,"Times New Roman","Liberation Serif","Times",serif;
  }
  .madoko .sans-serif {
    font-family: "Calibri", "Optima", sans-serif;
  }
  .madoko .symbol {
    font-family: "Segoe UI Symbol", Symbola, serif;
  }
  body.madoko {  
    -webkit-text-size-adjust: 100%;       
    text-rendering: optimizeLegibility;
  }
  body.madoko {
    max-width: 88ex; 
    margin: 1em auto;
    padding: 0em 2em;  
  }
  body.preview.madoko {
    padding: 0em 1em;
  }
  .madoko p {
    text-align: justify;
  }
  .madoko h1, .madoko h2, .madoko h3, .madoko h4 { 
    margin-top: 1.22em; 
    margin-bottom: 1ex;
  }
  .madoko h1+p, .madoko h2+p, .madoko h3+p, .madoko h4+p, .madoko h5+p  { 
    margin-top: 1ex;    
  }
  .madoko h5, .madoko h6 { 
    margin-top: 1ex;
    font-size: 1em;
  }
  .madoko h5 { 
    margin-bottom: 0.5ex;
  }
  .madoko h5 + p {
    margin-top: 0.5ex;
  }
  .madoko h6 { 
    margin-bottom: 0pt;
  }
  .madoko h6 + p {
    margin-top: 0pt;
  }
  .madoko pre, .madoko code, .madoko kbd, .madoko samp, .madoko tt, 
  .madoko .monospace, .madoko .token-indent, .madoko .reveal pre, .madoko .reveal code, .madoko .email {
    font-family: Consolas,"Andale Mono WT","Andale Mono",Lucida Console,Monaco,monospace,monospace;
    font-size: 0.85em;
  }
  .madoko pre code, .madoko .token-indent {
    font-size: 0.95em;
  }
  .madoko pre code {
    font-family: inherit !important;
  }
  .madoko ol.linenums li {
    background-color: white;
    list-style-type: decimal;
  }
  .madoko .remote {
    background-color: #F0FFF0;
  }
  .madoko .remote + * {
    margin-top: 0pt;
  }
  @media print {
    body.madoko {
      font-size: 10pt;
    }
    @page {
      margin: 1in 1.5in;
    }
  }
  @media only screen and (max-device-width:1024px) {
    body.madoko {
      padding: 0em 0.5em;    
    }
    .madoko li {
      text-align: left;
    }
  }
  
    </style>
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Noto+Sans:400,400italic,700,700italic"  class="link">
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Noto+Serif:400,400italic,700,700italic"  class="link">
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700,400italic"  class="link">
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto+Slab:300,400,700"  class="link">
  <style type="text/css"  class="link">
  /*# sourceURL=styles/koka.css */
  
  @media screen {
    body {
      max-width: 52em;
      margin: 1em auto;
      padding: 0em 1ex 45em 1ex; 
    }
    .koka.doc p {
      text-align: left;
    }
  }
  @media print {
    body {
      font-size: 9pt;
      margin: 0pt;
    }
    h2,h3,h4 { 
      page-break-after: avoid; 
    }  
    p { 
      text-align: justify;
    }
    @page:left  { margin: 8% 5% 8% 5%; }
    @page:right { margin: 8% 5% 8% 5%; }
  }
  body {
    -webkit-text-size-adjust: 100%;   
    color: black;
  }
  .sans-serif { 
    font-family: 'Noto Sans', 'Segoe UI', 'DejaVu Sans', sans-serif;
  }
  body,
  .koka .comment,
  .serif {
    font-family: 'Noto Serif', Cambria, "Times New Roman", "Liberation Serif", "Times", serif;
  }
  h1 { 
    font-size: 175%; 
  }
  .sans-section { 
    font-family: 'Century Gothic', 'Apple Gothic', 'Optima', 'URW Gothic L',  sans-serif; 
  }
  .koka.source,
  .koka.codeblock,
  .koka.preblock, 
  code, code.koka, .koka .code, .madoko code,
  pre, pre.koka, .madoko pre,
  .monospace { 
    font-family: "Roboto Mono", Consolas, "Andale Mono WT", "Andale Mono", Lucida Console, Monaco, monospace,monospace;
  }
  code, code.koka, .koka .code, .madoko code 
  { 
    font-size: 0.95em;
  }
  pre code code, .madoko pre code code {
    font-size: 1em;
  }
  .koka.codeblock,
  .koka.preblock,
  .koka.source  { 
    padding: 0.5ex 1ex 0.5ex 1ex;
  }
  .koka.source.unchecked {
  }
  .koka.source-body .source {
    margin-right: 1ex;
  }
  .koka .dash { 
    margin-left: -0.25ex; margin-right: -0.25ex
  }
  .koka .minus {
    font-weight: bold;
  }
  .koka .fslash {
    font-size: 90%;  
  }
  .koka .fslash .last {
    margin-right: 0.5ex;
  }
  .koka .postfix { 
    color: gray 
  }
  .koka.source,
  .koka.codeblock,
  .koka.preblock,
  .koka.code, code,
  .koka.pre, pre { 
    white-space: pre-wrap 
  }
  .koka.doc .comment p {
    margin: 0pt;
    margin-bottom: 0.5ex;
  }
  .plaincode  { 
    display: none;
    white-space: pre-wrap;
  }
  .koka.source a:hover,
  .koka.code a:hover, code.koka a:hover
  .koka.pre a:hover, pre.koka a:hover { 
    text-decoration: none 
  }
  .koka .type, .koka .tp          { color: teal }
  .koka .keyword, .koka .kw       { color: blue }     
  .koka .string, .koka .st        { color: maroon }
  .koka .module, .koka .mo        { color: navy }
  .koka .number, .koka .nu        { color: black }
  .koka .constructor, .koka .co   {  color: purple }
  .koka .namespace, .koka .mo     { color: navy }
  .koka .comment                  { color: green }
  .koka .type.typeparam, .koka .tp.tpp { color: #555 }
  .koka .type.typevar, .koka .tp.tv    { font-style: italic }
  .koka .type.keyword.operator, .koka .tp.kw.op { color: teal }
  .koka.emph {
    font-style: italic;
    color: black;
  }
  .koka.preblock,     
  .koka.codeblock
        { display: block 
        ; margin-top: 1ex
        ; margin-bottom: 1ex
        }
  .koka.line
        { display: block
        ; border-bottom: 1px dotted
        ; margin-top: 3px
        ; width: 75%
        }
  .koka .error, 
  .koka .warning { 
    border-bottom: dotted;
    border-width: 2px;
  }
  .koka .error    { border-color: red }
  .koka .warning  { border-color: teal }
  .koka .decl.type,
  .koka .decl.cotype,
  .koka .decl.rectype,
  .koka .decl.fun,
  .koka .decl.val,
  .koka .decl.external { 
  }
  .koka .decl.alias,
  .koka .decl.alias .koka .keywordop { 
    color: teal 
  }
  a.pp    { 
    position: relative;
    text-decoration: none;
    color: black;
  }
  .pc { 
    display: none;
  }
  a.pp:hover  { 
    z-index: 100;
    text-decoration: none;
  }
  a.pp:hover .pc, .tooltip { 
    display:block;
    position:absolute;
    top:1.5em;
    left:2ex;
    padding: 0.2ex 0.75ex 0.2ex 0.5ex;
    border:1px solid black;
    background: #FFFFE8;   
    white-space: pre;
  }
  a.pp a.pp:hover .pc
    { top: 3em }
  .koka.doc>pre.source {
    background-color: #F0F0F0;
    border: 1px solid #AAA;
  }
  h1.koka.module
        { font-weight: normal
        }
  .koka .toc-link 
        { font-size: 12pt
        ; float: right
        ; color: navy
        }
  .koka.doc .header
        { background: #F0F0F0
        ; padding: 0.25ex
        ; padding-left: 0.5ex
        ; margin-top: 0px
        ; margin-bottom: 0.5em
        }
  .koka.doc .link 
        { text-decoration: none
        ; color: black
        }
  .koka.doc .doc.comment
        { color: black;
        }
  .koka.doc .decl .decl
        { margin-left: 1em 
        }
  .koka.doc .decl .comment
        { margin: 0em 0em 0em 1em }
  .koka.doc.body>.comment
        { margin-bottom: 1em }
  .koka.doc .decl, 
  .koka.doc .con-decl
        { margin-top: 1.2em
        ; border: 1px solid #AAA
        ; border-width: 1px 0px 0px 1px
        }
  div.nested { 
    margin: 1.25em 0em 1.25em 1em 
  }
  .koka.doc .nested .decl
        { margin-left: 0em }  
  .koka.doc .con-decl
        { 
        ; margin-left: 1em
        ; margin-top: 0.5em
        ; margin-bottom: 0.5em
        }
  .koka.doc ul.toc 
        { list-style-type: none
        ; margin: 0em
        ; float: left;
        ; clear: none;
        ; padding: 0.5ex 1.5ex 1ex 0.5ex
        ; white-space: nowrap
        ; border-bottom: 1px solid #AAA
        }
  .koka.doc ul.toc li.nested
        { padding-left: 1em
        }
  .koka.doc div.toc 
        { overflow: auto
        ; width: 100%
        }
  .koka.doc div.toc+.doc {
    margin: 1em 0em;
    padding: 1em 0em;
  }
  .koka.doc table.index td {
    vertical-align: top;
    padding-right: 1em;
  }
  .koka.doc table.index .nested1 {
    margin-left: 1.5ex;
  }
  .koka.doc table.index .nested2 {
    margin-left: 2.75ex;
  }
  .koka.doc table.index .nested3 {
    margin-left: 4ex;
  }
  
    </style>
  <style type="text/css"  class="link">
  /*# sourceURL=styles/kokaspec.css */
  .tocitem {
    font-weight: normal !importan;
  }
  .koka.source, .madoko .koka.source {
    border-left: 0.5ex solid green;
  } 
  code, .madoko code,
  pre, .madoko pre,
  .koka.source.unchecked {
    background-color: #F0F0F0;
  }
  pre, .madoko pre,
  .koka.source,
  .koka.source.unchecked {
    border-left: 0.5ex solid #BBB; 
    padding: 0.5ex 1ex 0.5ex 2ex;
  }
  code, .madoko code {
    padding-right: 0.2ex;
  }
  .grammar table,
  table.grammar  {   
    margin: 0.5ex 0.5ex 0.5ex 2ex;
    padding: 0.5ex 1ex 0.5ex 1ex;
  }
  .grammar .code,
  .grammar code {
    padding: 0pt;
  }
  .grammar .bar {
    padding: 0ex 0.5ex;
  }
  .grammar td:nth-child(2) {
    font-style: normal; 
    padding: 0em 1ex;
    text-align: center;
  }
  .grammar td:nth-child(4) {
    font-style: normal; 
    padding-left: 2ex;
  }
  .grammar td {
    white-space: nowrap;
  }
  .grammar .code, .grammar code,
  .grammar .pre, .grammar pre {
    font-weight: bold;
  }
  table .kw, table .tp, table .co,
  .grammar .keyword, .grammar .kw,
  .grammar .type, .grammar .tp,
  .grammar .constructor, .grammar .co {
    color: black;
  }
  .nt {
    font-style: italic;
  }          
  .opt, .many {   
    padding: 0ex 0.5ex;
  }
  #toc {
    display: none;
  }
  #toc-toggle {
    cursor: pointer;
    vertical-align: center;
    margin-right: 10px;
    font-size: 16pt;
  }
  
    </style>
  <script  class="script">function genFullGrammar() {
    var fullLex = "";
    var fullParse = "";
    var divLex = document.getElementById("full-lexical");
    var divGrammar = document.getElementById("full-grammar");
    if (!divLex || !divGrammar) return; 
  
    var gs = document.getElementsByClassName("grammar");
    for(var i = 0; i < gs.length; i++) {
      var elem = gs[i];
      if (elem.tagName.toLowerCase() != "table") continue;
      if (elem.className.indexOf("lex") >= 0) fullLex += elem.innerHTML;
      else if (elem.className.indexOf("parse") >= 0) fullParse += elem.innerHTML;
    }
    divLex.innerHTML="<table class='grammar'>\n"+ fullLex + "</table>"; 
    divGrammar.innerHTML="<table class='grammar'>\n" + fullParse + "</table>";
  }
  
  window.onload = function() { genFullGrammar() };
  
  //# sourceURL=scripts/kokaspec.js
  </script>
  <!-- NO_CLICK_TRACKING -->
    <!--
      Copyright 2012-2016 Microsoft Corporation.
     
      This is free software; you can redistribute it and/or modify it under the
      terms of the Apache License, Version 2.0. A copy of the License can be
      found in the file "license.txt" at the root of this distribution.
    -->
  <style>
    /* ---------------------------------------------
          Center document in the viewport
        ----------------------------------------------*/
        body.madoko {
          margin: 0pt;
          padding: 0pt;
          max-width: 100%;
        }
        .body {
          width: 70em;
          max-width: 90%;
          margin: 1em auto;
        }
        .preview .body {
          width: 98%;
          max-width: 100%;
          margin: 0.25em auto;
        }
        
        /* -----------------------------------------
           Settings for a wide viewport:
           The contents are shown in the side panel
           on the left side.
        -------------------------------------------- */
        @media (min-width: 1024px) {
          body.madoko {
            padding-right: 8%; /* looks more balanced with sidepanel */
          }       
          .sidepanel {
            width   : 14rem ; 
            position: fixed;
            top     : 3rem ;
            max-height: 90%;
            overflow-y: auto;
          }
          .mainpanel, .footnotes, .titleblock {
            margin-left: calc(14rem + 4rem + 2px + 1rem);
          }
          .tocblock2, .tocblock3 {
            display:none;
          }
          .tocblock.auto-expands, .tocblock.click-expands {
            display:block;
          }     
          /*
          .tocitem.current::after {
            content: "\00A0\25CF";
          }
          */
          .tocitem.current .heading-label {
            font-weight: bold;
          }      
          span.unexpanded, span.expanded {
            display: inline-block;
            width: 1.25em;
            margin-left: -1.25em;
            font-family: "Segoe UI Symbol", Symbola, serif;
            font-size: 70%;
            cursor: pointer;
            vertical-align: 0.1em;
          }
          span.unexpanded::before {
            content: "\25B6";
          }
          span.expanded::before {
            content: "\25BC";
          }
        }
        
        /* ---------------------------------------------------
           Set margins and padding for side panel and sections
        ------------------------------------------------------ */
        .sidepanel, .mainpanel section, .footnotes {
          padding: 0pt 1rem 0.25rem 1rem;
        }
        .sidepanel .tocblock {
          font-size  : small;
          white-space: nowrap;
        }
        .sidepanel .toc, .sidepanel h2, .sidepanel h1 {
          margin-top: 0pt;
        }
        .footnotes {
          padding-top: 0.5em; 
        }
        .footnotes>hr {
          display:none;
        }
        section,.sidepanel {
          margin-bottom: 1em;
        }
        
        /* -----------------------------------
           Nice scrollbar for toc
        ----------------------------------- */
        .sidepanel::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }     
        /* Track */
        .sidepanel::-webkit-scrollbar-track {
            -webkit-box-shadow: inset 0 0 4px rgba(0,0,0,0.3); 
            -webkit-border-radius: 6px;
            border-radius: 6px;
        }    
        /* Handle */
        .sidepanel::-webkit-scrollbar-thumb {
            -webkit-border-radius: 6px;
            border-radius: 6px;
            background: lightgray; 
            -webkit-box-shadow: inset 0 0 4px rgba(0,0,0,0.5); 
        }
        .sidepanel::-webkit-scrollbar-thumb:window-inactive {
          background: gainsboro; 
        }
        .madoko .toc > .tocblock .tocblock .tocblock {
          margin-left: 1.5em;
        }
        .madoko .toc a {
          color: #444; 
        }
    h0:hover .entity-anchor,
        h1:hover .entity-anchor,
        h2:hover .entity-anchor,
        h3:hover .entity-anchor {
          display: inline-block;
        }
        
        a.entity-anchor {
          color: black;
        }
        
        a.localref.entity-anchor:hover {
          text-decoration: none;
        }
        
        .entity-anchor {
          display: none;
          width: 0.8em;
          margin-left: -0.8em;
          font-family: "Segoe UI Symbol", Symbola, serif;
          font-size: 80%;
        }
  </style>
  </head>
<body class="madoko">

<div class="body madoko" style="font-family:&#39;Noto Serif&#39;,&#39;Cambria&#39;, &quot;Times New Roman&quot;, &quot;Liberation Serif&quot;, &quot;Times&quot;, serif;line-adjust:0">

<div class="titleblock align-center para-block" style="text-align:center;line-adjust:0">
<div class="titleheader align-center" style="text-align:center;line-adjust:0">
<div class="title para-block" style="font-size:xx-large;font-weight:bold;margin-bottom:0.5ex;line-adjust:0">The Koka Book</div>
<div class="subtitle para-block" style="font-size:x-large;margin-bottom:0.5ex;line-adjust:0">An Introduction and Specification of the Koka language.</div></div></div>
<div class="sidepanel">
<span data-line=""></span>
<nav class="toc toc-contents" style="font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif">
<div class="tocblock tocblock1">
<div class="tocitem tocitem1" data-toc-target-elem="h1" data-toc-target="sec-getting-started" data-toc-depth="1" data-toc-line="[1]{.heading-label}.&#8194;Getting started" style="toctarget:sec-getting-started"><a href="#sec-getting-started" class="localref"><span class="heading-label">1</span>.&#8194;Getting started</a></div>
<div class="tocblock tocblock2">
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-installing-the-compiler" data-toc-depth="2" data-toc-line="[1.1]{.heading-label}.&#8194;Installing the compiler" style="toctarget:sec-installing-the-compiler"><a href="#sec-installing-the-compiler" class="localref"><span class="heading-label">1.1</span>.&#8194;Installing the compiler</a></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-running-the-interactive-compiler" data-toc-depth="2" data-toc-line="[1.2]{.heading-label}.&#8194;Running the interactive compiler" style="toctarget:sec-running-the-interactive-compiler"><a href="#sec-running-the-interactive-compiler" class="localref"><span class="heading-label">1.2</span>.&#8194;Running the interactive compiler</a></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-algebraic-effect-handlers" data-toc-depth="2" data-toc-line="[1.3]{.heading-label}.&#8194;Algebraic effect handlers" style="toctarget:sec-algebraic-effect-handlers"><a href="#sec-algebraic-effect-handlers" class="localref"><span class="heading-label">1.3</span>.&#8194;Algebraic effect handlers</a></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-a-primer-on-effect-handlers" data-toc-depth="2" data-toc-line="[1.4]{.heading-label}.&#8194;A primer on effect handlers" style="toctarget:sec-a-primer-on-effect-handlers"><a href="#sec-a-primer-on-effect-handlers" class="localref"><span class="heading-label">1.4</span>.&#8194;A primer on effect handlers</a></div></div>
<div class="tocitem tocitem1" data-toc-target-elem="h1" data-toc-target="sec-an-overview-of-koka" data-toc-depth="1" data-toc-line="[2]{.heading-label}.&#8194;An overview of Koka" style="toctarget:sec-an-overview-of-koka"><a href="#sec-an-overview-of-koka" class="localref"><span class="heading-label">2</span>.&#8194;An overview of Koka</a></div>
<div class="tocblock tocblock2">
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-hello-world" data-toc-depth="2" data-toc-line="[2.1]{.heading-label}.&#8194;Hello world" style="toctarget:sec-hello-world"><a href="#sec-hello-world" class="localref"><span class="heading-label">2.1</span>.&#8194;Hello world</a></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-dot" data-toc-depth="2" data-toc-line="[2.2]{.heading-label}.&#8194;Dot selection" style="toctarget:sec-dot"><a href="#sec-dot" class="localref"><span class="heading-label">2.2</span>.&#8194;Dot selection</a></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-types" data-toc-depth="2" data-toc-line="[2.3]{.heading-label}.&#8194;Types" style="toctarget:sec-types"><a href="#sec-types" class="localref"><span class="heading-label">2.3</span>.&#8194;Types</a></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-anon" data-toc-depth="2" data-toc-line="[2.4]{.heading-label}.&#8194;Anonymous functions" style="toctarget:sec-anon"><a href="#sec-anon" class="localref"><span class="heading-label">2.4</span>.&#8194;Anonymous functions</a></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-effect-types" data-toc-depth="2" data-toc-line="[2.5]{.heading-label}.&#8194;Effect types" style="toctarget:sec-effect-types"><a href="#sec-effect-types" class="localref"><span class="heading-label">2.5</span>.&#8194;Effect types</a></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-semantics-of-effects" data-toc-depth="2" data-toc-line="[2.6]{.heading-label}.&#8194;Semantics of effects" style="toctarget:sec-semantics-of-effects"><a href="#sec-semantics-of-effects" class="localref"><span class="heading-label">2.6</span>.&#8194;Semantics of effects</a></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-combining-effects" data-toc-depth="2" data-toc-line="[2.7]{.heading-label}.&#8194;Combining effects" style="toctarget:sec-combining-effects"><a href="#sec-combining-effects" class="localref"><span class="heading-label">2.7</span>.&#8194;Combining effects</a></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-polymorphic-effects" data-toc-depth="2" data-toc-line="[2.8]{.heading-label}.&#8194;Polymorphic effects" style="toctarget:sec-polymorphic-effects"><a href="#sec-polymorphic-effects" class="localref"><span class="heading-label">2.8</span>.&#8194;Polymorphic effects</a></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-runst" data-toc-depth="2" data-toc-line="[2.9]{.heading-label}.&#8194;Isolated state" style="toctarget:sec-runst"><a href="#sec-runst" class="localref"><span class="heading-label">2.9</span>.&#8194;Isolated state</a></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-a-larger-example--cracking-caesar-encoding" data-toc-depth="2" data-toc-line="[2.10]{.heading-label}.&#8194;A larger example: cracking Caesar encoding" style="toctarget:sec-a-larger-example--cracking-caesar-encoding"><a href="#sec-a-larger-example--cracking-caesar-encoding" class="localref"><span class="heading-label">2.10</span>.&#8194;A larger example: cracking Caesar encoding</a></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-optional-and-named-parameters" data-toc-depth="2" data-toc-line="[2.11]{.heading-label}.&#8194;Optional and named parameters" style="toctarget:sec-optional-and-named-parameters"><a href="#sec-optional-and-named-parameters" class="localref"><span class="heading-label">2.11</span>.&#8194;Optional and named parameters</a></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-structs" data-toc-depth="2" data-toc-line="[2.12]{.heading-label}.&#8194;Structs" style="toctarget:sec-structs"><a href="#sec-structs" class="localref"><span class="heading-label">2.12</span>.&#8194;Structs</a></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-copying" data-toc-depth="2" data-toc-line="[2.13]{.heading-label}.&#8194;Copying" style="toctarget:sec-copying"><a href="#sec-copying" class="localref"><span class="heading-label">2.13</span>.&#8194;Copying</a></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-more-data-types" data-toc-depth="2" data-toc-line="[2.14]{.heading-label}.&#8194;More data types" style="toctarget:sec-more-data-types"><a href="#sec-more-data-types" class="localref"><span class="heading-label">2.14</span>.&#8194;More data types</a></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-matching" data-toc-depth="2" data-toc-line="[2.15]{.heading-label}.&#8194;Matching" style="toctarget:sec-matching"><a href="#sec-matching" class="localref"><span class="heading-label">2.15</span>.&#8194;Matching</a></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-inductive-co-inductive-and-recursive-types" data-toc-depth="2" data-toc-line="[2.16]{.heading-label}.&#8194;Inductive, co-inductive, and recursive types" style="toctarget:sec-inductive-co-inductive-and-recursive-types"><a href="#sec-inductive-co-inductive-and-recursive-types" class="localref"><span class="heading-label">2.16</span>.&#8194;Inductive, co-inductive, and recursive types</a></div></div>
<div class="tocitem tocitem1" data-toc-target-elem="h1" data-toc-target="sec-koka-language-specification" data-toc-depth="1" data-toc-line="[3]{.heading-label}.&#8194;Koka language specification" style="toctarget:sec-koka-language-specification"><a href="#sec-koka-language-specification" class="localref"><span class="heading-label">3</span>.&#8194;Koka language specification</a></div>
<div class="tocblock tocblock2">
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-lexical-syntax" data-toc-depth="2" data-toc-line="[3.1]{.heading-label}.&#8194;Lexical syntax" style="toctarget:sec-lexical-syntax"><a href="#sec-lexical-syntax" class="localref"><span class="heading-label">3.1</span>.&#8194;Lexical syntax</a></div>
<div class="tocblock tocblock3">
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-source-code" data-toc-depth="3" data-toc-line="[3.1.1]{.heading-label}.&#8194;Source code" style="toctarget:sec-source-code"><a href="#sec-source-code" class="localref"><span class="heading-label">3.1.1</span>.&#8194;Source code</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-encoding" data-toc-depth="3" data-toc-line="[3.1.2]{.heading-label}.&#8194;Encoding" style="toctarget:sec-encoding"><a href="#sec-encoding" class="localref"><span class="heading-label">3.1.2</span>.&#8194;Encoding</a></div></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-lexical-grammar" data-toc-depth="2" data-toc-line="[3.2]{.heading-label}.&#8194;Lexical grammar" style="toctarget:sec-lexical-grammar"><a href="#sec-lexical-grammar" class="localref"><span class="heading-label">3.2</span>.&#8194;Lexical grammar</a></div>
<div class="tocblock tocblock3">
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-lexical-tokens" data-toc-depth="3" data-toc-line="[3.2.1]{.heading-label}.&#8194;Lexical tokens" style="toctarget:sec-lexical-tokens"><a href="#sec-lexical-tokens" class="localref"><span class="heading-label">3.2.1</span>.&#8194;Lexical tokens</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-identifiers" data-toc-depth="3" data-toc-line="[3.2.2]{.heading-label}.&#8194;Identifiers" style="toctarget:sec-identifiers"><a href="#sec-identifiers" class="localref"><span class="heading-label">3.2.2</span>.&#8194;Identifiers</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-operators-and-symbols" data-toc-depth="3" data-toc-line="[3.2.3]{.heading-label}.&#8194;Operators and symbols" style="toctarget:sec-operators-and-symbols"><a href="#sec-operators-and-symbols" class="localref"><span class="heading-label">3.2.3</span>.&#8194;Operators and symbols</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-literals" data-toc-depth="3" data-toc-line="[3.2.4]{.heading-label}.&#8194;Literals" style="toctarget:sec-literals"><a href="#sec-literals" class="localref"><span class="heading-label">3.2.4</span>.&#8194;Literals</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-white-space" data-toc-depth="3" data-toc-line="[3.2.5]{.heading-label}.&#8194;White space" style="toctarget:sec-white-space"><a href="#sec-white-space" class="localref"><span class="heading-label">3.2.5</span>.&#8194;White space</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-character-classes" data-toc-depth="3" data-toc-line="[3.2.6]{.heading-label}.&#8194;Character classes" style="toctarget:sec-character-classes"><a href="#sec-character-classes" class="localref"><span class="heading-label">3.2.6</span>.&#8194;Character classes</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-semicolons" data-toc-depth="3" data-toc-line="[3.2.7]{.heading-label}.&#8194;Semicolons?" style="toctarget:sec-semicolons"><a href="#sec-semicolons" class="localref"><span class="heading-label">3.2.7</span>.&#8194;Semicolons?</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec:lex-implementation" data-toc-depth="3" data-toc-line="[3.2.8]{.heading-label}.&#8194;Implementation" style="toctarget:sec:lex-implementation"><a href="#sec:lex-implementation" class="localref"><span class="heading-label">3.2.8</span>.&#8194;Implementation</a></div></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-context-free-syntax" data-toc-depth="2" data-toc-line="[3.3]{.heading-label}.&#8194;Context-free syntax" style="toctarget:sec-context-free-syntax"><a href="#sec-context-free-syntax" class="localref"><span class="heading-label">3.3</span>.&#8194;Context-free syntax</a></div>
<div class="tocblock tocblock3">
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-modules" data-toc-depth="3" data-toc-line="[3.3.1]{.heading-label}.&#8194;Modules" style="toctarget:sec-modules"><a href="#sec-modules" class="localref"><span class="heading-label">3.3.1</span>.&#8194;Modules</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-top-level-declarations" data-toc-depth="3" data-toc-line="[3.3.2]{.heading-label}.&#8194;Top level declarations" style="toctarget:sec-top-level-declarations"><a href="#sec-top-level-declarations" class="localref"><span class="heading-label">3.3.2</span>.&#8194;Top level declarations</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-type-declarations" data-toc-depth="3" data-toc-line="[3.3.3]{.heading-label}.&#8194;Type declarations" style="toctarget:sec-type-declarations"><a href="#sec-type-declarations" class="localref"><span class="heading-label">3.3.3</span>.&#8194;Type declarations</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-value-and-function-declarations" data-toc-depth="3" data-toc-line="[3.3.4]{.heading-label}.&#8194;Value and function declarations" style="toctarget:sec-value-and-function-declarations"><a href="#sec-value-and-function-declarations" class="localref"><span class="heading-label">3.3.4</span>.&#8194;Value and function declarations</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-statements" data-toc-depth="3" data-toc-line="[3.3.5]{.heading-label}.&#8194;Statements" style="toctarget:sec-statements"><a href="#sec-statements" class="localref"><span class="heading-label">3.3.5</span>.&#8194;Statements</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-expressions" data-toc-depth="3" data-toc-line="[3.3.6]{.heading-label}.&#8194;Expressions" style="toctarget:sec-expressions"><a href="#sec-expressions" class="localref"><span class="heading-label">3.3.6</span>.&#8194;Expressions</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-operator-expressions" data-toc-depth="3" data-toc-line="[3.3.7]{.heading-label}.&#8194;Operator expressions" style="toctarget:sec-operator-expressions"><a href="#sec-operator-expressions" class="localref"><span class="heading-label">3.3.7</span>.&#8194;Operator expressions</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-atomic-expressions" data-toc-depth="3" data-toc-line="[3.3.8]{.heading-label}.&#8194;Atomic expressions" style="toctarget:sec-atomic-expressions"><a href="#sec-atomic-expressions" class="localref"><span class="heading-label">3.3.8</span>.&#8194;Atomic expressions</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-matching" data-toc-depth="3" data-toc-line="[3.3.9]{.heading-label}.&#8194;Matching" style="toctarget:sec-matching"><a href="#sec-matching" class="localref"><span class="heading-label">3.3.9</span>.&#8194;Matching</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-handlers" data-toc-depth="3" data-toc-line="[3.3.10]{.heading-label}.&#8194;Handlers" style="toctarget:sec-handlers"><a href="#sec-handlers" class="localref"><span class="heading-label">3.3.10</span>.&#8194;Handlers</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-type-schemes" data-toc-depth="3" data-toc-line="[3.3.11]{.heading-label}.&#8194;Type schemes" style="toctarget:sec-type-schemes"><a href="#sec-type-schemes" class="localref"><span class="heading-label">3.3.11</span>.&#8194;Type schemes</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-types" data-toc-depth="3" data-toc-line="[3.3.12]{.heading-label}.&#8194;Types" style="toctarget:sec-types"><a href="#sec-types" class="localref"><span class="heading-label">3.3.12</span>.&#8194;Types</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-kinds" data-toc-depth="3" data-toc-line="[3.3.13]{.heading-label}.&#8194;Kinds" style="toctarget:sec-kinds"><a href="#sec-kinds" class="localref"><span class="heading-label">3.3.13</span>.&#8194;Kinds</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-implementation" data-toc-depth="3" data-toc-line="[3.3.14]{.heading-label}.&#8194;Implementation" style="toctarget:sec-implementation"><a href="#sec-implementation" class="localref"><span class="heading-label">3.3.14</span>.&#8194;Implementation</a></div></div></div>
<div class="tocitem tocitem1" data-toc-target-elem="h1" data-toc-target="sec-references" data-toc-depth="1" data-toc-line="References" style="toctarget:sec-references"><a href="#sec-references" class="localref">References</a></div>
<div class="tocitem tocitem1" data-toc-target-elem="h1" data-toc-target="sec-full-grammar-specification" data-toc-depth="1" data-toc-line="[A]{.heading-label}.&#8194;Full grammar specification" style="toctarget:sec-full-grammar-specification"><a href="#sec-full-grammar-specification" class="localref"><span class="heading-label">A</span>.&#8194;Full grammar specification</a></div>
<div class="tocblock tocblock2">
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec:full-lexical" data-toc-depth="2" data-toc-line="[A.1]{.heading-label}.&#8194;Lexical syntax" style="toctarget:sec:full-lexical"><a href="#sec:full-lexical" class="localref"><span class="heading-label">A.1</span>.&#8194;Lexical syntax</a></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec:full-grammar" data-toc-depth="2" data-toc-line="[A.2]{.heading-label}.&#8194;Context-free syntax" style="toctarget:sec:full-grammar"><a href="#sec:full-grammar" class="localref"><span class="heading-label">A.2</span>.&#8194;Context-free syntax</a></div></div></div></nav></div>
<div class="mainpanel">
<h1 id="sec-getting-started" class="h1" data-heading-depth="1" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-getting-started" class="entity-anchor localref">&#x1F517;</a><a href="#sec-getting-started" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">1</span>.&#8194;</span>Getting started</h1>
<p class="p noindent">Welcome to the Koka book. This provides an overview and
formal specification of the language. 
For more background information, see:
</p>
<ul class="ul list-star compact">
<li class="li ul-li list-star-li compact-li">The&nbsp;<a href="https://koka-lang.github.io/koka/doc/toc.html" data-linkid="libraries" target="_top">library documentation</a>.
</li>
<li class="li ul-li list-star-li compact-li">The&nbsp;<a href="http://research.microsoft.com/en-us/projects/koka" data-linkid="kokaproject" target="_top">Koka research page</a> and the&nbsp;<a href="http://research.microsoft.com/en-us/projects/koka/2012-overviewkoka.pdf" data-linkid="slides" target="_top">slides</a> of a talk presented Lang.Next (April 2012).
</li>
<li class="li ul-li list-star-li compact-li">The&nbsp;<a href="https://github.com/koka-lang/koka" data-linkid="kokarepo" target="_top">source code</a> of the Koka compiler.
</li>
<li class="li ul-li list-star-li compact-li">The article <em class="em-low1">Algebraic Effects for Functional Programming</em>&nbsp;<span class="citations" style="target-element:bibitem">[<a href="#leijen:algeff" title="Algebraic Effects for Functional Programming
Leijen, 2016" class="bibref localref" style="target-element:bibitem"><span class="cite-number">3</span></a>]</span> about the algebraic effects in Koka.
</li>
<li class="li ul-li list-star-li compact-li">An article about the type system and semantics of Koka&nbsp;<span class="citations" style="target-element:bibitem">[<a href="#leijen:msfp" title="Koka: Programming with Row Polymorphic Effect Types
Leijen, 2014" class="bibref localref" style="target-element:bibitem"><span class="cite-number">2</span></a>]</span>.
</li></ul>
<h2 id="sec-installing-the-compiler" class="h2" data-heading-depth="2" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-installing-the-compiler" class="entity-anchor localref">&#x1F517;</a><a href="#sec-installing-the-compiler" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">1.1</span>.&#8194;</span>Installing the compiler</h2>
<p class="p noindent">At this point there are no binary releases of Koka and you need to build
the compiler yourself. Fortunately, Koka has few dependencies and builds
without problems on most common platforms, e.g. Windows, MacOSX, and
Unix.
</p>
<p class="p indent">The following programs are required to build Koka:
</p>
<ul class="ul list-star compact">
<li class="li ul-li list-star-li compact-li">The&nbsp;<a href="http://www.haskell.org/platform">Haskell platform</a> (version 7.4 or later).
</li>
<li class="li ul-li list-star-li compact-li">The&nbsp;<a href="http://nodejs.org">NodeJS</a> runtime (version 4.2 LTS or later).
</li>
<li class="li ul-li list-star-li compact-li">Some version of&nbsp;<a href="https://help.github.com/articles/set-up-git/">Git</a> for version control.
</li></ul>

<p class="p noindent">All these programs are very easy to install on most platforms.
Now we can build Koka itself: 
</p>
<ol class="ol loose">
<li class="li ol-li loose-li">
<p>First clone the Koka sources with algebraic effects support:
</p>
<pre class="para-block pre-indented" style="display:block"><code><span class="code-escaped"><strong class="strong-star2"><code class="code code2">&gt; git clone https://github.com/koka-lang/koka.git </code></strong></span></code></pre>
<p>You can also use the flag <code class="code code2">-b dev</code> to get the latest development version.
</p></li>
<li class="li ol-li loose-li">
<p>Go to the newly created Koka directory:
</p>
<pre class="para-block pre-indented" style="display:block"><code><span class="code-escaped"><strong class="strong-star2"><code class="code code2">&gt; cd koka</code></strong></span></code></pre></li>
<li class="li ol-li loose-li">
<p>Install any needed Node libraries using the Node package manager: 
</p>
<pre class="para-block pre-indented" style="display:block"><code><span class="code-escaped"><strong class="strong-star2"><code class="code code2">&gt; npm install</code></strong></span></code></pre>
<p>If you are running on MacOSX or Unix, you may have to run this as
<code class="code code2">sudo npm install</code> so that the <code class="code code2">npm</code> package manager has enough
permissions to install the <code class="code code2">jake</code> and <code class="code code2">madoko</code> tools.
</p></li>
<li class="li ol-li loose-li">
<p>Finally, build the compiler and run the Koka interactive environment:
</p>
<pre class="para-block pre-indented" style="display:block"><code><span class="code-escaped"><strong class="strong-star2"><code class="code code2">&gt; jake</code></strong></span></code></pre>
<p>You can type <code class="code code2">jake help</code> to see an overview of all make targets.
</p></li></ol>

<p class="p noindent">The excellent&nbsp;<a href="http://www.sublimetext.com">Sublime</a> text editor is recommended
to edit Koka programs. You can install support for Koka programs using
</p>
<pre class="para-block pre-indented" style="display:block"><code><span class="code-escaped"><strong class="strong-star2"><code class="code code2">&gt; jake sublime</code></strong></span></code></pre>
<p class="p noindent para-continued">After this <code class="code code2">.kk</code> files will be properly highlighted. It is also
recommended to use the newly installed <code class="code code2">snow</code> color theme which is
designed to work well with Koka files.
</p><h2 id="sec-running-the-interactive-compiler" class="h2" data-heading-depth="2" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-running-the-interactive-compiler" class="entity-anchor localref">&#x1F517;</a><a href="#sec-running-the-interactive-compiler" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">1.2</span>.&#8194;</span>Running the interactive compiler</h2>
<p class="p noindent">After running a plain <code class="code code2">jake</code> command, the Koka interactive environment will start:
</p>
<pre class="para-block pre-fenced pre-fenced4" style="display:block"><code>__          _
| |        | |
| | __ ___ | | __ __ _
| |/ // _ \| |/ // _` | welcome to the koka interpreter
|   &lt;| (_) |   &lt;| (_| | version 0.7.0-dev (debug), Jun 30 2016
|_|\_\\___/|_|\_\\__,_| type :? for help

loading: std/core</code></pre>
<p class="p noindent para-continued">Now you can test some expressions:
</p>
<pre class="para-block pre-indented" style="display:block"><code><span class="code-escaped"><strong class="strong-star2"><code class="code code2">&gt; println(&quot;hi koka&quot;)</code></strong></span>
hi koka

<span class="code-escaped"><strong class="strong-star2"><code class="code code2">&gt; :t &quot;hi&quot;</code></strong></span>
<span class="code-escaped"><code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a></code></span>

<span class="code-escaped"><strong class="strong-star2"><code class="code code2">&gt; :t println(&quot;hi&quot;)</code></strong></span>
<span class="code-escaped"><code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_console"><span class="tp">console</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>console: <span class="tp">X</span></span></a> <span class="tp sp">(</span><span class="tp sp">)</span></code></span></code></pre>
<p class="p noindent para-continued">Or load a demo:
</p>
<pre class="para-block pre-indented" style="display:block"><code><span class="code-escaped"><strong class="strong-star2"><code class="code code2">&gt; :l demo/collatz</code></strong></span>
compile: lib/demo/collatz.kk
check  : demo/collatz
modules:
  demo/collatz

<span class="code-escaped"><strong class="strong-star2"><code class="code code2">&gt; main()</code></strong></span>
Collatz(27) took 111 steps.</code></pre>
<p class="p noindent para-continued">And quit the interpreter:
</p>
<pre class="para-block pre-indented" style="display:block"><code><span class="code-escaped"><strong class="strong-star2"><code class="code code2">&gt; :q</code></strong></span>

Before the effect one believes in different causes than one does after the effect.
 -- Friedrich Nietzsche</code></pre>
<p class="p noindent para-continued">You can also run examples in the browser by setting the host:
</p>
<pre class="para-block pre-indented" style="display:block"><code><span class="code-escaped"><strong class="strong-star2"><code class="code code2">&gt; :set --host=browser</code></strong></span>
<span class="code-escaped"><strong class="strong-star2"><code class="code code2">&gt; 1+2</code></strong></span></code></pre>
<p class="p noindent para-continued">Some browser specific demo to try is for example <code class="code code2">demo/dom/conway.kk</code>.
</p><h2 id="sec-algebraic-effect-handlers" class="h2" data-heading-depth="2" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-algebraic-effect-handlers" class="entity-anchor localref">&#x1F517;</a><a href="#sec-algebraic-effect-handlers" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">1.3</span>.&#8194;</span>Algebraic effect handlers</h2>
<p class="p noindent">A novel feature of Koka is a compiled and typed implementation of algebraic 
effect handlers (described in detail in&nbsp;<span class="citations" style="target-element:bibitem">[<a href="#leijen:algeff" title="Algebraic Effects for Functional Programming
Leijen, 2016" class="bibref localref" style="target-element:bibitem"><span class="cite-number">3</span></a>]</span>).
In the interactive environment, you can load various demo files with algebraic 
effects which are located in the <code class="code code2">test/algeff</code> directory. This is by default
included in the search path, so we can load them directly using
the <em class="em-low1">load</em> (<code class="code code2">:l</code>) command:
</p>
<pre class="para-block pre-indented" style="display:block"><code><span class="code-escaped"><strong class="strong-star2"><code class="code code2">&gt; :l scoped</code></strong></span></code></pre>
<p class="p noindent para-continued">Use the <code class="code code2">:?</code> command to get an overview of all commands. After
loading the <code class="code code2">scoped</code> demo, we can run it directly from the interpreter:
    
</p>
<pre class="para-block pre-indented" style="display:block"><code><span class="code-escaped"><strong class="strong-star2"><code class="code code2">&gt; :l scoped</code></strong></span>
compile: test/algeff/scoped.kk
check  : scoped
modules:
  scoped

<span class="code-escaped"><strong class="strong-star2"><code class="code code2">&gt; main()</code></strong></span>
[[3],[2,1],[1,2],[1,1,1]]
(state=12, [[3],[2,1],[1,2],[1,1,1]])
[(state=1, [3]),(state=5, [2,1]),(state=5, [1,2]),(state=9, [1,1,1])]
[[3]]
[42]</code></pre>
<p class="p noindent para-continued">Some interesting demos are:
</p>
<ul class="ul list-star loose">
<li class="li ul-li list-star-li loose-li">
<p><code class="code code2">common.kk</code>: Various examples from the paper &#8220;<em class="em-low1">Algebraic Effects for
Functional Programming</em>&#8221;&nbsp;<span class="citations" style="target-element:bibitem">[<a href="#leijen:algeff" title="Algebraic Effects for Functional Programming
Leijen, 2016" class="bibref localref" style="target-element:bibitem"><span class="cite-number">3</span></a>]</span>. Shows how to implement
common control-flow abstractions like exceptions, state, iterators,
ambiguity, and asynchronous programming.
</p></li>
<li class="li ul-li list-star-li loose-li">
<p><code class="code code2">scoped.kk</code>: Various examples from the paper &#8220;<em class="em-low1">Effect handlers in
Scope</em>&#8221;&nbsp;<span class="citations" style="target-element:bibitem">[<a href="#wu:hscope" title="Effect Handlers in Scope
Wu, Schrijvers, and Hinze, 2014" class="bibref localref" style="target-element:bibitem"><span class="cite-number">5</span></a>]</span>.
</p></li>
<li class="li ul-li list-star-li loose-li">
<p><code class="code code2">nim.kk</code>: Various examples from the paper &#8220;<em class="em-low1">Liberating effects with
rows and handlers</em>&#8221;&nbsp;<span class="citations" style="target-element:bibitem">[<a href="#lindley:liberate" title="Liberating Effects with Rows and Handlers
Hillerstrm and Lindley, 2016" class="bibref localref" style="target-element:bibitem"><span class="cite-number">1</span></a>]</span>.
</p></li>
<li class="li ul-li list-star-li loose-li">
<p><code class="code code2">async*.kk</code>: Various asynchronous effect examples.
</p></li>
<li class="li ul-li list-star-li loose-li">
<p><code class="code code2">parser.kk</code>: Implements parser combinators as an effect.
</p></li></ul>
<h2 id="sec-a-primer-on-effect-handlers" class="h2" data-heading-depth="2" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-a-primer-on-effect-handlers" class="entity-anchor localref">&#x1F517;</a><a href="#sec-a-primer-on-effect-handlers" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">1.4</span>.&#8194;</span>A primer on effect handlers</h2>
<p class="p noindent">Another small demo is <code class="code code2">effs2</code> that demonstrates the ambiguity
and state effect:
</p>
<pre class="para-block pre-indented" style="display:block"><code><span class="code-escaped"><strong class="strong-star2"><code class="code code2">&gt; :l effs2</code></strong></span>
compile: test/algeff/effs2.kk
check  : effs2
modules:
  effs1

<span class="code-escaped"><strong class="strong-star2"><code class="code code2">&gt; main()</code></strong></span>
<span class="code-escaped"><code class="koka">[<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_False"><span class="co">False</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>False: <span class="tp">bool</span></span></a>,<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_True"><span class="co">True</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a>,<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_True"><span class="co">True</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a>,<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_False"><span class="co">False</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>False: <span class="tp">bool</span></span></a>]</code></span>
<span class="code-escaped"><code class="koka">[<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_False"><span class="co">False</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>False: <span class="tp">bool</span></span></a>,<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_False"><span class="co">False</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>False: <span class="tp">bool</span></span></a>,<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_True"><span class="co">True</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a>,<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_True"><span class="co">True</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a>,<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_False"><span class="co">False</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>False: <span class="tp">bool</span></span></a>]</code></span>
<span class="code-escaped"><code class="koka">[<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_False"><span class="co">False</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>False: <span class="tp">bool</span></span></a>,<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_False"><span class="co">False</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>False: <span class="tp">bool</span></span></a>]</code></span></code></pre>
<p class="p noindent para-continued">The <code class="koka">effs2<span class="kw op">.</span>kk</code> module starts by defining the <code class="koka"><a class="pp" href="#type_space_amb"><span class="tp">amb</span><span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>amb: <span class="tp">HX</span></span></a></code> effect:
</p><pre class="koka source"><span class="plaincode">effect amb {
  fun flip() : bool
}
</span><span class="nicecode"><span class="decl-type" id="type_space_amb"><a class="pp"><span class="kw">effect</span><span class="pc">: <span class="tp kw op">.</span><span class="tp">ops<span class="dash">-</span>amb</span><span class="tp sp">&lt;</span><span class="number">14</span><span class="op">&gt;</span></span></a> <a class="pp" href="#type_space_amb"><span class="tp">amb</span><span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>amb: <span class="tp">HX</span></span></a></span> {
  <span class="kw">fun</span> <span class="decl-fun" id="flip"><a class="pp" href="#flip">flip<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>flip: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">amb</span> <span class="tp">bool</span></span></a>() <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a></span>
}
</span></pre>


<p class="p noindent">This declares <code class="koka"><a class="pp" href="#amb">amb<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>amb: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">amb</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp tv">e</span> <span class="tp">list</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span></span></a></code> as a new effect with a single operation <code class="koka"><a class="pp" href="#flip">flip<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>flip: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">amb</span> <span class="tp">bool</span></span></a></code>.
We can use this as:
</p><pre class="koka source"><span class="plaincode">fun xor() : amb bool {
  val p = flip()
  val q = flip()
  (p||q) &amp;&amp; not(p&amp;&amp;q)
}
</span><span class="nicecode"><span class="decl-fun" id="xor"><span class="kw">fun</span> <a class="pp" href="#xor">xor<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>xor: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">amb</span> <span class="tp">bool</span></span></a>() <span class="tp kw op">:</span> <a class="pp" href="#type_space_amb"><span class="tp">amb</span><span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>amb: <span class="tp">HX</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a> {
  <span class="kw">val</span> <a class="pp">p<span class="pc">p: <span class="tp">bool</span></span></a> <span class="kw">=</span> <a class="pp" href="#flip">flip<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>flip: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">amb</span> <span class="tp">bool</span></span></a>()
  <span class="kw">val</span> <a class="pp">q<span class="pc">q: <span class="tp">bool</span></span></a> <span class="kw">=</span> <a class="pp" href="#flip">flip<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>flip: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">amb</span> <span class="tp">bool</span></span></a>()
  (<a class="pp">p<span class="pc">p: <span class="tp">bool</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_bar__bar_">||<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(||): <span class="tp sp">(</span><span class="tp">bool</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a><a class="pp">q<span class="pc">q: <span class="tp">bool</span></span></a>) <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_amp__amp_">&amp;&amp;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&amp;&amp;): <span class="tp sp">(</span><span class="tp">bool</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#not">not<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>not: <span class="tp sp">(</span><span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>(<a class="pp">p<span class="pc">p: <span class="tp">bool</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_amp__amp_">&amp;&amp;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&amp;&amp;): <span class="tp sp">(</span><span class="tp">bool</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a><a class="pp">q<span class="pc">q: <span class="tp">bool</span></span></a>)
</span>}
</span></pre>


<p class="p noindent">where the type of <code class="koka"><a class="pp" href="#xor">xor<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>xor: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">amb</span> <span class="tp">bool</span></span></a></code> reflects that it has a <code class="koka"><a class="pp" href="#amb">amb<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>amb: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">amb</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp tv">e</span> <span class="tp">list</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span></span></a></code> effect and
returns a boolean.
</p>
<p class="p indent">Next, let&#39;s write a handler for this effect:
</p><pre class="koka source"><span class="plaincode">val amb = handler {
  return x -&gt; [x]
  flip()   -&gt; resume(False) + resume(True)
}
</span><span class="nicecode"><span class="decl-val" id="amb"><span class="kw">val</span> <a class="pp" href="#amb">amb<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>amb: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">amb</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw">=</span> <a class="pp"><span class="kw">handler</span><span class="pc">handler: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">amb</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> {
  <a class="pp"><span class="kw">return</span><span class="pc">return: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp tv">&#95;101</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">cps</span><span class="tp sp">|</span><span class="tp tv">&#95;110</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;101</span><span class="tp sp">&gt;</span></span></a> <a class="pp">x<span class="pc">x: <span class="tp tv">&#95;101</span></span></a> <span class="kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_Cons"><span class="co">[</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><a class="pp">x<span class="pc">x: <span class="tp tv">&#95;101</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_Nil"><span class="co">]</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
  <a class="pp" href="#flip">flip<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>flip: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">cps</span><span class="tp sp">|</span><span class="tp tv">&#95;110</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;101</span><span class="tp sp">&gt;</span></span></a>()   <span class="kw op">-></span> <a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">cps</span><span class="tp sp">|</span><span class="tp tv">&#95;110</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;101</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_False"><span class="co">False</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>False: <span class="tp">bool</span></span></a>) <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_plus__4">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+)<span class="postfix">.4</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">ys</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">cps</span><span class="tp sp">|</span><span class="tp tv">&#95;110</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;101</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_True"><span class="co">True</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a>)
</span>}
</span></pre>


<p class="p noindent">When a <code class="koka"><a class="pp" href="#flip">flip<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>flip: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">amb</span> <span class="tp">bool</span></span></a></code> operation is issued, this handler will catch it
dynamically. In the above handler, we resume twice: once with a <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_False"><span class="co">False</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>False: <span class="tp">bool</span></span></a></code>
value as the result for <code class="koka"><a class="pp" href="#flip">flip<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>flip: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">amb</span> <span class="tp">bool</span></span></a></code>, and once with a <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_True"><span class="co">True</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a></code> value. The
<code class="koka"><span class="kw">return</span></code> clause wraps the final result in a list which are concatenated
by the <code class="koka"><a class="pp" href="#flip">flip<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>flip: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">amb</span> <span class="tp">bool</span></span></a></code> handler. The type of the <code class="koka"><a class="pp" href="#amb">amb<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>amb: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">amb</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp tv">e</span> <span class="tp">list</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span></span></a></code> handler is a function that
removes the <code class="koka"><a class="pp" href="#amb">amb<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>amb: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">amb</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp tv">e</span> <span class="tp">list</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span></span></a></code> effect from its argument, and return a list of results:
</p>
<pre class="para-block pre-indented" style="display:block"><code><span class="code-escaped"><strong class="strong-star2"><code class="code code2">&gt; :t amb</code></strong></span>
<span class="code-escaped"><code class="koka"><span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><a class="pp" href="#type_space_amb"><span class="tp">amb</span><span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>amb: <span class="tp">HX</span></span></a><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp tv">e</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-&gt;</span> <span class="tp">V</span></span></a><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span></code></span></code></pre>
<p class="p noindent para-continued">We can now run the <code class="koka"><a class="pp" href="#xor">xor<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>xor: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">amb</span> <span class="tp">bool</span></span></a></code> function using the <code class="koka"><a class="pp" href="#amb">amb<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>amb: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">amb</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp tv">e</span> <span class="tp">list</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span></span></a></code> handler to 
handle the <code class="koka"><a class="pp" href="#flip">flip<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>flip: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">amb</span> <span class="tp">bool</span></span></a></code> operations:
</p><pre class="koka source"><span class="plaincode">fun test1() {
  amb(xor).show.println
}
</span><span class="nicecode"><span class="decl-fun" id="test1"><span class="kw">fun</span> <a class="pp" href="#test1">test1<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>test1: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">console</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>() {
  <a class="pp" href="#amb">amb<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>amb: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">amb</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="#xor">xor<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>xor: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">amb</span> <span class="tp">bool</span></span></a>)<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#show_10">show<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>show<span class="postfix">.10</span>: <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">bool</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#println">println<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>println: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">console</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>
</span>}
</span></pre>


<p class="p noindent">Here we used <em class="em-low1">dot</em> syntax introduced in Section&nbsp;<a href="#sec-dot" title="&#x1F517;#2.2.&#8194;Dot selection" class="localref" style="target-element:h2"><span class="heading-label">2.2</span></a>. If we run
<code class="koka"><a class="pp" href="#test1">test1<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>test1: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">console</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a></code> in the interpreter, we see all possible results:
</p>
<pre class="para-block pre-indented" style="display:block"><code><span class="code-escaped"><strong class="strong-star2"><code class="code code2">&gt; test1()</code></strong></span>
<span class="code-escaped"><code class="koka">[<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_False"><span class="co">False</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>False: <span class="tp">bool</span></span></a>,<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_True"><span class="co">True</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a>,<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_True"><span class="co">True</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a>,<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_False"><span class="co">False</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>False: <span class="tp">bool</span></span></a>]</code></span></code></pre>
<p class="p noindent para-continued"><br>
<strong class="strong-star2"> Adding state</strong><br>
Let&#39;s combine the ambiguity effect with state. The definition
of the state effect is polymorphic in its value:
</p><pre class="koka source"><span class="plaincode">effect state&lt;s&gt; {
  fun get()    : s
  fun set(i:s) : ()
}
</span><span class="nicecode"><span class="decl-type" id="type_space_state"><a class="pp"><span class="kw">effect</span><span class="pc">: <span class="tp kw op">.</span><span class="tp">ops<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="number">19</span>,<span class="number">18</span><span class="op">&gt;</span></span></a> <a class="pp" href="#type_space_state"><span class="tp">state</span><span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>state: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">HX</span></span></a></span><span class="tp sp">&lt;</span><a class="pp"><span class="tp">s</span><span class="pc">s: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
  <span class="kw">fun</span> <span class="decl-fun" id="get"><a class="pp" href="#get">get<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>get: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp tv">a</span></span></a>()    <span class="tp kw op">:</span> </span><a class="pp"><span class="tp tv">s</span><span class="pc">s: <span class="tp">V</span></span></a>
  <span class="kw">fun</span> <span class="decl-fun" id="set"><a class="pp" href="#set">set<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>set: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">i<span class="pc">: <span class="number">7</span></span></a><span class="tp kw op">:</span><a class="pp"><span class="tp tv">s</span><span class="pc">s: <span class="tp">V</span></span></a>) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a></span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a>
}
</span></pre>


<p class="p noindent">Next we define a function that uses both ambiguity and the state
effect:
</p><pre class="koka source"><span class="plaincode">fun foo() : &lt;amb,state&lt;int&gt;&gt; bool {
  val p = flip() 
  val i = get()
  set(i+1)
  if (i&gt;0 &amp;&amp; p) then xor() else False
}
</span><span class="nicecode"><span class="decl-fun" id="foo"><span class="kw">fun</span> <a class="pp" href="#foo">foo<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>foo: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">amb</span><span class="tp sp">,</span><span class="tp">state</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> <span class="tp">bool</span></span></a>() <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_amb"><span class="tp">amb</span><span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>amb: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="#type_space_state"><span class="tp">state</span><span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>state: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">HX</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a> {
  <span class="kw">val</span> <a class="pp">p<span class="pc">p: <span class="tp">bool</span></span></a> <span class="kw">=</span> <a class="pp" href="#flip">flip<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>flip: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">amb</span> <span class="tp">bool</span></span></a>() 
  <span class="kw">val</span> <a class="pp">i<span class="pc">i: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp" href="#get">get<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>get: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp tv">a</span></span></a>()
  <a class="pp" href="#set">set<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>set: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">i<span class="pc">i: <span class="tp">int</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="number">1</span>)
  <span class="kw">if</span> (<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_True"><span class="co">i</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_gt__1">&gt;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&gt;)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a><span class="number">0</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_amp__amp_">&amp;&amp;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&amp;&amp;): <span class="tp sp">(</span><span class="tp">bool</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">p<span class="pc">p: <span class="tp">bool</span></span></a>) <span class="kw">then</span> <a class="pp" href="#xor">xor<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>xor: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">amb</span> <span class="tp">bool</span></span></a>() <span class="kw">else</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_False"><span class="co">False</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>False: <span class="tp">bool</span></span></a>
</span>}
</span></pre>


<p class="p noindent">The handler for the <code class="koka"><a class="pp" href="#type_space_state"><span class="tp">state</span><span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>state: <span class="tp">V</span> <span class="tp kw op">-&gt;</span> <span class="tp">HX</span></span></a></code> effect takes a local parameter that
is propagated through the <code class="koka">resume</code> function. 
</p><pre class="koka source"><span class="plaincode">val state = handler(i) {
  return x -&gt; x
  get()    -&gt; resume(i,i)
  set(j)   -&gt; resume(j,())
}
</span><span class="nicecode"><span class="decl-val" id="state"><span class="kw">val</span> <a class="pp" href="#state">state<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>state: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span></span></a> <span class="kw">=</span> <a class="pp"><span class="kw">handler</span><span class="pc">handler: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span></span></a>(<a class="pp">i<span class="pc">i: <span class="tp tv">&#95;319</span></span></a>) {
  <a class="pp"><span class="kw">return</span><span class="pc">return: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp tv">&#95;319</span><span class="tp sp">,</span> <span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp tv">&#95;320</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">cps</span><span class="tp sp">|</span><span class="tp tv">&#95;324</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;320</span></span></a> <a class="pp">x<span class="pc">x: <span class="tp tv">&#95;320</span></span></a> <span class="kw op">-></span> <a class="pp">x<span class="pc">x: <span class="tp tv">&#95;320</span></span></a>
  <a class="pp" href="#get">get<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>get: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">cps</span><span class="tp sp">|</span><span class="tp tv">&#95;324</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;320</span></span></a>()    <span class="kw op">-></span> <a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp tv">&#95;319</span><span class="tp sp">,</span> <span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp tv">&#95;319</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">cps</span><span class="tp sp">|</span><span class="tp tv">&#95;324</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;320</span></span></a>(<a class="pp">i<span class="pc">i: <span class="tp tv">&#95;319</span></span></a>,<a class="pp">i<span class="pc">i: <span class="tp tv">&#95;319</span></span></a>)
  <a class="pp" href="#set">set<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>set: <span class="tp sp">(</span><span class="tp tv">&#95;319</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">cps</span><span class="tp sp">|</span><span class="tp tv">&#95;324</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;320</span></span></a>(j)   <span class="kw op">-></span> <a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp tv">&#95;319</span><span class="tp sp">,</span> <span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">cps</span><span class="tp sp">|</span><span class="tp tv">&#95;324</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;320</span></span></a>(<a class="pp">j<span class="pc">j: <span class="tp tv">&#95;319</span></span></a>,<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space__lp__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>)
</span>}
</span></pre>


<p class="p noindent">Type of the <code class="koka"><a class="pp" href="#state">state<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>state: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">state</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp tv">e</span> <span class="tp tv">b</span></span></a></code> handler takes an initial state as an extra argument:
</p>
<pre class="para-block pre-indented" style="display:block"><code><span class="code-escaped"><strong class="strong-star2"><code class="code code2">&gt; :t state</code></strong></span>
<span class="code-escaped"><code class="koka"><span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp op">&#62;.</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><a class="pp" href="#type_space_state"><span class="tp">state</span><span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>state: <span class="tp">V</span> <span class="tp kw op">-&gt;</span> <span class="tp">HX</span></span></a><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp tv">e</span> <span class="tp tv">b</span><span class="tp sp">)</span></code></span></code></pre>
<p class="p noindent para-continued">We can now combine the ambiguity handler with the state handler in
two ways (see Section&nbsp;<a href="#sec-anon" title="&#x1F517;#2.4.&#8194;Anonymous functions" class="localref" style="target-element:h2"><span class="heading-label">2.4</span></a> for a primer on anonymous function syntax):
</p><pre class="koka source"><span class="plaincode">fun test2()  {
  state(0){ amb(foo) }
}

fun test3()  {
  amb{ state(0,foo) }
}
</span><span class="nicecode"><span class="decl-fun" id="test2"><span class="kw">fun</span> <a class="pp" href="#test2">test2<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>test2: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">bool</span><span class="tp sp">&gt;</span></span></a>()  {
  <a class="pp" href="#state">state<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>state: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span></span></a>(<span class="number">0</span>){ <a class="pp" href="#amb">amb<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>amb: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">amb</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="#foo">foo<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>foo: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">amb</span><span class="tp sp">,</span><span class="tp">state</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> <span class="tp">bool</span></span></a>) }
</span>}

<span class="decl-fun" id="test3"><span class="kw">fun</span> <a class="pp" href="#test3">test3<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>test3: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">bool</span><span class="tp sp">&gt;</span></span></a>()  {
  <a class="pp" href="#amb">amb<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>amb: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">amb</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>{ <a class="pp" href="#state">state<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>state: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span></span></a>(<span class="number">0</span>,<a class="pp" href="#foo">foo<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>foo: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">amb</span><span class="tp sp">,</span><span class="tp">state</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> <span class="tp">bool</span></span></a>) }
</span>}
</span></pre>


<p class="p noindent">In <code class="koka"><a class="pp" href="#test2">test2<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>test2: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">list</span><span class="tp sp">&#60;</span><span class="tp">bool</span><span class="tp sp">&#62;</span></span></a></code> the state handler is outside and every ambiguity execution
modifies the same global state. In <code class="koka"><a class="pp" href="#test3">test3<span class="pc"><span class="mo">getstarted<span class="fslash last">/</span></span>test3: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">list</span><span class="tp sp">&#60;</span><span class="tp">bool</span><span class="tp sp">&#62;</span></span></a></code> the state handler is inside
and every ambiguity execution has its own local state instead. Can you
predict the outcomes of running the tests?
</p>
<pre class="para-block pre-indented" style="display:block"><code><span class="code-escaped"><strong class="strong-star2"><code class="code code2">&gt; test2()</code></strong></span>
<span class="code-escaped"><code class="koka">[<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_False"><span class="co">False</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>False: <span class="tp">bool</span></span></a>,<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_False"><span class="co">False</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>False: <span class="tp">bool</span></span></a>,<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_True"><span class="co">True</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a>,<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_True"><span class="co">True</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a>,<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_False"><span class="co">False</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>False: <span class="tp">bool</span></span></a>]</code></span>

<span class="code-escaped"><strong class="strong-star2"><code class="code code2">&gt; test3()</code></strong></span>
<span class="code-escaped"><code class="koka">[<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_False"><span class="co">False</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>False: <span class="tp">bool</span></span></a>,<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_False"><span class="co">False</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>False: <span class="tp">bool</span></span></a>]</code></span></code></pre><h1 id="sec-an-overview-of-koka" class="h1" data-heading-depth="1" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-an-overview-of-koka" class="entity-anchor localref">&#x1F517;</a><a href="#sec-an-overview-of-koka" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">2</span>.&#8194;</span>An overview of Koka</h1>
<p class="p noindent">This is a short introduction to the Koka programming language meant for
programmers familiar with languages like C++, C#, or JavaScript.
</p>
<p class="p indent">Koka is a <em class="em-low1">function-oriented</em> language that separates pure values from
side-effecting computations (The word &#8216;koka&#8217; (or &#x52B9;&#x679C;) means
&#8220;effect&#8221; or &#8220;effective&#8221; in Japanese). Koka is also
flexible and <code class="koka"><span class="kw">fun</span></code>: Koka has many features that help programmers to easily
change their data types and code organization correctly even in large-scale
programs, while having a small strongly-typed language core with a familiar
JavaScript like syntax.
</p><h2 id="sec-hello-world" class="h2" data-heading-depth="2" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-hello-world" class="entity-anchor localref">&#x1F517;</a><a href="#sec-hello-world" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">2.1</span>.&#8194;</span>Hello world</h2>
<p class="p noindent">As usual, we start with the familiar <em class="em-low1">Hello world</em> program:<span id=`examplemain`></span>
</p><pre class="koka source"><span class="plaincode">fun main() {
  println("Hello world!") // println output
}
</span><span class="nicecode"><span class="decl-fun" id="main"><span class="kw">fun</span> <a class="pp" href="#main">main<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>main: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">console</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>() {
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#println">println<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>println: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">console</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<span class="st">"Hello world!"</span>) <span class="comment">// println output
</span></span>}
</span></pre>


<p class="p noindent">Koka uses familiar curly-braces syntax where <code class="koka"></code> starts a line
comment. Functions are declared using the <code class="koka"><span class="kw">fun</span></code> keyword. 
</p>
<p class="p indent">If you are reading this on&nbsp;<a href="http://rise4fun.com/koka/tutorial" data-linkid="rise4fun">Rise4Fun</a>, you can click the <em class="em-low1">load in editor</em>
button in the upper right corner of the example to load it into the
editor and run the program.
</p>
<p class="p indent">Here is another short example program that encodes a string using the
<em class="em-low1">Caesar cipher</em>, where each lower-case letter in a string is replaced by the letter
three places up in the alphabet:
</p><pre class="koka source"><span class="plaincode">fun main() { println(caesar("koka is fun")) }

fun encode( s : string, shift : int )
{
  fun encode-char(c) {
    if (c &lt; 'a' || c &gt; 'z') return c
    val base = (c - 'a').int
    val rot  = (base + shift) % 26
    (rot.char + 'a')
  }
  s.map(encode-char)
}

fun caesar( s : string ) : string {
  s.encode( 3 )
}
</span><span class="nicecode"><span class="decl-fun" id="encode"><span class="kw">fun</span> <a class="pp" href="#encode">encode<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>encode: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">shift</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>( <a class="pp">s<span class="pc">s: <span class="tp">string</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a>, <a class="pp">shift<span class="pc">shift: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> )
{
  <span class="decl-fun" id="encode_char"><span class="kw">fun</span> <a class="pp">encode-char<span class="pc">encode<span class="dash">-</span>char: <span class="tp sp">(</span><span class="tp tpp">c</span> <span class="tp kw op">:</span> <span class="tp">char</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">char</span></span></a>(<a class="pp">c<span class="pc">c: <span class="tp">char</span></span></a>) {
    <span class="kw">if</span> (<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_True"><span class="co">c</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_lt_">&lt;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;): <span class="tp sp">(</span><span class="tp">char</span><span class="tp sp">,</span> <span class="tp">char</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <span class="st">'a'</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_bar__bar_">||<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(||): <span class="tp sp">(</span><span class="tp">bool</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">c<span class="pc">c: <span class="tp">char</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_gt_">&gt;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&gt;): <span class="tp sp">(</span><span class="tp">char</span><span class="tp sp">,</span> <span class="tp">char</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <span class="st">'z'</span>) <a class="pp"><span class="kw">return</span><span class="pc">return: <span class="tp">char</span></span></a> <a class="pp">c<span class="pc">c: <span class="tp">char</span></span></a>
    <span class="kw">val</span> <a class="pp">base<span class="pc">base: <span class="tp">int</span></span></a> <span class="kw">=</span> (<a class="pp">c<span class="pc">c: <span class="tp">char</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_dash__3">-<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="dash">-</span>)<span class="postfix">.3</span>: <span class="tp sp">(</span><span class="tp tpp">c</span> <span class="tp kw op">:</span> <span class="tp">char</span><span class="tp sp">,</span> <span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">char</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">total</span> <span class="tp">char</span></span></a> <span class="st">'a'</span>)<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#int">int<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp sp">(</span><span class="tp">char</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>
    <span class="kw">val</span> <a class="pp">rot<span class="pc">rot: <span class="tp">int</span></span></a>  <span class="kw">=</span> (<a class="pp">base<span class="pc">base: <span class="tp">int</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <a class="pp">shift<span class="pc">shift: <span class="tp">int</span></span></a>) <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_perc_">%<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(%): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">26</span>
    (<a class="pp">rot<span class="pc">rot: <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#char">char<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>char: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">char</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_plus__5">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+)<span class="postfix">.5</span>: <span class="tp sp">(</span><span class="tp tpp">c</span> <span class="tp kw op">:</span> <span class="tp">char</span><span class="tp sp">,</span> <span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">char</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">total</span> <span class="tp">char</span></span></a> <span class="st">'a'</span>)
  </span>}
  <a class="pp">s<span class="pc">s: <span class="tp">string</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#map_6">map<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>map<span class="postfix">.6</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">char</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">char</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">string</span></span></a>(<a class="pp">encode-char<span class="pc">encode<span class="dash">-</span>char: <span class="tp sp">(</span><span class="tp tpp">c</span> <span class="tp kw op">:</span> <span class="tp">char</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">char</span></span></a>)
</span>}

<span class="decl-fun" id="caesar"><span class="kw">fun</span> <a class="pp" href="#caesar">caesar<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>caesar: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>( <a class="pp">s<span class="pc">s: <span class="tp">string</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a> {
  <a class="pp">s<span class="pc">s: <span class="tp">string</span></span></a><span class="kw op">.</span><a class="pp" href="#encode">encode<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>encode: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">shift</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>( <span class="number">3</span> )
</span>}
</span></pre>



<p class="p noindent">In this example, we declare a local function <code class="koka">encode<span class="dash">-</span>char</code> which encodes a
single character <code class="koka">c</code>. The final statement <code class="koka">s<span class="kw op">.</span>map(encode<span class="dash">-</span>char)</code> applies the
<code class="koka">encode<span class="dash">-</span>char</code> function to each character in the string <code class="koka">s</code>, returning a
new string where each character is Caesar encoded. The result of the final
statement in a function is also the return value of that function, and you can
generally leave out an explicit <code class="koka"><span class="kw">return</span></code> keyword.
Similarly, Koka&#39;s grammar is constructed in such a way that no semi-colons
are needed to separate statements.
</p><h2 id="sec-dot" class="h2" data-heading-depth="2" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-dot" class="entity-anchor localref">&#x1F517;</a><a href="#sec-dot" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">2.2</span>.&#8194;</span>Dot selection</h2>
<p class="p noindent">Koka is a <em class="em-low1">function-oriented</em> language where <em class="em-low1">functions</em> and <em class="em-low1">data</em> form the
core of the language (in contrast to objects for example). In particular, the
expression <code class="koka">s<span class="kw op">.</span><a class="pp" href="#encode">encode<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>encode: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">shift</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">string</span></span></a>(<span class="number">3</span>)</code> does <em class="em-low1">not</em> select the <code class="koka"><a class="pp" href="#encode">encode<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>encode: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">shift</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">string</span></span></a></code> method from the
<code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a></code> object, but it is simply syntactic sugar for the function call
<code class="koka"><a class="pp" href="#encode">encode<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>encode: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">shift</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">string</span></span></a>(s,<span class="number">3</span>)</code> where <code class="koka">s</code> becomes the first argument. Similarly, <code class="koka">c<span class="kw op">.</span>int</code>
converts a character to an integer by calling <code class="koka">int(c)</code> (and both expressions
are equivalent). The dot notation is intu&#239;tive and quite convenient to
chain multiple calls together, as in:
</p><pre class="koka source"><span class="plaincode">fun showit( s : string ) -&gt; s.encode(3).count.println
</span><span class="nicecode"><span class="decl-fun" id="showit"><span class="kw">fun</span> <a class="pp" href="#showit">showit<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>showit: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">console</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">s<span class="pc">s: <span class="tp">string</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a> ) <span class="kw op">-></span> <a class="pp">s<span class="pc">s: <span class="tp">string</span></span></a><span class="kw op">.</span><a class="pp" href="#encode">encode<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>encode: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">shift</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>(<span class="number">3</span>)<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#count_1">count<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>count<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#println_1">println<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>println<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">console</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a></span>
</span></pre>



<p class="p noindent">for example (where the body desugars as <code class="koka">println(length(<a class="pp" href="#encode">encode<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>encode: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">shift</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">string</span></span></a>(s,<span class="number">3</span>)))</code>). An
advantage of the dot notation as syntactic sugar for function calls is that it
is easy to extend the &#8216;primitive&#8217; methods of any data type: just write a new
function that takes that type as its first argument. In most object-oriented
languages one would need to add that method to the class definition itself
which is not always possible if such class came as a library for example.
</p><h2 id="sec-types" class="h2" data-heading-depth="2" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-types" class="entity-anchor localref">&#x1F517;</a><a href="#sec-types" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">2.3</span>.&#8194;</span>Types</h2>
<p class="p noindent">Koka is also strongly typed. It uses a powerful type inference engine to
infer most types, and types generally do not get in the way. In
particular, you can always leave out the types of any local variables.
This is the case for example for <code class="code code2">base</code> and <code class="code code2">rot</code> values in the
previous example; hover with the mouse over the example to see the types
that were inferred by Koka. Generally, it is good practice though to
write type annotations for function parameters and the function result
since it both helps with type inference, and it provides useful
documentation with better feedback from the compiler.
</p>
<p class="p indent">For the <code class="koka"><a class="pp" href="#encode">encode<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>encode: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">shift</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">string</span></span></a></code> function it is actually essential to give the type of
the <code class="koka">s</code> parameter: since the <code class="koka">map</code> function is defined for both <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-&gt;</span> <span class="tp">V</span></span></a></code>
and <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a></code> types and the program is ambiguous without an annotation.
Try to load the example in the editor and remove the annotation to see
what error Koka produces.
</p><h2 id="sec-anon" class="h2" data-heading-depth="2" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-anon" class="entity-anchor localref">&#x1F517;</a><a href="#sec-anon" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">2.4</span>.&#8194;</span>Anonymous functions</h2>
<p class="p noindent">Koka also allows for anonymous function expressions. For example, instead of
declaring the <code class="koka">encode<span class="dash">-</span>char</code> function, we could just have passed it directly to
the <code class="koka">map</code> function as a function expression:
</p><pre class="koka source"><span class="plaincode">fun encode2( s : string, shift : int )
{
  s.map( fun(c) {
    if (c &lt; 'a' || c &gt; 'z') return c
    val base = (c - 'a').int
    val rot  = (base + shift) % 26
    (rot.char + 'a')
  });
}
</span><span class="nicecode"><span class="decl-fun" id="encode2"><span class="kw">fun</span> <a class="pp" href="#encode2">encode2<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>encode2: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">shift</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>( <a class="pp">s<span class="pc">s: <span class="tp">string</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a>, <a class="pp">shift<span class="pc">shift: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> )
{
  <a class="pp">s<span class="pc">s: <span class="tp">string</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#map_6">map<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>map<span class="postfix">.6</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">char</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">char</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">string</span></span></a>( <span class="kw">fun</span>(<a class="pp">c<span class="pc">c: <span class="tp">char</span></span></a>) {
    <span class="kw">if</span> (<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_True"><span class="co">c</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_lt_">&lt;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;): <span class="tp sp">(</span><span class="tp">char</span><span class="tp sp">,</span> <span class="tp">char</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <span class="st">'a'</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_bar__bar_">||<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(||): <span class="tp sp">(</span><span class="tp">bool</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">c<span class="pc">c: <span class="tp">char</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_gt_">&gt;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&gt;): <span class="tp sp">(</span><span class="tp">char</span><span class="tp sp">,</span> <span class="tp">char</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <span class="st">'z'</span>) <a class="pp"><span class="kw">return</span><span class="pc">return: <span class="tp">char</span></span></a> <a class="pp">c<span class="pc">c: <span class="tp">char</span></span></a>
    <span class="kw">val</span> <a class="pp">base<span class="pc">base: <span class="tp">int</span></span></a> <span class="kw">=</span> (<a class="pp">c<span class="pc">c: <span class="tp">char</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_dash__3">-<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="dash">-</span>)<span class="postfix">.3</span>: <span class="tp sp">(</span><span class="tp tpp">c</span> <span class="tp kw op">:</span> <span class="tp">char</span><span class="tp sp">,</span> <span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">char</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">total</span> <span class="tp">char</span></span></a> <span class="st">'a'</span>)<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#int">int<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp sp">(</span><span class="tp">char</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>
    <span class="kw">val</span> <a class="pp">rot<span class="pc">rot: <span class="tp">int</span></span></a>  <span class="kw">=</span> (<a class="pp">base<span class="pc">base: <span class="tp">int</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <a class="pp">shift<span class="pc">shift: <span class="tp">int</span></span></a>) <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_perc_">%<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(%): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">26</span>
    (<a class="pp">rot<span class="pc">rot: <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#char">char<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>char: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">char</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_plus__5">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+)<span class="postfix">.5</span>: <span class="tp sp">(</span><span class="tp tpp">c</span> <span class="tp kw op">:</span> <span class="tp">char</span><span class="tp sp">,</span> <span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">char</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">total</span> <span class="tp">char</span></span></a> <span class="st">'a'</span>)
  });
</span>}
</span></pre>



<p class="p noindent">It is a bit annoying we had to put the final right-parenthesis after the last
brace. As a convenience, Koka allows anonymous functions to <em class="em-low1">follow</em>
the function call instead. For example, here is how we can print the numbers
<code class="code code2">1</code> to <code class="code code2">10</code>:
</p><pre class="koka source"><span class="plaincode">fun main() { print10() }

fun print10() 
{
  for(1,10) fun(i) {
    println(i)
  }
}
</span><span class="nicecode"><span class="decl-fun" id="print10"><span class="kw">fun</span> <a class="pp" href="#print10">print10<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>print10: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">console</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>() 
{
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#for">for<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>for: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">start</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">end</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<span class="number">1</span>,<span class="number">10</span>) <span class="kw">fun</span>(<a class="pp">i<span class="pc">i: <span class="tp">int</span></span></a>) {
    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#println_1">println<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>println<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">console</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">i<span class="pc">i: <span class="tp">int</span></span></a>)
  }
</span>}
</span></pre>



<p class="p noindent">which is desugared to <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#for">for<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>for: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp tpp">start</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">end</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp tv">e</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp tv">e</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <span class="number">1</span>, <span class="number">10</span>, <span class="kw">fun</span>(i){ println(i) } )</code>. In fact, since we
pass the <code class="koka">i</code> argument directly to <code class="koka">println</code>, we can also the function itself
directly, and write <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#for">for<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>for: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp tpp">start</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">end</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp tv">e</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp tv">e</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<span class="number">1</span>,<span class="number">10</span>,println)</code>.
</p>
<p class="p indent">Anonymous functions without any arguments can be shortened further by leaving
out the <code class="koka"><span class="kw">fun</span></code> keyword and just using braces directly. Here is an example using
the <code class="koka">repeat</code> function:
</p><pre class="koka source"><span class="plaincode">fun main() { printhi10() }

fun printhi10()
{
  repeat(10) {
    println("hi")
  }
}
</span><span class="nicecode"><span class="decl-fun" id="printhi10"><span class="kw">fun</span> <a class="pp" href="#printhi10">printhi10<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>printhi10: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">console</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>()
{
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#repeat_1">repeat<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>repeat<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<span class="number">10</span>) {
    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#println">println<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>println: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">console</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<span class="st">"hi"</span>)
  }
</span>}
</span></pre>



<p class="p noindent">where the body desugars to <code class="koka">repeat( <span class="number">10</span>, <span class="kw">fun</span>(){println(</code><code class="koka">hi</code><code class="koka">)} )</code>. The is
especially convenient for the <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#while">while<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>while: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp tpp">predicate</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">div</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp">bool</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">div</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">div</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a></code> loop since this is not a built-in
operator in Koka but just a regular function:
</p><pre class="koka source"><span class="plaincode">fun main() { print11() }

fun print11() {
  var i := 10
  while { i &gt;= 0 } { 
    println(i)
    i := i - 1 
  }
}
</span><span class="nicecode"><span class="decl-fun" id="print11"><span class="kw">fun</span> <a class="pp" href="#print11">print11<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>print11: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">console</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>() {
  <span class="kw">var</span> <a class="pp">i<span class="pc">i: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;2094</span><span class="tp sp">,</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">:=</span> <span class="number">10</span>
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#while">while<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>while: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">predicate</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">div</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp">bool</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">div</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">div</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> { <a class="pp">i<span class="pc">i: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;2094</span><span class="tp sp">,</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_gt__eq__1">&gt;=<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&gt;=)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <span class="number">0</span> } { 
    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#println_1">println<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>println<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">console</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">i<span class="pc">i: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;2094</span><span class="tp sp">,</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a>)
    <a class="pp">i<span class="pc">i: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;2094</span><span class="tp sp">,</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#set"><span class="kw">:=</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>set: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <a class="pp">i<span class="pc">i: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;2094</span><span class="tp sp">,</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">1</span> 
  }
</span>}
</span></pre>



<p class="p noindent">Note how the first argument to <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#while">while<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>while: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp tpp">predicate</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">div</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp">bool</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">div</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">div</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a></code> is in braces instead of the usual
parenthesis: Koka makes it always explicit whether code is evaluated 
before a function is called (in between parenthesis), or whether 
code is evaluated (potentially
multiple times) by the called function instead (in between braces).
</p><h2 id="sec-effect-types" class="h2" data-heading-depth="2" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-effect-types" class="entity-anchor localref">&#x1F517;</a><a href="#sec-effect-types" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">2.5</span>.&#8194;</span>Effect types</h2>
<p class="p noindent">A novel part about Koka is that it automatically infers all the <em class="em-low1">side effects</em>
that occur in a function. The absence of any effect is denoted as <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_total"><span class="tp">total</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>total: <span class="tp">E</span></span></a></code> (or
<code class="koka"><span class="op">&#60;</span><span class="op">&#62;</span></code>) and corresponds to pure mathematical functions. If a function can raise
an exception the effect is <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_exn"><span class="tp">exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a></code>, and if a function may not terminate the
effect is <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_div"><span class="tp">div</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>div: <span class="tp">X</span></span></a></code> (for divergence). The combination of <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_exn"><span class="tp">exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a></code> and <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_div"><span class="tp">div</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>div: <span class="tp">X</span></span></a></code> is
<code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_pure"><span class="tp">pure</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>pure: <span class="tp">E</span></span></a></code> and corresponds directly to Haskell&#39;s notion of purity. Non-
deterministic functions get the <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_ndet"><span class="tp">ndet</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>ndet: <span class="tp">X</span></span></a></code> effect. The &#8216;worst&#8217; effect is <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_io"><span class="tp">io</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a></code>
and means that a program can raise exceptions, not terminate, be non-
deterministic, read and write to the heap, and do any input/output operations.
Here are some examples of effectful functions:
</p><pre class="koka source"><span class="plaincode">fun square1( x : int ) : total int
{
  return x&#42;x
}

fun square2( x : int ) : io int
{
  println( "a not so secret side-effect" )
  return x&#42;x
}

fun square3( x : int ) : div int
{
  square3( x )
  return x&#42;x
}

fun square4( x : int ) : exn int
{
  error( "oops" )
  return x&#42;x
}
</span><span class="nicecode"><span class="decl-fun" id="square1"><span class="kw">fun</span> <a class="pp" href="#square1">square1<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>square1: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">total</span> <span class="tp">int</span></span></a>( <a class="pp">x<span class="pc">x: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_total"><span class="tp"><span class="effect">total</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>total: <span class="tp">E</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a>
{
  <a class="pp"><span class="kw">return</span><span class="pc">return: <span class="tp">int</span></span></a> <a class="pp">x<span class="pc">x: <span class="tp">int</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><a class="pp">x<span class="pc">x: <span class="tp">int</span></span></a>
</span>}

<span class="decl-fun" id="square2"><span class="kw">fun</span> <a class="pp" href="#square2">square2<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>square2: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">int</span></span></a>( <a class="pp">x<span class="pc">x: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a>
{
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#println">println<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>println: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">console</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <span class="st">"a not so secret side-effect"</span> )
  <a class="pp"><span class="kw">return</span><span class="pc">return: <span class="tp">int</span></span></a> <a class="pp">x<span class="pc">x: <span class="tp">int</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><a class="pp">x<span class="pc">x: <span class="tp">int</span></span></a>
</span>}

<span class="decl-fun" id="square3"><span class="kw">fun</span> <a class="pp" href="#square3">square3<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>square3: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">div</span> <span class="tp">int</span></span></a>( <a class="pp">x<span class="pc">x: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_div"><span class="tp"><span class="effect">div</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>div: <span class="tp">X</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a>
{
  <a class="pp" href="#square3">square3<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>square3: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">div</span> <span class="tp">int</span></span></a>( <a class="pp">x<span class="pc">x: <span class="tp">int</span></span></a> )
  <a class="pp"><span class="kw">return</span><span class="pc">return: <span class="tp">int</span></span></a> <a class="pp">x<span class="pc">x: <span class="tp">int</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><a class="pp">x<span class="pc">x: <span class="tp">int</span></span></a>
</span>}

<span class="decl-fun" id="square4"><span class="kw">fun</span> <a class="pp" href="#square4">square4<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>square4: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp">int</span></span></a>( <a class="pp">x<span class="pc">x: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a>
{
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#error">error<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>error: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">message</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp tv">a</span></span></a>( <span class="st">"oops"</span> )
  <a class="pp"><span class="kw">return</span><span class="pc">return: <span class="tp">int</span></span></a> <a class="pp">x<span class="pc">x: <span class="tp">int</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><a class="pp">x<span class="pc">x: <span class="tp">int</span></span></a>
</span>}
</span></pre>



<p class="p noindent">When the effect is <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_total"><span class="tp">total</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>total: <span class="tp">E</span></span></a></code> we usually leave it out in the type annotation.
For example, when we write:
</p><pre class="koka source"><span class="plaincode">fun square5( x : int ) : int { x&#42;x }
</span><span class="nicecode"><span class="decl-fun" id="square5"><span class="kw">fun</span> <a class="pp" href="#square5">square5<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>square5: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>( <a class="pp">x<span class="pc">x: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> { <a class="pp">x<span class="pc">x: <span class="tp">int</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><a class="pp">x<span class="pc">x: <span class="tp">int</span></span></a> </span>}
</span></pre>



<p class="p noindent">Then the assumed effect is <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_total"><span class="tp">total</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>total: <span class="tp">E</span></span></a></code>. Sometimes, we write an effectful
function, but are not interested in explicitly writing down its effect type.
In that case, we can use a <em class="em-low1">wildcard type</em> which stands for some inferred
type. A wildcard type is denoted by writing an identifier prefixed with an
underscore, or even just an underscore by itself:
</p><pre class="koka source"><span class="plaincode">fun square6( x : int ) : &#95;e int
{
  println("I did not want to write down the io effect")
  return x&#42;x
}
</span><span class="nicecode"><span class="decl-fun" id="square6"><span class="kw">fun</span> <a class="pp" href="#square6">square6<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>square6: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">console</span> <span class="tp">int</span></span></a>( <a class="pp">x<span class="pc">x: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp"><span class="tp tv"><span class="effect">&#95;e</span></span><span class="pc">&#95;e: <span class="tp">E</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a>
{
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#println">println<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>println: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">console</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<span class="st">"I did not want to write down the io effect"</span>)
  <a class="pp"><span class="kw">return</span><span class="pc">return: <span class="tp">int</span></span></a> <a class="pp">x<span class="pc">x: <span class="tp">int</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><a class="pp">x<span class="pc">x: <span class="tp">int</span></span></a>
</span>}
</span></pre>



<p class="p noindent">Hover over <code class="koka"><a class="pp" href="#square6">square6<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>square6: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">console</span> <span class="tp">int</span></span></a></code> to see the inferred effect for <code class="koka"><span class="tp tv">&#95;e</span></code>
</p><h2 id="sec-semantics-of-effects" class="h2" data-heading-depth="2" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-semantics-of-effects" class="entity-anchor localref">&#x1F517;</a><a href="#sec-semantics-of-effects" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">2.6</span>.&#8194;</span>Semantics of effects</h2>
<p class="p noindent">The inferred effects are not just considered as some extra type information on
functions. On the contrary, through the inference of effects, Koka has a very
strong connection to its denotational semantics. In particular, <em class="em-low1">the full type
of a Koka functions corresponds directly to the type signature of the
mathematical function that describes its denotational semantics</em>. For example,
using &#x301A;<code class="koka"><span class="tp tv">t</span></code>&#x301B; to translate a type <code class="koka"><span class="tp tv">t</span></code> into its corresponding
mathematical type signature, we have:
</p><table class="madoko block">
<tbody><tr><td class="tbody tr-even col cell-line col-odd col-first" data-row="0" data-col="1"></td><td class="tbody tr-even col cell-line col-even" data-row="0" data-col="2"></td><td class="tbody tr-even col cell-line col-odd col-last" data-row="0" data-col="3"></td></tr>
<tr><td class="tbody tr-odd tr-first col col-odd col-first" data-row="1" data-col="1">&#x301A;<code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> <span class="tp kw op">-&gt;</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_total"><span class="tp">total</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>total: <span class="tp">E</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a></code>&#x301B;        </td><td class="tbody tr-odd tr-first col col-even" data-row="1" data-col="2"> =&#160;&#160; </td><td class="tbody tr-odd tr-first col col-odd col-last" data-row="1" data-col="3"> &#8484;<sub>32</sub> &#8594; &#8484;<sub>32</sub>                                             </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="2" data-col="1">&#x301A;<code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> <span class="tp kw op">-&gt;</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_exn"><span class="tp">exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a></code>&#x301B;          </td><td class="tbody tr-even col col-even" data-row="2" data-col="2"> =             </td><td class="tbody tr-even col col-odd col-last" data-row="2" data-col="3"> &#8484;<sub>32</sub> &#8594; (1 + &#8484;<sub>32</sub>)                                       </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="3" data-col="1">&#x301A;<code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> <span class="tp kw op">-&gt;</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_pure"><span class="tp">pure</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>pure: <span class="tp">E</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a></code>&#x301B;         </td><td class="tbody tr-odd col col-even" data-row="3" data-col="2"> =             </td><td class="tbody tr-odd col col-odd col-last" data-row="3" data-col="3"> &#8484;<sub>32</sub> &#8594; (1 + &#8484;<sub>32</sub>)<sub>&#8869;</sub>                              </td></tr>
<tr><td class="tbody tr-even tr-last col col-odd col-first" data-row="4" data-col="1">&#x301A;<code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_st"><span class="tp">st</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>st: <span class="tp">H</span> <span class="tp kw op">-&gt;</span> <span class="tp">E</span></span></a><span class="tp sp">&#60;</span><span class="tp tv">h</span><span class="tp sp">&#62;</span><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_pure"><span class="tp">pure</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>pure: <span class="tp">E</span></span></a><span class="tp sp">&#62;</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a></code>&#x301B; </td><td class="tbody tr-even tr-last col col-even" data-row="4" data-col="2"> =             </td><td class="tbody tr-even tr-last col col-odd col-last" data-row="4" data-col="3"> (<em class="em-low1">Heap</em> &#215; &#8484;<sub>32</sub>) &#8594; (<em class="em-low1">Heap</em> &#215; (1 + &#8484;<sub>32</sub>))<sub>&#8869;</sub></td></tr></tbody></table>
<p class="p noindent">In the above translation, we use <em class="em-low1">1 + t</em> as a sum
where we have either a unit 1 (i.e. exception) or a type <em class="em-low1">t</em>, and we use 
<em class="em-low1">Heap &#215; t</em> for a product consisting of a pair of a
heap and a type <em class="em-low1">t</em>. From the above correspondence, we can immediately see that
a <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_total"><span class="tp">total</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>total: <span class="tp">E</span></span></a></code> function is truly total in the mathematical sense, while a stateful
function (<code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_st"><span class="tp">st</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>st: <span class="tp">H</span> <span class="tp kw op">-&gt;</span> <span class="tp">E</span></span></a><span class="tp sp">&#60;</span><span class="tp tv">h</span><span class="tp sp">&#62;</span></code>) that can raise exceptions or not terminate (<code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_pure"><span class="tp">pure</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>pure: <span class="tp">E</span></span></a></code>)
takes an implicit heap parameter, and either does not terminate (&#8869;) or
returns an updated heap together with either a value or an exception (<code class="koka"><span class="number">1</span></code>).
</p>
<p class="p indent">We believe that this semantic correspondence is the true power of full effect
types and it enables effective equational reasoning about the code by a
programmer. For almost all other existing programming languages, even the most
basic semantics immediately include complex effects like heap manipulation and
divergence. In contrast, Koka allows a layered semantics where we can easily
separate out nicely behaved parts, which is essential for many domains, like
safe LINQ queries, parallel tasks, tier-splitting, sand-boxed mobile code,
etc.
</p><h2 id="sec-combining-effects" class="h2" data-heading-depth="2" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-combining-effects" class="entity-anchor localref">&#x1F517;</a><a href="#sec-combining-effects" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">2.7</span>.&#8194;</span>Combining effects</h2>
<p class="p noindent">Often, a function contains multiple effects, for example:
</p><pre class="koka source"><span class="plaincode">fun combine-effects() 
{
  val i = random-int() // non-deterministic
  error("hi")          // exception raising
  combine-effects()    // and non-terminating
}
</span><span class="nicecode"><span class="decl-fun" id="combine_effects"><span class="kw">fun</span> <a class="pp" href="#combine_effects">combine-effects<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>combine<span class="dash">-</span>effects: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">pure</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>() 
{
  <span class="kw">val</span> <a class="pp">i<span class="pc">i: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#random_int">random-int<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>random<span class="dash">-</span>int: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ndet</span> <span class="tp">int</span></span></a>() <span class="comment">// non-deterministic
</span>  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#error">error<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>error: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">message</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp tv">a</span></span></a>(<span class="st">"hi"</span>)          <span class="comment">// exception raising
</span>  <a class="pp" href="#combine_effects">combine-effects<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>combine<span class="dash">-</span>effects: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">|</span><span class="tp tv">&#95;2845</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;2824</span></span></a>()    <span class="comment">// and non-terminating
</span></span>}
</span></pre>



<p class="p noindent">The effect assigned to <code class="koka"><a class="pp" href="#combine_effects">combine<span class="dash">-</span>effects<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>combine<span class="dash">-</span>effects: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">pure</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">&#62;</span> <span class="tp tv">a</span></span></a></code> are <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_ndet"><span class="tp">ndet</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>ndet: <span class="tp">X</span></span></a></code>, <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_div"><span class="tp">div</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>div: <span class="tp">X</span></span></a></code>, and <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_exn"><span class="tp">exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a></code>. We
can write such combination as a <em class="em-low1">row</em> of effects as <code class="koka"><span class="tp sp">&#60;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_div"><span class="tp">div</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>div: <span class="tp">X</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_exn"><span class="tp">exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_ndet"><span class="tp">ndet</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>ndet: <span class="tp">X</span></span></a><span class="tp sp">&#62;</span></code>. When
you hover over the <code class="koka"><a class="pp" href="#combine_effects">combine<span class="dash">-</span>effects<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>combine<span class="dash">-</span>effects: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">pure</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">&#62;</span> <span class="tp tv">a</span></span></a></code> identifiers, you will see that the type
inferred is really <code class="koka"><span class="tp sp">&#60;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_pure"><span class="tp">pure</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>pure: <span class="tp">E</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_ndet"><span class="tp">ndet</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>ndet: <span class="tp">X</span></span></a><span class="tp sp">&#62;</span></code> where <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_pure"><span class="tp">pure</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>pure: <span class="tp">E</span></span></a></code> is a type alias defined as
</p><pre class="koka source unchecked"><span class="plaincode">alias pure = &lt;div,exn&gt;
</span><span class="nicecode"><span class="tp kw">alias</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_pure"><span class="tp">pure</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>pure: <span class="tp">E</span></span></a> <span class="tp kw">=</span> <span class="tp sp">&lt;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_div"><span class="tp">div</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>div: <span class="tp">X</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_exn"><span class="tp">exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">&gt;</span>
</span></pre>


<h2 id="sec-polymorphic-effects" class="h2" data-heading-depth="2" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-polymorphic-effects" class="entity-anchor localref">&#x1F517;</a><a href="#sec-polymorphic-effects" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">2.8</span>.&#8194;</span>Polymorphic effects</h2>
<p class="p noindent">Many functions are polymorphic in their effect. For example, the
<code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#map">map<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>map: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp tv">e</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp tv">e</span> <span class="tp">list</span><span class="tp sp">&#60;</span><span class="tp tv">b</span><span class="tp sp">&#62;</span></span></a></code> function
applies a function <code class="koka">f</code> to each element of a (finite) list. As such, the effect
depends on the effect of <code class="koka">f</code>, and the type of <code class="koka">map</code> becomes:
</p><pre class="koka source unchecked"><span class="plaincode">map : (xs : list&lt;a&gt;, f : (a) -&gt; e b) -&gt; e list&lt;b&gt;
</span><span class="nicecode">map <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span>
</span></pre>



<p class="p noindent">We use single letters (possibly followed by digits) for polymorphic types.
Here, the <code class="koka">map</code> functions takes a list with elements of some type <code class="koka"><span class="tp tv">a</span></code>, and a
function <code class="code code2">f</code> that takes an element of type <code class="koka"><span class="tp tv">a</span></code> and returns a new element of
type <code class="koka"><span class="tp tv">b</span></code>. The final result is a list with elements of type <code class="koka"><span class="tp tv">b</span></code>. Moreover,
the effect of the applied function <code class="koka"><span class="tp tv">e</span></code> is also the effect of the <code class="koka">map</code>
function itself; indeed, this function has no other effect by itself since it
does not diverge, nor raises exceptions.
</p>
<p class="p indent">We can use the notation <code class="koka"><span class="tp sp">&#60;</span><span class="tp tv">l</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span></code> to extend an effect <code class="koka"><span class="tp tv">e</span></code> with another effect
<code class="koka"><span class="tp tv">l</span></code>. This is used for example in the <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#while">while<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>while: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp tpp">predicate</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">div</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp">bool</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">div</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">div</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a></code> function which has type: 
<code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#while">while<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>while: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp tpp">predicate</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">div</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp">bool</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">div</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">div</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span> <span class="tp tpp">pred</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_div"><span class="tp">div</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>div: <span class="tp">X</span></span></a><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_div"><span class="tp">div</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>div: <span class="tp">X</span></span></a><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_div"><span class="tp">div</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>div: <span class="tp">X</span></span></a><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp sp">)</span></code>. 
The <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#while">while<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>while: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp tpp">predicate</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">div</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp">bool</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">div</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">div</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a></code> function takes a
predicate function and an action to perform, both with effect <code class="koka"><span class="tp sp">&#60;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_div"><span class="tp">div</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>div: <span class="tp">X</span></span></a><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span></code>.
Indeed, since while may diverge depending on the predicate its effect must
include divergence.
</p>
<p class="p indent">The reader may be worried that the type of <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#while">while<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>while: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp tpp">predicate</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">div</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp">bool</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">div</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">div</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a></code> forces the predicate and
action to have exactly the same effect <code class="koka"><span class="tp sp">&#60;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_div"><span class="tp">div</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>div: <span class="tp">X</span></span></a><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span></code>, which even includes
divergence. However, when effects are inferred at the call-site, both the
effects of predicate and action are extended automatically until they match.
This ensures we take the union of the effects in the predicate and action.
Take for example the following loop
</p><pre class="koka source"><span class="plaincode">fun main() { looptest() }

fun looptest() 
{
  while { odd?(random-int()) } 
  {
    error("&lt;b&gt;")
  }
}
</span><span class="nicecode"><span class="decl-fun" id="looptest"><span class="kw">fun</span> <a class="pp" href="#looptest">looptest<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>looptest: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">pure</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>() 
{
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#while">while<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>while: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">predicate</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">div</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp">bool</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">div</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">div</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> { <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#odd_ques_">odd?<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>odd?: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#random_int">random-int<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>random<span class="dash">-</span>int: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ndet</span> <span class="tp">int</span></span></a>()) } 
  {
    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#error">error<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>error: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">message</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp tv">a</span></span></a>(<span class="st">"&lt;b&gt;"</span>)
  }
</span>}
</span></pre>



<p class="p noindent">In the above program, Koka infers that the predicate <code class="koka">odd(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#random_int">random<span class="dash">-</span>int<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>random<span class="dash">-</span>int: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">ndet</span> <span class="tp">int</span></span></a>())</code> has
effect <code class="koka"><span class="tp sp">&#60;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_ndet"><span class="tp">ndet</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>ndet: <span class="tp">X</span></span></a><span class="tp sp">|</span><span class="tp tv">e1</span><span class="tp sp">&#62;</span></code> while the action has effect <code class="koka"><span class="tp sp">&#60;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_exn"><span class="tp">exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">|</span><span class="tp tv">e2</span><span class="tp sp">&#62;</span></code> for some <code class="koka"><span class="tp tv">e1</span></code> and <code class="koka"><span class="tp tv">e2</span></code>. 
When applying <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#while">while<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>while: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp tpp">predicate</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">div</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp">bool</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">div</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">div</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a></code>, those
effects are unified to the type <code class="koka"><span class="tp sp">&#60;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_exn"><span class="tp">exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_ndet"><span class="tp">ndet</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>ndet: <span class="tp">X</span></span></a><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_div"><span class="tp">div</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>div: <span class="tp">X</span></span></a><span class="tp sp">|</span><span class="tp tv">e3</span><span class="tp sp">&#62;</span></code> for some <code class="koka"><span class="tp tv">e3</span></code> (which can
be seen by hovering over the <code class="koka"><a class="pp" href="#looptest">looptest<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>looptest: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">pure</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a></code> identifier)
</p><h2 id="sec-runst" class="h2" data-heading-depth="2" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-runst" class="entity-anchor localref">&#x1F517;</a><a href="#sec-runst" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">2.9</span>.&#8194;</span>Isolated state</h2>
<p class="p noindent">The Fibonacci numbers are a sequence where each subsequent Fibonacci number is
the sum of the previous two, where <code class="koka"><a class="pp" href="#fib">fib<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>fib: <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">div</span> <span class="tp">int</span></span></a>(<span class="number">0</span>) <span class="op">==</span> <span class="number">0</span></code> and <code class="koka"><a class="pp" href="#fib">fib<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>fib: <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">div</span> <span class="tp">int</span></span></a>(<span class="number">1</span>) <span class="op">==</span> <span class="number">1</span></code>. We can
easily calculate Fibonacci numbers using a recursive function:
</p><pre class="koka source"><span class="plaincode">fun main() { println(fib(10)) }

fun fib(n : int) : div int
{
  if (n &lt;= 0)   then 0
  elif (n == 1) then 1
  else fib(n - 1) + fib(n - 2)
}
</span><span class="nicecode"><span class="decl-fun" id="fib"><span class="kw">fun</span> <a class="pp" href="#fib">fib<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>fib: <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">div</span> <span class="tp">int</span></span></a>(<a class="pp">n<span class="pc">n: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a>) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_div"><span class="tp"><span class="effect">div</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>div: <span class="tp">X</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a>
{
  <span class="kw">if</span> (<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_True"><span class="co">n</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_lt__eq__1">&lt;=<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;=)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <span class="number">0</span>)   <span class="kw">then</span> <span class="number">0</span>
  <span class="kw">elif</span> (<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_True"><span class="co">n</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_eq__eq__1">==<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(==)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <span class="number">1</span>) <span class="kw">then</span> <span class="number">1</span>
  <span class="kw">else</span> <a class="pp" href="#fib">fib<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>fib: <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">div</span> <span class="tp">int</span></span></a>(<a class="pp">n<span class="pc">n: <span class="tp">int</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">1</span>) <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <a class="pp" href="#fib">fib<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>fib: <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">div</span> <span class="tp">int</span></span></a>(<a class="pp">n<span class="pc">n: <span class="tp">int</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">2</span>)
</span>}
</span></pre>



<p class="p noindent">Note that the type inference engine is currently not powerful enough to
prove that this recursive function always terminates, which leads to
inclusion of the divergence effect <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_div"><span class="tp">div</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>div: <span class="tp">X</span></span></a></code> in the result type. 
</p>
<p class="p indent">Here is another version of the Fibonacci function but this time
implemented using local state. We use the <code class="koka">repeat</code> function to 
iterate <code class="koka">n</code> times:
</p><pre class="koka source"><span class="plaincode">fun main() { println(fib2(10)) }

fun fib2(n) 
{
  var x := 0
  var y := 1
  repeat(n) {
    val y0 = y
    y := x+y
    x := y0
  }
  return x
}
</span><span class="nicecode"><span class="decl-fun" id="fib2"><span class="kw">fun</span> <a class="pp" href="#fib2">fib2<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>fib2: <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>(<a class="pp">n<span class="pc">n: <span class="tp">int</span></span></a>) 
{
  <span class="kw">var</span> <a class="pp">x<span class="pc">x: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;1045</span><span class="tp sp">,</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">:=</span> <span class="number">0</span>
  <span class="kw">var</span> <a class="pp">y<span class="pc">y: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;1045</span><span class="tp sp">,</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">:=</span> <span class="number">1</span>
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#repeat_1">repeat<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>repeat<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">n<span class="pc">n: <span class="tp">int</span></span></a>) {
    <span class="kw">val</span> <a class="pp">y0<span class="pc">y0: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp">y<span class="pc">y: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;1045</span><span class="tp sp">,</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a>
    <a class="pp">y<span class="pc">y: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;1045</span><span class="tp sp">,</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#set"><span class="kw">:=</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>set: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <a class="pp">x<span class="pc">x: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;1045</span><span class="tp sp">,</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><a class="pp">y<span class="pc">y: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;1045</span><span class="tp sp">,</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a>
    <a class="pp">x<span class="pc">x: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;1045</span><span class="tp sp">,</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#set"><span class="kw">:=</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>set: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <a class="pp">y0<span class="pc">y0: <span class="tp">int</span></span></a>
  }
  <a class="pp"><span class="kw">return</span><span class="pc">return: <span class="tp">int</span></span></a> <a class="pp">x<span class="pc">x: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;1045</span><span class="tp sp">,</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a>
</span>}
</span></pre>



<p class="p noindent">The <code class="koka"><span class="kw">var</span></code> declaration declares a variable that can be assigned too using the
<code class="koka"><span class="op">(:=)</span></code> operator. In contrast, a regular equality sign, as in <code class="koka">y0 <span class="kw">=</span> y</code>
introduces an immutable value <code class="koka">y0</code>. For clarity, one can actually write <code class="koka"><span class="kw">val</span> y0 <span class="kw">=</span> y</code> 
for such declaration too but we usually leave out the <code class="koka"><span class="kw">val</span></code> keyword.
</p>
<p class="p indent">Local variables declared using <code class="koka"><span class="kw">var</span></code> are actually syntactic sugar for
allocating explicit references to mutable cells. A reference to a mutable
integer is allocated using <code class="koka">r <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#ref">ref<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>ref: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">(</span><span class="tp">alloc</span><span class="tp sp">&#60;</span><span class="tp tv">h</span><span class="tp sp">&#62;</span><span class="tp sp">)</span> <span class="tp">ref</span><span class="tp sp">&#60;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&#62;</span></span></a>(<span class="number">0</span>)</code> (since the reference itself is
actually a value!), and can be dereferenced using the bang operator, as <code class="code code2">!r</code>.
The desugared version of our previously Fibonacci function can be written
using explicit references as
</p><pre class="koka source"><span class="plaincode">fun main() { println(fib3(10)) }

fun fib3(n) 
{
  val x = ref(0)
  val y = ref(1)
  repeat(n) {
    val y0 = !y
    y := !x + !y
    x := y0
  }
  return !x
}
</span><span class="nicecode"><span class="decl-fun" id="fib3"><span class="kw">fun</span> <a class="pp" href="#fib3">fib3<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>fib3: <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>(<a class="pp">n<span class="pc">n: <span class="tp">int</span></span></a>) 
{
  <span class="kw">val</span> <a class="pp">x<span class="pc">x: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;1504</span><span class="tp sp">,</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a> <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#ref">ref<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>ref: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<span class="number">0</span>)
  <span class="kw">val</span> <a class="pp">y<span class="pc">y: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;1504</span><span class="tp sp">,</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a> <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#ref">ref<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>ref: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<span class="number">1</span>)
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#repeat_1">repeat<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>repeat<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">n<span class="pc">n: <span class="tp">int</span></span></a>) {
    <span class="kw">val</span> <a class="pp">y0<span class="pc">y0: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_excl__1">!<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(!)<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span> <span class="tp kw">with</span> <span class="tp">hdiv</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span></span></a><a class="pp">y<span class="pc">y: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;1504</span><span class="tp sp">,</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a>
    <a class="pp">y<span class="pc">y: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;1504</span><span class="tp sp">,</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#set"><span class="kw">:=</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>set: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_excl__1">!<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(!)<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span> <span class="tp kw">with</span> <span class="tp">hdiv</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span></span></a><a class="pp">x<span class="pc">x: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;1504</span><span class="tp sp">,</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_excl__1">!<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(!)<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span> <span class="tp kw">with</span> <span class="tp">hdiv</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span></span></a><a class="pp">y<span class="pc">y: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;1504</span><span class="tp sp">,</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a>
    <a class="pp">x<span class="pc">x: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;1504</span><span class="tp sp">,</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#set"><span class="kw">:=</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>set: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <a class="pp">y0<span class="pc">y0: <span class="tp">int</span></span></a>
  }
  <a class="pp"><span class="kw">return</span><span class="pc">return: <span class="tp">int</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_excl__1">!<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(!)<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span> <span class="tp kw">with</span> <span class="tp">hdiv</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span></span></a><a class="pp">x<span class="pc">x: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;1504</span><span class="tp sp">,</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a>
</span>}
</span></pre>



<p class="p noindent">As we can see, using <code class="koka"><span class="kw">var</span></code> declarations is quite convenient since such
declaration automatically adds a dereferencing operator to all occurrences
except on the left-hand side of an assignment.
</p>
<p class="p indent">When we look at the types inferred for the references, we see that <code class="koka">x</code> and <code class="koka">y</code>
have type <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_ref"><span class="tp">ref</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>ref: <span class="tp sp">(</span><span class="tp">H</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">V</span></span></a><span class="tp sp">&#60;</span><span class="tp tv">h</span><span class="tp sp">,</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a><span class="tp sp">&#62;</span></code> which stands for a reference to a mutable value of
type <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a></code> in some heap <code class="koka"><span class="tp tv">h</span></code>. The effects on heaps are allocation as
<code class="koka"><span class="tp">heap</span><span class="tp sp">&#60;</span><span class="tp tv">h</span><span class="tp sp">&#62;</span></code>, reading from a heap as <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_read"><span class="tp">read</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>read: <span class="tp">H</span> <span class="tp kw op">-&gt;</span> <span class="tp">X</span></span></a><span class="tp sp">&#60;</span><span class="tp tv">h</span><span class="tp sp">&#62;</span></code> and writing to a heap as
<code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_write"><span class="tp">write</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>write: <span class="tp">H</span> <span class="tp kw op">-&gt;</span> <span class="tp">X</span></span></a><span class="tp sp">&#60;</span><span class="tp tv">h</span><span class="tp sp">&#62;</span></code>. The combination of these effects is called stateful and denoted
with the alias <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_st"><span class="tp">st</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>st: <span class="tp">H</span> <span class="tp kw op">-&gt;</span> <span class="tp">E</span></span></a><span class="tp sp">&#60;</span><span class="tp tv">h</span><span class="tp sp">&#62;</span></code>.
</p>
<p class="p indent">Clearly, the effect of the body of <code class="koka"><a class="pp" href="#fib3">fib3<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>fib3: <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">int</span></span></a></code> is <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_st"><span class="tp">st</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>st: <span class="tp">H</span> <span class="tp kw op">-&gt;</span> <span class="tp">E</span></span></a><span class="tp sp">&#60;</span><span class="tp tv">h</span><span class="tp sp">&#62;</span></code>; but when we hover over
<code class="koka"><a class="pp" href="#fib3">fib3<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>fib3: <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">int</span></span></a></code>, we see the type inferred is actually the <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_total"><span class="tp">total</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>total: <span class="tp">E</span></span></a></code> effect: <code class="koka"><span class="tp sp">(</span><span class="tp tpp">n</span><span class="tp kw op">:</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a></code>. 
Indeed, even though <code class="koka"><a class="pp" href="#fib3">fib3<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>fib3: <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">int</span></span></a></code> is stateful inside, its side-effects can
never be observed. It turns out that we can safely discard the <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_st"><span class="tp">st</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>st: <span class="tp">H</span> <span class="tp kw op">-&gt;</span> <span class="tp">E</span></span></a><span class="tp sp">&#60;</span><span class="tp tv">h</span><span class="tp sp">&#62;</span></code>
effect whenever the heap type <code class="koka"><span class="tp tv">h</span></code> cannot be referenced outside this function,
i.e. it is not part of an argument or return type. More formally, the Koka
compiler proves this by showing that a function is fully polymorphic in the
heap type <code class="koka"><span class="tp tv">h</span></code> and applies the <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#run">run<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>run: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">h</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">st</span><span class="tp sp">&#60;</span><span class="tp tv">h</span><span class="tp sp">&#62;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp tv">e</span> <span class="tp tv">a</span></span></a></code> function (corresponding to <code class="code code2">runST</code> in
Haskell) to discard the <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_st"><span class="tp">st</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>st: <span class="tp">H</span> <span class="tp kw op">-&gt;</span> <span class="tp">E</span></span></a><span class="tp sp">&#60;</span><span class="tp tv">h</span><span class="tp sp">&#62;</span></code> effect.
</p>
<p class="p indent">The Garsia-Wachs algorithm is nice example where side-effects are used
internally across function definitions and data structures, but where the
final algorithm itself behaves like a pure function, see the
<code class="code code2">lib/demo/garsiaWachs.kk</code> example in the distribution.
</p><h2 id="sec-a-larger-example--cracking-caesar-encoding" class="h2" data-heading-depth="2" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-a-larger-example--cracking-caesar-encoding" class="entity-anchor localref">&#x1F517;</a><a href="#sec-a-larger-example--cracking-caesar-encoding" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">2.10</span>.&#8194;</span>A larger example: cracking Caesar encoding</h2>
<p class="p noindent">Enough about effects and imperative updates. Let&#39;s look at some more functional examples :-) 
For example, cracking Caesar encoded strings:
</p><pre class="koka source"><span class="plaincode">fun main() { test-uncaesar() }

fun encode( s : string, shift : int )
{
  function encode-char(c) {
    if (c &lt; 'a' || c &gt; 'z') return c
    val base = (c - 'a').int
    val rot  = (base + shift) % 26
    (rot.char + 'a')
  }

  s.map(encode-char)
}

// The letter frequency table for English
val english = [8.2,1.5,2.8,4.3,12.7,2.2,
               2.0,6.1,7.0,0.2,0.8,4.0,2.4,
               6.7,7.5,1.9,0.1, 6.0,6.3,9.1,
               2.8,1.0,2.4,0.2,2.0,0.1]

// Small helper functions
fun percent( n : int, m : int ) {
  100.0 &#42; (n.double / m.double)
}

fun rotate( xs, n ) {
  xs.drop(n) + xs.take(n)
}

// Calculate a frequency table for a string
fun freqs( s : string ) : list&lt;double&gt;
{
  val lowers = list('a','z')
  val occurs = lowers.map( fun(c){ s.count(c.string) })
  val total  = occurs.sum
  occurs.map( fun(i){ percent(i,total) } )
}

// Calculate how well two frequency tables match according 
// to the &#95;chi-square&#95; statistic.
fun chisqr( xs : list&lt;double&gt;, ys : list&lt;double&gt; ) : double
{
  zipwith(xs,ys, fun(x,y){ ((x - y)^2.0)/y } ).sum()
}

// Crack a Caesar encoded string
fun uncaesar( s : string ) : string
{
  val table  = freqs(s)                   // build a frequency table for &#96;s&#96;
  val chitab = list(0,25).map( fun(n) {   // build a list of chisqr numbers for each shift between 0 and 25
                  chisqr( table.rotate(n), english ) 
               })
  val min    = chitab.minimum()           // find the mininal element
  val shift  = chitab.index-of( fun(f){ f == min } ).negate  // and use its position as our shift
  s.encode( shift )
}
  
fun test-uncaesar() {
  println( uncaesar( "nrnd lv d ixq odqjxdjh" ) )
}
</span><span class="nicecode"><span class="comment">// The letter frequency table for English
</span><span class="decl-val" id="english"><span class="kw">val</span> <a class="pp" href="#english">english<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>english: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">double</span><span class="tp sp">&gt;</span></span></a> <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_Cons"><span class="co">[</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><span class="number">8.2</span>,<span class="number">1.5</span>,<span class="number">2.8</span>,<span class="number">4.3</span>,<span class="number">12.7</span>,<span class="number">2.2</span>,
               <span class="number">2.0</span>,<span class="number">6.1</span>,<span class="number">7.0</span>,<span class="number">0.2</span>,<span class="number">0.8</span>,<span class="number">4.0</span>,<span class="number">2.4</span>,
               <span class="number">6.7</span>,<span class="number">7.5</span>,<span class="number">1.9</span>,<span class="number">0.1</span>, <span class="number">6.0</span>,<span class="number">6.3</span>,<span class="number">9.1</span>,
               <span class="number">2.8</span>,<span class="number">1.0</span>,<span class="number">2.4</span>,<span class="number">0.2</span>,<span class="number">2.0</span>,<span class="number">0.1</span></span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_Nil"><span class="co">]</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>

<span class="comment">// Small helper functions
</span><span class="decl-fun" id="percent"><span class="kw">fun</span> <a class="pp" href="#percent">percent<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>percent: <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">m</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">double</span></span></a>( <a class="pp">n<span class="pc">n: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a>, <a class="pp">m<span class="pc">m: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> ) {
  <span class="number">100.0</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_star__1">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&#42;)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp">double</span><span class="tp sp">,</span> <span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">double</span></span></a> (<a class="pp">n<span class="pc">n: <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#double">double<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>double: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">double</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_fs__1">/<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="fslash">/</span>)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp">double</span><span class="tp sp">,</span> <span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">double</span></span></a> <a class="pp">m<span class="pc">m: <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#double">double<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>double: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">double</span></span></a>)
</span>}

<span class="decl-fun" id="rotate"><span class="kw">fun</span> <a class="pp" href="#rotate">rotate<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>rotate: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;2471</span><span class="tp sp">&gt;</span></span></a>, <a class="pp">n<span class="pc">n: <span class="tp">int</span></span></a> ) {
  <a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;2471</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#drop">drop<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>drop: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">n<span class="pc">n: <span class="tp">int</span></span></a>) <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_plus__4">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+)<span class="postfix">.4</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">ys</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;2471</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#take">take<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>take: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">n<span class="pc">n: <span class="tp">int</span></span></a>)
</span>}

<span class="comment">// Calculate a frequency table for a string
</span><span class="decl-fun" id="freqs"><span class="kw">fun</span> <a class="pp" href="#freqs">freqs<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>freqs: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">double</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">s<span class="pc">s: <span class="tp">string</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_double"><span class="tp">double</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>double: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>
{
  <span class="kw">val</span> <a class="pp">lowers<span class="pc">lowers: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">char</span><span class="tp sp">&gt;</span></span></a> <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#list_2">list<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list<span class="postfix">.2</span>: <span class="tp sp">(</span><span class="tp tpp">lo</span> <span class="tp kw op">:</span> <span class="tp">char</span><span class="tp sp">,</span> <span class="tp tpp">hi</span> <span class="tp kw op">:</span> <span class="tp">char</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">total</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">char</span><span class="tp sp">&gt;</span></span></a>(<span class="st">'a'</span>,<span class="st">'z'</span>)
  <span class="kw">val</span> <a class="pp">occurs<span class="pc">occurs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a> <span class="kw">=</span> <a class="pp">lowers<span class="pc">lowers: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">char</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#map_5">map<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>map<span class="postfix">.5</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>( <span class="kw">fun</span>(<a class="pp">c<span class="pc">c: <span class="tp">char</span></span></a>){ <a class="pp">s<span class="pc">s: <span class="tp">string</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#count">count<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>count: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">pattern</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>(<a class="pp">c<span class="pc">c: <span class="tp">char</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#string">string<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp sp">(</span><span class="tp tpp">c</span> <span class="tp kw op">:</span> <span class="tp">char</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>) })
  <span class="kw">val</span> <a class="pp">total<span class="pc">total: <span class="tp">int</span></span></a>  <span class="kw">=</span> <a class="pp">occurs<span class="pc">occurs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#sum">sum<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>sum: <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>
  <a class="pp">occurs<span class="pc">occurs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#map_5">map<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>map<span class="postfix">.5</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>( <span class="kw">fun</span>(<a class="pp">i<span class="pc">i: <span class="tp">int</span></span></a>){ <a class="pp" href="#percent">percent<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>percent: <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">m</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">double</span></span></a>(<a class="pp">i<span class="pc">i: <span class="tp">int</span></span></a>,<a class="pp">total<span class="pc">total: <span class="tp">int</span></span></a>) } )
</span>}

<span class="comment">// Calculate how well two frequency tables match according 
</span><span class="comment">// to the &#95;chi-square&#95; statistic.
</span><span class="decl-fun" id="chisqr"><span class="kw">fun</span> <a class="pp" href="#chisqr">chisqr<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>chisqr: <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">double</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">ys</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">double</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">double</span></span></a>( <a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">double</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_double"><span class="tp">double</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>double: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>, <a class="pp">ys<span class="pc">ys: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">double</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_double"><span class="tp">double</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>double: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_double"><span class="tp">double</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>double: <span class="tp">V</span></span></a>
{
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#zipwith">zipwith<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>zipwith: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">c</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">ys</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">c</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">c</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">double</span><span class="tp sp">&gt;</span></span></a>,<a class="pp">ys<span class="pc">ys: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">double</span><span class="tp sp">&gt;</span></span></a>, <span class="kw">fun</span>(<a class="pp">x<span class="pc">x: <span class="tp">double</span></span></a>,<a class="pp">y<span class="pc">y: <span class="tp">double</span></span></a>){ ((<a class="pp">x<span class="pc">x: <span class="tp">double</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_dash__2">-<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="dash">-</span>)<span class="postfix">.2</span>: <span class="tp sp">(</span><span class="tp">double</span><span class="tp sp">,</span> <span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">double</span></span></a> <a class="pp">y<span class="pc">y: <span class="tp">double</span></span></a>)<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_hat_">^<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(^): <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">double</span><span class="tp sp">,</span> <span class="tp tpp">p</span> <span class="tp kw op">:</span> <span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">double</span></span></a><span class="number">2.0</span>)<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_fs__1">/<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="fslash">/</span>)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp">double</span><span class="tp sp">,</span> <span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">double</span></span></a><a class="pp">y<span class="pc">y: <span class="tp">double</span></span></a> } )<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#sum_1">sum<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>sum<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">double</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">double</span></span></a>()
</span>}

<span class="comment">// Crack a Caesar encoded string
</span><span class="decl-fun" id="uncaesar"><span class="kw">fun</span> <a class="pp" href="#uncaesar">uncaesar<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>uncaesar: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>( <a class="pp">s<span class="pc">s: <span class="tp">string</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a>
{
  <span class="kw">val</span> <a class="pp">table<span class="pc">table: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">double</span><span class="tp sp">&gt;</span></span></a>  <span class="kw">=</span> <a class="pp" href="#freqs">freqs<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>freqs: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">double</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">s<span class="pc">s: <span class="tp">string</span></span></a>)                   <span class="comment">// build a frequency table for &#96;s&#96;
</span>  <span class="kw">val</span> <a class="pp">chitab<span class="pc">chitab: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">double</span><span class="tp sp">&gt;</span></span></a> <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#list">list<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp sp">(</span><span class="tp tpp">lo</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">hi</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">total</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a>(<span class="number">0</span>,<span class="number">25</span>)<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#map_5">map<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>map<span class="postfix">.5</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>( <span class="kw">fun</span>(<a class="pp">n<span class="pc">n: <span class="tp">int</span></span></a>) {   <span class="comment">// build a list of chisqr numbers for each shift between 0 and 25
</span>                  <a class="pp" href="#chisqr">chisqr<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>chisqr: <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">double</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">ys</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">double</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">double</span></span></a>( <a class="pp">table<span class="pc">table: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">double</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#rotate">rotate<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>rotate: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">n<span class="pc">n: <span class="tp">int</span></span></a>), <a class="pp" href="#english">english<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>english: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">double</span><span class="tp sp">&gt;</span></span></a> ) 
               })
  <span class="kw">val</span> <a class="pp">min<span class="pc">min: <span class="tp">double</span></span></a>    <span class="kw">=</span> <a class="pp">chitab<span class="pc">chitab: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">double</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#minimum_1">minimum<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>minimum<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">double</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">double</span></span></a>()           <span class="comment">// find the mininal element
</span>  <span class="kw">val</span> <a class="pp">shift<span class="pc">shift: <span class="tp">int</span></span></a>  <span class="kw">=</span> <a class="pp">chitab<span class="pc">chitab: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">double</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#index_of">index-of<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>index<span class="dash">-</span>of: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">pred</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>( <span class="kw">fun</span>(<a class="pp">f<span class="pc">f: <span class="tp">double</span></span></a>){ <a class="pp">f<span class="pc">f: <span class="tp">double</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_eq__eq__2">==<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(==)<span class="postfix">.2</span>: <span class="tp sp">(</span><span class="tp">double</span><span class="tp sp">,</span> <span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">min<span class="pc">min: <span class="tp">double</span></span></a> } )<span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#negate">negate<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>negate: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>  <span class="comment">// and use its position as our shift
</span>  <a class="pp">s<span class="pc">s: <span class="tp">string</span></span></a><span class="kw op">.</span><a class="pp" href="#encode">encode<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>encode: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">shift</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>( <a class="pp">shift<span class="pc">shift: <span class="tp">int</span></span></a> )
</span>}
  
<span class="decl-fun" id="test_uncaesar"><span class="kw">fun</span> <a class="pp" href="#test_uncaesar">test-uncaesar<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>test<span class="dash">-</span>uncaesar: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">console</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>() {
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#println">println<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>println: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">console</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp" href="#uncaesar">uncaesar<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>uncaesar: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>( <span class="st">"nrnd lv d ixq odqjxdjh"</span> ) )
</span>}
</span></pre>



<p class="p noindent">The <code class="koka"><span class="kw">val</span></code> keyword declares a static value. In the example, the value <code class="koka"><a class="pp" href="#english">english<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>english: <span class="tp">list</span><span class="tp sp">&#60;</span><span class="tp">double</span><span class="tp sp">&#62;</span></span></a></code>
is a list of floating point numbers (of type <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_double"><span class="tp">double</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>double: <span class="tp">V</span></span></a></code>) denoting the average
frequency for each letter. The function <code class="koka"><a class="pp" href="#freqs">freqs<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>freqs: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">list</span><span class="tp sp">&#60;</span><span class="tp">double</span><span class="tp sp">&#62;</span></span></a></code> builds a frequency table for a
specific string, while the function <code class="koka"><a class="pp" href="#chisqr">chisqr<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>chisqr: <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&#60;</span><span class="tp">double</span><span class="tp sp">&#62;</span><span class="tp sp">,</span> <span class="tp tpp">ys</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&#60;</span><span class="tp">double</span><span class="tp sp">&#62;</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">double</span></span></a></code> calculates how well two frequency
tables match. In the function <code class="koka">crack</code> these functions are used to find a
<code class="koka">shift</code> value that results in a string whose frequency table matches the
<code class="koka"><a class="pp" href="#english">english<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>english: <span class="tp">list</span><span class="tp sp">&#60;</span><span class="tp">double</span><span class="tp sp">&#62;</span></span></a></code> one the closest &#8211; and we use that to decode the string. Let&#39;s try
it out in the editor!
</p><h2 id="sec-optional-and-named-parameters" class="h2" data-heading-depth="2" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-optional-and-named-parameters" class="entity-anchor localref">&#x1F517;</a><a href="#sec-optional-and-named-parameters" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">2.11</span>.&#8194;</span>Optional and named parameters</h2>
<p class="p noindent">Being a function-oriented language, Koka has powerful support for function
calls where it supports both optional and named parameters. For example, the
function <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#replace_all">replace<span class="dash">-</span>all<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>replace<span class="dash">-</span>all: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">pattern</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">repl</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">string</span></span></a></code> takes a string, a <code class="code code2">pattern</code> pattern, and 
a replacement string <code class="code code2">repl</code>:
</p><pre class="koka source"><span class="plaincode">fun main() { println(world()) }

fun world() 
{
  replace-all("hi there", "there", "world")  // returns "hi world"
}
</span><span class="nicecode"><span class="decl-fun" id="world"><span class="kw">fun</span> <a class="pp" href="#world">world<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>world: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>() 
{
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#replace_all">replace-all<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>replace<span class="dash">-</span>all: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">pattern</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">repl</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>(<span class="st">"hi there"</span>, <span class="st">"there"</span>, <span class="st">"world"</span>)  <span class="comment">// returns "hi world"
</span></span>}
</span></pre>



<p class="p noindent">Using named parameters, we can also write the function call as:
</p><pre class="koka source"><span class="plaincode">fun main() { println(world2()) }

fun world2() 
{
  return "hi there".replace-all( repl="world", pattern="there" )
}
</span><span class="nicecode"><span class="decl-fun" id="world2"><span class="kw">fun</span> <a class="pp" href="#world2">world2<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>world2: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>() 
{
  <a class="pp"><span class="kw">return</span><span class="pc">return: <span class="tp">string</span></span></a> <span class="st">"hi there"</span><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#replace_all">replace-all<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>replace<span class="dash">-</span>all: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">pattern</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">repl</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>( repl<span class="kw">=</span><span class="st">"world"</span>, pattern<span class="kw">=</span><span class="st">"there"</span> )
</span>}
</span></pre>



<p class="p noindent">Optional parameters let you specify default values for parameters that do not
need to be provided at a call-site.  As an example, let&#39;s define a function
<code class="koka"><a class="pp" href="#sublist">sublist<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>sublist: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span><span class="tp sp">,</span> <span class="tp tpp">start</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">len</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">list</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span></span></a></code> that takes a list, a <code class="code code2">start</code> position, and the length <code class="code code2">len</code> of the desired
sublist.  We can make the <code class="code code2">len</code> parameter optional and by default return all
elements following the <code class="code code2">start</code> position by picking the length of the input list by
default:
</p><pre class="koka source"><span class="plaincode">fun main() { println( ['a','b','c'].sublist(1).string ) }

fun sublist( xs : list&lt;a&gt;, start : int,
                  len : int = xs.length ) : list&lt;a&gt;
{
  if (start &lt;= 0) return xs.take(len)
  match(xs) {
    Nil -&gt; Nil
    Cons(&#95;,xx) -&gt; xx.sublist(start - 1, len)
  }
}
</span><span class="nicecode"><span class="decl-fun" id="sublist"><span class="kw">fun</span> <a class="pp" href="#sublist">sublist<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>sublist: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">start</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">len</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;3300</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>, <a class="pp">start<span class="pc">start: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a>,
                  <a class="pp">len<span class="pc">len: <span class="tp op">?</span><span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_optional"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;3300</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#length_1">length<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>length<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>
{
  <span class="kw">if</span> (<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_True"><span class="co">start</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_lt__eq__1">&lt;=<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;=)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <span class="number">0</span>) <a class="pp"><span class="kw">return</span><span class="pc">return: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;3300</span><span class="tp sp">&gt;</span></span></a> <a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;3300</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#take">take<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>take: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">len<span class="pc">len: <span class="tp">int</span></span></a><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>
  <span class="kw">match</span>(<a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;3300</span><span class="tp sp">&gt;</span></span></a>) {
    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_Nil"><span class="co">Nil</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_Nil"><span class="co">Nil</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_Cons"><span class="co">Cons</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(&#95;,<a class="pp">xx<span class="pc">xx: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;3300</span><span class="tp sp">&gt;</span></span></a>) <span class="kw op">-></span> <a class="pp">xx<span class="pc">xx: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;3300</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#sublist">sublist<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>sublist: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">start</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">len</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">start<span class="pc">start: <span class="tp">int</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">1</span>, <a class="pp">len<span class="pc">len: <span class="tp">int</span></span></a>)
  }
</span>}
</span></pre>



<p class="p noindent">Hover over the <code class="koka"><a class="pp" href="#sublist">sublist<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>sublist: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span><span class="tp sp">,</span> <span class="tp tpp">start</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">len</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">list</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span></span></a></code> identifier to see its full type, where the <code class="code code2">len</code>
parameter has gotten an optional <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a></code> type signified by the question mark:
<code class="koka"><span class="op">:?</span>int</code>.
</p><h2 id="sec-structs" class="h2" data-heading-depth="2" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-structs" class="entity-anchor localref">&#x1F517;</a><a href="#sec-structs" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">2.12</span>.&#8194;</span>Structs</h2>
<p class="p noindent">An important aspect of a function-oriented language is to be able to define
rich data types over which the functions work. A common data type is that of a
<em class="em-low1">struct</em> or <em class="em-low1">record</em>. Here is an example of a struct that contains information
about a person:
</p><pre class="koka source"><span class="plaincode">struct person( age : int,
               name : string,
               realname : string = name )

val gaga = Person( 25, "Lady Gaga" )
</span><span class="nicecode"><span class="decl-type" id="type_space_person"><span class="tp kw">struct</span> <span class="decl-con" id="con_space_Person"><a class="pp" href="#type_space_person"><span class="tp">person</span><span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>person: <span class="tp">V</span></span></a>( <span class="decl-fun" id="age"><a class="pp">age<span class="pc">age: <span class="tp">int</span></span></a></span> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a>,
               <span class="decl-fun" id="name"><a class="pp">name<span class="pc">name: <span class="tp">string</span></span></a></span> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a>,
               <span class="decl-fun" id="realname"><a class="pp">realname<span class="pc">realname: <span class="tp">string</span></span></a></span> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp">name<span class="pc">name: <span class="tp">string</span></span></a> </span></span>)

<span class="decl-val" id="gaga"><span class="kw">val</span> <a class="pp" href="#gaga">gaga<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>gaga: <span class="tp">person</span></span></a> <span class="kw">=</span> <a class="pp" href="#con_space_Person"><span class="co">Person</span><span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>Person: <span class="tp sp">(</span><span class="tp tpp">age</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">realname</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">person</span></span></a>( <span class="number">25</span>, <span class="st">"Lady Gaga"</span> </span>)
</span></pre>



<p class="p noindent">Every <code class="koka"><span class="tp kw">struct</span></code> (and other data types) come with constructor functions to
create instances, as in <code class="koka"><a class="pp" href="#con_space_Person"><span class="co">Person</span><span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>Person: <span class="tp sp">(</span><span class="tp tpp">age</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">realname</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">person</span></span></a>(<span class="number">25</span>,</code><code class="koka"><a class="pp" href="#gaga">gaga<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>gaga: <span class="tp">person</span></span></a></code><code class="koka">)</code>. Moreover, these
constructors can use named arguments so we can also call the constructor
as <code class="koka"><a class="pp" href="#con_space_Person"><span class="co">Person</span><span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>Person: <span class="tp sp">(</span><span class="tp tpp">age</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">realname</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">person</span></span></a>( <a class="pp" href="#name">name<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>name: <span class="tp sp">(</span><span class="tp tpp">person</span> <span class="tp kw op">:</span> <span class="tp">person</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">string</span></span></a> <span class="kw">=</span> <span class="st">&#34;Lady Gaga&#34;</span>, <a class="pp" href="#age">age<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>age: <span class="tp sp">(</span><span class="tp tpp">person</span> <span class="tp kw op">:</span> <span class="tp">person</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">int</span></span></a> <span class="kw">=</span> <span class="number">25</span>, <a class="pp" href="#realname">realname<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>realname: <span class="tp sp">(</span><span class="tp tpp">person</span> <span class="tp kw op">:</span> <span class="tp">person</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">string</span></span></a> <span class="kw">=</span> <span class="st">&#34;Stefani Joanne Angelina Germanotta&#34;</span> )</code>
which is quite close regular record syntax but without any special rules;
it is just functions all the way down!
</p>
<p class="p indent">Also, Koka automatically generates accessor functions for each field in a
struct (or other data type), and we can access the <code class="koka"><a class="pp" href="#age">age<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>age: <span class="tp sp">(</span><span class="tp tpp">person</span> <span class="tp kw op">:</span> <span class="tp">person</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">int</span></span></a></code> of a <code class="koka"><a class="pp" href="#type_space_person"><span class="tp">person</span><span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>person: <span class="tp">V</span></span></a></code> as
<code class="koka"><a class="pp" href="#gaga">gaga<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>gaga: <span class="tp">person</span></span></a><span class="kw op">.</span><a class="pp" href="#age">age<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>age: <span class="tp sp">(</span><span class="tp tpp">person</span> <span class="tp kw op">:</span> <span class="tp">person</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">int</span></span></a></code> (which is of course just syntactic sugar for <code class="koka"><a class="pp" href="#age">age<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>age: <span class="tp sp">(</span><span class="tp tpp">person</span> <span class="tp kw op">:</span> <span class="tp">person</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">int</span></span></a>(<a class="pp" href="#gaga">gaga<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>gaga: <span class="tp">person</span></span></a>)</code>).
</p><h2 id="sec-copying" class="h2" data-heading-depth="2" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-copying" class="entity-anchor localref">&#x1F517;</a><a href="#sec-copying" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">2.13</span>.&#8194;</span>Copying</h2>
<p class="p noindent">By default, all structs (and other data types) are <em class="em-low1">immutable</em>. Instead of
directly mutating a field in a struct, we usually return a new struct where
the fields are updated. For example, here is a <code class="koka"><a class="pp" href="#birthday">birthday<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>birthday: <span class="tp sp">(</span><span class="tp tpp">p</span> <span class="tp kw op">:</span> <span class="tp">person</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">person</span></span></a></code> function that
increments the <code class="koka"><a class="pp" href="#age">age<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>age: <span class="tp sp">(</span><span class="tp tpp">person</span> <span class="tp kw op">:</span> <span class="tp">person</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">int</span></span></a></code> field:
</p><pre class="koka source"><span class="plaincode">fun main() { println( gaga.birthday.age ) }

struct person( age : int, name : string, realname : string = name )

val gaga = Person( 25, "Lady Gaga" )

fun birthday( p : person ) : person  
{
  return p( age = p.age + 1 )
}
</span><span class="nicecode"><span class="decl-fun" id="birthday"><span class="kw">fun</span> <a class="pp" href="#birthday">birthday<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>birthday: <span class="tp sp">(</span><span class="tp tpp">p</span> <span class="tp kw op">:</span> <span class="tp">person</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">person</span></span></a>( <a class="pp">p<span class="pc">p: <span class="tp">person</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_person"><span class="tp">person</span><span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>person: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_person"><span class="tp">person</span><span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>person: <span class="tp">V</span></span></a>  
{
  <a class="pp"><span class="kw">return</span><span class="pc">return: <span class="tp">person</span></span></a> <a class="pp">p<span class="pc">p: <span class="tp">person</span></span></a>( age <span class="kw">=</span> <a class="pp">p<span class="pc">p: <span class="tp">person</span></span></a><span class="kw op">.</span><a class="pp" href="#age">age<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>age: <span class="tp sp">(</span><span class="tp tpp">person</span> <span class="tp kw op">:</span> <span class="tp">person</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">1</span> )
</span>}
</span></pre>



<p class="p noindent">Here, <code class="koka"><a class="pp" href="#birthday">birthday<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>birthday: <span class="tp sp">(</span><span class="tp tpp">p</span> <span class="tp kw op">:</span> <span class="tp">person</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">person</span></span></a></code> returns a fresh <code class="koka"><a class="pp" href="#type_space_person"><span class="tp">person</span><span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>person: <span class="tp">V</span></span></a></code> which is equal to <code class="koka">p</code> but with the
<code class="koka"><a class="pp" href="#age">age<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>age: <span class="tp sp">(</span><span class="tp tpp">person</span> <span class="tp kw op">:</span> <span class="tp">person</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">int</span></span></a></code> incremented. The syntax <code class="code code2">p(...)</code> is sugar for calling the copy constructor of
a <code class="koka"><a class="pp" href="#type_space_person"><span class="tp">person</span><span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>person: <span class="tp">V</span></span></a></code>. This constructor is also automatically generated for each data
type, and is basically defined as:
</p><pre class="koka source"><span class="plaincode">fun main() { println( gaga.copy().age ) }

struct person( age : int, name : string, realname : string = name )

val gaga = Person( 25, "Lady Gaga" )

fun copy( p, age = p.age, name = p.name,
               rname = p.realname ) 
{
  return Person(age, name, rname) 
}
</span><span class="nicecode"><span class="decl-fun" id="copy"><span class="kw">fun</span> <a class="pp" href="#copy">copy<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>copy: <span class="tp sp">(</span><span class="tp tpp">p</span> <span class="tp kw op">:</span> <span class="tp">person</span><span class="tp sp">,</span> <span class="tp tpp">age</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">rname</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">person</span></span></a>( <a class="pp">p<span class="pc">p: <span class="tp">person</span></span></a>, <a class="pp">age<span class="pc">age: <span class="tp op">?</span><span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp">p<span class="pc">p: <span class="tp">person</span></span></a><span class="kw op">.</span><a class="pp" href="#age">age<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>age: <span class="tp sp">(</span><span class="tp tpp">person</span> <span class="tp kw op">:</span> <span class="tp">person</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>, <a class="pp">name<span class="pc">name: <span class="tp op">?</span><span class="tp">string</span></span></a> <span class="kw">=</span> <a class="pp">p<span class="pc">p: <span class="tp">person</span></span></a><span class="kw op">.</span><a class="pp" href="#name">name<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>name: <span class="tp sp">(</span><span class="tp tpp">person</span> <span class="tp kw op">:</span> <span class="tp">person</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>,
               <a class="pp">rname<span class="pc">rname: <span class="tp op">?</span><span class="tp">string</span></span></a> <span class="kw">=</span> <a class="pp">p<span class="pc">p: <span class="tp">person</span></span></a><span class="kw op">.</span><a class="pp" href="#realname">realname<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>realname: <span class="tp sp">(</span><span class="tp tpp">person</span> <span class="tp kw op">:</span> <span class="tp">person</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a> ) 
{
  <a class="pp"><span class="kw">return</span><span class="pc">return: <span class="tp">person</span></span></a> <a class="pp" href="#con_space_Person"><span class="co">Person</span><span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>Person: <span class="tp sp">(</span><span class="tp tpp">age</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">realname</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">person</span></span></a>(<a class="pp">age<span class="pc">age: <span class="tp">int</span></span></a>, <a class="pp">name<span class="pc">name: <span class="tp">string</span></span></a>, <a class="pp">rname<span class="pc">rname: <span class="tp">string</span></span></a>) 
</span>}
</span></pre>



<p class="p noindent">When arguments follow a data value, as in <code class="code code2">p( age = age + 1)</code>, it is desugared to call this
copy function, as in <code class="koka">p<span class="kw op">.</span><a class="pp" href="#copy">copy<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>copy: <span class="tp sp">(</span><span class="tp tpp">p</span> <span class="tp kw op">:</span> <span class="tp">person</span><span class="tp sp">,</span> <span class="tp tpp">age</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">rname</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">person</span></span></a>( <a class="pp" href="#age">age<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>age: <span class="tp sp">(</span><span class="tp tpp">person</span> <span class="tp kw op">:</span> <span class="tp">person</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">int</span></span></a> <span class="kw">=</span> p<span class="kw op">.</span><a class="pp" href="#age">age<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>age: <span class="tp sp">(</span><span class="tp tpp">person</span> <span class="tp kw op">:</span> <span class="tp">person</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">int</span></span></a><span class="op">+</span><span class="number">1</span> )</code>. Again, there are no special
rules for record updates and everything is just function calls with optional
and named parameters.
</p><h2 id="sec-more-data-types" class="h2" data-heading-depth="2" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-more-data-types" class="entity-anchor localref">&#x1F517;</a><a href="#sec-more-data-types" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">2.14</span>.&#8194;</span>More data types</h2>
<p class="p noindent">Koka also supports algebraic data types where there are multiple alternatives.
For example, here is an enumeration:
</p><pre class="koka source unchecked"><span class="plaincode">type colors {
  Red
  Green
  Blue
}
</span><span class="nicecode"><span class="tp kw">type</span> <span class="tp">colors</span> {
  <span class="co">Red</span>
  <span class="co">Green</span>
  <span class="co">Blue</span>
}
</span></pre>



<p class="p noindent">Special cases of these enumerated types are the <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_void"><span class="tp">void</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>void: <span class="tp">V</span></span></a></code> type which has no
alternatives (and therefore there exists no value with this type), the unit
type <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space__lp__rp_"><span class="tp">()</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a></code> which has just one constructor, also written as <code class="koka">()</code> (and
therefore, there exists only one value with the type <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space__lp__rp_"><span class="tp">()</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a></code>, namely <code class="koka">()</code>), and
finally the boolean type <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a></code> with two constructors <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_True"><span class="co">True</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a></code> and <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_False"><span class="co">False</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>False: <span class="tp">bool</span></span></a></code>.
</p><pre class="koka source unchecked"><span class="plaincode">type void
type () {
  ()
}
type bool {
  False
  True
}
</span><span class="nicecode"><span class="tp kw">type</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_void"><span class="tp">void</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>void: <span class="tp">V</span></span></a>
<span class="tp kw">type</span> <span class="tp sp">(</span><span class="tp sp">)</span> {
  ()
}
<span class="tp kw">type</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a> {
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_False"><span class="co">False</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>False: <span class="tp">bool</span></span></a>
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_True"><span class="co">True</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a>
}
</span></pre>



<p class="p noindent">Constructors can have parameters. For example, here is how to create a
<code class="koka"><span class="tp">number</span></code> type which is either an integer or the infinity value:
</p><pre class="koka source unchecked"><span class="plaincode">type number { 
  Infinity
  Integer( i : int )
}
</span><span class="nicecode"><span class="tp kw">type</span> <span class="tp">number</span> { 
  <span class="co">Infinity</span>
  <span class="co">Integer</span>( i <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> )
}
</span></pre>



<p class="p noindent">We can create such number by writing <code class="koka">integer(<span class="number">1</span>)</code> or <code class="koka">infinity</code>. Moreover,
data types can be polymorphic and recursive. Here is the definition of the
<code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-&gt;</span> <span class="tp">V</span></span></a></code> type which is either empty (<code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_Nil"><span class="co">Nil</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span> <span class="tp">list</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span></span></a></code>) or is a head element followed by a
tail list (<code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_Cons"><span class="co">Cons</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">list</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span></span></a></code>):
</p><pre class="koka source unchecked"><span class="plaincode">type list&lt;a&gt; {
  Nil
  Cons( head : a, tail : list&lt;a&gt; )
}
</span><span class="nicecode"><span class="tp kw">type</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> {
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_Nil"><span class="co">Nil</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_Cons"><span class="co">Cons</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( head <span class="tp kw op">:</span> <span class="tp tv">a</span>, tail <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> )
}
</span></pre>



<p class="p noindent">Koka automatically generates accessor functions for each named parameter. For
lists for example, we can access the head of a list as <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_Cons"><span class="co">Cons</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">list</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span></span></a>(<span class="number">1</span>,<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_Nil"><span class="co">Nil</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span> <span class="tp">list</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span></span></a>)<span class="kw op">.</span>head</code>.
</p>
<p class="p indent">We can now also see that <code class="koka"><span class="tp kw">struct</span></code> types are just syntactic sugar for regular a
<code class="koka"><span class="tp kw">type</span></code> with a single constructor of the same name as the type. For example,
our earlier <code class="koka"><a class="pp" href="#type_space_person"><span class="tp">person</span><span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>person: <span class="tp">V</span></span></a></code> struct, defined as
</p><pre class="koka source unchecked"><span class="plaincode">struct person( age : int, name : string,
               realname : string = name )
</span><span class="nicecode"><span class="tp kw">struct</span> <a class="pp" href="#type_space_person"><span class="tp">person</span><span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>person: <span class="tp">V</span></span></a>( <a class="pp" href="#age">age<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>age: <span class="tp sp">(</span><span class="tp tpp">person</span> <span class="tp kw op">:</span> <span class="tp">person</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a>, <a class="pp" href="#name">name<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>name: <span class="tp sp">(</span><span class="tp tpp">person</span> <span class="tp kw op">:</span> <span class="tp">person</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a>,
               <a class="pp" href="#realname">realname<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>realname: <span class="tp sp">(</span><span class="tp tpp">person</span> <span class="tp kw op">:</span> <span class="tp">person</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="#name">name<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>name: <span class="tp sp">(</span><span class="tp tpp">person</span> <span class="tp kw op">:</span> <span class="tp">person</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a> )
</span></pre>



<p class="p noindent">desugars to:
</p><pre class="koka source unchecked"><span class="plaincode">type person { 
  Person( age : int, name : string, realname : string = name ) 
}
</span><span class="nicecode"><span class="tp kw">type</span> <a class="pp" href="#type_space_person"><span class="tp">person</span><span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>person: <span class="tp">V</span></span></a> { 
  <a class="pp" href="#con_space_Person"><span class="co">Person</span><span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>Person: <span class="tp sp">(</span><span class="tp tpp">age</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">realname</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">person</span></span></a>( <a class="pp" href="#age">age<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>age: <span class="tp sp">(</span><span class="tp tpp">person</span> <span class="tp kw op">:</span> <span class="tp">person</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a>, <a class="pp" href="#name">name<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>name: <span class="tp sp">(</span><span class="tp tpp">person</span> <span class="tp kw op">:</span> <span class="tp">person</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a>, <a class="pp" href="#realname">realname<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>realname: <span class="tp sp">(</span><span class="tp tpp">person</span> <span class="tp kw op">:</span> <span class="tp">person</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="#name">name<span class="pc"><span class="mo">overview<span class="fslash last">/</span></span>name: <span class="tp sp">(</span><span class="tp tpp">person</span> <span class="tp kw op">:</span> <span class="tp">person</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a> ) 
}
</span></pre>


<h2 id="sec-matching" class="h2" data-heading-depth="2" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-matching" class="entity-anchor localref">&#x1F517;</a><a href="#sec-matching" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">2.15</span>.&#8194;</span>Matching</h2>
<p class="p noindent">Todo
</p><h2 id="sec-inductive-co-inductive-and-recursive-types" class="h2" data-heading-depth="2" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-inductive-co-inductive-and-recursive-types" class="entity-anchor localref">&#x1F517;</a><a href="#sec-inductive-co-inductive-and-recursive-types" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">2.16</span>.&#8194;</span>Inductive, co-inductive, and recursive types</h2>
<p class="p noindent">For the purposes of equational reasoning and termination checking, a <code class="koka"><span class="tp kw">type</span></code>
declaration is limited to finite inductive types. There are two more
declarations, namely <code class="koka"><span class="tp kw">cotype</span></code> and <code class="koka"><span class="tp kw">rectype</span></code> that allow for co-inductive types,
and arbitrary recursive types respectively.
</p><h1 id="sec-koka-language-specification" class="h1" data-heading-depth="1" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-koka-language-specification" class="entity-anchor localref">&#x1F517;</a><a href="#sec-koka-language-specification" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">3</span>.&#8194;</span>Koka language specification</h1>
<p class="p noindent">This is the draft language specification of the Koka language, version 0.7.<br>
Currently only the lexical and context-free grammar are specified. 
The&nbsp;<a href="toc.html" data-linkid="stdlib">standard libraries</a> are documented separately.
</p><h2 id="sec-lexical-syntax" class="h2" data-heading-depth="2" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-lexical-syntax" class="entity-anchor localref">&#x1F517;</a><a href="#sec-lexical-syntax" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">3.1</span>.&#8194;</span>Lexical syntax</h2>
<p class="p noindent">We define the grammar and lexical syntax of the language using standard BNF
notation where non-terminals are generated by alternative patterns:
</p><table class="grammar madoko block">
<tbody><tr><td class="tbody tr-odd tr-last tr-first col col-odd col-first" data-row="1" data-col="1"> <em class="em-low1">nonterm</em> </td><td class="tbody tr-odd tr-last tr-first col col-even" data-row="1" data-col="2"> ::= </td><td class="tbody tr-odd tr-last tr-first col col-odd" data-row="1" data-col="3"> <em class="em-low1">pattern</em><sub>1</sub> <span class="bar">|</span> <em class="em-low1">pattern</em><sub>2</sub> </td><td class="tbody tr-odd tr-last tr-first col col-even col-last" data-row="1" data-col="4">   </td></tr></tbody></table>
<p class="p noindent">In the patterns, we use the following notations:
</p><table class="grammar madoko block">
<tbody><tr><td class="tbody tr-odd tr-first col col-odd col-first" data-row="1" data-col="1"> <code class="koka">terminal</code>                         </td><td class="tbody tr-odd tr-first col col-even" data-row="1" data-col="2">   </td><td class="tbody tr-odd tr-first col col-odd col-last" data-row="1" data-col="3"> A terminal symbol                                                          </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="2" data-col="1"> <code class="code code2">x0A</code>                            </td><td class="tbody tr-even col col-even" data-row="2" data-col="2">   </td><td class="tbody tr-even col col-odd col-last" data-row="2" data-col="3"> A character with hexadecimal code 0A                                       </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="3" data-col="1"> <code class="code code2">a..f</code>                           </td><td class="tbody tr-odd col col-even" data-row="3" data-col="2">   </td><td class="tbody tr-odd col col-odd col-last" data-row="3" data-col="3"> The characters from a to f                                                 </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="4" data-col="1"> &#160;                             </td><td class="tbody tr-even col col-even" data-row="4" data-col="2">   </td><td class="tbody tr-even col col-odd col-last" data-row="4" data-col="3">                                                                            </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="5" data-col="1"> ( <em class="em-low1">pattern</em> )                      </td><td class="tbody tr-odd col col-even" data-row="5" data-col="2">   </td><td class="tbody tr-odd col col-odd col-last" data-row="5" data-col="3"> Grouping                                                                   </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="6" data-col="1"> [ <em class="em-low1">pattern</em> ]                      </td><td class="tbody tr-even col col-even" data-row="6" data-col="2">   </td><td class="tbody tr-even col col-odd col-last" data-row="6" data-col="3"> Optional occurrence of <em class="em-low1">pattern</em>                                           </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="7" data-col="1"> { <em class="em-low1">pattern</em> }                      </td><td class="tbody tr-odd col col-even" data-row="7" data-col="2">   </td><td class="tbody tr-odd col col-odd col-last" data-row="7" data-col="3"> Zero or more occurrences of <em class="em-low1">pattern</em>                                      </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="8" data-col="1"> <em class="em-low1">pattern</em><sub>1</sub> <span class="bar">|</span> <em class="em-low1">pattern</em><sub>2</sub> </td><td class="tbody tr-even col col-even" data-row="8" data-col="2">   </td><td class="tbody tr-even col col-odd col-last" data-row="8" data-col="3"> Choice: either <em class="em-low1">pattern</em><sub>1</sub> or <em class="em-low1">pattern</em><sub>2</sub>                                </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="9" data-col="1"> &#160;                             </td><td class="tbody tr-odd col col-even" data-row="9" data-col="2">   </td><td class="tbody tr-odd col col-odd col-last" data-row="9" data-col="3">                                                                            </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="10" data-col="1"> <em class="em-low1">pattern</em><sub>&#60;!<em class="em-low1">diff</em>&gt;</sub>            </td><td class="tbody tr-even col col-even" data-row="10" data-col="2">   </td><td class="tbody tr-even col col-odd col-last" data-row="10" data-col="3"> Difference: elements generated by <em class="em-low1">pattern</em> except those in <em class="em-low1">diff</em>         </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="11" data-col="1"> <em class="em-low1">pattern</em><sub>&#60;<em class="em-low1">postfix</em>&gt;</sub>          </td><td class="tbody tr-odd col col-even" data-row="11" data-col="2">   </td><td class="tbody tr-odd col col-odd col-last" data-row="11" data-col="3"> Postfix: any elements in <em class="em-low1">pattern</em> that are directly followed by <em class="em-low1">postfix</em> </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="12" data-col="1"> <sub>&#60;<em class="em-low1">prefix</em>&gt;</sub><em class="em-low1">pattern</em>           </td><td class="tbody tr-even col col-even" data-row="12" data-col="2">   </td><td class="tbody tr-even col col-odd col-last" data-row="12" data-col="3"> Prefix: any elements in <em class="em-low1">pattern</em> that directly follow <em class="em-low1">prefix</em>            </td></tr>
<tr><td class="tbody tr-odd tr-last col col-odd col-first" data-row="13" data-col="1"> <em class="em-low1">nonterm</em><sub>[<em class="em-low1">lex</em>]</sub>               </td><td class="tbody tr-odd tr-last col col-even" data-row="13" data-col="2">   </td><td class="tbody tr-odd tr-last col col-odd col-last" data-row="13" data-col="3"> Generate <em class="em-low1">nonterm</em> by drawing lexemes from <em class="em-low1">lex</em>                           </td></tr></tbody></table>
<p class="p grammar noindent">Care must be taken to distinguish meta-syntax such as 
 <span class="bar">|</span> and )
from concrete terminal symbols as <code class="code code2">|</code> and <code class="code code2">)</code>. In the specification
the order of the productions is not important and at each point the
<em class="em-low1">longest matching lexeme</em> is preferred. For example, even though
<code class="koka"><span class="kw">function</span></code> is a reserved word, the word <code class="koka">functions</code> is considered a
single identifier. A <em class="em-low1">prefix</em> or <em class="em-low1">postfix</em> pattern is included 
when considering a longest match.</p><h3 id="sec-source-code" class="h3" data-heading-depth="3" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-source-code" class="entity-anchor localref">&#x1F517;</a><a href="#sec-source-code" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">3.1.1</span>.&#8194;</span>Source code</h3>
<p class="p noindent">Source code consists of a sequence of 8-bit characters. Valid characters in
actual program code consists strictly of ASCII characters which range from 0
to 127 and can be encoded in 7-bits. Only comments, string literals, and
character literals are allowed to contain extended 8-bit characters.
</p><h3 id="sec-encoding" class="h3" data-heading-depth="3" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-encoding" class="entity-anchor localref">&#x1F517;</a><a href="#sec-encoding" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">3.1.2</span>.&#8194;</span>Encoding</h3>
<p class="p noindent">A program source is assumed to be UTF-8 encoded which allows comments,
string literals, and character literals to contain (encoded) unicode
characters. Moreover, the grammar is designed such that a lexical
analyzer and parser can directly work on source files without doing UTF-8
decoding or unicode category identification. To further facilitate the
processing of UTF-8 encoded files the lexical analyzer ignores an initial
byte-order mark that some UTF-8 encoders insert. In particular, any
program source is allowed to start with three byte-order mark bytes
<code class="code code2">0xEF</code>, <code class="code code2">0xBB</code>, and <code class="code code2">0xBF</code>, which are ignored.
</p><h2 id="sec-lexical-grammar" class="h2" data-heading-depth="2" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-lexical-grammar" class="entity-anchor localref">&#x1F517;</a><a href="#sec-lexical-grammar" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">3.2</span>.&#8194;</span>Lexical grammar</h2>
<p class="p noindent">In the specification of the lexical grammar all white space is explicit
and there is no implicit white space between juxtaposed symbols. The
lexical token stream is generated by the non-terminal <em class="em-low1">lex</em> which
consists of lexemes and whitespace.
</p>
<p class="p indent">Before doing lexical analysis, there is a <em class="em-low1">linefeed</em> character inserted
at the start and end of the input, which makes it easier to specify line
comments and directives.
</p><h3 id="sec-lexical-tokens" class="h3" data-heading-depth="3" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-lexical-tokens" class="entity-anchor localref">&#x1F517;</a><a href="#sec-lexical-tokens" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">3.2.1</span>.&#8194;</span>Lexical tokens</h3><table class="grammar lex madoko block">
<tbody><tr><td class="tbody tr-odd tr-first col col-odd col-first" data-row="1" data-col="1"> <em class="em-low1">lex</em>                </td><td class="tbody tr-odd tr-first col col-even" data-row="1" data-col="2"> ::=   </td><td class="tbody tr-odd tr-first col col-odd" data-row="1" data-col="3"> <em class="em-low1">lexeme</em> <span class="bar">|</span> <em class="em-low1">whitespace</em>                               </td><td class="tbody tr-odd tr-first col col-even col-last" data-row="1" data-col="4">     </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="2" data-col="1"> <em class="em-low1">lexeme</em>&#160;&#160; </td><td class="tbody tr-even col col-even" data-row="2" data-col="2"> ::=   </td><td class="tbody tr-even col col-odd" data-row="2" data-col="3"> <em class="em-low1">conid</em> <span class="bar">|</span> <em class="em-low1">qconid</em>                                    </td><td class="tbody tr-even col col-even col-last" data-row="2" data-col="4">     </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="3" data-col="1">                      </td><td class="tbody tr-odd col col-even" data-row="3" data-col="2"> &#124; </td><td class="tbody tr-odd col col-odd" data-row="3" data-col="3"> <em class="em-low1">varid</em> <span class="bar">|</span> <em class="em-low1">qvarid</em>                                    </td><td class="tbody tr-odd col col-even col-last" data-row="3" data-col="4">     </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="4" data-col="1">                      </td><td class="tbody tr-even col col-even" data-row="4" data-col="2"> &#124; </td><td class="tbody tr-even col col-odd" data-row="4" data-col="3"> <em class="em-low1">op</em> <span class="bar">|</span> <em class="em-low1">opid</em> <span class="bar">|</span> <em class="em-low1">qopid</em> <span class="bar">|</span> <em class="em-low1">wildcard</em>    </td><td class="tbody tr-even col col-even col-last" data-row="4" data-col="4">     </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="5" data-col="1">                      </td><td class="tbody tr-odd col col-even" data-row="5" data-col="2"> &#124; </td><td class="tbody tr-odd col col-odd" data-row="5" data-col="3"> <em class="em-low1">natural</em> <span class="bar">|</span> <em class="em-low1">float</em> <span class="bar">|</span> <em class="em-low1">string</em> <span class="bar">|</span> <em class="em-low1">char</em> </td><td class="tbody tr-odd col col-even col-last" data-row="5" data-col="4">     </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="6" data-col="1">                      </td><td class="tbody tr-even col col-even" data-row="6" data-col="2"> &#124; </td><td class="tbody tr-even col col-odd" data-row="6" data-col="3"> <em class="em-low1">reserved</em> <span class="bar">|</span> <em class="em-low1">opreserved</em>                             </td><td class="tbody tr-even col col-even col-last" data-row="6" data-col="4">     </td></tr>
<tr><td class="tbody tr-odd tr-last col col-odd col-first" data-row="7" data-col="1">                      </td><td class="tbody tr-odd tr-last col col-even" data-row="7" data-col="2"> &#124; </td><td class="tbody tr-odd tr-last col col-odd" data-row="7" data-col="3"> <em class="em-low1">special</em> <span class="bar">|</span> <em class="em-low1">funanon</em>                                 </td><td class="tbody tr-odd tr-last col col-even col-last" data-row="7" data-col="4">     </td></tr></tbody></table>
<p class="p noindent">The main program consists of <em class="em-low1">whitespace</em> or <em class="em-low1">lexeme</em>&#39;s. The context-free
grammar will draw it&#39;s lexemes from the <em class="em-low1">lex</em> production.
</p><h3 id="sec-identifiers" class="h3" data-heading-depth="3" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-identifiers" class="entity-anchor localref">&#x1F517;</a><a href="#sec-identifiers" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">3.2.2</span>.&#8194;</span>Identifiers</h3><table class="grammar lex madoko block">
<tbody><tr><td class="tbody tr-odd tr-first col col-odd col-first" data-row="1" data-col="1"> <em class="em-low1">anyid</em>      </td><td class="tbody tr-odd tr-first col col-even" data-row="1" data-col="2"> ::=   </td><td class="tbody tr-odd tr-first col col-odd" data-row="1" data-col="3"> <em class="em-low1">varid</em> <span class="bar">|</span> <em class="em-low1">qvarid</em> <span class="bar">|</span> <em class="em-low1">opid</em> <span class="bar">|</span> <em class="em-low1">qopid</em> <span class="bar">|</span> <em class="em-low1">conid</em> <span class="bar">|</span> <em class="em-low1">qconid</em> </td><td class="tbody tr-odd tr-first col col-even col-last" data-row="1" data-col="4">                                                         </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="2" data-col="1"> &#160;       </td><td class="tbody tr-even col col-even" data-row="2" data-col="2">       </td><td class="tbody tr-even col col-odd" data-row="2" data-col="3">                                                                                               </td><td class="tbody tr-even col col-even col-last" data-row="2" data-col="4">                                                         </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="3" data-col="1"> <em class="em-low1">qconid</em>     </td><td class="tbody tr-odd col col-even" data-row="3" data-col="2"> ::=   </td><td class="tbody tr-odd col col-odd" data-row="3" data-col="3"> <em class="em-low1">modulepath</em> <em class="em-low1">conid</em>                                                                          </td><td class="tbody tr-odd col col-even col-last" data-row="3" data-col="4">                                                         </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="4" data-col="1"> <em class="em-low1">qvarid</em>     </td><td class="tbody tr-even col col-even" data-row="4" data-col="2"> ::=   </td><td class="tbody tr-even col col-odd" data-row="4" data-col="3"> <em class="em-low1">modulepath</em> <em class="em-low1">lowerid</em>                                                                        </td><td class="tbody tr-even col col-even col-last" data-row="4" data-col="4">                                                         </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="5" data-col="1"> <em class="em-low1">modulepath</em> </td><td class="tbody tr-odd col col-even" data-row="5" data-col="2"> ::=   </td><td class="tbody tr-odd col col-odd" data-row="5" data-col="3"> <em class="em-low1">lowerid</em> <code class="koka"><span class="op"><span class="divide">/</span></span></code> <span class="many">{ <em class="em-low1">lowerid</em> <code class="koka"><span class="op"><span class="divide">/</span></span></code> }</span>                                                          </td><td class="tbody tr-odd col col-even col-last" data-row="5" data-col="4">                                                         </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="6" data-col="1"> &#160;       </td><td class="tbody tr-even col col-even" data-row="6" data-col="2">       </td><td class="tbody tr-even col col-odd" data-row="6" data-col="3">                                                                                               </td><td class="tbody tr-even col col-even col-last" data-row="6" data-col="4">                                                         </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="7" data-col="1"> <em class="em-low1">conid</em>      </td><td class="tbody tr-odd col col-even" data-row="7" data-col="2"> ::=   </td><td class="tbody tr-odd col col-odd" data-row="7" data-col="3"> <em class="em-low1">upperid</em>                                                                                     </td><td class="tbody tr-odd col col-even col-last" data-row="7" data-col="4">                                                         </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="8" data-col="1"> <em class="em-low1">varid</em>      </td><td class="tbody tr-even col col-even" data-row="8" data-col="2"> ::=   </td><td class="tbody tr-even col col-odd" data-row="8" data-col="3"> <em class="em-low1">lowerid</em><sub>&#60;!<em class="em-low1">reserved</em>&#62;</sub>                                                                </td><td class="tbody tr-even col col-even col-last" data-row="8" data-col="4">                                                         </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="9" data-col="1"> &#160;       </td><td class="tbody tr-odd col col-even" data-row="9" data-col="2">       </td><td class="tbody tr-odd col col-odd" data-row="9" data-col="3">                                                                                               </td><td class="tbody tr-odd col col-even col-last" data-row="9" data-col="4">                                                         </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="10" data-col="1"> <em class="em-low1">lowerid</em>    </td><td class="tbody tr-even col col-even" data-row="10" data-col="2"> ::=   </td><td class="tbody tr-even col col-odd" data-row="10" data-col="3"> <em class="em-low1">lower</em> <em class="em-low1">idtail</em>                                                                              </td><td class="tbody tr-even col col-even col-last" data-row="10" data-col="4">                                                         </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="11" data-col="1"> <em class="em-low1">upperid</em>    </td><td class="tbody tr-odd col col-even" data-row="11" data-col="2"> ::=   </td><td class="tbody tr-odd col col-odd" data-row="11" data-col="3"> <em class="em-low1">upper</em> <em class="em-low1">idtail</em>                                                                              </td><td class="tbody tr-odd col col-even col-last" data-row="11" data-col="4">                                                         </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="12" data-col="1"> <em class="em-low1">wildcard</em>   </td><td class="tbody tr-even col col-even" data-row="12" data-col="2"> ::=   </td><td class="tbody tr-even col col-odd" data-row="12" data-col="3"> <code class="code code2">_</code> <em class="em-low1">idtail</em>                                                                                </td><td class="tbody tr-even col col-even col-last" data-row="12" data-col="4">                                                         </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="13" data-col="1"> <em class="em-low1">typevarid</em>  </td><td class="tbody tr-odd col col-even" data-row="13" data-col="2"> ::=   </td><td class="tbody tr-odd col col-odd" data-row="13" data-col="3"> <em class="em-low1">letter</em> <span class="many">{ <em class="em-low1">digit</em> }</span>                                                                     </td><td class="tbody tr-odd col col-even col-last" data-row="13" data-col="4">                                                         </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="14" data-col="1"> &#160;       </td><td class="tbody tr-even col col-even" data-row="14" data-col="2">       </td><td class="tbody tr-even col col-odd" data-row="14" data-col="3">                                                                                               </td><td class="tbody tr-even col col-even col-last" data-row="14" data-col="4">                                                         </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="15" data-col="1"> <em class="em-low1">idtail</em>     </td><td class="tbody tr-odd col col-even" data-row="15" data-col="2"> ::=   </td><td class="tbody tr-odd col col-odd" data-row="15" data-col="3"> <span class="many">{ <em class="em-low1">idchar</em> }</span> <span class="opt">[ <em class="em-low1">idfinal</em> ]</span>                                                           </td><td class="tbody tr-odd col col-even col-last" data-row="15" data-col="4">                                                         </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="16" data-col="1"> <em class="em-low1">idchar</em>     </td><td class="tbody tr-even col col-even" data-row="16" data-col="2"> ::=   </td><td class="tbody tr-even col col-odd" data-row="16" data-col="3"> <em class="em-low1">letter</em> <span class="bar">|</span> <em class="em-low1">digit</em> <span class="bar">|</span> <code class="code code2">_</code> <span class="bar">|</span> <code class="code code2">-</code>                                       </td><td class="tbody tr-even col col-even col-last" data-row="16" data-col="4">                                                         </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="17" data-col="1"> <em class="em-low1">idfinal</em>    </td><td class="tbody tr-odd col col-even" data-row="17" data-col="2"> ::=   </td><td class="tbody tr-odd col col-odd" data-row="17" data-col="3"> <code class="code code2">?</code> <span class="bar">|</span> <span class="many">{ <code class="code code2">&#39;</code> }</span>                                                                 </td><td class="tbody tr-odd col col-even col-last" data-row="17" data-col="4">                                                         </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="18" data-col="1"> &#160;       </td><td class="tbody tr-even col col-even" data-row="18" data-col="2">       </td><td class="tbody tr-even col col-odd" data-row="18" data-col="3">                                                                                               </td><td class="tbody tr-even col col-even col-last" data-row="18" data-col="4">                                                         </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="19" data-col="1"> <em class="em-low1">funanon</em>    </td><td class="tbody tr-odd col col-even" data-row="19" data-col="2"> ::=   </td><td class="tbody tr-odd col col-odd" data-row="19" data-col="3"> (<code class="koka"><span class="kw">fun</span></code> <span class="bar">|</span> <code class="koka"><span class="kw">function</span></code>)<sub>&#60;&#160;<code class="code code2">&lt;</code><span class="bar">|</span><code class="code code2">(</code>&#62;</sub>                                     </td><td class="tbody tr-odd col col-even col-last" data-row="19" data-col="4"> (anonymous functions must be followed by a <code class="koka">(</code> or <code class="koka"><span class="op">&#60;</span></code>)) </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="20" data-col="1"> <em class="em-low1">reserved</em>   </td><td class="tbody tr-even col col-even" data-row="20" data-col="2"> ::=   </td><td class="tbody tr-even col col-odd" data-row="20" data-col="3"> <code class="koka"><span class="kw">infix</span></code> <span class="bar">|</span> <code class="koka"><span class="kw">infixr</span></code> <span class="bar">|</span> <code class="koka"><span class="kw">infixl</span></code> <span class="bar">|</span> <code class="koka"><span class="kw">prefix</span></code>                                 </td><td class="tbody tr-even col col-even col-last" data-row="20" data-col="4">                                                         </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="21" data-col="1">              </td><td class="tbody tr-odd col col-even" data-row="21" data-col="2"> &#124; </td><td class="tbody tr-odd col col-odd" data-row="21" data-col="3"> <code class="koka"><span class="tp kw">type</span></code> <span class="bar">|</span> <code class="koka"><span class="tp kw">cotype</span></code> <span class="bar">|</span> <code class="koka"><span class="tp kw">rectype</span></code> <span class="bar">|</span> <code class="koka"><span class="tp kw">alias</span></code>                                  </td><td class="tbody tr-odd col col-even col-last" data-row="21" data-col="4">                                                         </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="22" data-col="1">              </td><td class="tbody tr-even col col-even" data-row="22" data-col="2"> &#124; </td><td class="tbody tr-even col col-odd" data-row="22" data-col="3"> <code class="koka"><span class="kw">forall</span></code> <span class="bar">|</span> <code class="koka"><span class="kw">exists</span></code> <span class="bar">|</span> <code class="koka"><span class="kw">some</span></code>                                                    </td><td class="tbody tr-even col col-even col-last" data-row="22" data-col="4">                                                         </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="23" data-col="1">              </td><td class="tbody tr-odd col col-even" data-row="23" data-col="2"> &#124; </td><td class="tbody tr-odd col col-odd" data-row="23" data-col="3"> <code class="koka"><span class="kw">fun</span></code> <span class="bar">|</span> <code class="koka"><span class="kw">function</span></code> <span class="bar">|</span> <code class="koka"><span class="kw">val</span></code> <span class="bar">|</span> <code class="koka"><span class="kw">var</span></code> <span class="bar">|</span> <code class="koka"><span class="kw">con</span></code>                        </td><td class="tbody tr-odd col col-even col-last" data-row="23" data-col="4">                                                         </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="24" data-col="1">              </td><td class="tbody tr-even col col-even" data-row="24" data-col="2"> &#124; </td><td class="tbody tr-even col col-odd" data-row="24" data-col="3"> <code class="koka"><span class="kw">if</span></code> <span class="bar">|</span> <code class="koka"><span class="kw">then</span></code> <span class="bar">|</span> <code class="koka"><span class="kw">else</span></code> <span class="bar">|</span> <code class="koka"><span class="kw">elif</span></code> <span class="bar">|</span> <code class="koka"><span class="kw">match</span></code> <span class="bar">|</span> <code class="koka"><span class="kw">return</span></code>       </td><td class="tbody tr-even col col-even col-last" data-row="24" data-col="4">                                                         </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="25" data-col="1">              </td><td class="tbody tr-odd col col-even" data-row="25" data-col="2"> &#124; </td><td class="tbody tr-odd col col-odd" data-row="25" data-col="3"> <code class="koka"></code> <span class="bar">|</span> <code class="koka"><span class="kw">import</span></code> <span class="bar">|</span> <code class="koka"><span class="kw">as</span></code>                                                      </td><td class="tbody tr-odd col col-even col-last" data-row="25" data-col="4">                                                         </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="26" data-col="1">              </td><td class="tbody tr-even col col-even" data-row="26" data-col="2"> &#124; </td><td class="tbody tr-even col col-odd" data-row="26" data-col="3"> <code class="koka"><span class="kw">public</span></code> <span class="bar">|</span> <code class="koka"><span class="kw">private</span></code> <span class="bar">|</span> <code class="koka"><span class="kw">abstract</span></code>                                               </td><td class="tbody tr-even col col-even col-last" data-row="26" data-col="4">                                                         </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="27" data-col="1">              </td><td class="tbody tr-odd col col-even" data-row="27" data-col="2"> &#124; </td><td class="tbody tr-odd col col-odd" data-row="27" data-col="3"> <code class="koka"><span class="kw">interface</span></code> <span class="bar">|</span> <code class="koka"><span class="kw">instance</span></code> <span class="bar">|</span> <code class="koka"><span class="kw">with</span></code>                                               </td><td class="tbody tr-odd col col-even col-last" data-row="27" data-col="4">                                                         </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="28" data-col="1">              </td><td class="tbody tr-even col col-even" data-row="28" data-col="2"> &#124; </td><td class="tbody tr-even col col-odd" data-row="28" data-col="3"> <code class="koka"><span class="kw">external</span></code> <span class="bar">|</span> <code class="koka">inline</code> <span class="bar">|</span> <code class="koka">include</code>                                               </td><td class="tbody tr-even col col-even col-last" data-row="28" data-col="4">                                                         </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="29" data-col="1">              </td><td class="tbody tr-odd col col-even" data-row="29" data-col="2"> &#124; </td><td class="tbody tr-odd col col-odd" data-row="29" data-col="3"> <code class="koka"><span class="tp kw">effect</span></code> <span class="bar">|</span> <code class="koka"><span class="kw">handle</span></code> <span class="bar">|</span> <code class="koka"><span class="kw">handler</span></code> <span class="bar">|</span> <code class="koka">linear</code>                               </td><td class="tbody tr-odd col col-even col-last" data-row="29" data-col="4">                                                         </td></tr>
<tr><td class="tbody tr-even tr-last col col-odd col-first" data-row="30" data-col="1">              </td><td class="tbody tr-even tr-last col col-even" data-row="30" data-col="2"> &#124; </td><td class="tbody tr-even tr-last col col-odd" data-row="30" data-col="3"> <code class="koka">yield</code> <span class="bar">|</span> <code class="koka">qualified</code> <span class="bar">|</span> <code class="koka">hiding</code>                                                </td><td class="tbody tr-even tr-last col col-even col-last" data-row="30" data-col="4"> (future reserved words)                                 </td></tr></tbody></table>
<p class="p noindent">Identifiers always start with a letter, may contain underscores and
dashes, and can end with a question mark or primes. 
Like in Haskell, constructors always begin with an uppercase
letter while regular identifiers are lowercase. The rationale is to 
visibly distinguish constants from variables in pattern matches. 
Here are some example of valid identifiers:
</p><pre class="koka source unchecked"><span class="plaincode">x
concat1
visit-left
nil?
x'
Cons
True  
</span><span class="nicecode">x
concat1
visit<span class="dash">-</span>left
<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#nil_ques_">nil?<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>nil?: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">list</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>
x'
<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_Cons"><span class="co">Cons</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_True"><span class="co">True</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a>  
</span></pre>


<p class="p noindent">To avoid confusion with the subtraction operator, the occurrences of
dashes are restricted in identifiers. After lexical analysis, only
identifiers where each dash is surrounded on both sides with a <em class="em-low1">letter</em>
are accepted:
</p>
<pre class="para-block pre-fenced pre-fenced4 language-koka lang-koka koka colorized" style="display:block"><code>fold-right
n-1        <span style="color:darkgreen">//</span><span style="color:darkgreen"> illegal, a digit cannot follow a dash</span>
n - <span class="constant" style="color:purple">1</span>      <span style="color:darkgreen">//</span><span style="color:darkgreen"> n minus 1</span>
n-x-1      <span style="color:darkgreen">//</span><span style="color:darkgreen"> illegal, a digit cannot follow a dash</span>
n-x - <span class="constant" style="color:purple">1</span>    <span style="color:darkgreen">//</span><span style="color:darkgreen"> identifier </span><span style="color:darkgreen">&quot;</span><span style="color:gray">n-x</span><span style="color:darkgreen">&quot;</span><span style="color:darkgreen"> minus 1</span>
n - x - <span class="constant" style="color:purple">1</span>  <span style="color:darkgreen">//</span><span style="color:darkgreen"> n minus x minus 1</span></code></pre>
<p class="p noindent para-continued">Qualified identifiers are prefixed with a module path. Module
paths can be partial as long as they are unambiguous. 
</p>
<pre class="para-block pre-fenced pre-fenced4 language-koka lang-koka koka colorized" style="display:block"><code><span style="color:navy">core/</span>map
<span style="color:navy">std/</span>core/(&amp;)</code></pre><h3 id="sec-operators-and-symbols" class="h3" data-heading-depth="3" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-operators-and-symbols" class="entity-anchor localref">&#x1F517;</a><a href="#sec-operators-and-symbols" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">3.2.3</span>.&#8194;</span>Operators and symbols</h3><table class="grammar lex madoko block">
<tbody><tr><td class="tbody tr-odd tr-first col col-odd col-first" data-row="1" data-col="1"> <em class="em-low1">qopid</em>      </td><td class="tbody tr-odd tr-first col col-even" data-row="1" data-col="2"> ::=   </td><td class="tbody tr-odd tr-first col col-odd" data-row="1" data-col="3"> <em class="em-low1">modulepath</em> <em class="em-low1">opid</em>                                                                                                                                   </td><td class="tbody tr-odd tr-first col col-even col-last" data-row="1" data-col="4">    </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="2" data-col="1"> <em class="em-low1">opid</em>       </td><td class="tbody tr-even col col-even" data-row="2" data-col="2"> ::=   </td><td class="tbody tr-even col col-odd" data-row="2" data-col="3"> <code class="koka">(</code> <em class="em-low1">symbols</em> <code class="koka">)</code>                                                                                                                                     </td><td class="tbody tr-even col col-even col-last" data-row="2" data-col="4">    </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="3" data-col="1"> &#160;       </td><td class="tbody tr-odd col col-even" data-row="3" data-col="2">       </td><td class="tbody tr-odd col col-odd" data-row="3" data-col="3">                                                                                                                                                       </td><td class="tbody tr-odd col col-even col-last" data-row="3" data-col="4">    </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="4" data-col="1"> <em class="em-low1">op</em>         </td><td class="tbody tr-even col col-even" data-row="4" data-col="2"> ::=   </td><td class="tbody tr-even col col-odd" data-row="4" data-col="3"> <em class="em-low1">symbols</em><sub>&#60;!&#160;<em class="em-low1">opreserved</em><span class="bar">|</span><em class="em-low1">optype</em>&#62;</sub>  <span class="bar">|</span>  <code class="code code2"><span class="code-escaped">&#124;&#124;</span></code>                                                                      </td><td class="tbody tr-even col col-even col-last" data-row="4" data-col="4">    </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="5" data-col="1"> &#160;       </td><td class="tbody tr-odd col col-even" data-row="5" data-col="2">       </td><td class="tbody tr-odd col col-odd" data-row="5" data-col="3">                                                                                                                                                       </td><td class="tbody tr-odd col col-even col-last" data-row="5" data-col="4">    </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="6" data-col="1"> <em class="em-low1">symbols</em>    </td><td class="tbody tr-even col col-even" data-row="6" data-col="2"> ::=   </td><td class="tbody tr-even col col-odd" data-row="6" data-col="3"> <em class="em-low1">symbol</em> <span class="many">{ <em class="em-low1">symbol</em> }</span><span class="bar">|</span> <code class="code code2">/</code>                                                                                                             </td><td class="tbody tr-even col col-even col-last" data-row="6" data-col="4">    </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="7" data-col="1"> <em class="em-low1">symbol</em>     </td><td class="tbody tr-odd col col-even" data-row="7" data-col="2"> ::=   </td><td class="tbody tr-odd col col-odd" data-row="7" data-col="3"> <code class="koka"><span class="op">$</span></code> <span class="bar">|</span> <code class="koka"><span class="op">%</span></code> <span class="bar">|</span> <code class="code code2">&amp;</code> <span class="bar">|</span> <code class="koka"><span class="op">&#42;</span></code> <span class="bar">|</span> <code class="koka"><span class="op">+</span></code>                                                                                             </td><td class="tbody tr-odd col col-even col-last" data-row="7" data-col="4">    </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="8" data-col="1">              </td><td class="tbody tr-even col col-even" data-row="8" data-col="2"> &#124; </td><td class="tbody tr-even col col-odd" data-row="8" data-col="3"> <code class="code code2">~</code> <span class="bar">|</span> <code class="code code2">!</code> <span class="bar">|</span> <code class="code code2">\</code> <span class="bar">|</span> <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_hat_">(<sup>)<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(</sup>): <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">double</span><span class="tp sp">,</span> <span class="tp tpp">p</span> <span class="tp kw op">:</span> <span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">double</span></span></a></code> <span class="bar">|</span> <code class="code code2">#</code>                                                                                       </td><td class="tbody tr-even col col-even col-last" data-row="8" data-col="4">    </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="9" data-col="1">              </td><td class="tbody tr-odd col col-even" data-row="9" data-col="2"> &#124; </td><td class="tbody tr-odd col col-odd" data-row="9" data-col="3"> <code class="code code2">=</code> <span class="bar">|</span> <code class="code code2">.</code> <span class="bar">|</span> <code class="code code2">:</code> <span class="bar">|</span> <code class="koka"><span class="op"><span class="minus">-</span></span></code> <span class="bar">|</span> <code class="koka"><span class="op">?</span></code>                                                                                         </td><td class="tbody tr-odd col col-even col-last" data-row="9" data-col="4">    </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="10" data-col="1">              </td><td class="tbody tr-even col col-even" data-row="10" data-col="2"> &#124; </td><td class="tbody tr-even col col-odd" data-row="10" data-col="3"> <em class="em-low1">anglebar</em>                                                                                                                                            </td><td class="tbody tr-even col col-even col-last" data-row="10" data-col="4">    </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="11" data-col="1"> <em class="em-low1">anglebar</em>   </td><td class="tbody tr-odd col col-even" data-row="11" data-col="2"> ::=   </td><td class="tbody tr-odd col col-odd" data-row="11" data-col="3"> <code class="code code2">&lt;</code> <span class="bar">|</span> <code class="code code2">&gt;</code> <span class="bar">|</span> <code class="code code2"><span class="code-escaped">&#124;</span></code>                                                                                                           </td><td class="tbody tr-odd col col-even col-last" data-row="11" data-col="4">    </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="12" data-col="1"> &#160;       </td><td class="tbody tr-even col col-even" data-row="12" data-col="2">       </td><td class="tbody tr-even col col-odd" data-row="12" data-col="3">                                                                                                                                                       </td><td class="tbody tr-even col col-even col-last" data-row="12" data-col="4">    </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="13" data-col="1"> <em class="em-low1">opreserved</em> </td><td class="tbody tr-odd col col-even" data-row="13" data-col="2"> ::=   </td><td class="tbody tr-odd col col-odd" data-row="13" data-col="3"> <code class="koka"><span class="kw">=</span></code> <span class="bar">|</span> <code class="koka"><span class="kw op">.</span></code> <span class="bar">|</span> <code class="code code2">:</code> <span class="bar">|</span> <code class="koka"><span class="kw op">-&gt;</span></code>                                                                                                         </td><td class="tbody tr-odd col col-even col-last" data-row="13" data-col="4">    </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="14" data-col="1"> <em class="em-low1">optype</em>     </td><td class="tbody tr-even col col-even" data-row="14" data-col="2"> ::=   </td><td class="tbody tr-even col col-odd" data-row="14" data-col="3"> <em class="em-low1">anglebar</em> <em class="em-low1">anglebar</em> <span class="many">{ <em class="em-low1">anglebar</em> }</span>                                                                                                             </td><td class="tbody tr-even col col-even col-last" data-row="14" data-col="4">    </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="15" data-col="1"> &#160;       </td><td class="tbody tr-odd col col-even" data-row="15" data-col="2">       </td><td class="tbody tr-odd col col-odd" data-row="15" data-col="3">                                                                                                                                                       </td><td class="tbody tr-odd col col-even col-last" data-row="15" data-col="4">    </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="16" data-col="1"> <em class="em-low1">special</em>    </td><td class="tbody tr-even col col-even" data-row="16" data-col="2"> ::=   </td><td class="tbody tr-even col col-odd" data-row="16" data-col="3"> <code class="koka">{</code> <span class="bar">|</span> <code class="koka">}</code> <span class="bar">|</span> <code class="koka">(</code> <span class="bar">|</span> <code class="koka">)</code> <span class="bar">|</span> <code class="koka">[</code> <span class="bar">|</span> <code class="koka">]</code> <span class="bar">|</span> <code class="code code2"><span class="code-escaped">&#124;</span></code> <span class="bar">|</span> <code class="koka">;</code> <span class="bar">|</span> <code class="koka">,</code> <span class="bar">|</span> <em class="em-low1">lapp</em> <span class="bar">|</span> <em class="em-low1">lidx</em> </td><td class="tbody tr-even col col-even col-last" data-row="16" data-col="4">    </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="17" data-col="1"> <em class="em-low1">lapp</em>       </td><td class="tbody tr-odd col col-even" data-row="17" data-col="2"> ::=   </td><td class="tbody tr-odd col col-odd" data-row="17" data-col="3"> <sub>&#60;<em class="em-low1">apply</em>&#62;</sub><code class="koka">(</code>                                                                                                                                  </td><td class="tbody tr-odd col col-even col-last" data-row="17" data-col="4">    </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="18" data-col="1"> <em class="em-low1">lidx</em>       </td><td class="tbody tr-even col col-even" data-row="18" data-col="2"> ::=   </td><td class="tbody tr-even col col-odd" data-row="18" data-col="3"> <sub>&#60;<em class="em-low1">apply</em>&#62;</sub><code class="koka">[</code>                                                                                                                                  </td><td class="tbody tr-even col col-even col-last" data-row="18" data-col="4">    </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="19" data-col="1"> <em class="em-low1">apply</em>      </td><td class="tbody tr-odd col col-even" data-row="19" data-col="2"> ::=   </td><td class="tbody tr-odd col col-odd" data-row="19" data-col="3"> <code class="koka">)</code> <span class="bar">|</span> <code class="koka">]</code> <span class="bar">|</span> <em class="em-low1">anyid</em>                                                                                                                     </td><td class="tbody tr-odd col col-even col-last" data-row="19" data-col="4">    </td></tr>
<tr><td class="tbody tr-even tr-last col col-odd col-first" data-row="20" data-col="1"> &#160;       </td><td class="tbody tr-even tr-last col col-even" data-row="20" data-col="2">       </td><td class="tbody tr-even tr-last col col-odd" data-row="20" data-col="3">                                                                                                                                                       </td><td class="tbody tr-even tr-last col col-even col-last" data-row="20" data-col="4">    </td></tr></tbody></table><h3 id="sec-literals" class="h3" data-heading-depth="3" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-literals" class="entity-anchor localref">&#x1F517;</a><a href="#sec-literals" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">3.2.4</span>.&#8194;</span>Literals</h3><table class="grammar lex madoko block">
<tbody><tr><td class="tbody tr-odd tr-first col col-odd col-first" data-row="1" data-col="1"> <em class="em-low1">string</em>      </td><td class="tbody tr-odd tr-first col col-even" data-row="1" data-col="2"> ::=    </td><td class="tbody tr-odd tr-first col col-odd" data-row="1" data-col="3"> <code class="code code2">@&quot;</code> <span class="many">{ <em class="em-low1">graphic</em><sub>&#60;<code class="code code2">&quot;</code>&#62;</sub> <span class="bar">|</span> <em class="em-low1">utf8</em> <span class="bar">|</span> <em class="em-low1">space</em> <span class="bar">|</span> <em class="em-low1">tab</em> <span class="bar">|</span> <em class="em-low1">newline</em> <span class="bar">|</span> <code class="code code2">&quot;&quot;</code> }</span> <code class="code code2">&quot;</code> </td><td class="tbody tr-odd tr-first col col-even col-last" data-row="1" data-col="4"> (raw string) </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="2" data-col="1">               </td><td class="tbody tr-even col col-even" data-row="2" data-col="2"> &#124;  </td><td class="tbody tr-even col col-odd" data-row="2" data-col="3"> <code class="code code2">&quot;</code> <span class="many">{ <em class="em-low1">graphic</em><sub>&#60;<code class="code code2">&quot;</code><span class="bar">|</span><code class="code code2">\</code>&#62;</sub> <span class="bar">|</span> <em class="em-low1">utf8</em> <span class="bar">|</span> <em class="em-low1">space</em> <span class="bar">|</span> <em class="em-low1">escape</em> }</span> <code class="code code2">&quot;</code>                     </td><td class="tbody tr-even col col-even col-last" data-row="2" data-col="4">              </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="3" data-col="1"> <em class="em-low1">char</em>        </td><td class="tbody tr-odd col col-even" data-row="3" data-col="2"> ::=    </td><td class="tbody tr-odd col col-odd" data-row="3" data-col="3"> <code class="code code2">&#39;</code> ( <em class="em-low1">graphic</em><sub>&#60;<code class="code code2">&#39;</code><span class="bar">|</span><code class="code code2">\</code>&#62;</sub> <span class="bar">|</span> <em class="em-low1">utf8</em> <span class="bar">|</span> <em class="em-low1">space</em> <span class="bar">|</span> <em class="em-low1">escape</em> ) <code class="code code2">&#39;</code>                          </td><td class="tbody tr-odd col col-even col-last" data-row="3" data-col="4">              </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="4" data-col="1"> &#160;        </td><td class="tbody tr-even col col-even" data-row="4" data-col="2">        </td><td class="tbody tr-even col col-odd" data-row="4" data-col="3">                                                                                                                           </td><td class="tbody tr-even col col-even col-last" data-row="4" data-col="4">              </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="5" data-col="1"> <em class="em-low1">escape</em>      </td><td class="tbody tr-odd col col-even" data-row="5" data-col="2"> ::=    </td><td class="tbody tr-odd col col-odd" data-row="5" data-col="3"> <code class="code code2">\</code> ( <em class="em-low1">charesc</em> <span class="bar">|</span> <em class="em-low1">hexesc</em> )                                                                                       </td><td class="tbody tr-odd col col-even col-last" data-row="5" data-col="4">              </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="6" data-col="1"> <em class="em-low1">charesc</em>     </td><td class="tbody tr-even col col-even" data-row="6" data-col="2"> ::=    </td><td class="tbody tr-even col col-odd" data-row="6" data-col="3"> <code class="koka">n</code> <span class="bar">|</span> <code class="koka">r</code> <span class="bar">|</span> <code class="koka">t</code> <span class="bar">|</span> <code class="code code2">\</code> <span class="bar">|</span> <code class="code code2">&quot;</code> <span class="bar">|</span> <code class="code code2">&#39;</code>                                                      </td><td class="tbody tr-even col col-even col-last" data-row="6" data-col="4">              </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="7" data-col="1"> <em class="em-low1">hexesc</em>      </td><td class="tbody tr-odd col col-even" data-row="7" data-col="2"> ::=    </td><td class="tbody tr-odd col col-odd" data-row="7" data-col="3"> <code class="koka">x</code> <em class="em-low1">hexdigit</em><sub>2</sub> <span class="bar">|</span>   <code class="koka">u</code> <em class="em-low1">hexdigit</em><sub>4</sub> <span class="bar">|</span>   <code class="code code2">U</code> <em class="em-low1">hexdigit</em><sub>4</sub> <em class="em-low1">hexdigit</em><sub>2</sub>                                 </td><td class="tbody tr-odd col col-even col-last" data-row="7" data-col="4">              </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="8" data-col="1"> <em class="em-low1">hexdigit</em><sub>4</sub> </td><td class="tbody tr-even col col-even" data-row="8" data-col="2"> ::=    </td><td class="tbody tr-even col col-odd" data-row="8" data-col="3"> <em class="em-low1">hexdigit</em> <em class="em-low1">hexdigit</em> <em class="em-low1">hexdigit</em> <em class="em-low1">hexdigit</em>                                                                               </td><td class="tbody tr-even col col-even col-last" data-row="8" data-col="4">              </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="9" data-col="1"> <em class="em-low1">hexdigit</em><sub>2</sub> </td><td class="tbody tr-odd col col-even" data-row="9" data-col="2"> ::=    </td><td class="tbody tr-odd col col-odd" data-row="9" data-col="3"> <em class="em-low1">hexdigit</em> <em class="em-low1">hexdigit</em>                                                                                                     </td><td class="tbody tr-odd col col-even col-last" data-row="9" data-col="4">              </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="10" data-col="1"> &#160;        </td><td class="tbody tr-even col col-even" data-row="10" data-col="2">        </td><td class="tbody tr-even col col-odd" data-row="10" data-col="3">                                                                                                                           </td><td class="tbody tr-even col col-even col-last" data-row="10" data-col="4">              </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="11" data-col="1"> <em class="em-low1">float</em>       </td><td class="tbody tr-odd col col-even" data-row="11" data-col="2"> ::=    </td><td class="tbody tr-odd col col-odd" data-row="11" data-col="3"> <em class="em-low1">decimal</em> <code class="koka"><span class="kw op">.</span></code> <em class="em-low1">decimal</em> <span class="opt">[ <em class="em-low1">exponent</em> ]</span>                                                                                </td><td class="tbody tr-odd col col-even col-last" data-row="11" data-col="4">              </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="12" data-col="1"> <em class="em-low1">exponent</em>    </td><td class="tbody tr-even col col-even" data-row="12" data-col="2"> ::=    </td><td class="tbody tr-even col col-odd" data-row="12" data-col="3"> (<code class="code code2">e</code> &#124;  <code class="code code2">E</code>) <span class="opt">[ <code class="code code2">-</code> &#124;  <code class="code code2">+</code> ]</span> <em class="em-low1">decimal</em>                                                                     </td><td class="tbody tr-even col col-even col-last" data-row="12" data-col="4">              </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="13" data-col="1"> <em class="em-low1">natural</em>     </td><td class="tbody tr-odd col col-even" data-row="13" data-col="2"> ::=    </td><td class="tbody tr-odd col col-odd" data-row="13" data-col="3"> <em class="em-low1">decimal</em> <span class="bar">|</span> <code class="koka"><span class="number">0</span></code> &#160; (<code class="code code2">x</code> &#124;  <code class="code code2">X</code>) <em class="em-low1">hexadecimal</em>                                                              </td><td class="tbody tr-odd col col-even col-last" data-row="13" data-col="4">              </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="14" data-col="1"> <em class="em-low1">decimal</em>     </td><td class="tbody tr-even col col-even" data-row="14" data-col="2"> ::=    </td><td class="tbody tr-even col col-odd" data-row="14" data-col="3"> <em class="em-low1">digit</em> <span class="many">{ <em class="em-low1">digit</em> }</span>                                                                                                  </td><td class="tbody tr-even col col-even col-last" data-row="14" data-col="4">              </td></tr>
<tr><td class="tbody tr-odd tr-last col col-odd col-first" data-row="15" data-col="1"> <em class="em-low1">hexadecimal</em> </td><td class="tbody tr-odd tr-last col col-even" data-row="15" data-col="2"> ::=    </td><td class="tbody tr-odd tr-last col col-odd" data-row="15" data-col="3"> <em class="em-low1">hexdigit</em> <span class="many">{ <em class="em-low1">hexdigit</em> }</span>                                                                                            </td><td class="tbody tr-odd tr-last col col-even col-last" data-row="15" data-col="4">              </td></tr></tbody></table><h3 id="sec-white-space" class="h3" data-heading-depth="3" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-white-space" class="entity-anchor localref">&#x1F517;</a><a href="#sec-white-space" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">3.2.5</span>.&#8194;</span>White space</h3><table class="grammar lex madoko block">
<tbody><tr><td class="tbody tr-odd tr-first col col-odd col-first" data-row="1" data-col="1"> <em class="em-low1">whitespace</em>    </td><td class="tbody tr-odd tr-first col col-even" data-row="1" data-col="2"> ::=    </td><td class="tbody tr-odd tr-first col col-odd" data-row="1" data-col="3"> <em class="em-low1">white</em> <span class="many">{ <em class="em-low1">white</em> }</span> <span class="bar">|</span> <em class="em-low1">newline</em>                                                                           </td><td class="tbody tr-odd tr-first col col-even col-last" data-row="1" data-col="4">                          </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="2" data-col="1"> <em class="em-low1">white</em>         </td><td class="tbody tr-even col col-even" data-row="2" data-col="2"> ::=    </td><td class="tbody tr-even col col-odd" data-row="2" data-col="3"> <em class="em-low1">space</em>                                                                         </td><td class="tbody tr-even col col-even col-last" data-row="2" data-col="4">                          </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="3" data-col="1">                 </td><td class="tbody tr-odd col col-even" data-row="3" data-col="2"> &#124;  </td><td class="tbody tr-odd col col-odd" data-row="3" data-col="3"> <em class="em-low1">linecomment</em> <span class="bar">|</span> <em class="em-low1">blockcomment</em>                                                              </td><td class="tbody tr-odd col col-even col-last" data-row="3" data-col="4">                          </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="4" data-col="1">                 </td><td class="tbody tr-even col col-even" data-row="4" data-col="2"> &#124;  </td><td class="tbody tr-even col col-odd" data-row="4" data-col="3"> <em class="em-low1">linedirective</em>                                                                                    </td><td class="tbody tr-even col col-even col-last" data-row="4" data-col="4">                          </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="5" data-col="1"> &#160;          </td><td class="tbody tr-odd col col-even" data-row="5" data-col="2">        </td><td class="tbody tr-odd col col-odd" data-row="5" data-col="3">                                                                                                    </td><td class="tbody tr-odd col col-even col-last" data-row="5" data-col="4">                          </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="6" data-col="1"> <em class="em-low1">linecomment</em>   </td><td class="tbody tr-even col col-even" data-row="6" data-col="2"> ::=    </td><td class="tbody tr-even col col-odd" data-row="6" data-col="3"> <code class="code code2">//</code> <span class="many">{ <em class="em-low1">linechar</em> }</span>                                                                  </td><td class="tbody tr-even col col-even col-last" data-row="6" data-col="4">                          </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="7" data-col="1"> <em class="em-low1">linedirective</em> </td><td class="tbody tr-odd col col-even" data-row="7" data-col="2"> ::=    </td><td class="tbody tr-odd col col-odd" data-row="7" data-col="3"> <em class="em-low1">newline</em> <code class="code code2">#</code> <span class="many">{ <em class="em-low1">linechar</em> }</span>                                            </td><td class="tbody tr-odd col col-even col-last" data-row="7" data-col="4">                          </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="8" data-col="1"> <em class="em-low1">linechar</em>      </td><td class="tbody tr-even col col-even" data-row="8" data-col="2"> ::=    </td><td class="tbody tr-even col col-odd" data-row="8" data-col="3"> <em class="em-low1">graphic</em> <span class="bar">|</span> <em class="em-low1">utf8</em> <span class="bar">|</span> <em class="em-low1">space</em> <span class="bar">|</span> <em class="em-low1">tab</em>                                          </td><td class="tbody tr-even col col-even col-last" data-row="8" data-col="4">                          </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="9" data-col="1"> &#160;          </td><td class="tbody tr-odd col col-even" data-row="9" data-col="2">        </td><td class="tbody tr-odd col col-odd" data-row="9" data-col="3">                                                                                                    </td><td class="tbody tr-odd col col-even col-last" data-row="9" data-col="4">                          </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="10" data-col="1"> <em class="em-low1">blockcomment</em>  </td><td class="tbody tr-even col col-even" data-row="10" data-col="2"> ::=    </td><td class="tbody tr-even col col-odd" data-row="10" data-col="3"> <code>/&#42;</code> <em class="em-low1">blockpart</em> <span class="many">{ <em class="em-low1">blockcomment</em> <em class="em-low1">blockpart</em> }</span> <code>&#42;/</code>            </td><td class="tbody tr-even col col-even col-last" data-row="10" data-col="4"> (allows nested comments) </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="11" data-col="1"> <em class="em-low1">blockpart</em>     </td><td class="tbody tr-odd col col-even" data-row="11" data-col="2"> ::=    </td><td class="tbody tr-odd col col-odd" data-row="11" data-col="3"> <em class="em-low1">blockchars</em><sub>&#60;<em class="em-low1">blockchars</em>&#160;(<code>/&#42;</code><span class="bar">|</span><code>&#42;/</code>)&#160;<em class="em-low1">blockchars</em>&#62;</sub> </td><td class="tbody tr-odd col col-even col-last" data-row="11" data-col="4">                          </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="12" data-col="1"> <em class="em-low1">blockchars</em>    </td><td class="tbody tr-even col col-even" data-row="12" data-col="2"> ::=    </td><td class="tbody tr-even col col-odd" data-row="12" data-col="3"> <span class="many">{ <em class="em-low1">blockchar</em> }</span>                                                                               </td><td class="tbody tr-even col col-even col-last" data-row="12" data-col="4">                          </td></tr>
<tr><td class="tbody tr-odd tr-last col col-odd col-first" data-row="13" data-col="1"> <em class="em-low1">blockchar</em>     </td><td class="tbody tr-odd tr-last col col-even" data-row="13" data-col="2"> ::=    </td><td class="tbody tr-odd tr-last col col-odd" data-row="13" data-col="3"> <em class="em-low1">graphic</em> <span class="bar">|</span> <em class="em-low1">utf8</em> <span class="bar">|</span> <em class="em-low1">space</em> <span class="bar">|</span> <em class="em-low1">tab</em> <span class="bar">|</span> <em class="em-low1">newline</em>                       </td><td class="tbody tr-odd tr-last col col-even col-last" data-row="13" data-col="4">                          </td></tr></tbody></table><h3 id="sec-character-classes" class="h3" data-heading-depth="3" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-character-classes" class="entity-anchor localref">&#x1F517;</a><a href="#sec-character-classes" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">3.2.6</span>.&#8194;</span>Character classes</h3><table class="grammar lex madoko block">
<tbody><tr><td class="tbody tr-odd tr-first col col-odd col-first" data-row="1" data-col="1"> <em class="em-low1">letter</em>   </td><td class="tbody tr-odd tr-first col col-even" data-row="1" data-col="2"> ::=    </td><td class="tbody tr-odd tr-first col col-odd" data-row="1" data-col="3"> <em class="em-low1">upper</em> <span class="bar">|</span> <em class="em-low1">lower</em>                </td><td class="tbody tr-odd tr-first col col-even col-last" data-row="1" data-col="4">                                     </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="2" data-col="1"> <em class="em-low1">upper</em>    </td><td class="tbody tr-even col col-even" data-row="2" data-col="2"> ::=    </td><td class="tbody tr-even col col-odd" data-row="2" data-col="3"> <code class="code code2">A..Z</code>                                  </td><td class="tbody tr-even col col-even col-last" data-row="2" data-col="4">                                     </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="3" data-col="1"> <em class="em-low1">lower</em>    </td><td class="tbody tr-odd col col-even" data-row="3" data-col="2"> ::=    </td><td class="tbody tr-odd col col-odd" data-row="3" data-col="3"> <code class="code code2">a..z</code>                                  </td><td class="tbody tr-odd col col-even col-last" data-row="3" data-col="4">                                     </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="4" data-col="1"> <em class="em-low1">digit</em>    </td><td class="tbody tr-even col col-even" data-row="4" data-col="2"> ::=    </td><td class="tbody tr-even col col-odd" data-row="4" data-col="3"> <code class="code code2">0..9</code>                                  </td><td class="tbody tr-even col col-even col-last" data-row="4" data-col="4">                                     </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="5" data-col="1"> <em class="em-low1">hexdigit</em> </td><td class="tbody tr-odd col col-even" data-row="5" data-col="2"> ::=    </td><td class="tbody tr-odd col col-odd" data-row="5" data-col="3"> <code class="code code2">a..f</code> <span class="bar">|</span> <code class="code code2">A..F</code> <span class="bar">|</span> <em class="em-low1">digit</em> </td><td class="tbody tr-odd col col-even col-last" data-row="5" data-col="4">                                     </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="6" data-col="1"> &#160;     </td><td class="tbody tr-even col col-even" data-row="6" data-col="2">        </td><td class="tbody tr-even col col-odd" data-row="6" data-col="3">                                         </td><td class="tbody tr-even col col-even col-last" data-row="6" data-col="4">                                     </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="7" data-col="1"> <em class="em-low1">newline</em>  </td><td class="tbody tr-odd col col-even" data-row="7" data-col="2"> ::=    </td><td class="tbody tr-odd col col-odd" data-row="7" data-col="3"> <span class="opt">[ <em class="em-low1">return</em> ]</span> <em class="em-low1">linefeed</em>             </td><td class="tbody tr-odd col col-even col-last" data-row="7" data-col="4"> (windows or unix style end of line) </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="8" data-col="1"> &#160;     </td><td class="tbody tr-even col col-even" data-row="8" data-col="2">        </td><td class="tbody tr-even col col-odd" data-row="8" data-col="3">                                         </td><td class="tbody tr-even col col-even col-last" data-row="8" data-col="4">                                     </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="9" data-col="1"> <em class="em-low1">space</em>    </td><td class="tbody tr-odd col col-even" data-row="9" data-col="2"> ::=    </td><td class="tbody tr-odd col col-odd" data-row="9" data-col="3"> <code class="code code2">x20</code>                                   </td><td class="tbody tr-odd col col-even col-last" data-row="9" data-col="4"> (a space)                           </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="10" data-col="1"> <em class="em-low1">tab</em>      </td><td class="tbody tr-even col col-even" data-row="10" data-col="2"> ::=    </td><td class="tbody tr-even col col-odd" data-row="10" data-col="3"> <code class="code code2">x09</code>                                   </td><td class="tbody tr-even col col-even col-last" data-row="10" data-col="4"> (a tab (<code class="code code2">\t</code>))                      </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="11" data-col="1"> <em class="em-low1">linefeed</em> </td><td class="tbody tr-odd col col-even" data-row="11" data-col="2"> ::=    </td><td class="tbody tr-odd col col-odd" data-row="11" data-col="3"> <code class="code code2">x0A</code>                                   </td><td class="tbody tr-odd col col-even col-last" data-row="11" data-col="4"> (a line feed (<code class="code code2">\n</code>))                </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="12" data-col="1"> <em class="em-low1">return</em>   </td><td class="tbody tr-even col col-even" data-row="12" data-col="2"> ::=    </td><td class="tbody tr-even col col-odd" data-row="12" data-col="3"> <code class="code code2">x0D</code>                                   </td><td class="tbody tr-even col col-even col-last" data-row="12" data-col="4"> (a carriage return (<code class="code code2">\r</code>))          </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="13" data-col="1"> <em class="em-low1">graphic</em>  </td><td class="tbody tr-odd col col-even" data-row="13" data-col="2"> ::=    </td><td class="tbody tr-odd col col-odd" data-row="13" data-col="3"> <code class="code code2">x21</code>..<code class="code code2">x7E</code>                            </td><td class="tbody tr-odd col col-even col-last" data-row="13" data-col="4"> (a visible character)               </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="14" data-col="1"> &#160;     </td><td class="tbody tr-even col col-even" data-row="14" data-col="2">        </td><td class="tbody tr-even col col-odd" data-row="14" data-col="3">                                         </td><td class="tbody tr-even col col-even col-last" data-row="14" data-col="4">                                     </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="15" data-col="1"> <em class="em-low1">utf8</em>     </td><td class="tbody tr-odd col col-even" data-row="15" data-col="2"> ::=    </td><td class="tbody tr-odd col col-odd" data-row="15" data-col="3"> <code class="code code2">xC0</code> <code class="code code2">x80</code>                             </td><td class="tbody tr-odd col col-even col-last" data-row="15" data-col="4"> (encoded 0 character)               </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="16" data-col="1">            </td><td class="tbody tr-even col col-even" data-row="16" data-col="2"> &#124;  </td><td class="tbody tr-even col col-odd" data-row="16" data-col="3"> (<code class="code code2">xC2</code>..<code class="code code2">xDF</code>) <em class="em-low1">cont</em>                   </td><td class="tbody tr-even col col-even col-last" data-row="16" data-col="4">                                     </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="17" data-col="1">            </td><td class="tbody tr-odd col col-even" data-row="17" data-col="2"> &#124;  </td><td class="tbody tr-odd col col-odd" data-row="17" data-col="3"> <code class="code code2">xE0</code> (<code class="code code2">xA0</code>..<code class="code code2">xBF</code>) <em class="em-low1">cont</em>             </td><td class="tbody tr-odd col col-even col-last" data-row="17" data-col="4">                                     </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="18" data-col="1">            </td><td class="tbody tr-even col col-even" data-row="18" data-col="2"> &#124;  </td><td class="tbody tr-even col col-odd" data-row="18" data-col="3"> (<code class="code code2">xE1</code>..<code class="code code2">xEC</code>) <em class="em-low1">cont</em> <em class="em-low1">cont</em>            </td><td class="tbody tr-even col col-even col-last" data-row="18" data-col="4">                                     </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="19" data-col="1">            </td><td class="tbody tr-odd col col-even" data-row="19" data-col="2"> &#124;  </td><td class="tbody tr-odd col col-odd" data-row="19" data-col="3"> <code class="code code2">xED</code> (<code class="code code2">x80</code>..<code class="code code2">x9F</code>) <em class="em-low1">cont</em>             </td><td class="tbody tr-odd col col-even col-last" data-row="19" data-col="4">                                     </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="20" data-col="1">            </td><td class="tbody tr-even col col-even" data-row="20" data-col="2"> &#124;  </td><td class="tbody tr-even col col-odd" data-row="20" data-col="3"> (<code class="code code2">xEE</code>..<code class="code code2">xEF</code>) <em class="em-low1">cont</em> <em class="em-low1">cont</em>            </td><td class="tbody tr-even col col-even col-last" data-row="20" data-col="4">                                     </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="21" data-col="1">            </td><td class="tbody tr-odd col col-even" data-row="21" data-col="2"> &#124;  </td><td class="tbody tr-odd col col-odd" data-row="21" data-col="3"> <code class="code code2">xF0</code> (<code class="code code2">x90</code>..<code class="code code2">xBF</code>) <em class="em-low1">cont</em> <em class="em-low1">cont</em>      </td><td class="tbody tr-odd col col-even col-last" data-row="21" data-col="4">                                     </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="22" data-col="1">            </td><td class="tbody tr-even col col-even" data-row="22" data-col="2"> &#124;  </td><td class="tbody tr-even col col-odd" data-row="22" data-col="3"> (<code class="code code2">xF1</code>..<code class="code code2">xF3</code>) <em class="em-low1">cont</em> <em class="em-low1">cont</em> <em class="em-low1">cont</em>     </td><td class="tbody tr-even col col-even col-last" data-row="22" data-col="4">                                     </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="23" data-col="1">            </td><td class="tbody tr-odd col col-even" data-row="23" data-col="2"> &#124;  </td><td class="tbody tr-odd col col-odd" data-row="23" data-col="3"> <code class="code code2">xF4</code> (<code class="code code2">x80</code>..<code class="code code2">x8F</code>) <em class="em-low1">cont</em> <em class="em-low1">cont</em>      </td><td class="tbody tr-odd col col-even col-last" data-row="23" data-col="4">                                     </td></tr>
<tr><td class="tbody tr-even tr-last col col-odd col-first" data-row="24" data-col="1"> <em class="em-low1">cont</em>     </td><td class="tbody tr-even tr-last col col-even" data-row="24" data-col="2"> ::=    </td><td class="tbody tr-even tr-last col col-odd" data-row="24" data-col="3"> <code class="code code2">x80</code>..<code class="code code2">xBF</code>                            </td><td class="tbody tr-even tr-last col col-even col-last" data-row="24" data-col="4">                                     </td></tr></tbody></table><h3 id="sec-semicolons" class="h3" data-heading-depth="3" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-semicolons" class="entity-anchor localref">&#x1F517;</a><a href="#sec-semicolons" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">3.2.7</span>.&#8194;</span>Semicolons?</h3>
<p class="p noindent">Many languages have rules to avoid writing semicolons to separate
statements. Even though most of the time these rules are quite intuitive
to use, their actual definition can be quite subtle. For example,
both&nbsp;<a href="http://www.scala-lang.org/old/sites/default/files/linuxsoft_archives/docu/files/ScalaReference.pdf#page=13" data-linkid="lscala">Scala</a> and&nbsp;<a href="http://golang.org/ref/spec#Semicolons" data-linkid="lgo">Go</a> require remembering specific tokens to
know precisely when semicolon insertion takes place. In the case
of&nbsp;<a href="https://tc39.github.io/ecma262/#sec-rules-of-automatic-semicolon-insertion" data-linkid="ljavascript">JavaScript</a> and&nbsp;<a href="http://www.haskell.org/onlinereport/haskell2010/haskellch10.html#x17-17800010.3" data-linkid="lhaskell">Haskell</a> (I am sad to admit)
the precise behavior is bizarrely complex where semicolon insertion
depends on the interaction between the lexer and parser.
</p>
<p class="p indent">In Koka, the grammar is carefully constructed to not need any statement
separator at all and semicolons are never required by the grammar.
They are still allowed in the grammar but strictly to help new programmers
that are used to putting semicolons at the end of statements.
</p>
<p class="p indent">The construction of a grammar that does not need statement separators is
also good from a human perspective. The reason semicolons are required is
to resolve ambiguities in the syntax. When such ambiguities do not occur
in the first place, that also removes a cognitive burden from the
programmer. In particular, Koka statements often start with a keyword,
like <code class="koka"><span class="kw">val</span></code> or <code class="koka"><span class="kw">match</span></code>, signifying intention to both programmer and parser.
</p>
<p class="p indent">In other cases, we restrict the expression grammar. For example, one
reason why C requires semicolons is due to prefix- and postfix operators.
If we write <code class="code code2">p ++ q</code> the C parser needs a semicolon in order to know if
we meant <code class="code code2">p++; q</code> or <code class="code code2">p; ++q</code>. Such ambiguity is resolved in Koka by
not having postfix operators and restricting prefix operators to <code class="code code2">!</code>
and <code class="code code2">~</code>. 
</p>
<p class="p indent">One other reason that Koka can do without a statement separator is the
effect inference system: without such effect inference subtle bugs may
occur if we leave out semicolons. For example, consider the following
function:
</p><pre class="koka source"><span class="plaincode">fun square( x : int ) {
  x &#42; x
}
</span><span class="nicecode"><span class="decl-fun" id="square"><span class="kw">fun</span> <a class="pp" href="#square">square<span class="pc"><span class="mo">spec<span class="fslash last">/</span></span>square: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>( <a class="pp">x<span class="pc">x: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> ) {
  <a class="pp">x<span class="pc">x: <span class="tp">int</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <a class="pp">x<span class="pc">x: <span class="tp">int</span></span></a>
</span>}
</span></pre>


<p class="p noindent">which returns the square of <code class="koka">x</code>. Suppose now that we forgot to put
in the multiplication operation, giving:
</p><pre class="koka source unchecked"><span class="plaincode">fun square-wrong( x : int ) {
  x x
}
</span><span class="nicecode"><span class="kw">fun</span> square<span class="dash">-</span>wrong( x <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> ) {
  x x
}
</span></pre>


<p class="p noindent">The Koka grammar sees this as 2 separate statements now, i.e. as <code class="code code2">x; x</code> 
returning <code class="code code2">x</code> instead. In a language without effect inference it is hard
to detect such errors, but the Koka type system rejects this program: 
</p>
<pre class="para-block pre-indented" style="display:block"><code><span class="code-escaped"><strong class="strong-star2"><code class="code code2">&gt; fun square-wrong(x:int) { x x }</code></strong></span>
                            ^
((1),27): error: expression has no effect and is unused
  hint: did you forget an operator? or is there a space between an application?</code></pre><!--
### Semicolon insertion  {#sec:layout}

Just like programming languages like 
[Haskell], [Python], [JavaScript], [Scala], [Go], etc., there is a layout rule
which automatically adds semicolons at appropriate places. This enables the
programmer to leave out most semicolons.


Koka will insert semicolons automatically for any statements
and declarations that are _aligned between curly braces_ (<code class="koka">{</code> and <code class="koka">}</code>).
For example, in the following program:
{.grammar}

<pre class="koka source"><span class="plaincode">function eq1( x : int, y : int ) : io bool 
{  
  print("calculate equality")
  val result = if (x == y) then True            
                else False
  result
}  
</span><span class="nicecode"><span class="decl-fun" id="eq1"><span class="kw">function</span> <a class="pp" href="#eq1">eq1<span class="pc"><span class="mo">spec<span class="fslash last">/</span></span>eq1: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">bool</span></span></a>( <a class="pp">x<span class="pc">x: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a>, <a class="pp">y<span class="pc">y: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a> 
{  
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#print">print<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>print: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">console</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<span class="st">"calculate equality"</span>)
  <span class="kw">val</span> <a class="pp">result<span class="pc">result: <span class="tp">bool</span></span></a> <span class="kw">=</span> <span class="kw">if</span> (<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_True"><span class="co">x</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_eq__eq__1">==<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(==)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">y<span class="pc">y: <span class="tp">int</span></span></a>) <span class="kw">then</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_True"><span class="co">True</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a>            
                <span class="kw">else</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_False"><span class="co">False</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>False: <span class="tp">bool</span></span></a>
  <a class="pp">result<span class="pc">result: <span class="tp">bool</span></span></a>
</span>}  
</span></pre>

we get semicolons before each statement that was aligned between the braces:

<pre class="koka source"><span class="plaincode">function eqSemi( x : int, y : int ) : io bool 
{;  
  print("calculate equality");
  val result = if (x == y) then True            
                else False;
  result;
}  
</span><span class="nicecode"><span class="decl-fun" id="eqSemi"><span class="kw">function</span> <a class="pp" href="#eqSemi">eqSemi<span class="pc"><span class="mo">spec<span class="fslash last">/</span></span>eqSemi: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">bool</span></span></a>( <a class="pp">x<span class="pc">x: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a>, <a class="pp">y<span class="pc">y: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a> 
{;  
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#print">print<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>print: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">console</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<span class="st">"calculate equality"</span>);
  <span class="kw">val</span> <a class="pp">result<span class="pc">result: <span class="tp">bool</span></span></a> <span class="kw">=</span> <span class="kw">if</span> (<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_True"><span class="co">x</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_eq__eq__1">==<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(==)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">y<span class="pc">y: <span class="tp">int</span></span></a>) <span class="kw">then</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_True"><span class="co">True</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a>            
                <span class="kw">else</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_False"><span class="co">False</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>False: <span class="tp">bool</span></span></a>;
  <a class="pp">result<span class="pc">result: <span class="tp">bool</span></span></a>;
</span>}  
</span></pre>

Since semicolons are only inserted for _aligned_ statements, we can
write a long statement on multiple lines by using more indentation:

<pre class="koka source"><span class="plaincode">function eq2( x : int, y : int ) : io bool 
{  
  print("calculate " +
         "equ" +
         "ality")
  val result = if (x == y)
                then True 
                else False
  result
}  
</span><span class="nicecode"><span class="decl-fun" id="eq2"><span class="kw">function</span> <a class="pp" href="#eq2">eq2<span class="pc"><span class="mo">spec<span class="fslash last">/</span></span>eq2: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">bool</span></span></a>( <a class="pp">x<span class="pc">x: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a>, <a class="pp">y<span class="pc">y: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a> 
{  
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#print">print<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>print: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">console</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<span class="st">"calculate "</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_plus__3">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+)<span class="postfix">.3</span>: <span class="tp sp">(</span><span class="tp">string</span><span class="tp sp">,</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>
         <span class="st">"equ"</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_plus__3">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+)<span class="postfix">.3</span>: <span class="tp sp">(</span><span class="tp">string</span><span class="tp sp">,</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>
         <span class="st">"ality"</span>)
  <span class="kw">val</span> <a class="pp">result<span class="pc">result: <span class="tp">bool</span></span></a> <span class="kw">=</span> <span class="kw">if</span> (<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_True"><span class="co">x</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_eq__eq__1">==<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(==)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">y<span class="pc">y: <span class="tp">int</span></span></a>)
                <span class="kw">then</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_True"><span class="co">True</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a> 
                <span class="kw">else</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_False"><span class="co">False</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>False: <span class="tp">bool</span></span></a>
  <a class="pp">result<span class="pc">result: <span class="tp">bool</span></span></a>
</span>}  
</span></pre>

In contrast to token-based layout rules, as in [Scala] or [Go] for example, this
allows you to put line breaks at any point in a statement by just indenting
more. Moreover, it means that the visual indentation of a program corresponds
directly to how the compiler interprets the statements. Many tricky layout
examples in other programming languages are often based on a mismatch between
the visual representation and how a compiler interprets the tokens. With
Koka's layout rule, there is no such mismatch.

To still allow for "block-style" layout, the
layout rule does not insert a  semicolon for an aligned statement if it
starts with <code class="koka"><span class="kw">then</span></code>, <code class="koka"><span class="kw">else</span></code>, <code class="koka"><span class="kw">elif</span></code>, or one of <code class="koka">{</code>, <code class="koka">)</code>, or <code class="koka">]</code>.
{.grammar}

<pre class="koka source"><span class="plaincode">function bar()
{  
  val xs = [ 
    "list",
    "elements",
  ]
  if (odd?(random-int())) 
  {
    print("odd")
  }
  else 
    print("even")
}  
</span><span class="nicecode"><span class="decl-fun" id="bar"><span class="kw">function</span> <a class="pp" href="#bar">bar<span class="pc"><span class="mo">spec<span class="fslash last">/</span></span>bar: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">console</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>()
{  
  <span class="kw">val</span> <a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">string</span><span class="tp sp">&gt;</span></span></a> <span class="kw">=</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_Cons"><span class="co">[</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> 
    <span class="st">"list"</span>,
    <span class="st">"elements"</span>,
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_Nil"><span class="co">]</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
  <span class="kw">if</span> (<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_True"><span class="co">odd?</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a>(<a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#random_int">random-int<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>random<span class="dash">-</span>int: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ndet</span> <span class="tp">int</span></span></a>())) 
  {
    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#print">print<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>print: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">console</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<span class="st">"odd"</span>)
  }
  <span class="kw">else</span> 
    <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#print">print<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>print: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">console</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<span class="st">"even"</span>)
</span>}  
</span></pre>

Of course, it is still allowed to use semicolons explicitly which can be used
for example to put multiple statements on a single line:

<pre class="koka source"><span class="plaincode">function equalLine( x : int, y : int ) : io bool {
  print("calculate equality"); (x == y) 
}  
</span><span class="nicecode"><span class="decl-fun" id="equalLine"><span class="kw">function</span> <a class="pp" href="#equalLine">equalLine<span class="pc"><span class="mo">spec<span class="fslash last">/</span></span>equalLine: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">bool</span></span></a>( <a class="pp">x<span class="pc">x: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a>, <a class="pp">y<span class="pc">y: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a> {
  <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#print">print<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>print: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">console</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<span class="st">"calculate equality"</span>); (<a class="pp">x<span class="pc">x: <span class="tp">int</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#_eq__eq__1">==<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(==)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">y<span class="pc">y: <span class="tp">int</span></span></a>) 
</span>}  
</span></pre>

The layout algorithm also checks for invalid layouts where the layout would
not visually correspond to how the compiler interprets the tokens. In
particular, it is illegal to indent less than the layout context or to put
comments into the indentation (because of tabs or potential unicode
characters). For example, the program:

<pre class="koka source unchecked"><span class="plaincode">function equal( x : int, y : int ) : io bool {   
    print("calculate equality")
  result = if (x == y) then True   // wrong: too little indentation
  /&#42; wrong &#42;/      else False
    result
}  
</span><span class="nicecode"><span class="kw">function</span> equal( x <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a>, y <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_io"><span class="tp">io</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a> {   
    print(<span class="st">"calculate equality"</span>)
  result <span class="kw">=</span> <span class="kw">if</span> (x <span class="op">==</span> y) <span class="kw">then</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_True"><span class="co">True</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a>   <span class="comment">// wrong: too little indentation
</span>  <span class="comment">/&#42; wrong &#42;/</span>      <span class="kw">else</span> <a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#con_space_False"><span class="co">False</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>False: <span class="tp">bool</span></span></a>
    result
}  
</span></pre>

is rejected. In order to facilitate code generation or source code
compression, compilers are also required to support a mode where the layout
rule is not applied and where no semicolons are inserted. A recognized command
line flag for that mode should be ``--nolayout``.

#### The layout algorithm

The layout rule is natural to humans since semicolon insertion corresponds
directly to the visual two-dimensional layout of the program. The formal
specification of the layout rule is a bit more technical though since a
compiler interprets source code as a linear one-dimensional sequence. To
define the layout algorithm formally, we first establish some terminology:

* A new line is started after every _linefeed_ character.
* Any non-_white_ token is called a _lexeme_, where a line without lexemes 
  is called _blank_.
* The indentation of a lexeme is the column number of its first character on 
  that line (starting at 1), and the indentation of a line is the indentation 
  of the first lexeme on the line.

Because braces can be nested, we use a _layout stack_ of strictly
increasing indentations. The top indentation on the layout stack holds the
_layout indentation_. The initial layout stack contains the single
value 0 (which is never popped). The operations on the layout stack are always
done before the semicolon insertion:

* _Layout stack operations_: If the previous lexeme was an
  open brace <code class="koka">{</code> or the start of the lexical token sequence, we push the
  indentation of the current lexeme on the layout stack. The pushed indentation
  must be larger than the previous layout indentation (unless the current lexeme
  is a closing brace).  When a closing brace <code class="koka">}</code> is encountered the top
  indentation is popped from the layout stack.

* _Semicolon insertion_: For each non-blank line, the
  indentation must be equal or larger to the layout indentation. A semicolon is
  inserted before the line whenever the indentation is equal, unless the first
  lexeme on the line is one of <code class="koka"><span class="kw">then</span></code>, <code class="koka"><span class="kw">else</span></code>, <code class="koka"><span class="kw">elif</span></code>, or one of <code class="koka">{</code>, <code class="koka">)</code>, or
  <code class="koka">]</code>. Also, a semicolon is always inserted before a closing brace <code class="koka">}</code> and
  before the end of the token sequence.
{.grammar} 

As defined, semicolons are inserted whenever statements or declarations are
aligned, unless the lexeme happens to be a clear statement continuation. To
simplify the grammar specification, a semicolon is also always inserted before
a closing brace and the end of the source. This allows us to specify many
grammar elements as ended by semicolons instead of separated by semicolons
which is more difficult to specify for a LALR(1) grammar.

Semicolon insertion can be easily implemented as part of the lexer, but could
also be implemented as a straightforward transformation on the lexical token
stream. In particular, there are no intricate dependencies with the parser
that lead to bizarrely complex layout rules, as is the case in languages like
[Haskell] or [JavaScript].
-->


<h3 id="sec:lex-implementation" class="h3" data-heading-depth="3" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec:lex-implementation" class="entity-anchor localref">&#x1F517;</a><a href="#sec:lex-implementation" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">3.2.8</span>.&#8194;</span>Implementation</h3>
<p class="p noindent">There is a full&nbsp;<a href="https://koka.codeplex.com/SourceControl/latest#doc/spec/grammar/lexer.lex" data-linkid="flexlexer">Flex (Lex) implementation</a> of lexical
analysis, Ultimately, the Flex implementation serves as <em class="em-low1">the</em>
specification, and this document and the Flex implementation should
always be in agreement.
</p><h2 id="sec-context-free-syntax" class="h2" data-heading-depth="2" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-context-free-syntax" class="entity-anchor localref">&#x1F517;</a><a href="#sec-context-free-syntax" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">3.3</span>.&#8194;</span>Context-free syntax</h2>
<p class="p noindent">The grammar specification starts with the non terminal <em class="em-low1">module</em> which draws
its lexical tokens from <em class="em-low1">lex</em> where all <em class="em-low1">whitespace</em> tokens are implicitly
ignored.
</p><h3 id="sec-modules" class="h3" data-heading-depth="3" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-modules" class="entity-anchor localref">&#x1F517;</a><a href="#sec-modules" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">3.3.1</span>.&#8194;</span>Modules</h3><table class="grammar parse madoko block">
<tbody><tr><td class="tbody tr-odd tr-first col col-odd col-first" data-row="1" data-col="1"> <em class="em-low1">module</em><sub><span class="opt">[ <em class="em-low1">lex</em> ]</span></sub> </td><td class="tbody tr-odd tr-first col col-even" data-row="1" data-col="2"> ::=    </td><td class="tbody tr-odd tr-first col col-odd" data-row="1" data-col="3"> <span class="opt">[ <em class="em-low1">moduledecl</em> ]</span> <em class="em-low1">modulebody</em>                         </td><td class="tbody tr-odd tr-first col col-even col-last" data-row="1" data-col="4">   </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="2" data-col="1"> &#160;                  </td><td class="tbody tr-even col col-even" data-row="2" data-col="2">        </td><td class="tbody tr-even col col-odd" data-row="2" data-col="3">                                                           </td><td class="tbody tr-even col col-even col-last" data-row="2" data-col="4">   </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="3" data-col="1"> <em class="em-low1">moduledecl</em>            </td><td class="tbody tr-odd col col-even" data-row="3" data-col="2"> ::=    </td><td class="tbody tr-odd col col-odd" data-row="3" data-col="3"> <em class="em-low1">semis</em>  <span class="opt">[ <em class="em-low1">visibility</em> ]</span> <code class="koka"></code> <em class="em-low1">moduleid</em> </td><td class="tbody tr-odd col col-even col-last" data-row="3" data-col="4">   </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="4" data-col="1"> <em class="em-low1">moduleid</em>              </td><td class="tbody tr-even col col-even" data-row="4" data-col="2"> ::=    </td><td class="tbody tr-even col col-odd" data-row="4" data-col="3"> <em class="em-low1">qvarid</em> <span class="bar">|</span> <em class="em-low1">varid</em>                                 </td><td class="tbody tr-even col col-even col-last" data-row="4" data-col="4">   </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="5" data-col="1"> &#160;                  </td><td class="tbody tr-odd col col-even" data-row="5" data-col="2">        </td><td class="tbody tr-odd col col-odd" data-row="5" data-col="3">                                                           </td><td class="tbody tr-odd col col-even col-last" data-row="5" data-col="4">   </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="6" data-col="1"> <em class="em-low1">modulebody</em>            </td><td class="tbody tr-even col col-even" data-row="6" data-col="2"> ::=    </td><td class="tbody tr-even col col-odd" data-row="6" data-col="3"> <code class="koka">{</code> <em class="em-low1">semis</em> <em class="em-low1">declarations</em> <code class="koka">}</code> <em class="em-low1">semis</em>    </td><td class="tbody tr-even col col-even col-last" data-row="6" data-col="4">   </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="7" data-col="1">                         </td><td class="tbody tr-odd col col-even" data-row="7" data-col="2"> &#124;  </td><td class="tbody tr-odd col col-odd" data-row="7" data-col="3"> <em class="em-low1">semis</em> <em class="em-low1">declarations</em>                            </td><td class="tbody tr-odd col col-even col-last" data-row="7" data-col="4">   </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="8" data-col="1"> &#160;                  </td><td class="tbody tr-even col col-even" data-row="8" data-col="2">        </td><td class="tbody tr-even col col-odd" data-row="8" data-col="3">                                                           </td><td class="tbody tr-even col col-even col-last" data-row="8" data-col="4">   </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="9" data-col="1"> <em class="em-low1">visibility</em>            </td><td class="tbody tr-odd col col-even" data-row="9" data-col="2"> ::=    </td><td class="tbody tr-odd col col-odd" data-row="9" data-col="3"> <code class="koka"><span class="kw">public</span></code> <span class="bar">|</span> <code class="koka"><span class="kw">private</span></code>                               </td><td class="tbody tr-odd col col-even col-last" data-row="9" data-col="4">   </td></tr>
<tr><td class="tbody tr-even tr-last col col-odd col-first" data-row="10" data-col="1"> <em class="em-low1">semis</em>                 </td><td class="tbody tr-even tr-last col col-even" data-row="10" data-col="2"> ::=    </td><td class="tbody tr-even tr-last col col-odd" data-row="10" data-col="3"> <span class="many">{ <code class="koka">;</code> }</span>                                          </td><td class="tbody tr-even tr-last col col-even col-last" data-row="10" data-col="4">   </td></tr></tbody></table><h3 id="sec-top-level-declarations" class="h3" data-heading-depth="3" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-top-level-declarations" class="entity-anchor localref">&#x1F517;</a><a href="#sec-top-level-declarations" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">3.3.2</span>.&#8194;</span>Top level declarations</h3><table class="grammar parse madoko block">
<tbody><tr><td class="tbody tr-odd tr-first col col-odd col-first" data-row="1" data-col="1"> <em class="em-low1">declarations</em> </td><td class="tbody tr-odd tr-first col col-even" data-row="1" data-col="2"> ::=    </td><td class="tbody tr-odd tr-first col col-odd" data-row="1" data-col="3"> <span class="many">{ <em class="em-low1">import</em> <em class="em-low1">semis</em> }</span> <span class="many">{ <em class="em-low1">fixitydecl</em> <em class="em-low1">semis</em> }</span> <span class="many">{ <em class="em-low1">topdecl</em> <em class="em-low1">semis</em> }</span> </td><td class="tbody tr-odd tr-first col col-even col-last" data-row="1" data-col="4">   </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="2" data-col="1"> &#160;         </td><td class="tbody tr-even col col-even" data-row="2" data-col="2">        </td><td class="tbody tr-even col col-odd" data-row="2" data-col="3">                                                                                    </td><td class="tbody tr-even col col-even col-last" data-row="2" data-col="4">   </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="3" data-col="1"> <em class="em-low1">import</em>       </td><td class="tbody tr-odd col col-even" data-row="3" data-col="2"> ::=    </td><td class="tbody tr-odd col col-odd" data-row="3" data-col="3"> <span class="opt">[ <em class="em-low1">visibility</em> ]</span> <code class="koka"><span class="kw">import</span></code> <span class="opt">[ <em class="em-low1">moduleid</em> <code class="koka"><span class="kw">=</span></code> ]</span> <em class="em-low1">moduleid</em>                    </td><td class="tbody tr-odd col col-even col-last" data-row="3" data-col="4">   </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="4" data-col="1"> &#160;         </td><td class="tbody tr-even col col-even" data-row="4" data-col="2">        </td><td class="tbody tr-even col col-odd" data-row="4" data-col="3">                                                                                    </td><td class="tbody tr-even col col-even col-last" data-row="4" data-col="4">   </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="5" data-col="1"> <em class="em-low1">fixitydecl</em>   </td><td class="tbody tr-odd col col-even" data-row="5" data-col="2"> ::=    </td><td class="tbody tr-odd col col-odd" data-row="5" data-col="3"> <span class="opt">[ <em class="em-low1">visibility</em> ]</span> <em class="em-low1">fixity</em> <em class="em-low1">natural</em> <em class="em-low1">identifier</em> <span class="many">{ <code class="koka">,</code> <em class="em-low1">identifier</em> }</span>     </td><td class="tbody tr-odd col col-even col-last" data-row="5" data-col="4">   </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="6" data-col="1"> <em class="em-low1">fixity</em>       </td><td class="tbody tr-even col col-even" data-row="6" data-col="2"> ::=    </td><td class="tbody tr-even col col-odd" data-row="6" data-col="3"> <code class="koka"><span class="kw">infixl</span></code>                                                                           </td><td class="tbody tr-even col col-even col-last" data-row="6" data-col="4">   </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="7" data-col="1">                </td><td class="tbody tr-odd col col-even" data-row="7" data-col="2"> &#124;  </td><td class="tbody tr-odd col col-odd" data-row="7" data-col="3"> <code class="koka"><span class="kw">infixr</span></code>                                                                           </td><td class="tbody tr-odd col col-even col-last" data-row="7" data-col="4">   </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="8" data-col="1">                </td><td class="tbody tr-even col col-even" data-row="8" data-col="2"> &#124;  </td><td class="tbody tr-even col col-odd" data-row="8" data-col="3"> <code class="koka"><span class="kw">infix</span></code>                                                                            </td><td class="tbody tr-even col col-even col-last" data-row="8" data-col="4">   </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="9" data-col="1"> &#160;         </td><td class="tbody tr-odd col col-even" data-row="9" data-col="2">        </td><td class="tbody tr-odd col col-odd" data-row="9" data-col="3">                                                                                    </td><td class="tbody tr-odd col col-even col-last" data-row="9" data-col="4">   </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="10" data-col="1"> <em class="em-low1">topdecl</em>      </td><td class="tbody tr-even col col-even" data-row="10" data-col="2"> ::=    </td><td class="tbody tr-even col col-odd" data-row="10" data-col="3"> <span class="opt">[ <em class="em-low1">visibility</em> ]</span> <em class="em-low1">puredecl</em>                                                    </td><td class="tbody tr-even col col-even col-last" data-row="10" data-col="4">   </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="11" data-col="1">                </td><td class="tbody tr-odd col col-even" data-row="11" data-col="2"> &#124;  </td><td class="tbody tr-odd col col-odd" data-row="11" data-col="3"> <span class="opt">[ <em class="em-low1">visibility</em> ]</span> <em class="em-low1">aliasdecl</em>                                                   </td><td class="tbody tr-odd col col-even col-last" data-row="11" data-col="4">   </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="12" data-col="1">                </td><td class="tbody tr-even col col-even" data-row="12" data-col="2"> &#124;  </td><td class="tbody tr-even col col-odd" data-row="12" data-col="3"> <span class="opt">[ <em class="em-low1">visibility</em> ]</span> <em class="em-low1">typedecl</em>                                                    </td><td class="tbody tr-even col col-even col-last" data-row="12" data-col="4">   </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="13" data-col="1">                </td><td class="tbody tr-odd col col-even" data-row="13" data-col="2"> &#124;  </td><td class="tbody tr-odd col col-odd" data-row="13" data-col="3"> <span class="opt">[ <em class="em-low1">visibility</em> ]</span> <em class="em-low1">externdecl</em>                                                  </td><td class="tbody tr-odd col col-even col-last" data-row="13" data-col="4">   </td></tr>
<tr><td class="tbody tr-even tr-last col col-odd col-first" data-row="14" data-col="1">                </td><td class="tbody tr-even tr-last col col-even" data-row="14" data-col="2"> &#124;  </td><td class="tbody tr-even tr-last col col-odd" data-row="14" data-col="3"> <code class="koka"><span class="kw">abstract</span></code> <em class="em-low1">typedecl</em>                                                             </td><td class="tbody tr-even tr-last col col-even col-last" data-row="14" data-col="4">   </td></tr></tbody></table><h3 id="sec-type-declarations" class="h3" data-heading-depth="3" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-type-declarations" class="entity-anchor localref">&#x1F517;</a><a href="#sec-type-declarations" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">3.3.3</span>.&#8194;</span>Type declarations</h3><table class="grammar parse madoko block">
<tbody><tr><td class="tbody tr-odd tr-first col col-odd col-first" data-row="1" data-col="1"> <em class="em-low1">aliasdecl</em>   </td><td class="tbody tr-odd tr-first col col-even" data-row="1" data-col="2"> ::=   </td><td class="tbody tr-odd tr-first col col-odd" data-row="1" data-col="3"> <code class="koka"><span class="tp kw">alias</span></code> <em class="em-low1">typeid</em> <span class="opt">[ <em class="em-low1">typeparams</em> ]</span> <span class="opt">[ <em class="em-low1">kannot</em> ]</span> <code class="koka"><span class="kw">=</span></code> <em class="em-low1">type</em>                              </td><td class="tbody tr-odd tr-first col col-even col-last" data-row="1" data-col="4">    </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="2" data-col="1"> <em class="em-low1">typedecl</em>    </td><td class="tbody tr-even col col-even" data-row="2" data-col="2"> ::=   </td><td class="tbody tr-even col col-odd" data-row="2" data-col="3"> <em class="em-low1">typesort</em> <span class="opt">[ <em class="em-low1">typemod</em> ]</span> <em class="em-low1">typeid</em> <span class="opt">[ <em class="em-low1">typeparams</em> ]</span> <span class="opt">[ <em class="em-low1">kannot</em> ]</span> <span class="opt">[ <em class="em-low1">typebody</em> ]</span> </td><td class="tbody tr-even col col-even col-last" data-row="2" data-col="4">    </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="3" data-col="1">               </td><td class="tbody tr-odd col col-even" data-row="3" data-col="2"> &#124; </td><td class="tbody tr-odd col col-odd" data-row="3" data-col="3"> <code class="koka"><span class="tp kw">struct</span></code> <em class="em-low1">typeid</em> <span class="opt">[ <em class="em-low1">typeparams</em> ]</span> <span class="opt">[ <em class="em-low1">kannot</em> ]</span> <span class="opt">[ <em class="em-low1">conparams</em> ]</span>                    </td><td class="tbody tr-odd col col-even col-last" data-row="3" data-col="4">    </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="4" data-col="1">               </td><td class="tbody tr-even col col-even" data-row="4" data-col="2"> &#124; </td><td class="tbody tr-even col col-odd" data-row="4" data-col="3"> <code class="koka"><span class="tp kw">effect</span></code> <span class="opt">[ <code class="koka">linear</code> ]</span> <em class="em-low1">typeid</em> <span class="opt">[ <em class="em-low1">typeparams</em> ]</span> <span class="opt">[ <em class="em-low1">kannot</em> ]</span> <span class="opt">[ <em class="em-low1">opdecls</em> ]</span>     </td><td class="tbody tr-even col col-even col-last" data-row="4" data-col="4">    </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="5" data-col="1"> <em class="em-low1">typesort</em>    </td><td class="tbody tr-odd col col-even" data-row="5" data-col="2"> ::=   </td><td class="tbody tr-odd col col-odd" data-row="5" data-col="3"> <code class="koka"><span class="tp kw">type</span></code> <span class="bar">|</span> <code class="koka"><span class="tp kw">cotype</span></code> <span class="bar">|</span> <code class="koka"><span class="tp kw">rectype</span></code>                                                    </td><td class="tbody tr-odd col col-even col-last" data-row="5" data-col="4">    </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="6" data-col="1"> <em class="em-low1">typemod</em>     </td><td class="tbody tr-even col col-even" data-row="6" data-col="2"> ::=   </td><td class="tbody tr-even col col-odd" data-row="6" data-col="3"> <code class="koka">open</code> <span class="bar">|</span> <code class="koka"><a class="pp" href="https://koka-lang.github.io/koka/doc/std_core.html#extend">extend<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>extend: <span class="tp sp">(</span><span class="tp tpp">slice</span> <span class="tp kw op">:</span> <span class="tp">sslice</span><span class="tp sp">,</span> <span class="tp tpp">count</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">sslice</span></span></a></code>                                                                       </td><td class="tbody tr-even col col-even col-last" data-row="6" data-col="4">    </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="7" data-col="1"> &#160;        </td><td class="tbody tr-odd col col-even" data-row="7" data-col="2">       </td><td class="tbody tr-odd col col-odd" data-row="7" data-col="3">                                                                                                </td><td class="tbody tr-odd col col-even col-last" data-row="7" data-col="4">    </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="8" data-col="1"> <em class="em-low1">typeid</em>      </td><td class="tbody tr-even col col-even" data-row="8" data-col="2"> ::=   </td><td class="tbody tr-even col col-odd" data-row="8" data-col="3"> <em class="em-low1">varid</em>                                                                                        </td><td class="tbody tr-even col col-even col-last" data-row="8" data-col="4">    </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="9" data-col="1">               </td><td class="tbody tr-odd col col-even" data-row="9" data-col="2"> &#124; </td><td class="tbody tr-odd col col-odd" data-row="9" data-col="3"> <code class="code code2">[]</code>                                                                                         </td><td class="tbody tr-odd col col-even col-last" data-row="9" data-col="4">    </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="10" data-col="1">               </td><td class="tbody tr-even col col-even" data-row="10" data-col="2"> &#124; </td><td class="tbody tr-even col col-odd" data-row="10" data-col="3"> <code class="koka">(</code> <span class="many">{ <code class="koka">,</code> }</span> <code class="koka">)</code>                                                                           </td><td class="tbody tr-even col col-even col-last" data-row="10" data-col="4">    </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="11" data-col="1">               </td><td class="tbody tr-odd col col-even" data-row="11" data-col="2"> &#124; </td><td class="tbody tr-odd col col-odd" data-row="11" data-col="3"> <code class="koka"><span class="op">&#60;</span></code> <code class="koka"><span class="op">&#62;</span></code>                                                                                        </td><td class="tbody tr-odd col col-even col-last" data-row="11" data-col="4">    </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="12" data-col="1">               </td><td class="tbody tr-even col col-even" data-row="12" data-col="2"> &#124; </td><td class="tbody tr-even col col-odd" data-row="12" data-col="3"> <code class="koka"><span class="op">&#60;</span></code> <span class="koka code">&#124; </span> <code class="koka"><span class="op">&#62;</span></code>                                                                  </td><td class="tbody tr-even col col-even col-last" data-row="12" data-col="4">    </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="13" data-col="1"> &#160;        </td><td class="tbody tr-odd col col-even" data-row="13" data-col="2">       </td><td class="tbody tr-odd col col-odd" data-row="13" data-col="3">                                                                                                </td><td class="tbody tr-odd col col-even col-last" data-row="13" data-col="4">    </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="14" data-col="1"> <em class="em-low1">typeparams</em>  </td><td class="tbody tr-even col col-even" data-row="14" data-col="2"> ::=   </td><td class="tbody tr-even col col-odd" data-row="14" data-col="3"> <code class="koka"><span class="op">&#60;</span></code> <span class="opt">[ <em class="em-low1">tbinders</em> ]</span> <code class="koka"><span class="op">&#62;</span></code>                                                                     </td><td class="tbody tr-even col col-even col-last" data-row="14" data-col="4">    </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="15" data-col="1"> <em class="em-low1">tbinders</em>    </td><td class="tbody tr-odd col col-even" data-row="15" data-col="2"> ::=   </td><td class="tbody tr-odd col col-odd" data-row="15" data-col="3"> <em class="em-low1">tbinder</em> <span class="many">{ <code class="koka">,</code> <em class="em-low1">tbinder</em> }</span>                                                               </td><td class="tbody tr-odd col col-even col-last" data-row="15" data-col="4">    </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="16" data-col="1"> <em class="em-low1">tbinder</em>     </td><td class="tbody tr-even col col-even" data-row="16" data-col="2"> ::=   </td><td class="tbody tr-even col col-odd" data-row="16" data-col="3"> <em class="em-low1">varid</em> <span class="opt">[ <em class="em-low1">kannot</em> ]</span>                                                                       </td><td class="tbody tr-even col col-even col-last" data-row="16" data-col="4">    </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="17" data-col="1"> <em class="em-low1">typebody</em>    </td><td class="tbody tr-odd col col-even" data-row="17" data-col="2"> ::=   </td><td class="tbody tr-odd col col-odd" data-row="17" data-col="3"> <code class="koka">{</code> <em class="em-low1">semis</em> <span class="many">{ <em class="em-low1">constructor</em> <em class="em-low1">semis</em> }</span> <code class="koka">}</code>                                                 </td><td class="tbody tr-odd col col-even col-last" data-row="17" data-col="4">    </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="18" data-col="1"> &#160;        </td><td class="tbody tr-even col col-even" data-row="18" data-col="2">       </td><td class="tbody tr-even col col-odd" data-row="18" data-col="3">                                                                                                </td><td class="tbody tr-even col col-even col-last" data-row="18" data-col="4">    </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="19" data-col="1"> <em class="em-low1">constructor</em> </td><td class="tbody tr-odd col col-even" data-row="19" data-col="2"> ::=   </td><td class="tbody tr-odd col col-odd" data-row="19" data-col="3"> <span class="opt">[ <code class="koka"><span class="kw">con</span></code> ]</span> <em class="em-low1">conid</em> <span class="opt">[ <em class="em-low1">typeparams</em> ]</span> <span class="opt">[ <em class="em-low1">conparams</em> ]</span>                                 </td><td class="tbody tr-odd col col-even col-last" data-row="19" data-col="4">    </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="20" data-col="1"> <em class="em-low1">conparams</em>   </td><td class="tbody tr-even col col-even" data-row="20" data-col="2"> ::=   </td><td class="tbody tr-even col col-odd" data-row="20" data-col="3"> <em class="em-low1">lparen</em> <span class="opt">[ <em class="em-low1">conparam</em> <span class="many">{ <code class="koka">,</code> <em class="em-low1">conparam</em> }</span> ]</span> <code class="koka">)</code>                                        </td><td class="tbody tr-even col col-even col-last" data-row="20" data-col="4">    </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="21" data-col="1"> <em class="em-low1">conparam</em>    </td><td class="tbody tr-odd col col-even" data-row="21" data-col="2"> ::=   </td><td class="tbody tr-odd col col-odd" data-row="21" data-col="3"> <span class="opt">[ <em class="em-low1">paramid</em> ]</span> <code class="code code2">:</code> <em class="em-low1">paramtype</em> <span class="opt">[ <code class="koka"><span class="kw">=</span></code> <em class="em-low1">expr</em> ]</span>                                         </td><td class="tbody tr-odd col col-even col-last" data-row="21" data-col="4">    </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="22" data-col="1"> <em class="em-low1">lparen</em>      </td><td class="tbody tr-even col col-even" data-row="22" data-col="2"> ::=   </td><td class="tbody tr-even col col-odd" data-row="22" data-col="3"> <em class="em-low1">lapp</em> <span class="bar">|</span> <code class="koka">(</code>                                                                            </td><td class="tbody tr-even col col-even col-last" data-row="22" data-col="4">    </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="23" data-col="1"> &#160;        </td><td class="tbody tr-odd col col-even" data-row="23" data-col="2">       </td><td class="tbody tr-odd col col-odd" data-row="23" data-col="3">                                                                                                </td><td class="tbody tr-odd col col-even col-last" data-row="23" data-col="4">    </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="24" data-col="1"> <em class="em-low1">opdecls</em>     </td><td class="tbody tr-even col col-even" data-row="24" data-col="2"> ::=   </td><td class="tbody tr-even col col-odd" data-row="24" data-col="3"> <code class="koka">{</code> <em class="em-low1">semis</em> <span class="many">{ <em class="em-low1">opdecl</em> <em class="em-low1">semis</em> }</span> <code class="koka">}</code>                                                      </td><td class="tbody tr-even col col-even col-last" data-row="24" data-col="4">    </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="25" data-col="1"> <em class="em-low1">opdecl</em>      </td><td class="tbody tr-odd col col-even" data-row="25" data-col="2"> ::=   </td><td class="tbody tr-odd col col-odd" data-row="25" data-col="3"> <span class="opt">[ <em class="em-low1">visibility</em> ]</span> <em class="em-low1">identifier</em> <span class="opt">[ <em class="em-low1">typeparams</em> ]</span> <em class="em-low1">opparams</em> <span class="opt">[  <code class="code code2">:</code> <em class="em-low1">tatom</em> ]</span>       </td><td class="tbody tr-odd col col-even col-last" data-row="25" data-col="4">    </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="26" data-col="1"> <em class="em-low1">opparams</em>    </td><td class="tbody tr-even col col-even" data-row="26" data-col="2"> ::=   </td><td class="tbody tr-even col col-odd" data-row="26" data-col="3"> <em class="em-low1">lparen</em> <span class="opt">[ <em class="em-low1">opparam</em> <span class="many">{ <code class="koka">,</code> <em class="em-low1">opparam</em> }</span> ]</span> <code class="koka">)</code>                                          </td><td class="tbody tr-even col col-even col-last" data-row="26" data-col="4">    </td></tr>
<tr><td class="tbody tr-odd tr-last col col-odd col-first" data-row="27" data-col="1"> <em class="em-low1">opparam</em>     </td><td class="tbody tr-odd tr-last col col-even" data-row="27" data-col="2"> ::=   </td><td class="tbody tr-odd tr-last col col-odd" data-row="27" data-col="3"> <span class="opt">[ <em class="em-low1">paramid</em> ]</span> <code class="code code2">:</code> <em class="em-low1">paramtype</em>                                                            </td><td class="tbody tr-odd tr-last col col-even col-last" data-row="27" data-col="4">    </td></tr></tbody></table><h3 id="sec-value-and-function-declarations" class="h3" data-heading-depth="3" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-value-and-function-declarations" class="entity-anchor localref">&#x1F517;</a><a href="#sec-value-and-function-declarations" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">3.3.4</span>.&#8194;</span>Value and function declarations</h3><table class="grammar parse madoko block">
<tbody><tr><td class="tbody tr-odd tr-first col col-odd col-first" data-row="1" data-col="1"> <em class="em-low1">puredecl</em>       </td><td class="tbody tr-odd tr-first col col-even" data-row="1" data-col="2"> ::=      </td><td class="tbody tr-odd tr-first col col-odd" data-row="1" data-col="3"> <code class="koka"><span class="kw">val</span></code> <em class="em-low1">valdecl</em>                                                                               </td><td class="tbody tr-odd tr-first col col-even col-last" data-row="1" data-col="4">                       </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="2" data-col="1">                  </td><td class="tbody tr-even col col-even" data-row="2" data-col="2"> &#124;    </td><td class="tbody tr-even col col-odd" data-row="2" data-col="3"> (<code class="koka"><span class="kw">fun</span></code><span class="bar">|</span><code class="koka"><span class="kw">function</span></code>) <em class="em-low1">fundecl</em>                                                                          </td><td class="tbody tr-even col col-even col-last" data-row="2" data-col="4">                       </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="3" data-col="1"> &#160;           </td><td class="tbody tr-odd col col-even" data-row="3" data-col="2">          </td><td class="tbody tr-odd col col-odd" data-row="3" data-col="3">                                                                                               </td><td class="tbody tr-odd col col-even col-last" data-row="3" data-col="4">                       </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="4" data-col="1"> <em class="em-low1">valdecl</em>        </td><td class="tbody tr-even col col-even" data-row="4" data-col="2"> ::=      </td><td class="tbody tr-even col col-odd" data-row="4" data-col="3"> <em class="em-low1">binder</em> <code class="koka"><span class="kw">=</span></code> <em class="em-low1">expr</em>                                                                           </td><td class="tbody tr-even col col-even col-last" data-row="4" data-col="4">                       </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="5" data-col="1"> <em class="em-low1">binder</em>         </td><td class="tbody tr-odd col col-even" data-row="5" data-col="2"> ::=      </td><td class="tbody tr-odd col col-odd" data-row="5" data-col="3"> <em class="em-low1">identifier</em> <span class="opt">[ <code class="code code2">:</code> <em class="em-low1">type</em> ]</span>                                                               </td><td class="tbody tr-odd col col-even col-last" data-row="5" data-col="4">                       </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="6" data-col="1"> &#160;           </td><td class="tbody tr-even col col-even" data-row="6" data-col="2">          </td><td class="tbody tr-even col col-odd" data-row="6" data-col="3">                                                                                               </td><td class="tbody tr-even col col-even col-last" data-row="6" data-col="4">                       </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="7" data-col="1"> <em class="em-low1">fundecl</em>        </td><td class="tbody tr-odd col col-even" data-row="7" data-col="2"> ::=      </td><td class="tbody tr-odd col col-odd" data-row="7" data-col="3"> <em class="em-low1">somes</em> <em class="em-low1">funid</em> <em class="em-low1">fundef</em> <em class="em-low1">bodyexpr</em>                     </td><td class="tbody tr-odd col col-even col-last" data-row="7" data-col="4">                       </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="8" data-col="1"> <em class="em-low1">fundef</em>         </td><td class="tbody tr-even col col-even" data-row="8" data-col="2"> ::=      </td><td class="tbody tr-even col col-odd" data-row="8" data-col="3"> <span class="opt">[ <em class="em-low1">typeparams</em> ]</span> <em class="em-low1">parameters</em> <span class="opt">[ <code class="code code2">:</code> <em class="em-low1">tresult</em> ]</span> <span class="opt">[ <em class="em-low1">qualifier</em> ]</span>                                        </td><td class="tbody tr-even col col-even col-last" data-row="8" data-col="4">                       </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="9" data-col="1"> <em class="em-low1">funid</em>          </td><td class="tbody tr-odd col col-even" data-row="9" data-col="2"> ::=      </td><td class="tbody tr-odd col col-odd" data-row="9" data-col="3"> <em class="em-low1">identifier</em>                                                                                  </td><td class="tbody tr-odd col col-even col-last" data-row="9" data-col="4">                       </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="10" data-col="1">                  </td><td class="tbody tr-even col col-even" data-row="10" data-col="2"> &#124;    </td><td class="tbody tr-even col col-odd" data-row="10" data-col="3"> <code class="code code2">[</code> <span class="many">{ <code class="koka">,</code> }</span> <code class="code code2">]</code>                                                                          </td><td class="tbody tr-even col col-even col-last" data-row="10" data-col="4"> (indexing operator)   </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="11" data-col="1"> &#160;           </td><td class="tbody tr-odd col col-even" data-row="11" data-col="2">          </td><td class="tbody tr-odd col col-odd" data-row="11" data-col="3">                                                                                               </td><td class="tbody tr-odd col col-even col-last" data-row="11" data-col="4">                       </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="12" data-col="1"> <em class="em-low1">parameters</em>     </td><td class="tbody tr-even col col-even" data-row="12" data-col="2"> ::=      </td><td class="tbody tr-even col col-odd" data-row="12" data-col="3"> <em class="em-low1">lparen</em> <span class="opt">[ <em class="em-low1">parameter</em> <span class="many">{ <code class="koka">,</code> <em class="em-low1">parameter</em> }</span> ]</span> <code class="koka">)</code>                                     </td><td class="tbody tr-even col col-even col-last" data-row="12" data-col="4">                       </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="13" data-col="1"> <em class="em-low1">parameter</em>      </td><td class="tbody tr-odd col col-even" data-row="13" data-col="2"> ::=      </td><td class="tbody tr-odd col col-odd" data-row="13" data-col="3"> <em class="em-low1">paramid</em> <span class="opt">[ <code class="code code2">:</code> <em class="em-low1">paramtype</em> ]</span> <span class="opt">[ <code class="koka"><span class="kw">=</span></code> <em class="em-low1">expr</em> ]</span>                                          </td><td class="tbody tr-odd col col-even col-last" data-row="13" data-col="4">                       </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="14" data-col="1"> <em class="em-low1">paramid</em>        </td><td class="tbody tr-even col col-even" data-row="14" data-col="2"> ::=      </td><td class="tbody tr-even col col-odd" data-row="14" data-col="3"> <em class="em-low1">identifier</em> <span class="bar">|</span> <em class="em-low1">wildcard</em>                                                              </td><td class="tbody tr-even col col-even col-last" data-row="14" data-col="4">                       </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="15" data-col="1"> <em class="em-low1">paramtype</em>      </td><td class="tbody tr-odd col col-even" data-row="15" data-col="2"> ::=      </td><td class="tbody tr-odd col col-odd" data-row="15" data-col="3"> <em class="em-low1">type</em>                                                                                        </td><td class="tbody tr-odd col col-even col-last" data-row="15" data-col="4">                       </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="16" data-col="1">                  </td><td class="tbody tr-even col col-even" data-row="16" data-col="2"> &#124;    </td><td class="tbody tr-even col col-odd" data-row="16" data-col="3"> <code class="koka"><span class="op">?</span></code> <em class="em-low1">type</em>                                                                                    </td><td class="tbody tr-even col col-even col-last" data-row="16" data-col="4"> (optional parameter)                      </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="17" data-col="1"> &#160;           </td><td class="tbody tr-odd col col-even" data-row="17" data-col="2">          </td><td class="tbody tr-odd col col-odd" data-row="17" data-col="3">                                                                                               </td><td class="tbody tr-odd col col-even col-last" data-row="17" data-col="4">                       </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="18" data-col="1"> <em class="em-low1">qidentifier</em>    </td><td class="tbody tr-even col col-even" data-row="18" data-col="2"> ::=      </td><td class="tbody tr-even col col-odd" data-row="18" data-col="3"> <em class="em-low1">qvarid</em> <span class="bar">|</span> <em class="em-low1">qidop</em> <span class="bar">|</span> <em class="em-low1">identifier</em>                                               </td><td class="tbody tr-even col col-even col-last" data-row="18" data-col="4">                       </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="19" data-col="1"> <em class="em-low1">identifier</em>     </td><td class="tbody tr-odd col col-even" data-row="19" data-col="2"> ::=      </td><td class="tbody tr-odd col col-odd" data-row="19" data-col="3"> <em class="em-low1">varid</em> <span class="bar">|</span> <em class="em-low1">idop</em>                                                                       </td><td class="tbody tr-odd col col-even col-last" data-row="19" data-col="4">                       </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="20" data-col="1"> &#160;           </td><td class="tbody tr-even col col-even" data-row="20" data-col="2">          </td><td class="tbody tr-even col col-odd" data-row="20" data-col="3">                                                                                               </td><td class="tbody tr-even col col-even col-last" data-row="20" data-col="4">                       </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="21" data-col="1"> <em class="em-low1">qoperator</em>      </td><td class="tbody tr-odd col col-even" data-row="21" data-col="2"> ::=      </td><td class="tbody tr-odd col col-odd" data-row="21" data-col="3"> <em class="em-low1">op</em>                                                                                          </td><td class="tbody tr-odd col col-even col-last" data-row="21" data-col="4">                       </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="22" data-col="1"> &#160;           </td><td class="tbody tr-even col col-even" data-row="22" data-col="2">          </td><td class="tbody tr-even col col-odd" data-row="22" data-col="3">                                                                                               </td><td class="tbody tr-even col col-even col-last" data-row="22" data-col="4">                       </td></tr>
<tr><td class="tbody tr-odd tr-last col col-odd col-first" data-row="23" data-col="1"> <em class="em-low1">qconstructor</em>   </td><td class="tbody tr-odd tr-last col col-even" data-row="23" data-col="2"> ::=      </td><td class="tbody tr-odd tr-last col col-odd" data-row="23" data-col="3"> <em class="em-low1">conid</em> <span class="bar">|</span> <em class="em-low1">qconid</em>                                                                     </td><td class="tbody tr-odd tr-last col col-even col-last" data-row="23" data-col="4">                       </td></tr></tbody></table><h3 id="sec-statements" class="h3" data-heading-depth="3" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-statements" class="entity-anchor localref">&#x1F517;</a><a href="#sec-statements" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">3.3.5</span>.&#8194;</span>Statements</h3><table class="grammar parse madoko block">
<tbody><tr><td class="tbody tr-odd tr-first col col-odd col-first" data-row="1" data-col="1"> <em class="em-low1">block</em>     </td><td class="tbody tr-odd tr-first col col-even" data-row="1" data-col="2"> ::=   </td><td class="tbody tr-odd tr-first col col-odd" data-row="1" data-col="3"> <code class="code code2">{</code> <em class="em-low1">semis</em> <span class="many">{ <em class="em-low1">statement</em> <em class="em-low1">semis</em> }</span> <code class="code code2">}</code> </td><td class="tbody tr-odd tr-first col col-even col-last" data-row="1" data-col="4">                                          </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="2" data-col="1"> &#160;      </td><td class="tbody tr-even col col-even" data-row="2" data-col="2">       </td><td class="tbody tr-even col col-odd" data-row="2" data-col="3">                                                  </td><td class="tbody tr-even col col-even col-last" data-row="2" data-col="4">                                          </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="3" data-col="1"> <em class="em-low1">statement</em> </td><td class="tbody tr-odd col col-even" data-row="3" data-col="2"> ::=   </td><td class="tbody tr-odd col col-odd" data-row="3" data-col="3"> <em class="em-low1">expr</em><sub>&#60;!&#160;<em class="em-low1">funexpr</em>&#62;</sub>                     </td><td class="tbody tr-odd col col-even col-last" data-row="3" data-col="4">                                          </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="4" data-col="1">             </td><td class="tbody tr-even col col-even" data-row="4" data-col="2"> &#124; </td><td class="tbody tr-even col col-odd" data-row="4" data-col="3"> <em class="em-low1">decl</em>                                           </td><td class="tbody tr-even col col-even col-last" data-row="4" data-col="4">                                          </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="5" data-col="1"> &#160;      </td><td class="tbody tr-odd col col-even" data-row="5" data-col="2">       </td><td class="tbody tr-odd col col-odd" data-row="5" data-col="3">                                                  </td><td class="tbody tr-odd col col-even col-last" data-row="5" data-col="4">                                          </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="6" data-col="1"> <em class="em-low1">decl</em>      </td><td class="tbody tr-even col col-even" data-row="6" data-col="2"> ::=   </td><td class="tbody tr-even col col-odd" data-row="6" data-col="3"> (<code class="koka"><span class="kw">fun</span></code><span class="bar">|</span><code class="koka"><span class="kw">function</span></code>) <em class="em-low1">fundecl</em>              </td><td class="tbody tr-even col col-even col-last" data-row="6" data-col="4">                                          </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="7" data-col="1">             </td><td class="tbody tr-odd col col-even" data-row="7" data-col="2"> &#124; </td><td class="tbody tr-odd col col-odd" data-row="7" data-col="3"> <code class="koka"><span class="kw">val</span></code> <em class="em-low1">apattern</em> <code class="koka"><span class="kw">=</span></code> <em class="em-low1">valexpr</em>                   </td><td class="tbody tr-odd col col-even col-last" data-row="7" data-col="4"> (local values can use a pattern binding) </td></tr>
<tr><td class="tbody tr-even tr-last col col-odd col-first" data-row="8" data-col="1">             </td><td class="tbody tr-even tr-last col col-even" data-row="8" data-col="2"> &#124; </td><td class="tbody tr-even tr-last col col-odd" data-row="8" data-col="3"> <code class="koka"><span class="kw">var</span></code> <em class="em-low1">binder</em> <code class="code code2">:=</code> <em class="em-low1">valexpr</em>                  </td><td class="tbody tr-even tr-last col col-even col-last" data-row="8" data-col="4">                                          </td></tr></tbody></table><h3 id="sec-expressions" class="h3" data-heading-depth="3" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-expressions" class="entity-anchor localref">&#x1F517;</a><a href="#sec-expressions" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">3.3.6</span>.&#8194;</span>Expressions</h3><table class="grammar parse madoko block">
<tbody><tr><td class="tbody tr-odd tr-first col col-odd col-first" data-row="1" data-col="1"> <em class="em-low1">bodyexpr</em>    </td><td class="tbody tr-odd tr-first col col-even" data-row="1" data-col="2"> ::=   </td><td class="tbody tr-odd tr-first col col-odd" data-row="1" data-col="3"> <code class="koka"><span class="kw op">-&gt;</span></code> <em class="em-low1">blockexpr</em>                                                            </td><td class="tbody tr-odd tr-first col col-even col-last" data-row="1" data-col="4">                                    </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="2" data-col="1">               </td><td class="tbody tr-even col col-even" data-row="2" data-col="2"> &#124; </td><td class="tbody tr-even col col-odd" data-row="2" data-col="3"> <em class="em-low1">block</em>                                                                     </td><td class="tbody tr-even col col-even col-last" data-row="2" data-col="4">                                    </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="3" data-col="1"> &#160;        </td><td class="tbody tr-odd col col-even" data-row="3" data-col="2">       </td><td class="tbody tr-odd col col-odd" data-row="3" data-col="3">                                                                             </td><td class="tbody tr-odd col col-even col-last" data-row="3" data-col="4">                                    </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="4" data-col="1"> <em class="em-low1">blockexpr</em>   </td><td class="tbody tr-even col col-even" data-row="4" data-col="2"> ::=   </td><td class="tbody tr-even col col-odd" data-row="4" data-col="3"> <em class="em-low1">expr</em>                                                                      </td><td class="tbody tr-even col col-even col-last" data-row="4" data-col="4"> (implicitly wrapped in a block)    </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="5" data-col="1"> &#160;        </td><td class="tbody tr-odd col col-even" data-row="5" data-col="2">       </td><td class="tbody tr-odd col col-odd" data-row="5" data-col="3">                                                                             </td><td class="tbody tr-odd col col-even col-last" data-row="5" data-col="4">                                    </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="6" data-col="1"> <em class="em-low1">expr</em>        </td><td class="tbody tr-even col col-even" data-row="6" data-col="2"> ::=   </td><td class="tbody tr-even col col-odd" data-row="6" data-col="3"> <em class="em-low1">returnexpr</em>                                                                </td><td class="tbody tr-even col col-even col-last" data-row="6" data-col="4">                                    </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="7" data-col="1">               </td><td class="tbody tr-odd col col-even" data-row="7" data-col="2"> &#124; </td><td class="tbody tr-odd col col-odd" data-row="7" data-col="3"> <em class="em-low1">matchexpr</em>                                                                 </td><td class="tbody tr-odd col col-even col-last" data-row="7" data-col="4">                                    </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="8" data-col="1">               </td><td class="tbody tr-even col col-even" data-row="8" data-col="2"> &#124; </td><td class="tbody tr-even col col-odd" data-row="8" data-col="3"> <em class="em-low1">handlerexpr</em>                                                               </td><td class="tbody tr-even col col-even col-last" data-row="8" data-col="4">                                    </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="9" data-col="1">               </td><td class="tbody tr-odd col col-even" data-row="9" data-col="2"> &#124; </td><td class="tbody tr-odd col col-odd" data-row="9" data-col="3"> <em class="em-low1">funexpr</em>                                                                   </td><td class="tbody tr-odd col col-even col-last" data-row="9" data-col="4">                                    </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="10" data-col="1">               </td><td class="tbody tr-even col col-even" data-row="10" data-col="2"> &#124; </td><td class="tbody tr-even col col-odd" data-row="10" data-col="3"> <em class="em-low1">ifexpr</em>                                                                    </td><td class="tbody tr-even col col-even col-last" data-row="10" data-col="4">                                    </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="11" data-col="1">               </td><td class="tbody tr-odd col col-even" data-row="11" data-col="2"> &#124; </td><td class="tbody tr-odd col col-odd" data-row="11" data-col="3"> <em class="em-low1">opexpr</em>                                                                    </td><td class="tbody tr-odd col col-even col-last" data-row="11" data-col="4">                                    </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="12" data-col="1"> &#160;        </td><td class="tbody tr-even col col-even" data-row="12" data-col="2">       </td><td class="tbody tr-even col col-odd" data-row="12" data-col="3">                                                                             </td><td class="tbody tr-even col col-even col-last" data-row="12" data-col="4">                                    </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="13" data-col="1"> <em class="em-low1">ifexpr</em>      </td><td class="tbody tr-odd col col-even" data-row="13" data-col="2"> ::=   </td><td class="tbody tr-odd col col-odd" data-row="13" data-col="3"> <code class="koka"><span class="kw">if</span></code> <em class="em-low1">atom</em> <em class="em-low1">then</em> <span class="many">{ <em class="em-low1">elif</em> }</span> <span class="opt">[ <code class="koka"><span class="kw">else</span></code> <em class="em-low1">expr</em><sub>&#60;!<em class="em-low1">ifexpr</em>&#62;</sub> ]</span> </td><td class="tbody tr-odd col col-even col-last" data-row="13" data-col="4">                                    </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="14" data-col="1"> <em class="em-low1">then</em>        </td><td class="tbody tr-even col col-even" data-row="14" data-col="2"> ::=   </td><td class="tbody tr-even col col-odd" data-row="14" data-col="3"> <span class="opt">[ <code class="koka"><span class="kw">then</span></code> ]</span> <em class="em-low1">expr</em><sub>&#60;!<em class="em-low1">ifexpr</em>&#62;</sub>                                    </td><td class="tbody tr-even col col-even col-last" data-row="14" data-col="4">                                    </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="15" data-col="1"> <em class="em-low1">elif</em>        </td><td class="tbody tr-odd col col-even" data-row="15" data-col="2"> ::=   </td><td class="tbody tr-odd col col-odd" data-row="15" data-col="3"> <code class="koka"><span class="kw">elif</span></code> <em class="em-low1">atom</em> <em class="em-low1">then</em>                                                        </td><td class="tbody tr-odd col col-even col-last" data-row="15" data-col="4">                                    </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="16" data-col="1"> &#160;        </td><td class="tbody tr-even col col-even" data-row="16" data-col="2">       </td><td class="tbody tr-even col col-odd" data-row="16" data-col="3">                                                                             </td><td class="tbody tr-even col col-even col-last" data-row="16" data-col="4">                                    </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="17" data-col="1"> <em class="em-low1">matchexpr</em>   </td><td class="tbody tr-odd col col-even" data-row="17" data-col="2"> ::=   </td><td class="tbody tr-odd col col-odd" data-row="17" data-col="3"> <code class="koka"><span class="kw">match</span></code> <em class="em-low1">atom</em> <code class="koka">{</code> <em class="em-low1">semis</em> <span class="many">{ <em class="em-low1">matchrule</em> <em class="em-low1">semis</em> }</span> <code class="koka">}</code>                 </td><td class="tbody tr-odd col col-even col-last" data-row="17" data-col="4">                                    </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="18" data-col="1"> <em class="em-low1">returnexpr</em>  </td><td class="tbody tr-even col col-even" data-row="18" data-col="2"> ::=   </td><td class="tbody tr-even col col-odd" data-row="18" data-col="3"> <code class="koka"><span class="kw">return</span></code> <em class="em-low1">opexpr</em>                                                           </td><td class="tbody tr-even col col-even col-last" data-row="18" data-col="4">                                    </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="19" data-col="1"> <em class="em-low1">funexpr</em>     </td><td class="tbody tr-odd col col-even" data-row="19" data-col="2"> ::=   </td><td class="tbody tr-odd col col-odd" data-row="19" data-col="3"> <em class="em-low1">funanon</em> <em class="em-low1">fundef</em> <em class="em-low1">block</em>                                                  </td><td class="tbody tr-odd col col-even col-last" data-row="19" data-col="4">                                    </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="20" data-col="1">               </td><td class="tbody tr-even col col-even" data-row="20" data-col="2"> &#124; </td><td class="tbody tr-even col col-odd" data-row="20" data-col="3"> <em class="em-low1">block</em>                                                                     </td><td class="tbody tr-even col col-even col-last" data-row="20" data-col="4"> (zero-argument anonymous function) </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="21" data-col="1"> <em class="em-low1">handlerexpr</em> </td><td class="tbody tr-odd col col-even" data-row="21" data-col="2"> ::=   </td><td class="tbody tr-odd col col-odd" data-row="21" data-col="3"> <code class="koka"><span class="kw">handler</span></code> <em class="em-low1">handlereff</em> <em class="em-low1">handlerpars</em> <code class="koka">{</code> <em class="em-low1">handlerrules</em> <code class="koka">}</code>                 </td><td class="tbody tr-odd col col-even col-last" data-row="21" data-col="4">                                    </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="22" data-col="1">               </td><td class="tbody tr-even col col-even" data-row="22" data-col="2"> &#124; </td><td class="tbody tr-even col col-odd" data-row="22" data-col="3"> <code class="koka"><span class="kw">handle</span></code> <em class="em-low1">handlereff</em> <em class="em-low1">haction</em> <em class="em-low1">handlerpars</em> <code class="koka">{</code> <em class="em-low1">handlerrules</em> <code class="koka">}</code>        </td><td class="tbody tr-even col col-even col-last" data-row="22" data-col="4">                                    </td></tr>
<tr><td class="tbody tr-odd tr-last col col-odd col-first" data-row="23" data-col="1"> <em class="em-low1">haction</em>     </td><td class="tbody tr-odd tr-last col col-even" data-row="23" data-col="2"> ::=   </td><td class="tbody tr-odd tr-last col col-odd" data-row="23" data-col="3"> lparen <em class="em-low1">expr</em> <code class="koka">)</code>                                                            </td><td class="tbody tr-odd tr-last col col-even col-last" data-row="23" data-col="4">                                    </td></tr></tbody></table><h3 id="sec-operator-expressions" class="h3" data-heading-depth="3" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-operator-expressions" class="entity-anchor localref">&#x1F517;</a><a href="#sec-operator-expressions" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">3.3.7</span>.&#8194;</span>Operator expressions</h3>
<p class="p noindent">For simplicity, we parse all operators as if they are left associative with
the same precedence. We assume that a separate pass in the compiler will use
the fixity declarations that are in scope to properly associate all operators
in an expressions.
</p><table class="grammar parse madoko block">
<tbody><tr><td class="tbody tr-odd tr-first col col-odd col-first" data-row="1" data-col="1"> <em class="em-low1">opexpr</em>     </td><td class="tbody tr-odd tr-first col col-even" data-row="1" data-col="2"> ::=   </td><td class="tbody tr-odd tr-first col col-odd" data-row="1" data-col="3"> <em class="em-low1">prefix</em> <span class="many">{ <em class="em-low1">qoperator</em> <em class="em-low1">prefixexpr</em> }</span> </td><td class="tbody tr-odd tr-first col col-even col-last" data-row="1" data-col="4">                              </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="2" data-col="1"> <em class="em-low1">prefixexpr</em> </td><td class="tbody tr-even col col-even" data-row="2" data-col="2"> ::=   </td><td class="tbody tr-even col col-odd" data-row="2" data-col="3"> <span class="many">{ <code class="code code2">!</code> <span class="bar">|</span> <code class="code code2">~</code> }</span> <em class="em-low1">appexpr</em>    </td><td class="tbody tr-even col col-even col-last" data-row="2" data-col="4">                              </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="3" data-col="1"> &#160;       </td><td class="tbody tr-odd col col-even" data-row="3" data-col="2">       </td><td class="tbody tr-odd col col-odd" data-row="3" data-col="3">                                            </td><td class="tbody tr-odd col col-even col-last" data-row="3" data-col="4">                              </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="4" data-col="1"> <em class="em-low1">appexpr</em>    </td><td class="tbody tr-even col col-even" data-row="4" data-col="2"> ::=   </td><td class="tbody tr-even col col-odd" data-row="4" data-col="3"> <em class="em-low1">appexpr</em> <em class="em-low1">lapp</em> <span class="opt">[ <em class="em-low1">arguments</em> ]</span> <code class="koka">)</code>   </td><td class="tbody tr-even col col-even col-last" data-row="4" data-col="4"> (regular application)        </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="5" data-col="1">              </td><td class="tbody tr-odd col col-even" data-row="5" data-col="2"> &#124; </td><td class="tbody tr-odd col col-odd" data-row="5" data-col="3"> <em class="em-low1">appexpr</em> <em class="em-low1">lidx</em> <span class="opt">[ <em class="em-low1">arguments</em> ]</span> <code class="koka">]</code>   </td><td class="tbody tr-odd col col-even col-last" data-row="5" data-col="4"> (index operation)            </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="6" data-col="1">              </td><td class="tbody tr-even col col-even" data-row="6" data-col="2"> &#124; </td><td class="tbody tr-even col col-odd" data-row="6" data-col="3"> <em class="em-low1">appexpr</em> <span class="many">{ <em class="em-low1">funexpr</em> }</span>               </td><td class="tbody tr-even col col-even col-last" data-row="6" data-col="4"> (apply function expressions) </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="7" data-col="1">              </td><td class="tbody tr-odd col col-even" data-row="7" data-col="2"> &#124; </td><td class="tbody tr-odd col col-odd" data-row="7" data-col="3"> <em class="em-low1">appexpr</em> <code class="koka"><span class="kw op">.</span></code> <em class="em-low1">atom</em>                       </td><td class="tbody tr-odd col col-even col-last" data-row="7" data-col="4">                              </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="8" data-col="1">              </td><td class="tbody tr-even col col-even" data-row="8" data-col="2"> &#124; </td><td class="tbody tr-even col col-odd" data-row="8" data-col="3"> <em class="em-low1">atom</em>                                     </td><td class="tbody tr-even col col-even col-last" data-row="8" data-col="4">                              </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="9" data-col="1"> &#160;       </td><td class="tbody tr-odd col col-even" data-row="9" data-col="2">       </td><td class="tbody tr-odd col col-odd" data-row="9" data-col="3">                                            </td><td class="tbody tr-odd col col-even col-last" data-row="9" data-col="4">                              </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="10" data-col="1"> <em class="em-low1">arguments</em>  </td><td class="tbody tr-even col col-even" data-row="10" data-col="2"> ::=   </td><td class="tbody tr-even col col-odd" data-row="10" data-col="3"> <em class="em-low1">argument</em> <span class="many">{ <code class="koka">,</code> <em class="em-low1">argument</em> }</span>         </td><td class="tbody tr-even col col-even col-last" data-row="10" data-col="4">                              </td></tr>
<tr><td class="tbody tr-odd tr-last col col-odd col-first" data-row="11" data-col="1"> <em class="em-low1">argument</em>   </td><td class="tbody tr-odd tr-last col col-even" data-row="11" data-col="2"> ::=   </td><td class="tbody tr-odd tr-last col col-odd" data-row="11" data-col="3"> <span class="opt">[ <em class="em-low1">identifier</em> <code class="koka"><span class="kw">=</span></code> ]</span> <em class="em-low1">expr</em>            </td><td class="tbody tr-odd tr-last col col-even col-last" data-row="11" data-col="4">                              </td></tr></tbody></table><h3 id="sec-atomic-expressions" class="h3" data-heading-depth="3" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-atomic-expressions" class="entity-anchor localref">&#x1F517;</a><a href="#sec-atomic-expressions" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">3.3.8</span>.&#8194;</span>Atomic expressions</h3><table class="grammar parse madoko block">
<tbody><tr><td class="tbody tr-odd tr-first col col-odd col-first" data-row="1" data-col="1"> <em class="em-low1">atom</em>       </td><td class="tbody tr-odd tr-first col col-even" data-row="1" data-col="2"> ::=      </td><td class="tbody tr-odd tr-first col col-odd" data-row="1" data-col="3"> <em class="em-low1">qidentifier</em>                                                  </td><td class="tbody tr-odd tr-first col col-even col-last" data-row="1" data-col="4">                              </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="2" data-col="1">              </td><td class="tbody tr-even col col-even" data-row="2" data-col="2"> &#124;    </td><td class="tbody tr-even col col-odd" data-row="2" data-col="3"> <em class="em-low1">qconstructor</em>                                                 </td><td class="tbody tr-even col col-even col-last" data-row="2" data-col="4">                              </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="3" data-col="1">              </td><td class="tbody tr-odd col col-even" data-row="3" data-col="2"> &#124;    </td><td class="tbody tr-odd col col-odd" data-row="3" data-col="3"> <em class="em-low1">literal</em>                                                      </td><td class="tbody tr-odd col col-even col-last" data-row="3" data-col="4">                              </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="4" data-col="1">              </td><td class="tbody tr-even col col-even" data-row="4" data-col="2"> &#124;    </td><td class="tbody tr-even col col-odd" data-row="4" data-col="3"> <code class="koka">(</code> <code class="koka">)</code>                                                        </td><td class="tbody tr-even col col-even col-last" data-row="4" data-col="4"> (unit)                       </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="5" data-col="1">              </td><td class="tbody tr-odd col col-even" data-row="5" data-col="2"> &#124;    </td><td class="tbody tr-odd col col-odd" data-row="5" data-col="3"> <code class="koka">(</code> <em class="em-low1">annexpr</em> <code class="koka">)</code>                                              </td><td class="tbody tr-odd col col-even col-last" data-row="5" data-col="4"> (parenthesized expression)   </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="6" data-col="1">              </td><td class="tbody tr-even col col-even" data-row="6" data-col="2"> &#124;    </td><td class="tbody tr-even col col-odd" data-row="6" data-col="3"> <code class="koka">(</code> <em class="em-low1">annexprs</em> <code class="koka">)</code>                                             </td><td class="tbody tr-even col col-even col-last" data-row="6" data-col="4"> (tuple expression)           </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="7" data-col="1">              </td><td class="tbody tr-odd col col-even" data-row="7" data-col="2"> &#124;    </td><td class="tbody tr-odd col col-odd" data-row="7" data-col="3"> <code class="koka">[</code> <span class="opt">[ <em class="em-low1">annexpr</em> <span class="many">{ <code class="koka">,</code> <em class="em-low1">annexprs</em> }</span> <span class="opt">[ <code class="koka">,</code> ]</span>  ]</span> <code class="koka">]</code>  </td><td class="tbody tr-odd col col-even col-last" data-row="7" data-col="4"> (list expression)            </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="8" data-col="1"> &#160;       </td><td class="tbody tr-even col col-even" data-row="8" data-col="2">          </td><td class="tbody tr-even col col-odd" data-row="8" data-col="3">                                                                </td><td class="tbody tr-even col col-even col-last" data-row="8" data-col="4">                              </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="9" data-col="1"> <em class="em-low1">literal</em>    </td><td class="tbody tr-odd col col-even" data-row="9" data-col="2"> ::=      </td><td class="tbody tr-odd col col-odd" data-row="9" data-col="3"> <em class="em-low1">natural</em> <span class="bar">|</span> <em class="em-low1">float</em> <span class="bar">|</span> <em class="em-low1">char</em> <span class="bar">|</span> <em class="em-low1">string</em>   </td><td class="tbody tr-odd col col-even col-last" data-row="9" data-col="4">                              </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="10" data-col="1"> &#160;       </td><td class="tbody tr-even col col-even" data-row="10" data-col="2">          </td><td class="tbody tr-even col col-odd" data-row="10" data-col="3">                                                                </td><td class="tbody tr-even col col-even col-last" data-row="10" data-col="4">                              </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="11" data-col="1"> <em class="em-low1">annexprs</em>   </td><td class="tbody tr-odd col col-even" data-row="11" data-col="2"> ::=      </td><td class="tbody tr-odd col col-odd" data-row="11" data-col="3"> <em class="em-low1">annexpr</em> <span class="many">{ <code class="koka">,</code> <em class="em-low1">annexpr</em> }</span>                               </td><td class="tbody tr-odd col col-even col-last" data-row="11" data-col="4">                              </td></tr>
<tr><td class="tbody tr-even tr-last col col-odd col-first" data-row="12" data-col="1"> <em class="em-low1">annexpr</em>    </td><td class="tbody tr-even tr-last col col-even" data-row="12" data-col="2"> ::=      </td><td class="tbody tr-even tr-last col col-odd" data-row="12" data-col="3"> <em class="em-low1">expr</em> <span class="opt">[ <code class="code code2">:</code> <em class="em-low1">typescheme</em> ]</span>                                </td><td class="tbody tr-even tr-last col col-even col-last" data-row="12" data-col="4">                              </td></tr></tbody></table><h3 id="sec-matching" class="h3" data-heading-depth="3" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-matching" class="entity-anchor localref">&#x1F517;</a><a href="#sec-matching" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">3.3.9</span>.&#8194;</span>Matching</h3><table class="grammar parse madoko block">
<tbody><tr><td class="tbody tr-odd tr-first col col-odd col-first" data-row="1" data-col="1"> <em class="em-low1">matchrule</em> </td><td class="tbody tr-odd tr-first col col-even" data-row="1" data-col="2"> ::=   </td><td class="tbody tr-odd tr-first col col-odd" data-row="1" data-col="3"> <em class="em-low1">patterns</em> <code class="code code2"><span class="code-escaped">&#124;</span></code> <em class="em-low1">expr</em> <code class="koka"><span class="kw op">-&gt;</span></code> <em class="em-low1">blockexpr</em> </td><td class="tbody tr-odd tr-first col col-even col-last" data-row="1" data-col="4">                                              </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="2" data-col="1">             </td><td class="tbody tr-even col col-even" data-row="2" data-col="2"> &#124; </td><td class="tbody tr-even col col-odd" data-row="2" data-col="3"> <em class="em-low1">patterns</em> <em class="em-low1">bodyexpr</em>                                    </td><td class="tbody tr-even col col-even col-last" data-row="2" data-col="4">                                              </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="3" data-col="1"> &#160;      </td><td class="tbody tr-odd col col-even" data-row="3" data-col="2">       </td><td class="tbody tr-odd col col-odd" data-row="3" data-col="3">                                                          </td><td class="tbody tr-odd col col-even col-last" data-row="3" data-col="4">                                              </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="4" data-col="1"> <em class="em-low1">apattern</em>  </td><td class="tbody tr-even col col-even" data-row="4" data-col="2"> ::=   </td><td class="tbody tr-even col col-odd" data-row="4" data-col="3"> <em class="em-low1">pattern</em> <span class="opt">[ <code class="koka"></code> <em class="em-low1">typescheme</em> ]</span>                       </td><td class="tbody tr-even col col-even col-last" data-row="4" data-col="4">                                              </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="5" data-col="1"> <em class="em-low1">pattern</em>   </td><td class="tbody tr-odd col col-even" data-row="5" data-col="2"> ::=   </td><td class="tbody tr-odd col col-odd" data-row="5" data-col="3"> <em class="em-low1">identifier</em>                                             </td><td class="tbody tr-odd col col-even col-last" data-row="5" data-col="4">                                              </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="6" data-col="1">             </td><td class="tbody tr-even col col-even" data-row="6" data-col="2"> &#124; </td><td class="tbody tr-even col col-odd" data-row="6" data-col="3"> <em class="em-low1">wildcard</em>                                               </td><td class="tbody tr-even col col-even col-last" data-row="6" data-col="4">                                              </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="7" data-col="1">             </td><td class="tbody tr-odd col col-even" data-row="7" data-col="2"> &#124; </td><td class="tbody tr-odd col col-odd" data-row="7" data-col="3"> <em class="em-low1">qconstructor</em> [<em class="em-low1">lparen</em> <span class="opt">[ <em class="em-low1">patargs</em> ]</span> <code class="koka">)</code>]          </td><td class="tbody tr-odd col col-even col-last" data-row="7" data-col="4">                                              </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="8" data-col="1">             </td><td class="tbody tr-even col col-even" data-row="8" data-col="2"> &#124; </td><td class="tbody tr-even col col-odd" data-row="8" data-col="3"> <code class="koka">(</code> <span class="opt">[ <em class="em-low1">apatterns</em> ]</span> <code class="koka">)</code>                              </td><td class="tbody tr-even col col-even col-last" data-row="8" data-col="4"> (unit, parenthesized pattern, tuple pattern) </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="9" data-col="1">             </td><td class="tbody tr-odd col col-even" data-row="9" data-col="2"> &#124; </td><td class="tbody tr-odd col col-odd" data-row="9" data-col="3"> <code class="koka">[</code> <span class="opt">[ <em class="em-low1">apatterns</em> ]</span> <code class="koka">]</code>                              </td><td class="tbody tr-odd col col-even col-last" data-row="9" data-col="4"> (list pattern)                               </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="10" data-col="1">             </td><td class="tbody tr-even col col-even" data-row="10" data-col="2"> &#124; </td><td class="tbody tr-even col col-odd" data-row="10" data-col="3"> <em class="em-low1">apattern</em> <code class="koka"><span class="kw">as</span></code> <em class="em-low1">identifier</em>                             </td><td class="tbody tr-even col col-even col-last" data-row="10" data-col="4"> (named pattern)                              </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="11" data-col="1">             </td><td class="tbody tr-odd col col-even" data-row="11" data-col="2"> &#124; </td><td class="tbody tr-odd col col-odd" data-row="11" data-col="3"> <em class="em-low1">literal</em>                                                </td><td class="tbody tr-odd col col-even col-last" data-row="11" data-col="4">                                              </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="12" data-col="1"> &#160;      </td><td class="tbody tr-even col col-even" data-row="12" data-col="2">       </td><td class="tbody tr-even col col-odd" data-row="12" data-col="3">                                                          </td><td class="tbody tr-even col col-even col-last" data-row="12" data-col="4">                                              </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="13" data-col="1"> <em class="em-low1">patterns</em>  </td><td class="tbody tr-odd col col-even" data-row="13" data-col="2"> ::=   </td><td class="tbody tr-odd col col-odd" data-row="13" data-col="3"> <em class="em-low1">pattern</em> <span class="many">{ <code class="koka">,</code> <em class="em-low1">pattern</em> }</span>                         </td><td class="tbody tr-odd col col-even col-last" data-row="13" data-col="4">                                              </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="14" data-col="1"> <em class="em-low1">apatterns</em> </td><td class="tbody tr-even col col-even" data-row="14" data-col="2"> ::=   </td><td class="tbody tr-even col col-odd" data-row="14" data-col="3"> <em class="em-low1">apattern</em> <span class="many">{ <code class="koka">,</code> <em class="em-low1">apattern</em> }</span>                       </td><td class="tbody tr-even col col-even col-last" data-row="14" data-col="4">                                              </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="15" data-col="1"> <em class="em-low1">patargs</em>   </td><td class="tbody tr-odd col col-even" data-row="15" data-col="2"> ::=   </td><td class="tbody tr-odd col col-odd" data-row="15" data-col="3"> <em class="em-low1">patarg</em> <span class="many">{ <code class="koka">,</code> <em class="em-low1">patarg</em> }</span>                           </td><td class="tbody tr-odd col col-even col-last" data-row="15" data-col="4">                                              </td></tr>
<tr><td class="tbody tr-even tr-last col col-odd col-first" data-row="16" data-col="1"> <em class="em-low1">patarg</em>    </td><td class="tbody tr-even tr-last col col-even" data-row="16" data-col="2"> ::=   </td><td class="tbody tr-even tr-last col col-odd" data-row="16" data-col="3"> <span class="opt">[ <em class="em-low1">identifier</em> <code class="koka"><span class="kw">=</span></code> ]</span> <em class="em-low1">apattern</em>                      </td><td class="tbody tr-even tr-last col col-even col-last" data-row="16" data-col="4"> (possibly named parameter)                   </td></tr></tbody></table><h3 id="sec-handlers" class="h3" data-heading-depth="3" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-handlers" class="entity-anchor localref">&#x1F517;</a><a href="#sec-handlers" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">3.3.10</span>.&#8194;</span>Handlers</h3><table class="grammar parse madoko block">
<tbody><tr><td class="tbody tr-odd tr-first col col-odd col-first" data-row="1" data-col="1"> <em class="em-low1">handlerrules</em> </td><td class="tbody tr-odd tr-first col col-even" data-row="1" data-col="2"> ::=   </td><td class="tbody tr-odd tr-first col col-odd" data-row="1" data-col="3"> <em class="em-low1">semis</em> <em class="em-low1">handlerrule</em> <span class="many">{ <em class="em-low1">semis</em> <em class="em-low1">handlerrule</em> }</span> semis     </td><td class="tbody tr-odd tr-first col col-even col-last" data-row="1" data-col="4">    </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="2" data-col="1"> <em class="em-low1">handlerrule</em>  </td><td class="tbody tr-even col col-even" data-row="2" data-col="2"> ::=   </td><td class="tbody tr-even col col-odd" data-row="2" data-col="3"> <em class="em-low1">qidentifier</em> <em class="em-low1">opargs</em> <em class="em-low1">bodyexpr</em>                              </td><td class="tbody tr-even col col-even col-last" data-row="2" data-col="4">    </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="3" data-col="1">                </td><td class="tbody tr-odd col col-even" data-row="3" data-col="2"> &#124; </td><td class="tbody tr-odd col col-odd" data-row="3" data-col="3"> <code class="koka"><span class="kw">return</span></code>  (<em class="em-low1">lparen</em> <em class="em-low1">oparg</em> <code class="koka">)</code> <span class="bar">|</span> <em class="em-low1">paramid</em>) <em class="em-low1">bodyexpr</em> </td><td class="tbody tr-odd col col-even col-last" data-row="3" data-col="4">    </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="4" data-col="1"> &#160;         </td><td class="tbody tr-even col col-even" data-row="4" data-col="2">       </td><td class="tbody tr-even col col-odd" data-row="4" data-col="3">                                                                </td><td class="tbody tr-even col col-even col-last" data-row="4" data-col="4">    </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="5" data-col="1"> <em class="em-low1">opargs</em>       </td><td class="tbody tr-odd col col-even" data-row="5" data-col="2"> &#124; </td><td class="tbody tr-odd col col-odd" data-row="5" data-col="3"> <em class="em-low1">lparen</em> <span class="opt">[ <em class="em-low1">oparg</em> <span class="many">{ <code class="koka">,</code> <em class="em-low1">oparg</em> }</span> ]</span> <code class="koka">)</code>              </td><td class="tbody tr-odd col col-even col-last" data-row="5" data-col="4">    </td></tr>
<tr><td class="tbody tr-even tr-last col col-odd col-first" data-row="6" data-col="1"> <em class="em-low1">oparg</em>        </td><td class="tbody tr-even tr-last col col-even" data-row="6" data-col="2"> &#124; </td><td class="tbody tr-even tr-last col col-odd" data-row="6" data-col="3"> <em class="em-low1">paramid</em> <span class="opt">[ <code class="code code2">:</code> <em class="em-low1">type</em> ]</span>                                 </td><td class="tbody tr-even tr-last col col-even col-last" data-row="6" data-col="4">    </td></tr></tbody></table><h3 id="sec-type-schemes" class="h3" data-heading-depth="3" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-type-schemes" class="entity-anchor localref">&#x1F517;</a><a href="#sec-type-schemes" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">3.3.11</span>.&#8194;</span>Type schemes</h3><table class="grammar parse madoko block">
<tbody><tr><td class="tbody tr-odd tr-first col col-odd col-first" data-row="1" data-col="1"> <em class="em-low1">typescheme</em>   </td><td class="tbody tr-odd tr-first col col-even" data-row="1" data-col="2"> ::= </td><td class="tbody tr-odd tr-first col col-odd" data-row="1" data-col="3"> <em class="em-low1">somes</em> <em class="em-low1">foralls</em> <em class="em-low1">tarrow</em> <span class="opt">[ <em class="em-low1">qualifier</em> ]</span>    </td><td class="tbody tr-odd tr-first col col-even" data-row="1" data-col="4">             </td><td class="tbody tr-odd tr-first col col-odd col-last" data-row="1" data-col="5">     </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="2" data-col="1"> <em class="em-low1">type</em>         </td><td class="tbody tr-even col col-even" data-row="2" data-col="2"> ::= </td><td class="tbody tr-even col col-odd" data-row="2" data-col="3"> <em class="em-low1">foralls</em> <em class="em-low1">tarrow</em> <span class="opt">[ <em class="em-low1">qualifier</em> ]</span>    </td><td class="tbody tr-even col col-even" data-row="2" data-col="4">             </td><td class="tbody tr-even col col-odd col-last" data-row="2" data-col="5">     </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="3" data-col="1"> &#160;         </td><td class="tbody tr-odd col col-even" data-row="3" data-col="2">     </td><td class="tbody tr-odd col col-odd" data-row="3" data-col="3">                                                       </td><td class="tbody tr-odd col col-even" data-row="3" data-col="4">             </td><td class="tbody tr-odd col col-odd col-last" data-row="3" data-col="5">     </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="4" data-col="1"> <em class="em-low1">foralls</em>      </td><td class="tbody tr-even col col-even" data-row="4" data-col="2"> ::= </td><td class="tbody tr-even col col-odd" data-row="4" data-col="3"> <span class="opt">[ <code class="koka"><span class="kw">forall</span></code> <em class="em-low1">typeparams</em> ]</span>           </td><td class="tbody tr-even col col-even" data-row="4" data-col="4">             </td><td class="tbody tr-even col col-odd col-last" data-row="4" data-col="5">     </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="5" data-col="1"> <em class="em-low1">some</em>         </td><td class="tbody tr-odd col col-even" data-row="5" data-col="2"> ::= </td><td class="tbody tr-odd col col-odd" data-row="5" data-col="3"> <span class="opt">[ <code class="koka"><span class="kw">some</span></code> <em class="em-low1">typeparams</em> ]</span>           </td><td class="tbody tr-odd col col-even" data-row="5" data-col="4">             </td><td class="tbody tr-odd col col-odd col-last" data-row="5" data-col="5">     </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="6" data-col="1"> &#160;         </td><td class="tbody tr-even col col-even" data-row="6" data-col="2">     </td><td class="tbody tr-even col col-odd" data-row="6" data-col="3">                                                       </td><td class="tbody tr-even col col-even" data-row="6" data-col="4">             </td><td class="tbody tr-even col col-odd col-last" data-row="6" data-col="5">     </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="7" data-col="1"> <em class="em-low1">qualifier</em>    </td><td class="tbody tr-odd col col-even" data-row="7" data-col="2"> ::= </td><td class="tbody tr-odd col col-odd" data-row="7" data-col="3"> <code class="koka"><span class="kw">with</span></code> <code class="koka">(</code> <em class="em-low1">predicates</em> <code class="koka">)</code>                           </td><td class="tbody tr-odd col col-even" data-row="7" data-col="4">             </td><td class="tbody tr-odd col col-odd col-last" data-row="7" data-col="5">     </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="8" data-col="1"> &#160;         </td><td class="tbody tr-even col col-even" data-row="8" data-col="2">     </td><td class="tbody tr-even col col-odd" data-row="8" data-col="3">                                                       </td><td class="tbody tr-even col col-even" data-row="8" data-col="4">             </td><td class="tbody tr-even col col-odd col-last" data-row="8" data-col="5">     </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="9" data-col="1"> <em class="em-low1">predicates</em>   </td><td class="tbody tr-odd col col-even" data-row="9" data-col="2"> ::= </td><td class="tbody tr-odd col col-odd" data-row="9" data-col="3"> <em class="em-low1">predicate</em> <span class="many">{ <code class="koka">,</code> <em class="em-low1">predicate</em> }</span>                  </td><td class="tbody tr-odd col col-even" data-row="9" data-col="4">             </td><td class="tbody tr-odd col col-odd col-last" data-row="9" data-col="5">     </td></tr>
<tr><td class="tbody tr-even tr-last col col-odd col-first" data-row="10" data-col="1"> <em class="em-low1">predicate</em>    </td><td class="tbody tr-even tr-last col col-even" data-row="10" data-col="2"> ::= </td><td class="tbody tr-even tr-last col col-odd" data-row="10" data-col="3"> <em class="em-low1">typeapp</em>                                             </td><td class="tbody tr-even tr-last col col-even" data-row="10" data-col="4"> (interface) </td><td class="tbody tr-even tr-last col col-odd col-last" data-row="10" data-col="5">     </td></tr></tbody></table><h3 id="sec-types" class="h3" data-heading-depth="3" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-types" class="entity-anchor localref">&#x1F517;</a><a href="#sec-types" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">3.3.12</span>.&#8194;</span>Types</h3><table class="grammar parse madoko block">
<tbody><tr><td class="tbody tr-odd tr-first col col-odd col-first" data-row="1" data-col="1"> <em class="em-low1">tarrow</em>  </td><td class="tbody tr-odd tr-first col col-even" data-row="1" data-col="2"> ::=    </td><td class="tbody tr-odd tr-first col col-odd" data-row="1" data-col="3"> <em class="em-low1">tatom</em> <span class="opt">[ <code class="koka"><span class="kw op">-&gt;</span></code> <em class="em-low1">tresult</em> ]</span>                                                 </td><td class="tbody tr-odd tr-first col col-even col-last" data-row="1" data-col="4">                                        </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="2" data-col="1"> <em class="em-low1">tresult</em> </td><td class="tbody tr-even col col-even" data-row="2" data-col="2"> ::=    </td><td class="tbody tr-even col col-odd" data-row="2" data-col="3"> <em class="em-low1">tatom</em> <span class="opt">[ <em class="em-low1">tbasic</em> ]</span>                                                       </td><td class="tbody tr-even col col-even col-last" data-row="2" data-col="4">                                        </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="3" data-col="1"> &#160;    </td><td class="tbody tr-odd col col-even" data-row="3" data-col="2">        </td><td class="tbody tr-odd col col-odd" data-row="3" data-col="3">                                                                                </td><td class="tbody tr-odd col col-even col-last" data-row="3" data-col="4">                                        </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="4" data-col="1"> <em class="em-low1">tatom</em>   </td><td class="tbody tr-even col col-even" data-row="4" data-col="2"> ::=    </td><td class="tbody tr-even col col-odd" data-row="4" data-col="3"> <em class="em-low1">tbasic</em>                                                                       </td><td class="tbody tr-even col col-even col-last" data-row="4" data-col="4">                                        </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="5" data-col="1">           </td><td class="tbody tr-odd col col-even" data-row="5" data-col="2"> &#124;  </td><td class="tbody tr-odd col col-odd" data-row="5" data-col="3"> <code class="koka"><span class="op">&#60;</span></code> <em class="em-low1">anntype</em> <span class="many">{ <code class="koka">,</code> <em class="em-low1">anntype</em> }</span> <span class="opt">[ <code class="code code2"><span class="code-escaped">&#124;</span></code> <em class="em-low1">tatom</em> ]</span> <code class="koka"><span class="op">&#62;</span></code> </td><td class="tbody tr-odd col col-even col-last" data-row="5" data-col="4">                                        </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="6" data-col="1">           </td><td class="tbody tr-even col col-even" data-row="6" data-col="2"> &#124;  </td><td class="tbody tr-even col col-odd" data-row="6" data-col="3"> <code class="koka"><span class="op">&#60;</span></code> <code class="koka"><span class="op">&#62;</span></code>                                                                        </td><td class="tbody tr-even col col-even col-last" data-row="6" data-col="4">                                        </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="7" data-col="1"> &#160;    </td><td class="tbody tr-odd col col-even" data-row="7" data-col="2">        </td><td class="tbody tr-odd col col-odd" data-row="7" data-col="3">                                                                                </td><td class="tbody tr-odd col col-even col-last" data-row="7" data-col="4">                                        </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="8" data-col="1"> <em class="em-low1">tbasic</em>  </td><td class="tbody tr-even col col-even" data-row="8" data-col="2"> ::=    </td><td class="tbody tr-even col col-odd" data-row="8" data-col="3"> <em class="em-low1">typeapp</em>                                                                      </td><td class="tbody tr-even col col-even col-last" data-row="8" data-col="4">                                        </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="9" data-col="1">           </td><td class="tbody tr-odd col col-even" data-row="9" data-col="2"> &#124;  </td><td class="tbody tr-odd col col-odd" data-row="9" data-col="3"> <code class="koka">(</code> <code class="koka">)</code>                                                                        </td><td class="tbody tr-odd col col-even col-last" data-row="9" data-col="4"> (unit type)                            </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="10" data-col="1">           </td><td class="tbody tr-even col col-even" data-row="10" data-col="2"> &#124;  </td><td class="tbody tr-even col col-odd" data-row="10" data-col="3"> <code class="koka">(</code> <em class="em-low1">tparam</em> <code class="koka">)</code>                                                               </td><td class="tbody tr-even col col-even col-last" data-row="10" data-col="4"> (parenthesized type or type parameter) </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="11" data-col="1">           </td><td class="tbody tr-odd col col-even" data-row="11" data-col="2"> &#124;  </td><td class="tbody tr-odd col col-odd" data-row="11" data-col="3"> <code class="koka">(</code> <em class="em-low1">tparam</em> <span class="many">{ <code class="koka">,</code> <em class="em-low1">tparam</em> }</span> <code class="koka">)</code>                                         </td><td class="tbody tr-odd col col-even col-last" data-row="11" data-col="4"> (tuple type or parameters)             </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="12" data-col="1">           </td><td class="tbody tr-even col col-even" data-row="12" data-col="2"> &#124;  </td><td class="tbody tr-even col col-odd" data-row="12" data-col="3"> <code class="koka">[</code> <em class="em-low1">anntype</em> <code class="koka">]</code>                                                              </td><td class="tbody tr-even col col-even col-last" data-row="12" data-col="4"> (list type)                            </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="13" data-col="1"> &#160;    </td><td class="tbody tr-odd col col-even" data-row="13" data-col="2">        </td><td class="tbody tr-odd col col-odd" data-row="13" data-col="3">                                                                                </td><td class="tbody tr-odd col col-even col-last" data-row="13" data-col="4">                                        </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="14" data-col="1"> <em class="em-low1">typeapp</em> </td><td class="tbody tr-even col col-even" data-row="14" data-col="2"> ::=    </td><td class="tbody tr-even col col-odd" data-row="14" data-col="3"> <em class="em-low1">typecon</em> <span class="opt">[ <code class="koka"><span class="op">&#60;</span></code> <em class="em-low1">anntype</em> <span class="many">{ <code class="koka">,</code> <em class="em-low1">anntype</em> }</span> <code class="koka"><span class="op">&#62;</span></code> ]</span>                     </td><td class="tbody tr-even col col-even col-last" data-row="14" data-col="4">                                        </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="15" data-col="1"> &#160;    </td><td class="tbody tr-odd col col-even" data-row="15" data-col="2">        </td><td class="tbody tr-odd col col-odd" data-row="15" data-col="3">                                                                                </td><td class="tbody tr-odd col col-even col-last" data-row="15" data-col="4">                                        </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="16" data-col="1"> <em class="em-low1">typecon</em> </td><td class="tbody tr-even col col-even" data-row="16" data-col="2"> ::=    </td><td class="tbody tr-even col col-odd" data-row="16" data-col="3"> <em class="em-low1">varid</em> <span class="bar">|</span> <em class="em-low1">qvarid</em>                                                      </td><td class="tbody tr-even col col-even col-last" data-row="16" data-col="4">                                        </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="17" data-col="1">           </td><td class="tbody tr-odd col col-even" data-row="17" data-col="2"> &#124;  </td><td class="tbody tr-odd col col-odd" data-row="17" data-col="3"> <em class="em-low1">wildcard</em>                                                                     </td><td class="tbody tr-odd col col-even col-last" data-row="17" data-col="4">                                        </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="18" data-col="1">           </td><td class="tbody tr-even col col-even" data-row="18" data-col="2"> &#124;  </td><td class="tbody tr-even col col-odd" data-row="18" data-col="3"> <code class="koka">(</code> <code class="koka">,</code> <span class="many">{ <code class="koka">,</code> }</span> <code class="koka">)</code>                                                       </td><td class="tbody tr-even col col-even col-last" data-row="18" data-col="4"> (tuple constructor)                    </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="19" data-col="1">           </td><td class="tbody tr-odd col col-even" data-row="19" data-col="2"> &#124;  </td><td class="tbody tr-odd col col-odd" data-row="19" data-col="3"> <code class="koka">[</code> <code class="koka">]</code>                                                                        </td><td class="tbody tr-odd col col-even col-last" data-row="19" data-col="4"> (list constructor)                     </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="20" data-col="1">           </td><td class="tbody tr-even col col-even" data-row="20" data-col="2"> &#124;  </td><td class="tbody tr-even col col-odd" data-row="20" data-col="3"> <code class="koka">(</code> <code class="koka"><span class="kw op">-&gt;</span></code> <code class="koka">)</code>                                                                   </td><td class="tbody tr-even col col-even col-last" data-row="20" data-col="4"> (function constructor)                 </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="21" data-col="1"> &#160;    </td><td class="tbody tr-odd col col-even" data-row="21" data-col="2">        </td><td class="tbody tr-odd col col-odd" data-row="21" data-col="3">                                                                                </td><td class="tbody tr-odd col col-even col-last" data-row="21" data-col="4">                                        </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="22" data-col="1"> <em class="em-low1">tparam</em>  </td><td class="tbody tr-even col col-even" data-row="22" data-col="2"> ::=    </td><td class="tbody tr-even col col-odd" data-row="22" data-col="3"> <span class="opt">[ <em class="em-low1">varid</em> <code class="code code2">:</code> ]</span> <em class="em-low1">anntype</em>                                                  </td><td class="tbody tr-even col col-even col-last" data-row="22" data-col="4">                                        </td></tr>
<tr><td class="tbody tr-odd tr-last col col-odd col-first" data-row="23" data-col="1"> <em class="em-low1">anntype</em> </td><td class="tbody tr-odd tr-last col col-even" data-row="23" data-col="2"> ::=    </td><td class="tbody tr-odd tr-last col col-odd" data-row="23" data-col="3"> <em class="em-low1">type</em> <span class="opt">[ <em class="em-low1">kannot</em> ]</span>                                                        </td><td class="tbody tr-odd tr-last col col-even col-last" data-row="23" data-col="4">                                        </td></tr></tbody></table><h3 id="sec-kinds" class="h3" data-heading-depth="3" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-kinds" class="entity-anchor localref">&#x1F517;</a><a href="#sec-kinds" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">3.3.13</span>.&#8194;</span>Kinds</h3><table class="grammar parse madoko block">
<tbody><tr><td class="tbody tr-odd tr-first col col-odd col-first" data-row="1" data-col="1"> <em class="em-low1">kannot</em> </td><td class="tbody tr-odd tr-first col col-even" data-row="1" data-col="2"> ::=    </td><td class="tbody tr-odd tr-first col col-odd" data-row="1" data-col="3"> <code class="code code2">::</code> <em class="em-low1">kind</em>                                    </td><td class="tbody tr-odd tr-first col col-even col-last" data-row="1" data-col="4">                  </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="2" data-col="1"> &#160;   </td><td class="tbody tr-even col col-even" data-row="2" data-col="2">        </td><td class="tbody tr-even col col-odd" data-row="2" data-col="3">                                                </td><td class="tbody tr-even col col-even col-last" data-row="2" data-col="4">                  </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="3" data-col="1"> <em class="em-low1">kind</em>   </td><td class="tbody tr-odd col col-even" data-row="3" data-col="2"> ::=    </td><td class="tbody tr-odd col col-odd" data-row="3" data-col="3"> <code class="koka">(</code> <em class="em-low1">kind</em> <span class="many">{ <code class="koka">,</code> <em class="em-low1">kind</em> }</span> <code class="koka">)</code> <code class="koka"><span class="kw op">-&gt;</span></code> <em class="em-low1">kind</em> </td><td class="tbody tr-odd col col-even col-last" data-row="3" data-col="4">                  </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="4" data-col="1">          </td><td class="tbody tr-even col col-even" data-row="4" data-col="2"> &#124;  </td><td class="tbody tr-even col col-odd" data-row="4" data-col="3"> <em class="em-low1">katom</em> <code class="koka"><span class="kw op">-&gt;</span></code> <em class="em-low1">kind</em>                            </td><td class="tbody tr-even col col-even col-last" data-row="4" data-col="4">                  </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="5" data-col="1">          </td><td class="tbody tr-odd col col-even" data-row="5" data-col="2"> &#124;  </td><td class="tbody tr-odd col col-odd" data-row="5" data-col="3"> <em class="em-low1">katom</em>                                        </td><td class="tbody tr-odd col col-even col-last" data-row="5" data-col="4">                  </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="6" data-col="1"> &#160;   </td><td class="tbody tr-even col col-even" data-row="6" data-col="2">        </td><td class="tbody tr-even col col-odd" data-row="6" data-col="3">                                                </td><td class="tbody tr-even col col-even col-last" data-row="6" data-col="4">                  </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="7" data-col="1"> <em class="em-low1">katom</em>  </td><td class="tbody tr-odd col col-even" data-row="7" data-col="2"> ::=    </td><td class="tbody tr-odd col col-odd" data-row="7" data-col="3"> <code class="koka"><span class="co">V</span></code>                                            </td><td class="tbody tr-odd col col-even col-last" data-row="7" data-col="4"> (value type)     </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="8" data-col="1">          </td><td class="tbody tr-even col col-even" data-row="8" data-col="2"> &#124;  </td><td class="tbody tr-even col col-odd" data-row="8" data-col="3"> <code class="koka"><span class="co">X</span></code>                                            </td><td class="tbody tr-even col col-even col-last" data-row="8" data-col="4"> (effect type)    </td></tr>
<tr><td class="tbody tr-odd col col-odd col-first" data-row="9" data-col="1">          </td><td class="tbody tr-odd col col-even" data-row="9" data-col="2"> &#124;  </td><td class="tbody tr-odd col col-odd" data-row="9" data-col="3"> <code class="koka"><span class="co">E</span></code>                                            </td><td class="tbody tr-odd col col-even col-last" data-row="9" data-col="4"> (effect row)     </td></tr>
<tr><td class="tbody tr-even col col-odd col-first" data-row="10" data-col="1">          </td><td class="tbody tr-even col col-even" data-row="10" data-col="2"> &#124;  </td><td class="tbody tr-even col col-odd" data-row="10" data-col="3"> <code class="koka"><span class="co">H</span></code>                                            </td><td class="tbody tr-even col col-even col-last" data-row="10" data-col="4"> (heap type)      </td></tr>
<tr><td class="tbody tr-odd tr-last col col-odd col-first" data-row="11" data-col="1">          </td><td class="tbody tr-odd tr-last col col-even" data-row="11" data-col="2"> &#124;  </td><td class="tbody tr-odd tr-last col col-odd" data-row="11" data-col="3"> <code class="koka"><span class="co">P</span></code>                                            </td><td class="tbody tr-odd tr-last col col-even col-last" data-row="11" data-col="4"> (predicate type) </td></tr></tbody></table><h3 id="sec-implementation" class="h3" data-heading-depth="3" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-implementation" class="entity-anchor localref">&#x1F517;</a><a href="#sec-implementation" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">3.3.14</span>.&#8194;</span>Implementation</h3>
<p class="p noindent">As a companion to the Flex lexical implementation, there is a full 
Bison(Yacc) LALR(1)&nbsp;<a href="https://koka.codeplex.com/SourceControl/latest#doc/spec/grammar/parser.y" data-linkid="bisongrammar">implementation</a> 
available. Again, the Bison parser functions
as <em class="em-low1">the</em> specification of the grammar and this document should always
be in agreement with that implementation.
</p>
<div class="bibl" style="bbl-file:./kokaspec-bib.bbl.mdk"><h1 id="sec-references" class="clearnum h1 heading-references" data-heading-depth="1" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif">References</h1>
<div class="bibliography bib-numeric" data-hanging-indent="0" data-cite-style="numeric:&#39;[&#39;,&#39;]&#39;,&#39;, &#39;" data-style="madoko-numeric" style="bibstyle:madoko-numeric">
<div id="lindley:liberate" class="bibitem" data-cite-year="2016" data-cite-authors="Hillerstrm and Lindley" data-cite-authors-long="Hillerstrm and Lindley" data-cite-label="1" data-line="koka.bib:16" style="text-indent:-2rem;margin-left:2rem;searchterm:Liberating%20Effects%20with%20Rows%20and%20Handlers%20Hillerstr%C3%B6m%20and%20Lindley%2C%202016;spellcheck:false;bibitem-label:\5C [1\5C ]"><span class="bibitem-before" style="padding-right:0.5em;display: inline-block; width:calc(2rem - 0.5em);display: inline-block; text-align:right;font-size:90%">[1]</span>Daniel Hillerstrm, and Sam Lindley. &#8220;Liberating Effects with Rows and Handlers.&#8221; In <em class="em-low1">Proceedings of the 1st International Workshop on Type-Driven Development</em>, 1527. TyDe 2016. Nara, Japan. 2016. doi:<a href="https://dx.doi.org/10.1145/2976022.2976033" class="bib-doi" style="font-size:smaller">10.1145/2976022.2976033</a>.&nbsp;<a href="http://www.bing.com/search?q=Liberating%20Effects%20with%20Rows%20and%20Handlers%20Hillerstr%C3%B6m%20and%20Lindley%2C%202016" class="bibsearch">&#128270;</a></div>
<div id="leijen:msfp" class="bibitem" data-cite-year="2014" data-cite-authors="Leijen" data-cite-authors-long="Leijen" data-cite-label="2" data-line="koka.bib:29" style="text-indent:-2rem;margin-left:2rem;searchterm:Koka%3A%20Programming%20with%20Row%20Polymorphic%20Effect%20Types%20Leijen%2C%202014;spellcheck:false;bibitem-label:\5C [2\5C ]"><span class="bibitem-before" style="padding-right:0.5em;display: inline-block; width:calc(2rem - 0.5em);display: inline-block; text-align:right;font-size:90%">[2]</span>Daan Leijen. &#8220;Koka: Programming with Row Polymorphic Effect Types.&#8221; In <em class="em-low1">Mathematically Structured Functional Programming 2014</em>. EPTCS.&#160;Mar. 2014. <span class="bib-urlpre"><span class="etype">arXiv:</span></span><a href="http://arxiv.org/abs/1406.2061" class="bib-url">1406.2061</a>.&nbsp;<a href="http://www.bing.com/search?q=Koka%3A%20Programming%20with%20Row%20Polymorphic%20Effect%20Types%20Leijen%2C%202014" class="bibsearch">&#128270;</a></div>
<div id="leijen:algeff" class="bibitem" data-cite-year="2016" data-cite-authors="Leijen" data-cite-authors-long="Leijen" data-cite-label="3" data-line="koka.bib:40" style="text-indent:-2rem;margin-left:2rem;searchterm:Algebraic%20Effects%20for%20Functional%20Programming%20Leijen%2C%202016;spellcheck:false;bibitem-label:\5C [3\5C ]"><span class="bibitem-before" style="padding-right:0.5em;display: inline-block; width:calc(2rem - 0.5em);display: inline-block; text-align:right;font-size:90%">[3]</span>Daan Leijen. <em class="em-low1">Algebraic Effects for Functional Programming</em>. MSR-TR-2016-29. Microsoft Research. Aug. 2016. <a href="https://www.microsoft.com/en-us/research/publication/algebraic-effects-for-functional-programming" class="bib-url texturl monospace">https://&#8203;www.&#8203;microsoft.&#8203;com/&#8203;en-&#8203;us/&#8203;research/&#8203;publication/&#8203;algebraic-&#8203;effects-&#8203;for-&#8203;functional-&#8203;programming</a>. Extended version of&nbsp;<span class="citations" style="target-element:bibitem">[<a href="#leijen:algeffpopl" title="Type Directed Compilation of Row-Typed Algebraic Effects
Leijen, 2017" class="bibref localref" style="target-element:bibitem"><span class="cite-number">4</span></a>]</span>.&nbsp;<a href="http://www.bing.com/search?q=Algebraic%20Effects%20for%20Functional%20Programming%20Leijen%2C%202016" class="bibsearch">&#128270;</a></div>
<div id="leijen:algeffpopl" class="bibitem" data-cite-year="2017" data-cite-authors="Leijen" data-cite-authors-long="Leijen" data-cite-label="4" data-line="koka.bib:51" style="text-indent:-2rem;margin-left:2rem;searchterm:Type%20Directed%20Compilation%20of%20RowTyped%20Algebraic%20Effects%20Leijen%2C%202017;spellcheck:false;bibitem-label:\5C [4\5C ]"><span class="bibitem-before" style="padding-right:0.5em;display: inline-block; width:calc(2rem - 0.5em);display: inline-block; text-align:right;font-size:90%">[4]</span>Daan Leijen. &#8220;Type Directed Compilation of Row-Typed Algebraic Effects.&#8221; In <em class="em-low1">Proceedings of Principles of Programming Languages (POPL17)</em>. Paris, France. Jan. 2017.&nbsp;<a href="http://www.bing.com/search?q=Type%20Directed%20Compilation%20of%20RowTyped%20Algebraic%20Effects%20Leijen%2C%202017" class="bibsearch">&#128270;</a></div>
<div id="wu:hscope" class="bibitem" data-cite-year="2014" data-cite-authors="Wu et al." data-cite-authors-long="Wu, Schrijvers, and Hinze" data-cite-label="5" data-line="koka.bib:1" style="text-indent:-2rem;margin-left:2rem;searchterm:Effect%20Handlers%20in%20Scope%20Wu%2C%20Schrijvers%2C%20and%20Hinze%2C%202014;spellcheck:false;bibitem-label:\5C [5\5C ]"><span class="bibitem-before" style="padding-right:0.5em;display: inline-block; width:calc(2rem - 0.5em);display: inline-block; text-align:right;font-size:90%">[5]</span>Nicolas Wu, Tom Schrijvers, and Ralf Hinze. &#8220;Effect Handlers in Scope.&#8221; In <em class="em-low1">Proceedings of the 2014 ACM SIGPLAN Symposium on Haskell</em>, 112. Haskell 14. ACM, New York, NY, USA.&#160;2014. doi:<a href="https://dx.doi.org/10.1145/2633357.2633358" class="bib-doi" style="font-size:smaller">10.1145/2633357.2633358</a>.&nbsp;<a href="http://www.bing.com/search?q=Effect%20Handlers%20in%20Scope%20Wu%2C%20Schrijvers%2C%20and%20Hinze%2C%202014" class="bibsearch">&#128270;</a></div></div></div><h1 id="sec-appendix" class="clearnum h1" data-heading-depth="1" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif">Appendix</h1><h1 id="sec-full-grammar-specification" class="h1" data-heading-depth="1" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec-full-grammar-specification" class="entity-anchor localref">&#x1F517;</a><a href="#sec-full-grammar-specification" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">A</span>.&#8194;</span>Full grammar specification</h1><h2 id="sec:full-lexical" class="h2" data-heading-depth="2" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec:full-lexical" class="entity-anchor localref">&#x1F517;</a><a href="#sec:full-lexical" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">A.1</span>.&#8194;</span>Lexical syntax</h2>
<div id="full-lexical" class="div"></div><h2 id="sec:full-grammar" class="h2" data-heading-depth="2" style="display:block;font-family:&#39;Noto Sans&#39;, &#39;Segoe UI&#39;, sans-serif"><a href="#sec:full-grammar" class="entity-anchor localref">&#x1F517;</a><a href="#sec:full-grammar" class="entity-anchor localref">#</a><span class="heading-before"><span class="heading-label">A.2</span>.&#8194;</span>Context-free syntax</h2>
<div id="full-grammar" class="div"></div></div><span data-line=""></span></div>
</body>
<script type="text/javascript">
  // ---------------------------------------------
      // Classname helpers
      // ---------------------------------------------
      function hasClassName(elem,cname) {
        if (elem==null) return false;
        var regex = new RegExp("\\s*\\b" + cname + "\\b","g");
        return regex.test(elem.className);
      }
      
      function removeClassName(elem,cname) {
        var regex = new RegExp("\\s*\\b" + cname + "\\b","g");
        elem.className = elem.className.replace( regex, "" );
      }
      
      function addClassName(elem,cname) {
        if (!hasClassName(elem,cname)) elem.className = elem.className + " " + cname;
      }
      
      function toggleClassName(elem,cname) {
        var regex = new RegExp("\\s*\\b" + cname + "\\b","g");
        var classes = elem.className;
        if (regex.test(classes)) {
          elem.className = classes.replace( regex, "" );
          return false;
        }
        else {
          elem.className = classes + " " + cname;
          return true;
        }
      }
      
      // ---------------------------------------------
      // Reliable offset determination
      // ---------------------------------------------
      
      function getWindowOffset(elem) {
        var box;
        if (elem.getBoundingClientRect) {
          box = elem.getBoundingClientRect();
        }
        else if (elem.offsetParent && elem.offsetParent.getBoundingClientRect) {
          // text node
          box = elem.offsetParent.getBoundingClientRect();
          box.top = box.top + elem.offsetTop;
          box.left = box.left + elem.offsetLeft;
        }
        else {
          box = { top: 0, left : 0 };
        }
        return box;
      }
      
      // Return the viewport position: -1 (before), 0 (visible), 1 (after)
      function viewportPosition(elem) {
        var pos = getWindowOffset(elem)
        if (pos.top < 0 || pos.left < 0) 
          return -1;
        else if (pos.top > (window.innerHeight || document.documentElement.clientHeight) ||
                 pos.left > (window.innerWidth || document.documentElement.clientWidth)) 
          return 1;
        else 
          return 0;
      }
      
      // ---------------------------------------------
      // Expand the toc sections and align headers with the toc.
      // ---------------------------------------------
      
      var side = document.getElementsByClassName("sidepanel")[0];
      var afterScroll = null;
      
      // Align a heading at the top of the page with the toc
      function alignHeading( elem ) {
        var ofs     = getWindowOffset(elem).top;
        var sideofs = getWindowOffset(side).top;
        if (ofs >= 0 && ofs < sideofs) {
          window.scrollBy(0, ofs - sideofs);
        } 
      }
      
      // Expand, or unexpand, one toc item
      // The class is 'auto-expands' or 'click-expands'; the latter is sticky
      // as it is user induced and will not be automatically unexpanded.
      function itemExpand(item,cls,expand) {
        // get possible toc block (that follows the item)
        var tocblock = item.nextElementSibling;
        if (tocblock==null || !hasClassName(tocblock,"tocblock")) return;
       
        // set expand class
        if (expand===undefined) expand = !hasClassName(tocblock,"expands");
        if (cls===undefined) cls = "auto-expands" 
        if (cls==="click-expands") removeClassName(tocblock,"auto-expands");
        if (expand && !hasClassName(tocblock,cls)) {
          toggleClassName(tocblock,cls); 
        }
        else if (!expand && hasClassName(tocblock,cls)) {
          toggleClassName(tocblock,cls);
          item.firstElementChild.className = "unexpanded";
        }
        
        // set expansion icon
        if (hasClassName(tocblock,"auto-expands") || hasClassName(tocblock,"click-expands")) {
          item.firstElementChild.className = "expanded";   
        }
        else {
          item.firstElementChild.className = "unexpanded";
        }
      }
      
      // Expand a single item in the toc (and unexpand others).
      function itemExpandOne(item) {
        // unexpand anything that was expanded
        [].forEach.call( document.querySelectorAll(".tocitem"), function(item) {
          removeClassName(item,"current");
          itemExpand(item,"auto-expands",false);      
        });
        addClassName(item,"current");
        // expand the chain of parent blocks
        var tocblock = null;
        var toc = item.nextElementSibling;
        if (toc && hasClassName(toc,"tocblock")) { 
          tocblock = toc;
        }
        else {
          tocblock = item.parentElement;
        }
        while(tocblock != null && !hasClassName(tocblock,"toc")) {
          if (hasClassName(tocblock,"tocblock")) {
            item = tocblock.previousElementSibling;
            if (item != null) itemExpand(item,"auto-expands",true);
          }
          tocblock = tocblock.parentElement;
        }
      }
      
      // Auto expand the toc at current  position in the document 
      function expandToc() {
        // find the first section heading that is visible in the viewport 
        var current = null;
        [].every.call( document.querySelectorAll(".tocitem"), function(item) {
          var target = document.getElementById( item.getAttribute("data-toc-target") );
          var pos = viewportPosition(target);
          if (pos <= 0) current = item;
          return (pos < 0);
        });
        // if found, expand the corresponding item
        if (current != null) itemExpandOne(current);
      }
      
      document.addEventListener("load", function(ev) { expandToc(); });
      document.addEventListener("resize", function(ev) { expandToc(); });
      
      // fire at end of scrolling
      var scrollHandler = null;
      document.addEventListener("scroll", function(ev) {
        if (scrollHandler) clearTimeout(scrollHandler);
        scrollHandler = setTimeout( function() {
          scrollHandler = null;
          if (afterScroll) {
            afterScroll();
            afterScroll = null;
          }
          else {
            expandToc();
          }
        }, 50 );
      });
      
      // ---------------------------------------------
      // Install event handlers for all items in the TOC
      // ---------------------------------------------
      [].forEach.call( document.querySelectorAll(".tocitem"), function(item) {
        // only for toc items with a target
        var target = document.getElementById( item.getAttribute("data-toc-target") );
        if (!target) return;
        
        // ensure every tocblock has a expansion icon in front
        // (the optional nested tocblock follows the item)
        var tocblock = null;
        var toc = item.nextElementSibling;  
        if (toc && hasClassName(toc,"tocblock")) { 
          tocblock = toc;
          item.innerHTML = "<span class='unexpanded'></span>" + item.innerHTML;   
        } 
        
        // on a click
        item.addEventListener( "click", function() {
          // expand this toc item and set expansion icon
          itemExpand(item,"click-expands");
          // after navigation, align the heading with the toc
          afterScroll = (function() {
            alignHeading(target);
          });    
        }); 
      });
</script>

</html>
